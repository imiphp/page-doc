var originSearchDatas = [{"id":184,"title":"\u65ad\u70b9\u8c03\u8bd5","pageTitle":"\u65ad\u70b9\u8c03\u8bd5","url":"adv\/debug.html","content":"\u65ad\u70b9\u8c03\u8bd5Swoole \u5f00\u53d1\u7ec4\u6210\u5458 @codinghuang \u5f00\u53d1\u4e86\u4e00\u4e2a\u65b0\u7684\u8c03\u8bd5\u6269\u5c55\uff0c\u540d\u4e3a Yasd \uff0c\u53e6\u4e00\u4e2a Swoole \u8c03\u8bd5\u5668\u3002\u4f17\u6240\u5468\u77e5\uff0cxdebug \u539f\u751f\u5bf9 Swoole \u5e76\u4e0d\u517c\u5bb9\uff0c\u5e76\u4e14\u4ee3\u7801\u96be\u4ee5\u7ef4\u62a4\uff0c\u6240\u4ee5\u624d\u6709\u4e86 Yasd\uff01Yasd \u5b8c\u5168\u517c\u5bb9 xdebug \u534f\u8bae\uff0c\u4f60\u53ef\u4ee5\u5728\u4efb\u4f55\u652f\u6301 xdebug \u7684 IDE \u4e2d\u4ee5\u540c\u6837\u7684\u65b9\u5f0f\u4f7f\u7528 Yasd \u8fdb\u884c\u5355\u6b65\u8c03\u8bd5\u3002Yasd \u5730\u5740\uff1ahttps:\/\/github.com\/swoole\/yasd"},{"id":186,"title":"\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1","pageTitle":"\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1","url":"adv\/devp.html","content":"\u53c2\u4e0e\u6846\u67b6\u5f00\u53d1\u4ed3\u5e93Github\uff1ahttps:\/\/github.com\/imiphp\/imi\u76ee\u5f55\u7ed3\u6784\u251c\u2500\u2500 bin         \/\/ \u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84\n\u251c\u2500\u2500 config      \/\/ \u6846\u67b6\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\n\u251c\u2500\u2500 doc         \/\/ \u6587\u6863 markdown \u6e90\u6587\u4ef6\n\u251c\u2500\u2500 mddoc       \/\/ \u6587\u6863 html \u6a21\u7248\n\u251c\u2500\u2500 res         \/\/ \u8d44\u6e90\u6587\u4ef6\n\u251c\u2500\u2500 src         \/\/ PHP \u6e90\u4ee3\u7801\n\u251c\u2500\u2500 tests       \/\/ \u6d4b\u8bd5\u7528\u4f8b\u76ee\u5f55\n\u2514\u2500\u2500 website     \/\/ \u5b98\u7f51 Html \u6e90\u4ee3\u7801\u57fa\u672c\u64cd\u4f5c\u5728 Github \u7684 imi \u9875\u9762\u70b9\u51fb fork \u6309\u94ae\uff0c\u5c06\u9879\u76ee\u590d\u523b\u5230\u4f60\u81ea\u5df1\u540d\u4e0b\u3002\u5c06\u4ee3\u7801\u62c9\u5230\u672c\u5730\uff0c\u5728\u6700\u65b0\u7684 dev \u5206\u652f\u57fa\u7840\u4e0a\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u6b64\u6b21\u8d21\u732e\u7684\u5206\u652f\u3002\u6b64\u6b21\u8d21\u732e\u7684\u4ee3\u7801\u90fd\u63d0\u4ea4\u5230\u4e0a\u4e00\u6b65\u521b\u5efa\u7684\u5206\u652f\u4e2d\u3002\u5728 Github \u7684 imi \u9875\u9762\u70b9\u51fb Pull requests\uff0c\u7136\u540e\u70b9\u51fb New pull request \u628a\u4f60\u4fee\u6539\u7684\u5206\u652f\u7533\u8bf7\u5408\u5e76\u3002\u53c2\u4e0e\u65b9\u5f0f\u6587\u6863imi \u7684\u6587\u6863\u662f\u7528 markdown \u7f16\u5199\uff0c\u4f7f\u7528 mddoc \u5c06 markdown \u8f6c\u6362\u4e3a html \u7528\u4e8e\u8bbf\u95ee\u3002\u6587\u6863\u6e90\u4ee3\u7801\u5728 imi \u4ed3\u5e93\u4e2d\u7684 doc \u76ee\u5f55\uff0cmddoc \u7684 html \u6a21\u7248\u5728 mddoc \u76ee\u5f55\u4e2d\u3002\u4f60\u53ef\u4ee5\u5e2e\u52a9\u5b8c\u5584\u6587\u6863\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4fee\u6b63\u9519\u522b\u5b57\u3001\u8865\u5145\u6587\u6863\u8bf4\u660e\u3001\u8d21\u732e\u793a\u4f8b\u4ee3\u7801\u7b49\u3002\u4ee3\u7801imi \u5b8c\u5168\u4f7f\u7528 PHP \u5f00\u53d1\uff0c\u4e00\u4e2a\u7a0d\u5fae\u6709\u70b9\u80fd\u529b\u7684 PHP \u5f00\u53d1\u8005\uff0c\u5e94\u8be5\u90fd\u53ef\u4ee5\u53c2\u4e0e\u8fdb\u6765\u3002\u4f60\u53ef\u4ee5\u5e2e\u52a9 imi \u53d8\u5f97\u66f4\u597d\u66f4\u5f3a\u5927\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4fee\u590d BUG\u3001\u8d21\u732e\u65b0\u529f\u80fd\u7b49\u3002\u8d21\u732e\u4ee3\u7801\u9700\u8981\u80fd\u8dd1\u901a\u539f\u6709\u6d4b\u8bd5\u7528\u4f8b\uff0c\u5e76\u4e14\u4e3a\u65b0\u589e\u529f\u80fd\u7279\u6027\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u3002\u5173\u4e8e\u6d4b\u8bd5\u7528\u4f8b\u73af\u5883\u8981\u6c42Redis\u3001MySQL\u9996\u6b21\u8fd0\u884c\u6d4b\u8bd5\u6267\u884c tests\/db\/install-db.sh \u5bfc\u5165\u6570\u636e\u5e93\u8868\u7ed3\u6784\u914d\u7f6e\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff0c\u5982\u679c\u9ed8\u8ba4\u503c\u8ddf\u4f60\u7684\u4e00\u6837\u5c31\u65e0\u9700\u914d\u7f6e\u4e86\u540d\u79f0\u63cf\u8ff0\u9ed8\u8ba4\u503cSERVER_HOST\u6d4b\u8bd5\u7528\u7684\u670d\u52a1\uff0c\u76d1\u542c\u7684\u4e3b\u673a\u540d127.0.0.1MYSQL_SERVER_HOSTMySQL \u4e3b\u673a\u540d127.0.0.1MYSQL_SERVER_PORTMySQL \u7aef\u53e33306MYSQL_SERVER_USERNAMEMySQL \u7528\u6237\u540drootMYSQL_SERVER_PASSWORDMySQL \u5bc6\u7801rootREDIS_SERVER_HOSTRedis \u4e3b\u673a\u540d127.0.0.1REDIS_SERVER_PORTRedis \u7aef\u53e36379REDIS_SERVER_PASSWORDRedis \u5bc6\u7801 REDIS_CACHE_DBRedis \u7f13\u5b58\u7528\u7684 db\uff0c\u8be5 db \u4f1a\u88ab\u6e05\u7a7a\u6570\u636e\uff0c\u8bf7\u614e\u91cd\u8bbe\u7f6e1\u914d\u7f6e\u547d\u4ee4\uff1aexport NAME=VALUE\u9996\u6b21\u8fd0\u884c\u6d4b\u8bd5\u811a\u672c\uff1acomposer install-test\u9996\u6b21\u4e4b\u540e\u518d\u8fd0\u884c\u6d4b\u8bd5\u7684\u547d\u4ee4\uff1acomposer test\u5b98\u65b9\u7f51\u7ad9imi \u5b98\u65b9\u7f51\u7ad9 (https:\/\/www.imiphp.com) \u7684\u6e90\u4ee3\u7801\u5728 imi \u4ed3\u5e93\u4e2d\u7684 website \u76ee\u5f55\u4e2d\u3002\u4f60\u53ef\u4ee5\u5e2e\u52a9\u5b8c\u5584\u5b98\u7f51\u8bf4\u660e\uff0c\u5982\u679c\u4f60\u6709\u66f4\u597d\u8bbe\u8ba1\u60f3\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u4e0e\u6211\u4eec\u6c9f\u901a\u6216\u8005\u76f4\u63a5\u8d21\u732e\u4ee3\u7801\u3002"},{"id":185,"title":"\u6027\u80fd\u4f18\u5316","pageTitle":"\u6027\u80fd\u4f18\u5316","url":"adv\/performance.html","content":"\u6027\u80fd\u4f18\u5316imi \u4e3a\u6027\u80fd\u505a\u4e86\u4ee5\u4e0b\u52aa\u529b\uff1a\u6846\u67b6\u6838\u5fc3\u8fd0\u884c\u65f6\u7f13\u5b58\u9879\u76ee\u8fd0\u884c\u65f6\u7f13\u5b58\u70ed\u66f4\u65b0\u91cd\u542f\u91c7\u7528\u589e\u91cf\u65b9\u5f0f\u6570\u636e\u5e93 Statement \u590d\u7528\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u6ce8\u5165\u5904\u7406\u4f7f\u7528\u6846\u67b6\u6838\u5fc3\u8fd0\u884c\u65f6\u7f13\u5b58+\u70ed\u66f4\u65b0\u91cd\u542f\u91c7\u7528\u589e\u91cf\u65b9\u5f0f\uff0c\u6211\u4eec\u7684\u5b9e\u9645\u9879\u76ee\u539f\u672c\u91cd\u542f\u9700\u8981 6 \u79d2\uff0c\u73b0\u5728\u53ea\u9700\u51e0\u6beb\u79d2\uff0c\u63d0\u5347\u53ef\u8c13\u662f\u5de8\u5927\u7684\u3002\u4f7f\u7528\u9879\u76ee\u8fd0\u884c\u65f6\u7f13\u5b58\u540e\uff0c\u6bcf\u6b21\u542f\u52a8\u548c\u70ed\u91cd\u542fworker\u8fdb\u7a0b\u65f6\uff0c\u786c\u76d8\u8bfb\u5199\u538b\u529b\u4e0d\u518d\u5de8\u5927\u3002\u6211\u4eec\u5c06\u6301\u7eed\u4e3a\u6027\u80fd\u4f18\u5316\uff0c\u4e3a\u53ef\u9760\u6027\u4f18\u5316\u3002\u4e0a\u9762\u63d0\u5230\u7684\u6846\u67b6\u6838\u5fc3\u8fd0\u884c\u65f6\u7f13\u5b58\u9700\u8981\u5728\u5f00\u53d1\u65f6\u624b\u52a8\u751f\u6210\uff0c\u5e76\u4e14\u5982\u679c\u66f4\u65b0\u6846\u67b6\u9700\u8981\u624b\u52a8\u8fdb\u884c\u6e05\u9664\u5e76\u91cd\u65b0\u751f\u6210\u3002\u63a7\u5236\u5668\u5355\u4f8bimi \u7684\u63a7\u5236\u5668\u9ed8\u8ba4\u662f\u4f7f\u7528 clone \u8fdb\u884c\u590d\u7528\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5bf9\u63a7\u5236\u5668\u5c5e\u6027\u8fdb\u884c\u65e0\u538b\u529b\u7684\u8bfb\u5199\u3002\u5f53\u7136\uff0c\u4e00\u822c\u6765\u8bb2\u4e0d\u9700\u8981\u5c5e\u6027\u8bfb\u5199\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u628a\u63a7\u5236\u5668\u8bbe\u4e3a\u5355\u4f8b\u3002\u65b9\u6cd51\uff1a\u63a7\u5236\u5668\u6ce8\u89e3\uff0c@Controller(singleton=true)\uff0c\u5728 WS\u3001TCP \u4e2d\u4e00\u6837\u52a0\u5165\u8be5\u5c5e\u6027\u5373\u53ef\u3002\u65b9\u6cd52\uff1a\u5728\u670d\u52a1\u5668\u914d\u7f6e\u4e2d\u52a0\u5165\uff1a[\n    &#039;controller&#039;    =&gt;  [\n        &#039;singleton&#039; =&gt; true,\n    ],\n]"},{"id":"645b0b4a491795.81244888","title":"","pageTitle":"","url":"adv\/README.html","content":""},{"id":171,"title":"\u7f16\u5199\u81ea\u5b9a\u4e49\u6ce8\u89e3","pageTitle":"\u7f16\u5199\u81ea\u5b9a\u4e49\u6ce8\u89e3","url":"annotations\/annotation.html","content":"\u7f16\u5199\u81ea\u5b9a\u4e49\u6ce8\u89e3\u5728 imi \u6846\u67b6\u4e2d\uff0c\u4f7f\u7528\u6ce8\u89e3\u53ef\u4ee5\u5b9e\u73b0\u5f88\u591a\u529f\u80fd\u3002\u6bd4\u5982\uff1a\u8def\u7531\u3001\u6a21\u578b\u5b9a\u4e49\u3001\u4e8b\u52a1\u3001\u7f13\u5b58\u7b49\u7b49\u9664\u4e86\u5185\u7f6e\u7684\u6ce8\u89e3\u4ee5\u5916\uff0c\u5982\u679c\u7f16\u5199\u5c5e\u4e8e\u81ea\u5df1\u7684\u6ce8\u89e3\u5462\uff1f\u8fd9\u7bc7\u6559\u7a0b\u5c31\u6765\u6559\u5927\u5bb6\u6765\u7f16\u5199\u5c5e\u4e8e\u81ea\u5df1\u7684\u6ce8\u89e3\u3002\u6ce8\u89e3\u5b9a\u4e49\u6ce8\u89e3\u626b\u63cfimi \u662f\u5e38\u9a7b\u5185\u5b58\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u51b7\u542f\u52a8\u65f6\u91c7\u7528\u4e86\u5168\u91cf\u626b\u63cf\u7684\u65b9\u5f0f\uff0c\u6765\u5b9e\u73b0\u6ce8\u89e3\u7f13\u5b58\u3002\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5c31\u548c\u8bfb\u53d6\u914d\u7f6e\u4e00\u6837\u7b80\u5355\u9ad8\u6548\u3002\u4e00\u822c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u7684beanScan\u4e2d\uff0c\u914d\u7f6e\u6ce8\u89e3\u7c7b\u6240\u5728\u547d\u540d\u7a7a\u95f4\u3002\u5728 imi \u6846\u67b6\u4e2d\uff0c\u6d89\u53ca\u6ce8\u89e3\u7684\uff0c\u90fd\u9700\u8981\u914d\u7f6e\u3002\u6ce8\u89e3\u7c7b\u6bcf\u4e2a\u6ce8\u89e3\u90fd\u662f\u4e00\u4e2a\u7c7b\u3002\u6ce8\u89e3\u7c7b\u9700\u8981\u7ee7\u627f\\Imi\\Bean\\Annotation\\Base\u7c7b&lt;?php\nnamespace ImiApp\\Annotation;\n\nuse Imi\\Bean\\Annotation\\Base;\nuse Imi\\Bean\\Annotation\\Parser;\n\n\/**\n * \u793a\u4f8b\u6ce8\u89e3\n * @Annotation\n * @Target(&quot;METHOD&quot;)\n * @Parser(&quot;\\Imi\\Bean\\Parser\\NullParser&quot;)\n *\/\nclass MyAnnotation extends Base\n{\n    \/**\n     * \u53ea\u4f20\u4e00\u4e2a\u53c2\u6570\u65f6\u7684\u53c2\u6570\u540d\n     * @var string\n     *\/\n    protected $defaultFieldName = &#039;name&#039;;\n\n    \/**\n     * \u968f\u4fbf\u5b9a\u4e49\u7684\u5c5e\u6027\n     * @var string\n     *\/\n    public $name;\n\n    \/**\n     * \u968f\u4fbf\u5b9a\u4e49\u7684\u5c5e\u6027\n     * @var int\n     *\/\n    public $age;\n\n}defaultFieldName\u5b9a\u4e49\u7684\u53c2\u6570\u540d\uff0c\u5728\u4f60\u4f7f\u7528\u6ce8\u89e3\u65f6\u5019\uff0c\u5982\u679c\u53ea\u4f20\u8fd9\u4e00\u4e2a\u53c2\u6570\uff0c\u53ef\u4ee5\u7701\u7565\u53c2\u6570\u540d\u5199\u5728\u7c7b\u4e0a\u7684\uff1a@Annotation\u6ce8\u89e3\uff0c\u8868\u793a\u5f53\u524d\u7c7b\u662f\u6ce8\u89e3\u7c7b\u3002@Target\u6ce8\u89e3\uff0c\u8868\u793a\u5f53\u524d\u6ce8\u89e3\u53ef\u4ee5\u5199\u5728\u4ec0\u4e48\u4e0a\u9762\u3002\u53ef\u9009\uff1aCLASS\u3001METHOD\u3001PROPERTY\u3001CONST\u3002\u652f\u6301\u4f20\u591a\u4e2a\u7684\u5199\u6cd5\uff1a@Target({&quot;CLASS&quot;, &quot;METHOD&quot;, &quot;PROPERTY&quot;, &quot;CONST&quot;})@Parser\u6ce8\u89e3\uff0c\u6307\u5b9a\u626b\u63cf\u6ce8\u89e3\u65f6\u5019\u7684\u5904\u7406\u5668\uff0c\u4e00\u822c\u7528\u4e0d\u7740\uff0c\u586b\u5199&quot;\\Imi\\Bean\\Parser\\NullParser&quot;\u5373\u53ef\u6ce8\u89e3\u4f7f\u7528\u7531\u4e8e\u6ce8\u89e3\u662f\u4e00\u4e2a\u7c7b\uff0c\u6240\u4ee5\u4f7f\u7528\u6ce8\u89e3\u9700\u8981use\u5b83&lt;?php\nnamespace ImiApp\\Test;\n\nuse ImiApp\\Annotation\\MyAnnotation;\n\nclass Test\n{\n    \/**\n     * @MyAnnotation(&quot;a&quot;)\n     * @MyAnnotation(name=&quot;b&quot;, age=11)\n     *\/\n    public function aaa()\n    {\n\n    }\n\n}\u6ce8\u5165\u6ce8\u89e3imi \u4e2d\u53ef\u4ee5\u6ce8\u5165\u5e26\u6709\u6ce8\u89e3\u7684\u65b9\u6cd5\u3002\u7f16\u5199 AOP \u7c7b\uff1a\uff08\u4e0d\u8981\u5fd8\u8bb0\u52a0\u5165beanScan\u54e6\uff01\uff09namespace ImiApp\\Aop;\n\nuse Imi\\Aop\\Annotation\\Aspect;\nuse Imi\\Aop\\Annotation\\PointCut;\nuse Imi\\Aop\\PointCutType;\nuse Imi\\Aop\\AroundJoinPoint;\n\n\/**\n * @Aspect\n *\/\nclass TransactionAop\n{\n    \/**\n     * \u81ea\u52a8\u4e8b\u52a1\u652f\u6301\n     * @PointCut(\n     *         type=PointCutType::ANNOTATION,\n     *         allow={\n     *             \\ImiApp\\Annotation\\MyAnnotation::class\n     *         }\n     * )\n     * @Around\n     * @return mixed\n     *\/\n    public function parseTransaction(AroundJoinPoint $joinPoint)\n    {\n        \/\/ \u524d\u7f6e\u64cd\u4f5c\n\n        \/\/ \u6267\u884c\u539f\u65b9\u6cd5\uff0c\u83b7\u53d6\u8fd4\u56de\u503c\n        $result = $joinPoint-&gt;proceed($args);\n        \/\/ \u540e\u7f6e\u64cd\u4f5c\n\n        \/\/ \u8fd4\u56de\u8fd4\u56de\u503c\uff0c\u5982\u6709\u5fc5\u8981\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u51b3\u5b9a\u5176\u4ed6\u8fd4\u56de\u503c\n        return $result;\n    }\n}\u5177\u4f53\u7528\u6cd5\u8bf7\u53c2\u8003\uff1ahttps:\/\/doc.imiphp.com\/components\/aop\/index.html\u83b7\u53d6\u6ce8\u89e3\u5177\u4f53\u7528\u6cd5\u8bf7\u53c2\u8003\uff1ahttps:\/\/doc.imiphp.com\/annotations\/annotationManager.html"},{"id":172,"title":"\u6ce8\u89e3\u7ba1\u7406\u5668","pageTitle":"\u6ce8\u89e3\u7ba1\u7406\u5668","url":"annotations\/annotationManager.html","content":"\u6ce8\u89e3\u7ba1\u7406\u5668imi \u4e2d\u5185\u7f6e\u4e86\u4e00\u4e2a\u6ce8\u89e3\u7ba1\u7406\u5668\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u8f7b\u677e\u83b7\u53d6\u5230\u7c7b\u3001\u65b9\u6cd5\u3001\u5c5e\u6027\u3001\u5e38\u91cf\u4e2d\u7684\u6ce8\u89e3\u3002\u7c7b\uff1a\\Imi\\Bean\\Annotation\\AnnotationManager\u7528\u6cd5\u83b7\u53d6\u6ce8\u89e3\u4f7f\u7528\u70b9AnnotationManager::getAnnotationPoints($annotationClassName, $where = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eannotationClassName\u6ce8\u89e3\u7c7b\u540dwhere\u4f7f\u7528\u70b9\uff0c\u9ed8\u8ba4\u4e3anull\u4e0d\u9650\u5236\u3002\u53ef\u9009\uff1aclass\/method\/property\/constant\u8fd4\u56de\uff1a\u6ce8\u89e3\u6570\u7ec4\u83b7\u53d6\u7c7b\u6ce8\u89e3AnnotationManager::getClassAnnotations($className, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a\u6ce8\u89e3\u6570\u7ec4\u83b7\u53d6\u65b9\u6cd5\u6ce8\u89e3AnnotationManager::getMethodAnnotations($className, $methodName, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dmethodName\u76ee\u6807\u65b9\u6cd5\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a\u6ce8\u89e3\u6570\u7ec4\u83b7\u53d6\u5c5e\u6027\u6ce8\u89e3AnnotationManager::getPropertyAnnotations($className, $propertyName, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dpropertyName\u76ee\u6807\u5c5e\u6027\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a\u6ce8\u89e3\u6570\u7ec4\u83b7\u53d6\u5e38\u91cf\u6ce8\u89e3AnnotationManager::getConstantAnnotations($className, $constantName, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dconstantName\u76ee\u6807\u5e38\u91cf\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a\u6ce8\u89e3\u6570\u7ec4\u83b7\u53d6\u4e00\u4e2a\u7c7b\u4e2d\u6240\u6709\u5305\u542b\u6307\u5b9a\u6ce8\u89e3\u7684\u65b9\u6cd5AnnotationManager::getMethodsAnnotations($className, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a[\n    &#039;\u65b9\u6cd5\u540d&#039;    =&gt;  [\n        \/\/ \u6ce8\u89e3\u6570\u7ec4\n    ],\n]\u83b7\u53d6\u4e00\u4e2a\u7c7b\u4e2d\u6240\u6709\u5305\u542b\u6307\u5b9a\u6ce8\u89e3\u7684\u5c5e\u6027AnnotationManager::getPropertiesAnnotations($className, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a[\n    &#039;\u5c5e\u6027\u540d&#039;    =&gt;  [\n        \/\/ \u6ce8\u89e3\u6570\u7ec4\n    ],\n]\u83b7\u53d6\u4e00\u4e2a\u7c7b\u4e2d\u6240\u6709\u5305\u542b\u6307\u5b9a\u6ce8\u89e3\u7684\u5e38\u91cfAnnotationManager::getConstantsAnnotations($className, $annotationClassName = null): array\u53c2\u6570\u540d\u79f0\u8bf4\u660eclassName\u76ee\u6807\u7c7b\u540dannotationClassName\u60f3\u8981\u83b7\u53d6\u7684\u6ce8\u89e3\u7c7b\u7c7b\u540d\uff0c\u4e3anull\u5219\u4e0d\u9650\u5236\u8fd4\u56de\uff1a[\n    &#039;\u5e38\u91cf\u540d&#039;    =&gt;  [\n        \/\/ \u6ce8\u89e3\u6570\u7ec4\n    ],\n]"},{"id":170,"title":"\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668","pageTitle":"\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668","url":"annotations\/filterArg.html","content":"\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668\u5728\u65b9\u6cd5\u8c03\u7528\u65f6\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u65b9\u6cd5\u53c2\u6570\u8fc7\u6ee4\u5668\uff0c\u5bf9\u4f20\u5165\u65b9\u6cd5\u7684\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\u5904\u7406\u3002\u6ce8\u89e3\u8bf4\u660e@FilterArg\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u53c2\u6570\u540dfilter\u8fc7\u6ee4\u5668callable\u7528\u6cd5\u793a\u4f8b\u7b80\u5355\u4f7f\u7528\uff1a\/*\n * @FilterArg(name=&quot;data&quot;, filter=&quot;json_decode&quot;)\n *\/\npublic function test($data)\n{\n    var_dump($data); \/\/ \u8fd9\u662f\u4e00\u4e2astdClass\u5bf9\u8c61\n}\n\n$obj-&gt;test(&#039;{&quot;id&quot;:1, &quot;message&quot;: &quot;imi nb!&quot;}&#039;);\u590d\u6742\u7528\u6cd5\uff1a\u7ed3\u5408@Callback\u3001@Inject\u6ce8\u89e3\u4f7f\u7528\uff0c\u652f\u6301\u4f7f\u7528bean\u4e2d\u7684\u65b9\u6cd5\u3002\/**\n * @Bean(&quot;XXX&quot;)\n *\/\nclass TestXXX\n{\n    public function decode($data)\n    {\n        return json_decode($data, true);\n    }\n}\n\n\/*\n * @FilterArg(name=&quot;data&quot;, filter=@Callback(\n *     class=@Inject(&quot;XXX&quot;),\n *     method=&quot;decode&quot;\n * ))\n *\/\npublic function test($data)\n{\n    var_dump($data); \/\/ \u8fd9\u662f\u4e00\u4e2a\u6570\u7ec4\n}\n\n$obj-&gt;test(&#039;{&quot;id&quot;:1, &quot;message&quot;: &quot;imi nb!&quot;}&#039;);"},{"id":169,"title":"\u6ce8\u5165\u503c\u6ce8\u89e3","pageTitle":"\u6ce8\u5165\u503c\u6ce8\u89e3","url":"annotations\/injectValue.html","content":"\u6ce8\u5165\u503c\u6ce8\u89e3imi \u4e2d\u6709\u4e00\u7c7b\u6ce8\u89e3\uff0c\u4ed6\u4eec\u652f\u6301\u5c06\u503c\u52a8\u6001\u6ce8\u5165\u5230\u6ce8\u89e3\u5c5e\u6027\u4e2d\uff0c\u5f53\u8c03\u7528\u83b7\u53d6\u6ce8\u89e3\u5c5e\u6027\u65f6\uff0c\u624d\u5b9e\u65f6\u8ba1\u7b97\u5e76\u8fd4\u56de\u3002\u6ce8\u89e3\u8bf4\u660e@ConstValue\u4ece\u5e38\u91cf\u4e2d\u8bfb\u53d6\u503c\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u5e38\u91cf\u540ddefault\u5e38\u91cf\u4e0d\u5b58\u5728\u65f6\uff0c\u8fd4\u56de\u7684\u9ed8\u8ba4\u503c@ConfigValue\u4ece\u914d\u7f6e\u4e2d\u8bfb\u53d6\u503c\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u914d\u7f6e\u540d\uff0c\u652f\u6301@app\u3001@currentServer\u7b49\u7528\u6cd5default\u914d\u7f6e\u540d\uff0c\u652f\u6301@app\u3001@currentServer\u7b49\u7528\u6cd5\u4e0d\u5b58\u5728\u65f6\uff0c\u8fd4\u56de\u7684\u9ed8\u8ba4\u503c@Inject\u5bf9\u8c61\u6ce8\u5165\uff0c\u4f7f\u7528\uff1aApp::getBean()\u5c5e\u6027\u540d\u79f0\u8bf4\u660enameBean\u540d\u79f0\u6216\u7c7b\u540dargsBean\u5b9e\u4f8b\u5316\u53c2\u6570@RequestInject\u5bf9\u8c61\u6ce8\u5165\uff0c\u4f7f\u7528\uff1aRequestContext::getBean()\u540c@Inject@Callback\u56de\u8c03\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660eclass\u7c7b\u540d\uff0c\u6216\u8005\u4f20\u5165\u5bf9\u8c61\uff0c\u6bd4\u5982\u53ef\u4ee5\u4f7f\u7528 @Inject\u3001@RequestInject \u518d\u6b21\u503c\u6ce8\u5165method\u65b9\u6cd5\u540d\u7528\u6cd5\u793a\u4f8b\/*\n * @Cacheable(\n *   key=&quot;index:{page}&quot;,\n *   ttl=10,\n *   lockable=@Lockable(\n *     id=&quot;index:{page}&quot;,\n *     waitTimeout=999999,\n *   ),\n *   preventBreakdown=true,\n * )\n *\/@DbInject\u6ce8\u5165\u6570\u636e\u5e93\u5bf9\u8c61\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u8fde\u63a5\u6c60\u540d\uff0c\u5982\u679c\u4e3anull\u5219\u53d6\u914d\u7f6e@app.db.defaultPoolqueryType\u67e5\u8be2\u7c7b\u578b\uff0c\u5f71\u54cd\u8bfb\u5199\u5206\u79bb\u903b\u8f91\u3002\u53ef\u9009\uff1aQueryType::READ\/QueryType::WRITE\uff0c\u9ed8\u8ba4\u4e3aQueryType::WRITE@RedisInject\u6ce8\u5165Redis\u5bf9\u8c61\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u8fde\u63a5\u6c60\u540d\uff0c\u5982\u679c\u4e3anull\u5219\u53d6\u914d\u7f6e@app.redis.defaultPool@PoolResource\u6ce8\u5165\u8fde\u63a5\u6c60\u8d44\u6e90\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u8fde\u63a5\u6c60\u540d"},{"id":173,"title":"\u6ce8\u89e3\u76f8\u5173\u95ee\u9898","pageTitle":"\u6ce8\u89e3\u76f8\u5173\u95ee\u9898","url":"annotations\/qa.html","content":"\u6ce8\u89e3\u76f8\u5173\u95ee\u9898\u672c\u9875\u5217\u51fa\u6ce8\u89e3\u76f8\u5173\u5e38\u89c1\u95ee\u9898\uff0c\u6b22\u8fce\u5927\u5bb6\u8865\u5145\u3002\u5982\u4f55\u5ffd\u7565\u4e00\u4e9b\u6211\u4e0d\u60f3\u88ab\u626b\u63cf\u5230\u7684\u7c7b\uff1f\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff1areturn [\n    \/\/ \u5ffd\u7565\u626b\u63cf\u7684\u547d\u540d\u7a7a\u95f4\n    &#039;ignoreNamespace&#039;   =&gt;  [\n        &#039;Imi\\Test\\Component\\Annotation\\A\\*&#039;,    \/\/ \u5ffd\u7565\u626b\u63cf\u8be5\u547d\u540d\u7a7a\u95f4\u4e0b\u6240\u6709\u7c7b\n        &#039;Imi\\Test\\Component\\Annotation\\B\\TestB&#039;,\/\/ \u5ffd\u7565\u8be5\u7c7b\n    ],\n]\u600e\u6837\u5ffd\u7565\u626b\u63cf\u6307\u5b9a\u6ce8\u89e3\u5728\u9879\u76ee\u7684 Main.php \u4e2d\u5199\u5165\uff1a&lt;?php\nnamespace ImiApp;\n\nuse Imi\\Main\\AppBaseMain;\nuse Yurun\\Doctrine\\Common\\Annotations\\AnnotationReader;\n\nclass Main extends AppBaseMain\n{\n    public function __init()\n    {\n        AnnotationReader::addGlobalIgnoredName(&#039;xxx&#039;);\n    }\n\n}"},{"id":6,"title":"\u914d\u7f6e\u6587\u4ef6","pageTitle":"\u914d\u7f6e\u6587\u4ef6","url":"base\/config.html","content":"\u914d\u7f6e\u6587\u4ef6\u5728\u6bcf\u4e2aMain\u6240\u5728\u76ee\u5f55\u4e0b\u7684config\/config.php\u914d\u7f6e\u6587\u4ef6\uff0c\u4f1a\u5728\u8be5Main\u88ab\u5b9e\u4f8b\u5316\u65f6\u52a0\u8f7d\u3002\u5982\u679c\u4f60\u4e0d\u77e5\u9053Main\u662f\u4ec0\u4e48\uff0c\u8bf7\u770b\u4e0a\u4e00\u7ae0\uff1a\u300a\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u300bimi \u8fd8\u652f\u6301\u4f60\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\uff0c\u5efa\u7acb\u4e00\u4e2a.env\u6587\u4ef6\uff0c\u5728\u91cc\u9762\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\u914d\u7f6e\u3002\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784\u5171\u6709\u7ed3\u6784&lt;?php\nreturn [\n    \/\/ \u52a0\u8f7d\u5b50\u914d\u7f6e\u6587\u4ef6\uff0c\u907f\u514d`config.php`\u8fc7\u4e8e\u81c3\u80bf\u4e0d\u4fbf\u7ef4\u62a4\n    \/\/ \u8981\u6ce8\u610f\u8fd9\u91cc\u7684\u522b\u540d\u4e0d\u53ef\u4e0econfigs\u540c\u7ea7\u7684\u540d\u5b57\u91cd\u590d\uff0c\u5426\u5219\u4f1a\u88ab\u8986\u76d6\n    &#039;configs&#039;    =&gt;    [\n        &quot;\u522b\u540d1&quot;    =&gt;    &#039;\u914d\u7f6e\u6587\u4ef6\u8def\u5f841&#039;,\n        &quot;\u522b\u540d2&quot;    =&gt;    &#039;\u914d\u7f6e\u6587\u4ef6\u8def\u5f842&#039;,\n        \u2026\u2026\n    ],\n    \/\/ bean\u626b\u63cf\u76ee\u5f55\uff0c\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\n    &#039;beanScan&#039;    =&gt;    [\n        &#039;ImiDemo\\WebSocketDemo\\Listener&#039;,\n    ],\n];\u9879\u76ee\u914d\u7f6e\u6587\u4ef6return [\n    \/\/ \u5ffd\u7565\u626b\u63cf\u7684\u547d\u540d\u7a7a\u95f4\n    &#039;ignoreNamespace&#039;   =&gt;  [\n        &#039;Imi\\Test\\Component\\Annotation\\A\\*&#039;,    \/\/ \u5ffd\u7565\u626b\u63cf\u8be5\u547d\u540d\u7a7a\u95f4\u4e0b\u6240\u6709\u7c7b\n        &#039;Imi\\Test\\Component\\Annotation\\B\\TestB&#039;,\/\/ \u5ffd\u7565\u8be5\u7c7b\n    ],\n    \/\/ Swoole &gt;= 4.1.0\u53ef\u7528\uff0c\u4e0d\u8bbe\u7f6e\u9ed8\u8ba4\u4e3atrue\uff0c\u5f00\u542f\u4e00\u952e\u534f\u7a0b\u5316\n    &#039;enableCoroutine&#039;    =&gt;    true,\n    \/\/ runtime\u76ee\u5f55\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u53ef\u4e0d\u8bbe\u7f6e\uff0c\u4e3a\u5f53\u524d\u9879\u76ee\u4e0b\u7684.runtime\u76ee\u5f55\n    \/\/ \u6ce8\u610f\uff0c\u591a\u4e2a\u9879\u76ee\u4e0d\u53ef\u8bbe\u7f6e\u4e3a\u76f8\u540c\u76ee\u5f55\uff01\n    &#039;runtimePath&#039;   =&gt;  &#039;\/tmp\/imidemo-runtime\/&#039;,\n    \/\/ \u5b9a\u4e49\u8fdb\u7a0b\u540d\u89c4\u5219\n    &#039;process&#039;   =&gt;  [\n        &#039;master&#039;        =&gt;  &#039;imi:master:{namespace}&#039;,\n        &#039;manager&#039;       =&gt;  &#039;imi:manager:{namespace}&#039;,\n        &#039;worker&#039;        =&gt;  &#039;imi:worker-{workerId}:{namespace}&#039;,\n        &#039;taskWorker&#039;    =&gt;  &#039;imi:taskWorker-{workerId}:{namespace}&#039;,\n        &#039;process&#039;       =&gt;  &#039;imi:process-{processName}:{namespace}&#039;,\n        &#039;processPool&#039;   =&gt;  &#039;imi:process-pool-{processPoolName}-{workerId}:{namespace}&#039;,\n        &#039;tool&#039;          =&gt;  &#039;imi:{toolName}\/{toolOperation}:{namespace}&#039;,\n    ],\n    &#039;imi&#039;   =&gt;  [\n        \/\/ \u8986\u76d6 imi \u6846\u67b6\u9ed8\u8ba4\u7684 beanScan\uff0c\u53ef\u4ee5\u7981\u7528\u67d0\u4e9b\u7528\u4e0d\u5230\u7684\u6a21\u5757\n        &#039;beanScan&#039;  =&gt;  [\n            &#039;Imi\\Config&#039;,\n            &#039;Imi\\Bean&#039;,\n            &#039;Imi\\Aop&#039;,\n            &#039;Imi\\Annotation&#039;,\n            &#039;Imi\\Cache&#039;,\n            &#039;Imi\\Server&#039;,\n            &#039;Imi\\Log&#039;,\n            &#039;Imi\\Pool&#039;,\n            &#039;Imi\\Db&#039;,\n            &#039;Imi\\Redis&#039;,\n            &#039;Imi\\Listener&#039;,\n            &#039;Imi\\Model&#039;,\n            &#039;Imi\\Task&#039;,\n            &#039;Imi\\Tool&#039;,\n            &#039;Imi\\Process&#039;,\n            &#039;Imi\\HotUpdate&#039;,\n            &#039;Imi\\Validate&#039;,\n            &#039;Imi\\HttpValidate&#039;,\n            &#039;Imi\\Enum&#039;,\n            &#039;Imi\\Lock&#039;,\n            &#039;Imi\\Facade&#039;,\n        ],\n    ],\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n    &#039;mainServer&#039;    =&gt;    [\n        \/\/ \u6307\u5b9a\u670d\u52a1\u5668\u547d\u540d\u7a7a\u95f4\n        &#039;namespace&#039;    =&gt;    &#039;ImiDemo\\HttpDemo\\MainServer&#039;,\n        \/\/ \u670d\u52a1\u5668\u7c7b\u578b(http\/WebSocket\/TcpServer\/UdpServer)\n        &#039;type&#039;        =&gt;    \\Imi\\Server\\Type::HTTP,\n        \/\/ \u76d1\u542c\u7684IP\u5730\u5740\uff0c\u53ef\u9009\n        &#039;host&#039;        =&gt;    &#039;0.0.0.0&#039;,\n        \/\/ \u76d1\u542c\u7684\u7aef\u53e3\n        &#039;port&#039;        =&gt;    8080,\n        \/\/ \u53c2\u8003 swoole mode\uff0c\u53ef\u9009\n        &#039;mode&#039;        =&gt;    SWOOLE_BASE,\n        \/\/ \u53c2\u8003 swoole sockType\uff0c\u53ef\u9009\n        &#039;sockType&#039;    =&gt;    SWOOLE_SOCK_TCP,\n        \/\/ \u670d\u52a1\u5668\u914d\u7f6e\uff0c\u53c2\u6570\u7528\u6cd5\u540c\\Swoole\\Server-&gt;set($configs)\n        &#039;configs&#039;    =&gt;    [\n            &#039;reactor_num&#039;        =&gt; 8,\n            &#039;worker_num&#039;        =&gt; 8,\n            &#039;task_worker_num&#039;    =&gt; 16,\n        ],\n    ],\n    \/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n    &#039;subServers&#039;    =&gt;    [\n        \/\/ \u5b50\u670d\u52a1\u5668\u522b\u540d\n        &#039;alias1&#039;    =&gt;    [\n            \/\/ \u8fd9\u91cc\u540c\u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n        ]\n    ],\n];.env\u5728 .env \u4e2d\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u652f\u6301\u4e24\u79cd\u5199\u6cd5\u3002\u5199\u6cd5\u4e00\uff1a\u76f4\u63a5\u6ce8\u5165\u914d\u7f6e\uff0c\u548cConfig::set()\u5199\u6cd5\u7c7b\u4f3c\uff0c\u652f\u6301@app\u7b49\u5199\u6cd5\u3002\u5199\u6cd5\u4e8c\uff1a\u4f20\u7edf\u65b9\u5f0f\uff0c\u5982\u8bbe\u5b9a\u4e00\u4e2aABC=123\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    &#039;abc2&#039;   =&gt;  getenv(&#039;ABC&#039;), \/\/ PHP \u5185\u7f6e\n    &#039;abc1&#039;   =&gt;  imiGetEnv(&#039;ABC&#039;, &#039;default&#039;), \/\/ imi \u6846\u67b6\u5c01\u88c5\uff0c\u652f\u6301\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u9ed8\u8ba4\u503c\n];\u5982\u4e0b\uff0c\u662f\u8bbe\u7f6e\u8fde\u63a5\u6c60\u7684uri\u4f8b\u5b50\uff1a@app.pools.maindb.async.resource = &quot;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&quot;\u6570\u7ec4\u7684\u652f\u6301\uff1a@app.a.0.id = 1\n@app.a.0.name = name1\n@app.a.1.id = 2\n@app.a.1.name = name2\u540c\uff1a[\n    &#039;a&#039; =&gt;  [\n        [&#039;id&#039;=&gt;1, &#039;name&#039;=&gt;&#039;name1&#039;],\n        [&#039;id&#039;=&gt;2, &#039;name&#039;=&gt;&#039;name2&#039;],\n    ]\n]"},{"id":4,"title":"\u73af\u5883\u8981\u6c42","pageTitle":"\u73af\u5883\u8981\u6c42","url":"base\/env.html","content":"\u73af\u5883\u8981\u6c42\u8fd0\u884c\u73af\u5883Linux \u7cfb\u7edf (Swoole \u4e0d\u652f\u6301\u5728 Windows \u4e0a\u8fd0\u884c)PHP &gt;= 7.1ComposerSwoole &gt;= 4.4.0Redis\u3001PDO \u6269\u5c55Windows \u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u673a\u3001Windows 10 Linux \u5b50\u7cfb\u7edf\u7b49\u73af\u5883\uff0c\u5b9e\u73b0\u5728 Windows \u7cfb\u7edf\u4e0a\u5f00\u53d1\u548c\u8c03\u8bd5\u3002Docker\u63a8\u8350\u4f7f\u7528 Swoole \u5b98\u65b9 Docker\uff1ahttps:\/\/github.com\/swoole\/docker-swoole\u5b89\u88c5\u6559\u7a0b\u865a\u62df\u673a\u5b89\u88c5 Linux\u3010\u5b87\u6da6\u3011VirtualBox \u865a\u62df\u673a\u5b89\u88c5 Ubuntu 16.04\u3010\u5b87\u6da6\u3011VirtualBox \u865a\u62df\u673a\u5b89\u88c5 Ubuntu 18.04\u3010\u5b87\u6da6\u3011VirtualBox \u865a\u62df\u673a\u5b89\u88c5 CentOS 7\u3010\u5b87\u6da6\u3011VirtualBox \u865a\u62df\u673a\u5b89\u88c5 CentOS 8.1PHP \u73af\u5883\u5b89\u88c5\u3010\u5b87\u6da6\u3011Ubuntu\u3001Debian \u7cfb\u7edf\u5b89\u88c5 php \u4e00\u628a\u68ad\u6559\u7a0b\u3010\u5b87\u6da6\u3011CentOS \u7cfb\u7edf\u5b89\u88c5 php \u4e00\u628a\u68ad\u6559\u7a0b\uff08RedHat Linux + yum\uff09Swoole \u73af\u5883\u5b89\u88c5\u3010\u5b87\u6da6\u3011\u4e00\u952e\u5b89\u88c5 Swoole \u73af\u5883\u6559\u7a0b\uff0c\u4e00\u628a\u68ad\uff0c\u8ba9\u5929\u4e0b\u6ca1\u6709\u96be\u88c5\u7684 Swoole"},{"id":3,"title":"\u4ecb\u7ecd","pageTitle":"\u4ecb\u7ecd","url":"base\/intro.html","content":"\u4ecb\u7ecdimi \u662f\u57fa\u4e8e PHP Swoole \u7684\u9ad8\u6027\u80fd\u534f\u7a0b\u5e94\u7528\u5f00\u53d1\u6846\u67b6\uff0c\u5b83\u652f\u6301 HttpApi\u3001WebSocket\u3001TCP\u3001UDP\u3001MQTT \u670d\u52a1\u7684\u5f00\u53d1\u3002\u5728 Swoole \u7684\u52a0\u6301\u4e0b\uff0c\u76f8\u6bd4 php-fpm \u8bf7\u6c42\u54cd\u5e94\u80fd\u529b\uff0cI\/O\u5bc6\u96c6\u578b\u573a\u666f\u5904\u7406\u80fd\u529b\uff0c\u6709\u7740\u672c\u8d28\u4e0a\u7684\u63d0\u5347\u3002imi \u6846\u67b6\u62e5\u6709\u4e30\u5bcc\u7684\u529f\u80fd\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4e92\u8054\u7f51\u3001\u79fb\u52a8\u901a\u4fe1\u3001\u4f01\u4e1a\u8f6f\u4ef6\u3001\u4e91\u8ba1\u7b97\u3001\u7f51\u7edc\u6e38\u620f\u3001\u7269\u8054\u7f51\uff08IOT\uff09\u3001\u8f66\u8054\u7f51\u3001\u667a\u80fd\u5bb6\u5c45\u7b49\u9886\u57df\u3002\u53ef\u4ee5\u4f7f\u4f01\u4e1a IT \u7814\u53d1\u56e2\u961f\u7684\u6548\u7387\u5927\u5927\u63d0\u5347\uff0c\u66f4\u52a0\u4e13\u6ce8\u4e8e\u5f00\u53d1\u521b\u65b0\u4ea7\u54c1\u3002QQ\u7fa4\uff1a17916227 \uff0c\u5982\u6709\u95ee\u9898\uff0c\u8d1f\u8d23\u7684\u5b87\u6da6\u5168\u7a0b\u624b\u628a\u624b\u89e3\u51b3\u3002\u4e3a\u4ec0\u4e48\u8981\u7528 Swoole\uff1fhttps:\/\/wiki.swoole.com\/https:\/\/my.oschina.net\/yurun\/blog\/1831238https:\/\/my.oschina.net\/yurun\/blog\/3034196\u6838\u5fc3\u7ec4\u4ef6HttpApi\u3001WebSocket\u3001TCP\u3001UDP\u3001MQTT \u670d\u52a1\u5668MySQL \u8fde\u63a5\u6c60 (\u4e3b\u4ece+\u8d1f\u8f7d\u5747\u8861)Redis \u8fde\u63a5\u6c60 (\u4e3b\u4ece+\u8d1f\u8f7d\u5747\u8861)\u8d85\u597d\u7528\u7684 ORM (Db\u3001Redis\u3001Tree)\u6beb\u79d2\u7ea7\u70ed\u66f4\u65b0AOPBean \u5bb9\u5668\u7f13\u5b58 (Cache)\u914d\u7f6e\u8bfb\u5199 (Config)\u679a\u4e3e (Enum)\u4e8b\u4ef6 (Event)\u95e8\u9762 (Facade)\u9a8c\u8bc1\u5668 (Validate)\u9501 (Lock)\u65e5\u5fd7 (Log)\u5f02\u6b65\u4efb\u52a1 (Task)"},{"id":5,"title":"\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee","pageTitle":"\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee","url":"base\/new.html","content":"\u5f00\u59cb\u4e00\u4e2a\u65b0\u9879\u76ee\u9879\u76ee\u521d\u59cb\u5316\u521b\u5efa Http Server \u9879\u76ee\uff1acomposer create-project imiphp\/project-http:~1.0\u521b\u5efa WebSocket Server \u9879\u76ee\uff1acomposer create-project imiphp\/project-websocket:~1.0\u521b\u5efa TCP Server \u9879\u76ee\uff1acomposer create-project imiphp\/project-tcp:~1.0\u521b\u5efa UDP Server \u9879\u76ee\uff1acomposer create-project imiphp\/project-udp:~1.0\u521b\u5efa MQTT Server \u9879\u76ee\uff1acomposer create-project imiphp\/project-mqtt:~1.0\u5982\u4f55\u8fd0\u884c\u8bf7\u770b\u4e0a\u9762\u9879\u76ee\u4e2d\u7684README.md\u9879\u76ee\u6700\u7ec8\u4f7f\u7528\u4ec0\u4e48\u534f\u8bae\uff0c\u548c\u4e0a\u9762\u7684\u547d\u4ee4\u884c\u65e0\u7edd\u5bf9\u5173\u7cfb\u3002\u547d\u4ee4\u884c\u521b\u5efa\u9879\u76ee\u53ea\u662f\u63d0\u4f9b\u4e00\u4e2a\u5feb\u6377\u9014\u5f84\uff0c\u670d\u52a1\u7684\u901a\u4fe1\u534f\u8bae\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u6765\u66f4\u6362\u3002\u6d41\u7a0b\u8bf4\u660e\u5728 imi \u6846\u67b6\u4e2d\uff0c\u4e00\u4e2a\u9879\u76ee\u5206\u4e3a\u4e00\u4e2a\u4e3b\u670d\u52a1\u5668\u548c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u3002\u5176\u4e2d\uff0c\u4e3b\u670d\u52a1\u5668\u4e3a\u5fc5\u987b\uff0c\u5b50\u670d\u52a1\u5668\u4e3a\u53ef\u9009\u3002\u5b50\u670d\u52a1\u5668\u901a\u8fc7\u76d1\u542c\u7aef\u53e3\u5b9e\u73b0\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\u5f00\u542f\u8fc7\u591a\u7684\u5b50\u670d\u52a1\u5668\u3002\u4f60\u9700\u8981\u4e3a\u6846\u67b6\u3001\u6bcf\u4e2a\u670d\u52a1\u5668\u5728\u5176\u547d\u540d\u7a7a\u95f4\u76ee\u5f55\u4e0b\u90fd\u521b\u5efa\u4e00\u4e2aMain.php\uff0c\u5e76\u628a\u7c7b\u547d\u540d\u4e3aMain\u9879\u76ee\u7684Main\u5fc5\u987b\u7ee7\u627fImi\\Main\\AppBaseMain\u7c7b\u3002\u670d\u52a1\u5668\u7684Main\u5fc5\u987b\u7ee7\u627fImi\\Main\\BaseMain\u7c7b\u3002\u5e76\u4e14\u5b9e\u73b0\u4e00\u4e2a__init()\u65b9\u6cd5:public function __init()\n{\n\n}\u4f60\u53ef\u4ee5\u5728\u91cc\u9762\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u7684\u4e8b\u60c5\uff0c\u4e0d\u8fc7\u5927\u591a\u6570\u65f6\u5019\u4ec0\u4e48\u90fd\u4e0d\u9700\u8981\u505a\u3002"},{"id":7,"title":"\u5e38\u89c1\u95ee\u9898","pageTitle":"\u5e38\u89c1\u95ee\u9898","url":"base\/qa.html","content":"\u5e38\u89c1\u95ee\u9898PHP Warning:  exec() has been disabled for security reasons\u89e3\u51b3\u65b9\u6848\uff1a\u4e0d\u8981\u7981\u7528 exec\u3001shell_exec\uff0c\u5728 php.ini \u4e2d\u4fee\u6539 disable_functions \u9879[error] Uncaught RuntimeException: Tool \/xxx\/imi\/vendor\/yurunsoft\/imi\/bin\/imi does not exists!Could not find package imiphp\/project-http with stability stable\u89e3\u51b3\u65b9\u6848\uff1a\u5982\u679c\u4f60\u662f Windows \u7528\u6237\uff0c\u8bf7\u4e0d\u8981\u4f7f\u7528 Windows \u4e2d\u7684 Composer\uff01\u4e0d\u8981\u4f7f\u7528pkg.phpcomposer.com\u955c\u50cf\uff0c\u5efa\u8bae\u4f7f\u7528\u963f\u91cc\u4e91\u5bb6\u7684\uff1acomposer config -g repo.packagist composer https:\/\/mirrors.aliyun.com\/composer\/\u5c06 imi \u66f4\u65b0\u5230\u6700\u65b0\u7248\u672c"},{"id":"645b0b4a4c62f0.11965010","title":"","pageTitle":"","url":"base\/README.html","content":""},{"id":132,"title":"\u6743\u9650\u63a7\u5236","pageTitle":"\u6743\u9650\u63a7\u5236","url":"components\/access-control.html","content":"\u6743\u9650\u63a7\u5236\u4ecb\u7ecdimi \u6846\u67b6\u7684\u6743\u9650\u63a7\u5236\u7ec4\u4ef6\uff0c\u4e0d\u63d0\u4f9b\u5177\u4f53 API\u3001\u7ba1\u7406\u754c\u9762\uff0c\u4ec5\u63d0\u4f9b\u57fa\u7840\u64cd\u4f5c\u7ec4\u4ef6\u3002\u672c\u7ec4\u4ef6\u4e2d\u652f\u6301\uff1a\u89d2\u8272\u5173\u8054\u64cd\u4f5c\uff0c\u7528\u6237\u5173\u8054\u89d2\u8272\uff0c\u7528\u4e8e\u5173\u8054\u64cd\u4f5c\u3002\u7528\u6237\u9664\u4e86\u89d2\u8272\u8d4b\u4e88\u7684\u64cd\u4f5c\u6743\u9650\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u5355\u72ec\u8d4b\u4e88\u64cd\u4f5c\u6743\u9650\u3002Composer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-access-control&quot;: &quot;~1.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;AccessControl&#039;    =&gt;  &#039;Imi\\AC&#039;,\n    ],\n]\u64cd\u4f5c\u6743\u9650\u521b\u5efa\u64cd\u4f5c\u6743\u9650use Imi\\AC\\AccessControl\\Operation;\n\nOperation::create(&#039;\u6743\u9650\u540d\u79f0&#039;);\n\n\/\/ \u6743\u9650\u4ee3\u7801\u4e0d\u4f20\u6216\u4e3anull\uff0c\u5219\u548c\u6743\u9650\u540d\u79f0\u76f8\u540c\uff0c\u4e0d\u53ef\u91cd\u590d\nOperation::create(&#039;\u6743\u9650\u540d\u79f0&#039;, &#039;\u6743\u9650\u4ee3\u7801&#039;);\n\n\/\/ \u6307\u5b9a\u7236\u7ea7ID\u3001\u6392\u5e8f\u7d22\u5f15\nOperation::create(&#039;\u6743\u9650\u540d\u79f0&#039;, &#039;\u6743\u9650\u4ee3\u7801&#039;, $parentId, $index, &#039;\u4ecb\u7ecd&#039;);\u89d2\u8272\u521b\u5efa\u89d2\u8272use Imi\\AC\\AccessControl\\Role;\n\n\/\/ \u4e0e Operation::create \u4e00\u6837\uff0c\u4e0d\u591a\u505a\u8bf4\u660e\u4e86\n$role = Role::create(&#039;\u6743\u9650\u540d\u79f0&#039;, &#039;\u6743\u9650\u4ee3\u7801&#039;, &#039;\u4ecb\u7ecd&#039;);\u83b7\u53d6\u89d2\u8272\u4fe1\u606f\/\/ \u652f\u6301ID\u3001Code\u4e24\u79cd\u6a21\u5f0f\n$role = new Role(&#039;\u6743\u9650ID&#039;);\n$role = new Role(&#039;\u6743\u9650\u4ee3\u7801&#039;, &#039;code&#039;);\n$roleInfo = $role-&gt;getRoleInfo(); \/\/ $roleInfo-&gt;id\/code\/name\/description\u83b7\u53d6\u89d2\u8272\u64cd\u4f5c\u6743\u9650\/\/ \u6570\u7ec4\uff0c\u6210\u5458\u4e3a \\Imi\\AC\\Model\\Operation \u7c7b\u578b\n$operations = $role-&gt;getOperations();\n\n\/\/ \u6811\u5f62\u7ed3\u6784\uff0c\u6210\u5458\u4e3a \\Imi\\AC\\Model\\Filter\\OperationTreeItem \u7c7b\u578b\uff0c$item-&gt;children \u4e3a\u5176\u4e0b\u4e00\u7ea7\u89d2\u8272\uff0c\u540c\u6837\u4e3a \\Imi\\AC\\Model\\Filter\\OperationTreeItem \u7c7b\u578b\n$operationTree = $role-&gt;getOperationTree();\u589e\u52a0\u3001\u8bbe\u7f6e\u6743\u9650$role-&gt;addOperations(&#039;code1&#039;, &#039;code2&#039;); \/\/ \u53ea\u5728\u5f53\u524d\u57fa\u7840\u4e0a\u589e\u52a0\u8fd9\u4e24\u4e2a\u6743\u9650\n\n$role-&gt;setOperations(&#039;code1&#039;, &#039;code2&#039;); \/\/ \u5c06\u89d2\u8272\u6743\u9650\u8bbe\u7f6e\u4e3a\u4ec5\u6709\u8fd9\u4e24\u4e2a\u6743\u9650\u79fb\u9664\u6743\u9650$role-&gt;removeOperations(&#039;code1&#039;, &#039;code2&#039;);\u5224\u65ad\u89d2\u8272\u662f\u5426\u62e5\u6709\u6743\u9650$result = $role-&gt;hasOperations(&#039;code1&#039;, &#039;code2&#039;);\u7528\u6237\u83b7\u53d6\u8be5\u7528\u6237\u6240\u6709\u89d2\u8272use Imi\\AC\\AccessControl\\Member;\n\n$memberId = 1;\n$member = new Member(1);\n\n$roles = $member-&gt;getRoles();\u589e\u52a0\u3001\u8bbe\u7f6e\u89d2\u8272$member-&gt;addRoles(&#039;code1&#039;, &#039;code2&#039;); \/\/ \u53ea\u5728\u5f53\u524d\u57fa\u7840\u4e0a\u589e\u52a0\u8fd9\u4e24\u4e2a\u89d2\u8272\n\n$member-&gt;setRoles(&#039;code1&#039;, &#039;code2&#039;); \/\/ \u5c06\u7528\u6237\u89d2\u8272\u8bbe\u7f6e\u4e3a\u4ec5\u6709\u8fd9\u4e24\u4e2a\u89d2\u8272\u79fb\u9664\u89d2\u8272$member-&gt;removeRoles(&#039;code1&#039;, &#039;code2&#039;);\u5224\u65ad\u7528\u6237\u662f\u5426\u62e5\u6709\u89d2\u8272$result = $member-&gt;hasRoles(&#039;code1&#039;, &#039;code2&#039;);\u83b7\u53d6\u7528\u6237\u64cd\u4f5c\u6743\u9650\/\/ \u6570\u7ec4\uff0c\u6210\u5458\u4e3a \\Imi\\AC\\Model\\Operation \u7c7b\u578b\n$operations = $member-&gt;getOperations();\n\n\/\/ \u6811\u5f62\u7ed3\u6784\uff0c\u6210\u5458\u4e3a \\Imi\\AC\\Model\\Filter\\OperationTreeItem \u7c7b\u578b\uff0c$item-&gt;children \u4e3a\u5176\u4e0b\u4e00\u7ea7\u89d2\u8272\uff0c\u540c\u6837\u4e3a \\Imi\\AC\\Model\\Filter\\OperationTreeItem \u7c7b\u578b\n$operationTree = $member-&gt;getOperationTree();\u589e\u52a0\u3001\u8bbe\u7f6e\u6743\u9650$member-&gt;addOperations(&#039;code1&#039;, &#039;code2&#039;); \/\/ \u53ea\u5728\u5f53\u524d\u57fa\u7840\u4e0a\u589e\u52a0\u8fd9\u4e24\u4e2a\u6743\u9650\n\n$member-&gt;setOperations(&#039;code1&#039;, &#039;code2&#039;); \/\/ \u5c06\u89d2\u8272\u6743\u9650\u8bbe\u7f6e\u4e3a\u4ec5\u6709\u8fd9\u4e24\u4e2a\u6743\u9650\u79fb\u9664\u6743\u9650$member-&gt;removeOperations(&#039;code1&#039;, &#039;code2&#039;);\u5224\u65ad\u7528\u6237\u662f\u5426\u62e5\u6709\u6743\u9650$result = $member-&gt;hasOperations(&#039;code1&#039;, &#039;code2&#039;);"},{"id":118,"title":"AOP","pageTitle":"AOP","url":"components\/aop\/index.html","content":"AOP\u4ecb\u7ecd\u9996\u5148\uff0c\u4f60\u4e0d\u8981\u770b\u5230 AOP \u5c31\u611f\u89c9\u597d\u96be\u597d\u590d\u6742\uff0c\u770b\u4e0b\u53bb\u5176\u5b9e\u4e5f\u5c31\u90a3\u6837\u3002\u800c\u4e14\u5728 imi \u4e2d\u4f60\u4e5f\u4e0d\u4e00\u5b9a\u9700\u8981\u7528\u5230AOP\uff0c\u8fd9\u662f\u975e\u5fc5\u987b\u7684\u3002AOP \u7684\u6982\u5ff5\u901a\u8fc7\u641c\u7d22\u5f15\u64ce\u4e00\u5b9a\u662f\u770b\u70e6\u4e86\uff0c\u800c\u4e14\u770b\u4e86\u4e5f\u6ca1\u4ec0\u4e48\u5927\u5375\u7528\uff0c\u4e0d\u8d34\u8fd1\u5b9e\u9645\u3002\u6211\u5148\u4e3e\u4e2a AOP \u5b9e\u9645\u5e94\u7528\u7684\u7b80\u5355\u4f8b\u5b50\uff0c\u6bd4\u5982\u5728\u5199\u4e00\u4e2a\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u8981\u9488\u5bf9\u67d0\u4e2a\u65b9\u6cd5\u5199\u524d\u7f6e\u548c\u540e\u7f6e\u64cd\u4f5c\uff0c\u4f20\u7edf\u5199\u6cd5\u5982\u4e0b\uff1aabstract class ParentClass\n{\n    public function test()\n    {\n        $this-&gt;__beforeTest();\n        \/\/ \u505a\u4e00\u4e9b\u4e8b\u60c5...\n        echo &#039;Parent-&gt;test()&#039;, PHP_EOL;\n        $this-&gt;__afterTest();\n    }\n\n    public abstract function __beforeTest();\n\n    public abstract function __afterTest();\n}\n\nclass Child extends ParentClass\n{\n    public function __beforeTest()\n    {\n        echo &#039;Child-&gt;__beforeTest()&#039;, PHP_EOL;\n    }\n\n    public function __afterTest()\n    {\n        echo &#039;Child-&gt;__afterTest()&#039;, PHP_EOL;\n    }\n}\n\n$child = new Child;\n$child-&gt;test();\u8fd0\u884c\u7ed3\u679c\uff1aChild-&gt;__beforeTest()\nParent-&gt;test()\nChild-&gt;__afterTest()\u8fd9\u79cd\u5199\u6cd5\u4f60\u9700\u8981\u4e8b\u5148\u5b9a\u4e49\u597d\u524d\u7f6e\u548c\u540e\u7f6e\u65b9\u6cd5\uff0c\u5982\u679c\u9700\u8981\u524d\u540e\u7f6e\u7684\u65b9\u6cd5\u4e00\u591a\uff0c\u5199\u8d77\u6765\u4f1a\u975e\u5e38\u7e41\u7410\u3002AOP \u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5728\u7f16\u5199\u4e0a\u4e0d\u7528\u4e8b\u5148\u5b9a\u4e49\u8fd9\u4e48\u591a\u65b9\u6cd5\uff0c\u8fd8\u975e\u5e38\u6709\u52a9\u4e8e\u89e3\u8026\u3002AOP \u540d\u8bcd\u5207\u9762 Aspect\u666e\u901a\u7684\u7c7b\uff0c\u4f60\u8981\u5207\u5165\u7684\u7c7b\u3002\u5207\u5165\u70b9 Pointcut\u666e\u901a\u7c7b\u4e2d\u7684\u65b9\u6cd5\uff0c\u4f60\u8981\u5207\u5165\u7684\u65b9\u6cd5\u3002\u8fde\u63a5\u70b9 Joinpoint\u5728\u8fd9\u4e2a\u65b9\u6cd5\u76f8\u5173\u7684\u4ec0\u4e48\u65f6\u673a\u89e6\u53d1\u901a\u77e5\uff0c\u6bd4\u5982\uff1a\u8c03\u7528\u7684\u524d\u7f6e\u540e\u7f6e\u3001\u629b\u51fa\u5f02\u5e38\u7b49\u3002\u901a\u77e5 Advice\u5728\u8fde\u63a5\u70b9\u89e6\u53d1\u7684\u901a\u77e5\uff0c\u6bd4\u5982\u5728\u524d\u7f6e\u64cd\u4f5c\u89e6\u53d1\uff0c\u901a\u77e5\u91cc\u5199\u524d\u7f6e\u7684\u5177\u4f53\u5b9e\u73b0\u3002imi \u652f\u6301\u7684\u901a\u77e5\u70b9\u6709\uff1a@Before\u524d\u7f6e\u64cd\u4f5c@After\u540e\u7f6e\u64cd\u4f5c@Around\u73af\u7ed5\u64cd\u4f5c\u3002\u5148\u89e6\u53d1\u73af\u7ed5\u64cd\u4f5c\uff0c\u5728\u524d\u7f6e\u64cd\u4f5c\u524d\u548c\u540e\u7f6e\u64cd\u4f5c\u540e\uff0c\u90fd\u53ef\u4ee5\u505a\u4e00\u4e9b\u4e8b\u60c5\u3002\u751a\u81f3\u53ef\u4ee5\u5b8c\u5168\u4e0d\u8ba9\u539f\u65b9\u6cd5\u8fd0\u884c\uff0c\u5728\u73af\u7ed5\u4e2d\u5b9e\u73b0\u8be5\u65b9\u6cd5\u529f\u80fd\u3002@AfterReturning\u5728\u539f\u65b9\u6cd5\u8fd4\u56de\u540e\u89e6\u53d1\uff0c\u53ef\u4ee5\u4fee\u6539\u8fd4\u56de\u503c@AfterThrowing\u5728\u629b\u51fa\u5f02\u5e38\u540e\u89e6\u53d1\uff0c\u5141\u8bb8\u8bbe\u7f6eallow\u548cdeny\uff0c\u8bbe\u7f6e\u5141\u8bb8\u548c\u62d2\u7edd\u6355\u83b7\u7684\u5f02\u5e38\u7c7b\u4f7f\u7528\u65b9\u6cd5\u4f7f\u7528\u6ce8\u89e3\u6ce8\u5165\u65b9\u6cd5\u76d1\u542c\u6c60\u5b50\u7684\u8d44\u6e90\u83b7\u53d6\u548c\u91ca\u653e\uff1a&lt;?php\nnamespace Test;\n\nuse Imi\\Aop\\JoinPoint;\nuse Imi\\Aop\\Annotation\\After;\nuse Imi\\Aop\\Annotation\\Aspect;\nuse Imi\\Aop\\Annotation\\PointCut;\n\n\/**\n * @Aspect\n *\/\nclass Pool\n{\n    \/**\n     * @PointCut(\n     *         allow={\n     *             &quot;Imi\\*Pool*::getResource&quot;,\n     *             &quot;Imi\\*Pool*::release&quot;,\n     *         }\n     * )\n     * @After\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function test(JoinPoint $joinPoint)\n    {\n        echo $joinPoint-&gt;getType() . &#039; &#039; . get_parent_class($joinPoint-&gt;getTarget()) . &#039;::&#039; . $joinPoint-&gt;getMethod() . &#039;(): &#039; . $joinPoint-&gt;getTarget()-&gt;getFree() . &#039;\/&#039; . $joinPoint-&gt;getTarget()-&gt;getCount() . PHP_EOL;\n    }\n}\u8fd0\u884c\u6548\u679c\uff1aafter Imi\\Redis\\CoroutineRedisPool::getResource(): 0\/1\nafter Imi\\Redis\\CoroutineRedisPool::release(): 1\/1\u7c7b\u540d\u3001\u65b9\u6cd5\u540d\u548c\u547d\u540d\u7a7a\u95f4\u6ca1\u6709\u8981\u6c42\uff0c\u53ea\u8981beanScan\u91cc\u80fd\u626b\u63cf\u5230\u5373\u53ef\u3002\u7c7b\u6ce8\u91ca\u4e2d\u5fc5\u987b\u5199@Aspect\u8868\u660e\u662f\u4e00\u4e2a\u5207\u9762\u7c7b\u65b9\u6cd5\u4e2d\u5199@PointCut\u8868\u793a\u6307\u5b9a\u5207\u5165\u70b9\uff0c\u652f\u6301\u901a\u914d\u7b26@After\u4ee3\u8868\u5728\u8be5\u65b9\u6cd5\u8c03\u7528\u540e\u89e6\u53d1\u6ce8\u5165\u5e26\u6709\u6ce8\u89e3\u7684\u65b9\u6cd5\u53ef\u53c2\u8003imi\\src\\Db\\Aop\\TransactionAop.php\u6587\u4ef6\uff1a\/**\n * @Aspect\n *\/\nclass TransactionAop\n{\n    \/**\n     * \u81ea\u52a8\u4e8b\u52a1\u652f\u6301\n     * @PointCut(\n     *         type=PointCutType::ANNOTATION,\n     *         allow={\n     *             Transaction::class\n     *         }\n     * )\n     * @Around\n     * @return mixed\n     *\/\n    public function parseTransaction(AroundJoinPoint $joinPoint)\n    {\n    }\n}\u65e0\u8bba\u8fd9\u4e2a\u6ce8\u89e3\u5728\u65b9\u6cd5\u4e0a\u51fa\u73b0\u4e86\u51e0\u6b21\uff0c\u90fd\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\u6ce8\u5165\u5904\u7406\u914d\u7f6e\u6ce8\u5165\u5b9e\u73b0\u4ee3\u7801namespace Test;\n\nuse Imi\\Aop\\JoinPoint;\n\nclass Test\n{\n    \/**\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function test(JoinPoint $joinPoint)\n    {\n        echo $joinPoint-&gt;getType() . &#039; &#039; . get_parent_class($joinPoint-&gt;getTarget()) . &#039;::&#039; . $joinPoint-&gt;getMethod() . &#039;(): &#039; . $joinPoint-&gt;getTarget()-&gt;getFree() . &#039;\/&#039; . $joinPoint-&gt;getTarget()-&gt;getCount() . PHP_EOL;\n    }\n}\u5bf9\u7c7b\u6ca1\u6709\u4efb\u4f55\u8981\u6c42\uff0c\u65b9\u6cd5\u53ea\u9700\u8981\u53c2\u6570\u5bf9\u5373\u53ef\u3002\u914d\u7f6e&lt;?php\nreturn [\n    \/\/ \u7c7b\u540d\n    \\Test\\Test::class    =&gt;    [\n        \/\/ \u56fa\u5b9a\u5199\u6cd5methods\n        &#039;methods&#039;    =&gt;    [\n            \/\/ \u65b9\u6cd5\u540d\n            &#039;test&#039;    =&gt;    [\n                \/\/ \u6307\u5b9a\u5207\u5165\u70b9\n                &#039;pointCut&#039;    =&gt;    [\n                    &#039;allow&#039;    =&gt;    [\n                        &quot;Imi\\*Pool*::getResource&quot;,\n                        &quot;Imi\\*Pool*::release&quot;,\n                    ]\n                ],\n                &#039;after&#039;    =&gt;    [\n                    \n                ]\n            ]\n        ]\n    ],\n];\u6240\u6709\u6ce8\u5165\u6f14\u793a&lt;?php\nnamespace Test;\n\nuse Imi\\Aop\\JoinPoint;\nuse Imi\\Aop\\AroundJoinPoint;\nuse Imi\\Aop\\Annotation\\After;\nuse Imi\\Aop\\Annotation\\Around;\nuse Imi\\Aop\\Annotation\\Aspect;\nuse Imi\\Aop\\Annotation\\Before;\nuse Imi\\Aop\\Annotation\\PointCut;\nuse Imi\\Aop\\AfterThrowingJoinPoint;\nuse Imi\\Aop\\AfterReturningJoinPoint;\nuse Imi\\Aop\\Annotation\\AfterThrowing;\nuse Imi\\Aop\\Annotation\\AfterReturning;\n\n\/**\n * @Aspect\n *\/\nclass Test\n{\n    \/**\n     * \u524d\u7f6e\u64cd\u4f5c\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @Before\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function before(JoinPoint $joinPoint)\n    {\n        \/\/ \u4fee\u6539\u53c2\u6570\n        \/\/ $joinPoint-&gt;setArgs(\/*\u53c2\u6570\u6570\u7ec4*\/);\n        echo &#039;getScore()-before&#039;, PHP_EOL;\n    }\n\n    \/**\n     * \u540e\u7f6e\u64cd\u4f5c\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @After\n     * @param JoinPoint $a\n     * @return void\n     *\/\n    public function after(JoinPoint $joinPoint)\n    {\n        echo &#039;getScore()-after&#039;, PHP_EOL;\n    }\n\n    \/**\n     * \u73af\u7ed5\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore1&quot;,\n     *         }\n     * )\n     * @Around\n     * @return mixed\n     *\/\n    public function around(AroundJoinPoint $joinPoint)\n    {\n        var_dump(&#039;\u8c03\u7528\u524d&#039;);\n        \/\/ \u8c03\u7528\u539f\u65b9\u6cd5\uff0c\u83b7\u53d6\u8fd4\u56de\u503c\n        $result = $joinPoint-&gt;proceed();\n        var_dump(&#039;\u8c03\u7528\u540e&#039;);\n        return &#039;value&#039;; \/\/ \u65e0\u89c6\u539f\u65b9\u6cd5\u8c03\u7528\u540e\u7684\u8fd4\u56de\u503c\uff0c\u5f3a\u5236\u8fd4\u56de\u4e00\u4e2a\u5176\u5b83\u503c\n        return $result; \/\/ \u8fd4\u56de\u539f\u65b9\u6cd5\u8fd4\u56de\u503c\n    }\n\n    \/**\n     * \u8fd4\u56de\u503c\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @AfterReturning\n     * @param AfterReturningJoinPoint $joinPoint\n     * @return void\n     *\/\n    public function afterReturning(AfterReturningJoinPoint $joinPoint)\n    {\n        $joinPoint-&gt;setReturnValue(&#039;\u4fee\u6539\u8fd4\u56de\u503c&#039;);\n    }\n\n    \/**\n     * \u5f02\u5e38\u6355\u83b7\n     * @PointCut(\n     *         allow={\n     *             &quot;ImiDemo\\HttpDemo\\MainServer\\Model\\Goods::getScore&quot;,\n     *         }\n     * )\n     * @AfterThrowing\n     * @param AfterThrowingJoinPoint $joinPoint\n     * @return void\n     *\/\n    public function afterThrowing(AfterThrowingJoinPoint $joinPoint)\n    {\n        \/\/ \u5f02\u5e38\u4e0d\u4f1a\u88ab\u7ee7\u7eed\u629b\u51fa\uff0c\u4e5f\u4e0d\u4f1a\u8bb0\u5f55\u65e5\u5fd7\n        $joinPoint-&gt;cancelThrow();\n        var_dump(&#039;\u5f02\u5e38\u6355\u83b7:&#039; . $joinPoint-&gt;getThrowable()-&gt;getMessage());\n        \/\/ \u5982\u6709\u9700\u8981\uff0c\u53ef\u4ee5\u624b\u52a8\u8bb0\u5f55\u4e0b\u65e5\u5fd7\uff1a\n        \\Imi\\App::getBean(&#039;ErrorLog&#039;)-&gt;onException($joinPoint-&gt;getThrowable());\n    }\n}\n\u5c5e\u6027\u6ce8\u5165\u5982\u4e0b\u4ee3\u7801\u4f8b\u5b50\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u4f7f\u7528@Inject\u6ce8\u89e3\u6765\u6ce8\u91ca\u5c5e\u6027\uff0c\u5728\u901a\u8fc7getBean()\u5b9e\u4f8b\u5316\u65f6\uff0c\u4f1a\u81ea\u52a8\u7ed9\u88ab\u6ce8\u91ca\u7684\u5c5e\u6027\u8d4b\u503c\u76f8\u5e94\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002namespace Test;\n\nclass TestClass\n{\n    \/**\n     * \u67d0Model\u5bf9\u8c61\n     * @Inject(&quot;XXX\\Model\\User&quot;)\n     *\/\n    protected $model;\n    \n    \/**\n     * \u67d0Model\u5bf9\u8c61\uff0c\u901a\u8fc7\u6ce8\u91ca\u7c7b\u578b\u6ce8\u5165\n     * @Inject\n     * \n     * @var XXX\\Model\\User\n     *\/\n    protected $model2;\n    \n    \/**\n     * \u67d0Model\u5bf9\u8c61\uff0c\u901a\u8fc7 PHP 7.4 \u4ee5\u4e0a\u7c7b\u578b\u58f0\u660e\u6ce8\u5165\n     * @Inject\n     *\/\n    protected XXX\\Model\\User $model3;\n\n    public function test()\n    {\n        var_dump($model-&gt;toArray());\n    }\n}\n\n$testClass = App::getBean(&#039;Test\\TestClass&#039;);\n$testClass-&gt;test();\u975e Bean \u7c7b\u4f7f\u7528\u5c5e\u6027\u6ce8\u5165imi \u63d0\u4f9b\u4e86\u4e00\u4e2a Imi\\Bean\\Traits\\TAutoInject \u6765\u8ba9\u975e Bean \u7c7b\u4e5f\u80fd\u591f\u4f7f\u7528\u5c5e\u6027\u6ce8\u5165\u3002\u4e5f\u5c31\u662f\u76f4\u63a5new\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u81ea\u52a8\u6ce8\u5165\u5c5e\u6027\u3002\u5f53\u7136\uff0c\u8fd9\u4e2a\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\u5fc5\u987b\u5728beanScan\u4e2d\u914d\u7f6e\uff0c\u80fd\u88ab\u626b\u63cf\u5230\u624d\u53ef\u4ee5\u6b63\u5e38\u6ce8\u5165\u3002\u65e0\u6784\u9020\u65b9\u6cd5\u7684\u7c7b\uff1anamespace Test;\n\nuse Imi\\Aop\\Annotation\\Inject;\n\nclass Test\n{\n    use Imi\\Bean\\Traits\\TAutoInject;\n\n    \/**\n     * @Inject(&quot;XXX&quot;)\n     *\/\n    public $xxx;\n}\n\n$test = new Test;\n$test-&gt;xxx; \/\/ \u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\uff0c\u4e0d\u7528\u624b\u52a8\u521d\u59cb\u5316\u6709\u6784\u9020\u65b9\u6cd5\u7684\u7c7b\uff1anamespace Test;\n\nuse Imi\\Aop\\Annotation\\Inject;\n\nclass Test\n{\n    use Imi\\Bean\\Traits\\TAutoInject;\n\n    \/**\n     * @Inject(&quot;XXX&quot;)\n     *\/\n    public $xxx;\n\n    private $value;\n\n    public function __construct()\n    {\n        $this-&gt;__autoInject(); \/\/ \u624b\u52a8\u8c03\u7528 __autoInject() \u65b9\u6cd5\n        $this-&gt;value = 123;\n    }\n}\n\n$test = new Test;\n$test-&gt;xxx; \/\/ \u4f1a\u88ab\u81ea\u52a8\u6ce8\u5165\uff0c\u4e0d\u7528\u624b\u52a8\u521d\u59cb\u5316\u65b9\u6cd5\u53c2\u6570\u6ce8\u5165\/**\n * @InjectArg(name=&quot;a&quot;, value=&quot;123&quot;)\n * @InjectArg(name=&quot;b&quot;, value=@Inject(&quot;\\ImiDemo\\HttpDemo\\MainServer\\Model\\User&quot;))\n *\n * @return void\n *\/\npublic function test($a, $b)\n{\n    var_dump($a, $b);\n}\u53ef\u4ee5\u76f4\u63a5\u6ce8\u5165\u503c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u503c\u6ce8\u5165\u6ce8\u89e3\u3002"},{"id":104,"title":"\u6587\u4ef6\u7f13\u5b58","pageTitle":"\u6587\u4ef6\u7f13\u5b58","url":"components\/cache\/file.html","content":"\u6587\u4ef6\u7f13\u5b58\u914d\u7f6e&lt;?php\nreturn [\n    &#039;caches&#039;    =&gt;    [\n        \/\/ \u7f13\u5b58\u540d\u79f0\n        &#039;alias1&#039;    =&gt;    [\n            \/\/ \u7f13\u5b58\u9a71\u52a8\u7c7b\n            &#039;handlerClass&#039;    =&gt;    \\Imi\\Cache\\Handler\\File::class,\n            \/\/ \u9a71\u52a8\u5b9e\u4f8b\u914d\u7f6e\n            &#039;option&#039;        =&gt;    [\n                &#039;savePath&#039;    =&gt;    &#039;\u6587\u4ef6\u7f13\u5b58\u4fdd\u5b58\u8def\u5f84&#039;,\n                &#039;formatHandlerClass&#039;    =&gt;    null, \/\/ \u6570\u636e\u8bfb\u5199\u4fee\u6539\u5668\n                \/\/ \u4fdd\u5b58\u6587\u4ef6\u540d\u5904\u7406\u56de\u8c03\uff0c\u4e00\u822c\u53ef\u4ee5\u4e0d\u5199\n                \/\/ &#039;saveFileNameCallback&#039;    =&gt;    function($savePath, $key){\n                \/\/     return &#039;&#039;;\n                \/\/ },\n            ],\n        ],\n    ],\n];formatHandlerClass \u53ef\u9009\uff1aImi\\Util\\Format\\Json\u3001Imi\\Util\\Format\\PhpSerialize\uff0c\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0Imi\\Util\\Format\\IFormat\u63a5\u53e3\u6587\u4ef6\u7f13\u5b58\u9664\u975e\u6302\u8f7d samba \u7b49\u7f51\u7edc\u78c1\u76d8\uff0c\u5426\u5219\u4e0d\u652f\u6301\u5206\u5e03\u5f0f\u5b58\u50a8\uff0c\u8bf7\u614e\u91cd\u9009\u62e9\uff01"},{"id":103,"title":"\u7f13\u5b58","pageTitle":"\u7f13\u5b58","url":"components\/cache\/index.html","content":"\u7f13\u5b58imi \u4e2d\u7684\u7f13\u5b58\uff0c\u7b26\u5408PSR-16\u89c4\u8303\u3002\u4f7f\u7528\u65f6\u9700\u8981\u5148\u914d\u7f6e\u9a71\u52a8\u548c\u5b9e\u4f8b\u3002\u914d\u7f6e\u9ed8\u8ba4\u7f13\u5b58\u8bbe\u7f6e&lt;?php\nreturn [\n    &#039;cache&#039;    =&gt;    [\n        &#039;default&#039;    =&gt;    &#039;alias1&#039;,\n    ],\n];\u624b\u52a8\u4f7f\u7528\u5199\u5165\u7f13\u5b58\/\/ \u6c38\u4e45\u6709\u6548\nImi\\Cache\\CacheManager::set(&#039;\u7f13\u5b58\u540d\u79f0&#039;, &#039;key&#039;, &#039;value&#039;);\n\n$ttl = 3600; \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\nImi\\Cache\\CacheManager::set(&#039;\u7f13\u5b58\u540d\u79f0&#039;, &#039;key&#039;, &#039;value&#039;, $ttl);\u6279\u91cf\u5199\u5165\u7f13\u5b58$values = [\n    &#039;k1&#039;    =&gt;    &#039;v1&#039;,\n    &#039;k2&#039;    =&gt;    &#039;v2&#039;,\n];\nImi\\Cache\\CacheManager::setMultiple(&#039;\u7f13\u5b58\u540d\u79f0&#039;, $values);\n\n$ttl = 3600; \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\nImi\\Cache\\CacheManager::setMultiple(&#039;\u7f13\u5b58\u540d\u79f0&#039;, $values, $ttl);\u8bfb\u53d6\u7f13\u5b58Imi\\Cache\\CacheManager::get(&#039;\u7f13\u5b58\u540d\u79f0&#039;, &#039;key&#039;);\n\nImi\\Cache\\CacheManager::get(&#039;\u7f13\u5b58\u540d\u79f0&#039;, &#039;key&#039;, &#039;default&#039;);\u6279\u91cf\u8bfb\u53d6\u7f13\u5b58$keys = [&#039;k1&#039;, &#039;k2&#039;];\n\nImi\\Cache\\CacheManager::getMultiple(&#039;\u7f13\u5b58\u540d\u79f0&#039;, $keys);\n\nImi\\Cache\\CacheManager::getMultiple(&#039;\u7f13\u5b58\u540d\u79f0&#039;, $keys, &#039;default&#039;);\u5220\u9664\u7f13\u5b58Imi\\Cache\\CacheManager::delete(&#039;\u7f13\u5b58\u540d\u79f0&#039;, &#039;key&#039;);\u6279\u91cf\u5220\u9664\u7f13\u5b58$keys = [&#039;k1&#039;, &#039;k2&#039;];\n\nImi\\Cache\\CacheManager::deleteMultiple(&#039;\u7f13\u5b58\u540d\u79f0&#039;, $keys);\u7f13\u5b58\u662f\u5426\u5b58\u5728Imi\\Cache\\CacheManager::has(&#039;\u7f13\u5b58\u540d\u79f0&#039;, &#039;key&#039;);\u6e05\u7a7a\u7f13\u5b58Imi\\Cache\\CacheManager::clear(&#039;\u7f13\u5b58\u540d\u79f0&#039;);\u6ce8\u89e3\u4f7f\u7528\u9664\u4e86\u624b\u52a8\u63a7\u5236\u7f13\u5b58\u8bfb\u5199\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u6765\u505a\uff0c\u771f\u7684\u7092\u9e21\u65b9\u4fbf\u54e6\uff01\u9996\u5148\u6765\u8ba4\u8bc6\u4e00\u4e0b imi \u4e2d\u7684\u7f13\u5b58\u6ce8\u89e3\u5427\uff01@Cacheable\u8c03\u7528\u65b9\u6cd5\u524d\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u7f13\u5b58\uff0c\u5982\u679c\u5b58\u5728\u76f4\u63a5\u8fd4\u56de\uff1b\u4e0d\u5b58\u5728\u5219\u6267\u884c\u65b9\u6cd5\u4f53\uff0c\u7136\u540e\u5c06\u8fd4\u56de\u503c\u5b58\u5165\u7f13\u5b58\u7528\u6cd5\uff1a\u57fa\u672c\u7528\u6cd5\uff1a@Cacheable(name=&quot;\u7f13\u5b58\u5668\u540d\uff0c\u4e3anull\u5219\u53d6cache.default\u914d\u7f6e&quot;, key=&quot;\u7f13\u5b58\u952e\u540d\uff0c\u652f\u6301{id}\u3001{data.name}\u3001{:args}(\u6240\u6709\u53c2\u6570\u7684hash\u503c)\u5f62\u5f0f\uff0c\u4ee3\u5165\u53c2\u6570\uff0c\u5982\u679c\u4e3anull\uff0c\u5219\u4f7f\u7528\u7c7b\u540d+\u65b9\u6cd5\u540d+\u5168\u90e8\u53c2\u6570\uff0c\u5e8f\u5217\u5316\u540ehash&quot;, ttl=&quot;\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2&quot;, lockable=&quot;Lock \u6ce8\u89e3\uff0c\u5728\u8c03\u7528\u65b9\u6cd5\u4f53\u524d\u540e\u52a0\u9501&quot;, hashMethod=&quot;md5&quot;)\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\uff1a\/*\n * @Cacheable(\n *   key=&quot;index:{page}&quot;,\n *   ttl=10,\n *   lockable=@Lockable(\n *     id=&quot;index:{page}&quot;,\n *     waitTimeout=999999,\n *   ),\n *   preventBreakdown=true,\n * )\n *\/lockable \u7528\u6cd5\u8bf7\u53c2\u8003 LockpreventBreakdown \u5982\u679c\u8bbe\u4e3a true\uff0c\u4f1a\u5728\u83b7\u5f97\u9501\u540e\uff0c\u5c1d\u8bd5\u83b7\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u7f13\u5b58\u5b58\u5728\u5219\u4e0d\u518d\u6267\u884c\u65b9\u6cd5\u4f53\u5982\u679c preventBreakdown \u8bbe\u4e3a true\uff0c\u5e76\u4e14lockable\u4e2d\u4e5f\u8bbe\u5b9a\u4e86afterLock\uff0c\u4f18\u5148\u7ea7\u4e3a\uff1aafterLock &gt; \u7f13\u5b58\u68c0\u6d4b@CacheEvict\u7f13\u5b58\u9a71\u9010\u6ce8\u89e3\uff0c\u65b9\u6cd5\u4f53\u6267\u884c\u65f6\uff0c\u5c06\u6307\u5b9a\u7f13\u5b58\u6e05\u9664\u7528\u6cd5\uff1a\u5728\u65b9\u6cd5\u6267\u884c\u524d\u5220\u9664\u7f13\u5b58\uff1a@CacheEvict(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, beforeInvocation=true, hashMethod=&quot;md5&quot;)\u5728\u65b9\u6cd5\u6267\u884c\u540e\u5220\u9664\u7f13\u5b58\uff1a@CacheEvict(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, hashMethod=&quot;md5&quot;)@CachePut\u65b9\u6cd5\u4f53\u6267\u884c\u540e\uff0c\u5c06\u8fd4\u56de\u503c\u5b58\u5165\u7f13\u5b58\u7528\u6cd5\uff1a\u5c06\u65b9\u6cd5\u8fd4\u56de\u503c\u5168\u90e8\u5199\u5165\u7f13\u5b58\uff1a@CachePut(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, ttl=&quot;\u540c\u4e0a&quot;, hashMethod=&quot;md5&quot;)\u5c06\u65b9\u6cd5\u8fd4\u56de\u503c\u7684\u4e00\u90e8\u5206\u5199\u5165\u7f13\u5b58\uff1a@CachePut(name=&quot;\u540c\u4e0a&quot;, key=&quot;\u540c\u4e0a&quot;, ttl=&quot;\u540c\u4e0a&quot;, value=&quot;a.b&quot;, hashMethod=&quot;md5&quot;)\u4e0a\u9762\u7684\u6ce8\u89e3\uff0c\u5982\u679c\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3a\uff1a[\n    &#039;a&#039; =&gt;  [\n        &#039;b&#039; =&gt;  123,\n    ],\n]\u5219\u4f1a\u5c06123\u5199\u5165\u7f13\u5b58\u3002"},{"id":105,"title":"Redis Cache","pageTitle":"Redis Cache","url":"components\/cache\/redis.html","content":"Redis Cache\u4f7f\u7528 redis \u7684 set \u548c get \u65b9\u6cd5\u5b9e\u73b0\uff0c\u652f\u6301 ttl\u914d\u7f6ereturn [\n    &#039;caches&#039;    =&gt;    [\n        \/\/ \u7f13\u5b58\u540d\u79f0\n        &#039;alias1&#039;    =&gt;    [\n            \/\/ \u7f13\u5b58\u9a71\u52a8\u7c7b\n            &#039;handlerClass&#039;    =&gt;    \\Imi\\Cache\\Handler\\Redis::class,\n            \/\/ \u9a71\u52a8\u5b9e\u4f8b\u914d\u7f6e\n            &#039;option&#039;        =&gt;    [\n                &#039;poolName&#039;              =&gt;  &#039;\u8fde\u63a5\u6c60\u540d\u79f0&#039;,\n                &#039;prefix&#039;                =&gt;  &#039;&#039;, \/\/ \u7f13\u5b58\u952e\u524d\u7f00\n                &#039;formatHandlerClass&#039;    =&gt;  null, \/\/ \u6570\u636e\u8bfb\u5199\u4fee\u6539\u5668\n                &#039;replaceDot&#039;            =&gt;  false, \/\/ \u5c06 key \u4e2d\u7684 &quot;.&quot; \u66ff\u6362\u4e3a &quot;:&quot;\n            ],\n        ],\n    ],\n];formatHandlerClass \u53ef\u9009\uff1aImi\\Util\\Format\\Json\u3001Imi\\Util\\Format\\PhpSerialize\uff0c\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0Imi\\Util\\Format\\IFormat\u63a5\u53e3"},{"id":106,"title":"Redis Cache","pageTitle":"Redis Cache","url":"components\/cache\/redisHash.html","content":"Redis Cache\u4f7f\u7528 redis \u7684 hash\uff0c\u5373 hset \u548c hget \u65b9\u6cd5\u5b9e\u73b0\uff0c\u4e0d\u652f\u6301ttl\u4f7f\u7528\u65f6\u9700\u8981\u6ce8\u610f\uff0ckey\u683c\u5f0f\u4e3ahashkey-&gt;member\uff0c\u5373\u4e3a$redis-&gt;hget(&#039;hashkey&#039;, &#039;member&#039;)\u914d\u7f6ereturn [\n    &#039;caches&#039;    =&gt;    [\n        \/\/ \u7f13\u5b58\u540d\u79f0\n        &#039;alias1&#039;    =&gt;    [\n            \/\/ \u7f13\u5b58\u9a71\u52a8\u7c7b\n            &#039;handlerClass&#039;    =&gt;    \\Imi\\Cache\\Handler\\RedisHash::class,\n            \/\/ \u9a71\u52a8\u5b9e\u4f8b\u914d\u7f6e\n            &#039;option&#039;        =&gt;    [\n                &#039;poolName&#039;    =&gt;    &#039;\u8fde\u63a5\u6c60\u540d\u79f0&#039;,\n                &#039;separator&#039; =&gt;    &#039;\u5206\u9694\u7b26\uff0c\u5206\u9694 hash key\u548c member\uff0c\u9ed8\u8ba4\u4e3a-&gt;&#039;,\n                &#039;defaultHashKey&#039;    =&gt;    &#039;imi:RedisHashCache&#039;, \/\/ \u9ed8\u8ba4\u7f3a\u7701\u7684 hash key\n                &#039;formatHandlerClass&#039;    =&gt;    null, \/\/ \u6570\u636e\u8bfb\u5199\u4fee\u6539\u5668\n            ],\n        ],\n    ],\n];formatHandlerClass \u53ef\u9009\uff1aImi\\Util\\Format\\Json\u3001Imi\\Util\\Format\\PhpSerialize\uff0c\u6216\u8005\u53ef\u4ee5\u81ea\u884c\u5b9e\u73b0Imi\\Util\\Format\\IFormat\u63a5\u53e3"},{"id":78,"title":"\u914d\u7f6e(Config)","pageTitle":"\u914d\u7f6e(Config)","url":"components\/config\/index.html","content":"\u914d\u7f6e(Config)\u5173\u4e8e\u914d\u7f6e\u6587\u4ef6\u7684\u5b9a\u4e49\uff0c\u8bf7\u770b\u57fa\u7840\u5165\u95e8-\u914d\u7f6e\u6587\u4ef6\u7ae0\u8282\u3002\u8bfb\u53d6\u914d\u7f6e\u7c7b\uff1aImi\\Config\u8bfb\u53d6\u9879\u76ee\u914d\u7f6eecho Config::get(&#039;@app.namespace&#039;); \/\/ namespace \u53ef\u4ee5\u6362\u4e3a\u5176\u5b83\u7684\u8282\u8bfb\u53d6\u4e3b\u670d\u52a1\u5668\u914d\u7f6eecho Config::get(&#039;@server.main.namespace&#039;); \/\/ namespace \u53ef\u4ee5\u6362\u4e3a\u5176\u5b83\u7684\u8282\u8bfb\u53d6\u5b50\u670d\u52a1\u5668\u914d\u7f6e\/\/ \u5982\u5b50\u670d\u52a1\u5668\u540d\u4e3aabc\uff0c\u8bfb\u53d6\u5b83\u4e0b\u9762\u7684\u914d\u7f6e\necho Config::get(&#039;@server.abc.namespace&#039;); \/\/ namespace \u53ef\u4ee5\u6362\u4e3a\u5176\u5b83\u7684\u8282\u667a\u80fd\u8bfb\u53d6\u4f18\u5148\u8bfb\u53d6\u5f53\u524d\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u5219\u53d6\u9879\u76ee\u914d\u7f6e\uff08@app\uff09echo Config::get(&#039;@currentServer.db.default&#039;);"},{"id":81,"title":"\u6570\u636e\u5e93","pageTitle":"\u6570\u636e\u5e93","url":"components\/db\/index.html","content":"\u6570\u636e\u5e93\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u914d\u7f6e\u65b9\u5f0f\u5df2\u7ecf\u5728\u8fde\u63a5\u6c60\u91cc\u8bb2\u8fc7\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u4e86\uff0c\u76f4\u63a5\u8bf4\u4f7f\u7528\u65b9\u6cd5\u3002\u8fde\u63a5\u6c60\u914d\u7f6e\u6807\u51c6\u5199\u6cd5\uff1a\u4ece imi v1.2.1 \u7248\u672c\u5f00\u59cb\u652f\u6301&lt;?php\nreturn [\n    &#039;db&#039;    =&gt; [\n        &#039;defaultPool&#039;   =&gt; &#039;alias1&#039;, \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\n        &#039;statement&#039;     =&gt;  [\n            &#039;cache&#039; =&gt;  true, \/\/ \u662f\u5426\u5f00\u542f statement \u7f13\u5b58\uff0c\u9ed8\u8ba4\u5f00\u542f\n        ],\n    ],\n    &#039;pools&#039; =&gt; [\n        \/\/ \u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;alias1&#039; =&gt; [\n            &#039;pool&#039; =&gt; [\n                \/\/ \u540c\u6b65\u6c60\u7c7b\u540d\n                &#039;syncClass&#039;     =&gt;    \\Imi\\Db\\Pool\\SyncDbPool::class,\n                \/\/ \u534f\u7a0b\u6c60\u7c7b\u540d\n                &#039;asyncClass&#039;    =&gt;    \\Imi\\Db\\Pool\\CoroutineDbPool::class,\n                \/\/ \u8fde\u63a5\u6c60\u914d\u7f6e\n                &#039;config&#039; =&gt; [\n                    \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                    \/\/ &#039;maxResources&#039; =&gt; 10,\n                    \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                    \/\/ &#039;minResources&#039; =&gt; 2,\n                    \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;gcInterval&#039; =&gt; 60,\n                    \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;maxActiveTime&#039; =&gt; 3600,\n                    \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                    \/\/ &#039;waitTimeout&#039; =&gt; 3000,\n                    \/\/ \u5fc3\u8df3\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;heartbeatInterval&#039; =&gt; null,\n                    \/\/ \u5f53\u83b7\u53d6\u8d44\u6e90\u65f6\uff0c\u662f\u5426\u68c0\u67e5\u72b6\u6001\n                    \/\/ &#039;checkStateWhenGetResource&#039; =&gt; true,\n                    \/\/ \u6bcf\u6b21\u83b7\u53d6\u8d44\u6e90\u6700\u957f\u4f7f\u7528\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                    \/\/ &#039;maxUsedTime&#039; =&gt; null,\n                    \/\/ \u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u68c0\u67e5\u72b6\u6001\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u652f\u6301\u5c0f\u6570\u7684\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                    \/\/ &#039;requestResourceCheckInterval&#039; =&gt; 30,\n                    \/\/ \u8d1f\u8f7d\u5747\u8861-\u8f6e\u6d41\n                    \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::TURN,\n                    \/\/ \u8d1f\u8f7d\u5747\u8861-\u968f\u673a\n                    \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::RANDOM,\n                ],\n            ],\n            \/\/ \u8fde\u63a5\u6c60\u8d44\u6e90\u914d\u7f6e\n            &#039;resource&#039; =&gt; [\n                &#039;host&#039; =&gt; &#039;127.0.0.1&#039;,\n                &#039;username&#039; =&gt; &#039;root&#039;,\n                &#039;password&#039; =&gt; &#039;root&#039;,\n                &#039;database&#039; =&gt; &#039;database&#039;,\n                \/\/ &#039;port&#039;    =&gt; &#039;3306&#039;,\n                \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                \/\/ \u4f7f\u7528 hook pdo \u9a71\u52a8\uff08\u7f3a\u7701\u9ed8\u8ba4\uff09\n                \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\PdoMysql\\Driver::class,\n                \/\/ \u4f7f\u7528 hook mysqli \u9a71\u52a8\n                \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Mysqli\\Driver::class,\n                \/\/ \u4f7f\u7528 Swoole MySQL \u9a71\u52a8\n                \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Swoole\\Driver::class,\n                \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                \/\/ &#039;initSqls&#039; =&gt; [\n                \/\/     &#039;select 1&#039;,\n                \/\/     &#039;select 2&#039;,\n                \/\/ ],\n            ],\n            \/\/ uri \u5199\u6cd5\n            \/\/ &#039;resource&#039;  =&gt;  [\n            \/\/     &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n            \/\/     &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n            \/\/ ],\n            \/\/ &#039;resource&#039;  =&gt;  &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n        ],\n        \/\/ \u4ece\u5e93\u914d\u7f6e\n        \/\/ \u539f\u8fde\u63a5\u6c60\u540d\u540e\u52a0.slave\u5373\u4e3a\u4ece\u5e93\u914d\u7f6e\uff0c\u975e\u5fc5\u8bbe\n        \/\/ \u5982\u679c\u914d\u7f6e\u4e86\uff0c\u9ed8\u8ba4\u67e5\u8be2\u8d70\u4ece\u5e93\uff0c\u589e\u5220\u6539\u8d70\u4e3b\u5e93\n        \/\/ \u5982\u679c\u5728\u4e8b\u52a1\u4e2d\uff0c\u9ed8\u8ba4\u90fd\u8d70\u4e3b\u5e93\n        &#039;alias1.slave&#039; =&gt; [\n            &#039;pool&#039; =&gt; [\n                \/\/ \u540c\u6b65\u6c60\u7c7b\u540d\n                &#039;syncClass&#039;     =&gt;    \\Imi\\Db\\Pool\\SyncDbPool::class,\n                \/\/ \u534f\u7a0b\u6c60\u7c7b\u540d\n                &#039;asyncClass&#039;    =&gt;    \\Imi\\Db\\Pool\\CoroutineDbPool::class,\n                \/\/ \u8fde\u63a5\u6c60\u914d\u7f6e\n                &#039;config&#039; =&gt; [\n                    \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                    \/\/ &#039;maxResources&#039; =&gt; 10,\n                    \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                    \/\/ &#039;minResources&#039; =&gt; 2,\n                    \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;gcInterval&#039; =&gt; 60,\n                    \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;maxActiveTime&#039; =&gt; 3600,\n                    \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                    \/\/ &#039;waitTimeout&#039; =&gt; 3000,\n                    \/\/ \u5fc3\u8df3\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;heartbeatInterval&#039; =&gt; null,\n                    \/\/ \u5f53\u83b7\u53d6\u8d44\u6e90\u65f6\uff0c\u662f\u5426\u68c0\u67e5\u72b6\u6001\n                    \/\/ &#039;checkStateWhenGetResource&#039; =&gt; true,\n                    \/\/ \u6bcf\u6b21\u83b7\u53d6\u8d44\u6e90\u6700\u957f\u4f7f\u7528\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                    \/\/ &#039;maxUsedTime&#039; =&gt; null,\n                    \/\/ \u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u68c0\u67e5\u72b6\u6001\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u652f\u6301\u5c0f\u6570\u7684\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                    \/\/ &#039;requestResourceCheckInterval&#039; =&gt; 30,\n                    \/\/ \u8d1f\u8f7d\u5747\u8861-\u8f6e\u6d41\n                    \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::TURN,\n                    \/\/ \u8d1f\u8f7d\u5747\u8861-\u968f\u673a\n                    \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::RANDOM,\n                ],\n            ],\n            \/\/ \u8fde\u63a5\u6c60\u8d44\u6e90\u914d\u7f6e\n            &#039;resource&#039; =&gt; [\n                &#039;host&#039; =&gt; &#039;127.0.0.1&#039;,\n                &#039;username&#039; =&gt; &#039;root&#039;,\n                &#039;password&#039; =&gt; &#039;root&#039;,\n                &#039;database&#039; =&gt; &#039;database&#039;,\n                \/\/ &#039;port&#039;    =&gt; &#039;3306&#039;,\n                \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                \/\/ \u4f7f\u7528 hook pdo \u9a71\u52a8\uff08\u7f3a\u7701\u9ed8\u8ba4\uff09\n                \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\PdoMysql\\Driver::class,\n                \/\/ \u4f7f\u7528 hook mysqli \u9a71\u52a8\n                \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Mysqli\\Driver::class,\n                \/\/ \u4f7f\u7528 Swoole MySQL \u9a71\u52a8\n                \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Swoole\\Driver::class,\n                \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                \/\/ &#039;initSqls&#039; =&gt; [\n                \/\/     &#039;select 1&#039;,\n                \/\/     &#039;select 2&#039;,\n                \/\/ ],\n            ],\n            \/\/ uri \u5199\u6cd5\n            \/\/ &#039;resource&#039;  =&gt;  [\n            \/\/     &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n            \/\/     &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n            \/\/ ],\n            \/\/ &#039;resource&#039;  =&gt;  &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n        ]\n    ],\n];\u65e7\u5199\u6cd5\uff1a\u4f9d\u7136\u652f\u6301\uff0c\u4f46\u4e0d\u518d\u63a8\u8350&lt;?php\nreturn [\n    &#039;db&#039;    =&gt; [\n        &#039;defaultPool&#039;   =&gt; &#039;alias1&#039;, \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\n        &#039;statement&#039;     =&gt;  [\n            &#039;cache&#039; =&gt;  true, \/\/ \u662f\u5426\u5f00\u542f statement \u7f13\u5b58\uff0c\u9ed8\u8ba4\u5f00\u542f\n        ],\n    ],\n    &#039;pools&#039; =&gt; [\n        \/\/ \u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;alias1&#039; =&gt; [\n            \/\/ \u540c\u6b65\u6c60\u5b50\uff0ctask\u8fdb\u7a0b\u4f7f\u7528\n            &#039;sync&#039; =&gt; [\n                &#039;pool&#039; =&gt; [\n                    &#039;class&#039; =&gt; \\Imi\\Db\\Pool\\SyncDbPool::class,\n                    &#039;config&#039; =&gt; [\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                        \/\/ &#039;maxResources&#039; =&gt; 10,\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                        \/\/ &#039;minResources&#039; =&gt; 2,\n                        \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;gcInterval&#039; =&gt; 60,\n                        \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;maxActiveTime&#039; =&gt; 3600,\n                        \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                        \/\/ &#039;waitTimeout&#039; =&gt; 3000,\n                        \/\/ \u5fc3\u8df3\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;heartbeatInterval&#039; =&gt; null,\n                        \/\/ \u5f53\u83b7\u53d6\u8d44\u6e90\u65f6\uff0c\u662f\u5426\u68c0\u67e5\u72b6\u6001\n                        \/\/ &#039;checkStateWhenGetResource&#039; =&gt; true,\n                        \/\/ \u6bcf\u6b21\u83b7\u53d6\u8d44\u6e90\u6700\u957f\u4f7f\u7528\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                        \/\/ &#039;maxUsedTime&#039; =&gt; null,\n                        \/\/ \u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u68c0\u67e5\u72b6\u6001\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u652f\u6301\u5c0f\u6570\u7684\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                        \/\/ &#039;requestResourceCheckInterval&#039; =&gt; 30,\n                        \/\/ \u8d1f\u8f7d\u5747\u8861-\u8f6e\u6d41\n                        \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::TURN,\n                        \/\/ \u8d1f\u8f7d\u5747\u8861-\u968f\u673a\n                        \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::RANDOM,\n                    ],\n                ],\n                &#039;resource&#039; =&gt; [\n                    &#039;host&#039; =&gt; &#039;127.0.0.1&#039;,\n                    &#039;username&#039; =&gt; &#039;root&#039;,\n                    &#039;password&#039; =&gt; &#039;root&#039;,\n                    &#039;database&#039; =&gt; &#039;database&#039;,\n                    \/\/ &#039;port&#039;    =&gt; &#039;3306&#039;,\n                    \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                    \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                    \/\/ &#039;strict_type&#039; =&gt; false, \/\/\u5f00\u542f\u4e25\u683c\u6a21\u5f0f\uff0c\u8fd4\u56de\u7684\u5b57\u6bb5\u5c06\u81ea\u52a8\u8f6c\u4e3a\u6570\u5b57\u7c7b\u578b\n                    \/\/ \u4f7f\u7528 hook pdo \u9a71\u52a8\uff08\u7f3a\u7701\u9ed8\u8ba4\uff09\n                    \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\PdoMysql\\Driver::class,\n                    \/\/ \u4f7f\u7528 hook mysqli \u9a71\u52a8\n                    \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Mysqli\\Driver::class,\n                    \/\/ \u4f7f\u7528 Swoole MySQL \u9a71\u52a8\n                    \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Swoole\\Driver::class,\n                    \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                    \/\/ &#039;initSqls&#039; =&gt; [\n                    \/\/     &#039;select 1&#039;,\n                    \/\/     &#039;select 2&#039;,\n                    \/\/ ],\n                ],\n            ],\n            \/\/ \u5f02\u6b65\u6c60\u5b50\uff0cworker\u8fdb\u7a0b\u4f7f\u7528\n            &#039;async&#039; =&gt; [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\Db\\Pool\\CoroutineDbPool::class,\n                    &#039;config&#039;    =&gt;    [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                \/\/ resource\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u8fde\u63a5\n                &#039;resource&#039;    =&gt;    [\n                    [\n                        &#039;host&#039;        =&gt; &#039;127.0.0.1&#039;,\n                        &#039;username&#039;        =&gt; &#039;root&#039;,\n                        &#039;password&#039;    =&gt; &#039;root&#039;,\n                        &#039;database&#039;    =&gt; &#039;database&#039;,\n                        \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                        \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                        \/\/ &#039;options&#039; =&gt; [], \/\/ PDO\u8fde\u63a5\u9009\u9879\n                        \/\/ \u4f7f\u7528 hook pdo \u9a71\u52a8\uff08\u7f3a\u7701\u9ed8\u8ba4\uff09\n                        \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\PdoMysql\\Driver::class,\n                        \/\/ \u4f7f\u7528 hook mysqli \u9a71\u52a8\n                        \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Mysqli\\Driver::class,\n                        \/\/ \u4f7f\u7528 Swoole MySQL \u9a71\u52a8\n                        \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Swoole\\Driver::class,\n                        \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                        \/\/ &#039;initSqls&#039; =&gt; [\n                        \/\/     &#039;select 1&#039;,\n                        \/\/     &#039;select 2&#039;,\n                        \/\/ ],\n                    ],\n                    [\n                        &#039;host&#039;        =&gt; &#039;127.0.0.2&#039;,\n                        &#039;username&#039;        =&gt; &#039;root&#039;,\n                        &#039;password&#039;    =&gt; &#039;root&#039;,\n                        &#039;database&#039;    =&gt; &#039;database&#039;,\n                        \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                        \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                        \/\/ &#039;options&#039; =&gt; [], \/\/ PDO\u8fde\u63a5\u9009\u9879\n                        \/\/ \u4f7f\u7528 hook pdo \u9a71\u52a8\uff08\u7f3a\u7701\u9ed8\u8ba4\uff09\n                        \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\PdoMysql\\Driver::class,\n                        \/\/ \u4f7f\u7528 hook mysqli \u9a71\u52a8\n                        \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Mysqli\\Driver::class,\n                        \/\/ \u4f7f\u7528 Swoole MySQL \u9a71\u52a8\n                        \/\/ &#039;dbClass&#039; =&gt; \\Imi\\Db\\Drivers\\Swoole\\Driver::class,\n                        \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                        \/\/ &#039;initSqls&#039; =&gt; [\n                        \/\/     &#039;select 1&#039;,\n                        \/\/     &#039;select 2&#039;,\n                        \/\/ ],\n                    ]\n                ],\n            ],\n        ],\n        \/\/ \u4ece\u5e93\u914d\u7f6e\n        \/\/ \u539f\u8fde\u63a5\u6c60\u540d\u540e\u52a0.slave\u5373\u4e3a\u4ece\u5e93\u914d\u7f6e\uff0c\u975e\u5fc5\u8bbe\n        \/\/ \u5982\u679c\u914d\u7f6e\u4e86\uff0c\u9ed8\u8ba4\u67e5\u8be2\u8d70\u4ece\u5e93\uff0c\u589e\u5220\u6539\u8d70\u4e3b\u5e93\n        \/\/ \u5982\u679c\u5728\u4e8b\u52a1\u4e2d\uff0c\u9ed8\u8ba4\u90fd\u8d70\u4e3b\u5e93\n        &#039;alias1.slave&#039; =&gt; [\n            \/\/ \u540c\u6b65\u6c60\u5b50\uff0ctask\u8fdb\u7a0b\u4f7f\u7528\n            &#039;sync&#039; =&gt; [\n                &#039;pool&#039; =&gt; [\n                    &#039;class&#039; =&gt; \\Imi\\Db\\Pool\\SyncDbPool::class,\n                    &#039;config&#039; =&gt; [\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                        \/\/ &#039;maxResources&#039; =&gt; 10,\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                        \/\/ &#039;minResources&#039; =&gt; 2,\n                        \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;gcInterval&#039; =&gt; 60,\n                        \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;maxActiveTime&#039; =&gt; 3600,\n                        \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                        \/\/ &#039;waitTimeout&#039; =&gt; 3000,\n                    ],\n                ],\n                &#039;resource&#039; =&gt; [\n                    &#039;host&#039; =&gt; &#039;127.0.0.1&#039;,\n                    &#039;username&#039; =&gt; &#039;root&#039;,\n                    &#039;password&#039; =&gt; &#039;root&#039;,\n                    &#039;database&#039; =&gt; &#039;database&#039;,\n                    \/\/ &#039;port&#039;    =&gt; &#039;3306&#039;,\n                    \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                    \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                    \/\/ &#039;strict_type&#039; =&gt; false, \/\/\u5f00\u542f\u4e25\u683c\u6a21\u5f0f\uff0c\u8fd4\u56de\u7684\u5b57\u6bb5\u5c06\u81ea\u52a8\u8f6c\u4e3a\u6570\u5b57\u7c7b\u578b\n                    \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                    \/\/ &#039;initSqls&#039; =&gt; [\n                    \/\/     &#039;select 1&#039;,\n                    \/\/     &#039;select 2&#039;,\n                    \/\/ ],\n                ],\n            ],\n            \/\/ \u5f02\u6b65\u6c60\u5b50\uff0cworker\u8fdb\u7a0b\u4f7f\u7528\n            &#039;async&#039; =&gt; [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\Db\\Pool\\CoroutineDbPool::class,\n                    &#039;config&#039;    =&gt;    [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                &#039;resource&#039;    =&gt;    [\n                    &#039;host&#039;        =&gt; &#039;127.0.0.1&#039;,\n                    &#039;username&#039;        =&gt; &#039;root&#039;,\n                    &#039;password&#039;    =&gt; &#039;root&#039;,\n                    &#039;database&#039;    =&gt; &#039;database&#039;,\n                    \/\/ &#039;timeout&#039; =&gt; &#039;\u5efa\u7acb\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4&#039;,\n                    \/\/ &#039;charset&#039; =&gt; &#039;&#039;,\n                    \/\/ &#039;options&#039; =&gt; [], \/\/ PDO\u8fde\u63a5\u9009\u9879\n                    \/\/ \u6570\u636e\u5e93\u8fde\u63a5\u540e\uff0c\u6267\u884c\u521d\u59cb\u5316\u7684 SQL\n                    \/\/ &#039;initSqls&#039; =&gt; [\n                    \/\/     &#039;select 1&#039;,\n                    \/\/     &#039;select 2&#039;,\n                    \/\/ ],\n                ],\n                \/\/ uri \u5199\u6cd5\n                \/\/ &#039;resource&#039;  =&gt;  [\n                \/\/     &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n                \/\/     &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n                \/\/ ],\n                \/\/ &#039;resource&#039;  =&gt;  &#039;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60;tcp:\/\/192.168.0.222\/?username=root&amp;password=root&amp;database=db_test&amp;timeout=60&#039;,\n            ],\n        ]\n    ],\n];Db \u9a71\u52a8\u5bf9\u8c61\u64cd\u4f5c\u7528\u4e8e\u76f4\u63a5\u6267\u884c SQL\/\/ \u83b7\u53d6\u65b0\u7684\u6570\u636e\u5e93\u8fde\u63a5\u5b9e\u4f8b\n$db = Db::getNewInstance();\n\/\/ \u8bfb\u5e93\n$db = Db::getNewInstance($poolName, QueryType::READ);\n\/\/ \u5199\u5e93\n$db = Db::getNewInstance($poolName, QueryType::WRITE);\n\n\/\/ \u83b7\u53d6\u6570\u636e\u5e93\u8fde\u63a5\u5b9e\u4f8b\uff0c\u6bcf\u4e2aRequestContext\u4e2d\u5171\u7528\u4e00\u4e2a\n$db = Db::getInstance();\n\/\/ \u8bfb\u5e93\n$db = Db::getInstance($poolName, QueryType::READ);\n\/\/ \u5199\u5e93\n$db = Db::getInstance($poolName, QueryType::WRITE);\n\n\/\/ \u91ca\u653e\u8fde\u63a5\uff0c\u56de\u5f52\u8fde\u63a5\u6c60\nDb::release($db);\n\n$returnValue = Db::use(function(IDb $db){\n    \/\/ \u64cd\u4f5c $db\n    return &#039;imi&#039;;\n}); \/\/ imi\u65b9\u6cd5\/**\n * \u6253\u5f00\n * @return boolean\n *\/\npublic function open();\n\n\/**\n * \u5173\u95ed\n * @return void\n *\/\npublic function close();\n\n\/**\n * \u662f\u5426\u5df2\u8fde\u63a5\n * @return boolean\n *\/\npublic function isConnected(): bool;\n\n\/**\n * \u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\n * @return boolean\n *\/\npublic function beginTransaction(): bool;\n\n\/**\n * \u63d0\u4ea4\u4e00\u4e2a\u4e8b\u52a1\n * @return boolean\n *\/\npublic function commit(): bool;\n\n\/**\n * \u56de\u6eda\u4e8b\u52a1\n * \u652f\u6301\u8bbe\u7f6e\u56de\u6eda\u4e8b\u52a1\u5c42\u6570\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\u5219\u4e3a\u5168\u90e8\u56de\u6eda\n * @param int $levels\n * @return boolean\n *\/\npublic function rollBack($levels = null): bool;\n\n\/**\n * \u83b7\u53d6\u4e8b\u52a1\u5c42\u6570\n *\n * @return int\n *\/\npublic function getTransactionLevels(): int;\n\n\/**\n * \u8fd4\u56de\u9519\u8bef\u7801\n * @return mixed\n *\/\npublic function errorCode();\n\n\/**\n * \u8fd4\u56de\u9519\u8bef\u4fe1\u606f\n * @return array\n *\/\npublic function errorInfo(): string;\n\n\/**\n * \u83b7\u53d6\u6700\u540e\u4e00\u6761\u6267\u884c\u7684SQL\u8bed\u53e5\n * @return string\n *\/\npublic function lastSql();\n\n\/**\n * \u6267\u884c\u4e00\u6761 SQL \u8bed\u53e5\uff0c\u5e76\u8fd4\u56de\u53d7\u5f71\u54cd\u7684\u884c\u6570\n *\n * @param string $sql\n *\n * @return integer\n *\/\npublic function exec(string $sql): int;\n\n\/**\n * \u6279\u91cf\u6267\u884c SQL\uff0c\u8fd4\u56de\u67e5\u8be2\u7ed3\u679c\n *\n * @param string $sql\n * @return array\n *\/\npublic function batchExec(string $sql): array;\n\n\/**\n * \u53d6\u56de\u4e00\u4e2a\u6570\u636e\u5e93\u8fde\u63a5\u7684\u5c5e\u6027\n *\n * @param mixed $attribute\n *\n * @return mixed\n *\/\npublic function getAttribute($attribute);\n\n\/**\n * \u8bbe\u7f6e\u5c5e\u6027\n *\n * @param mixed $attribute\n * @param mixed $value\n *\n * @return bool\n *\/\npublic function setAttribute($attribute, $value);\n\n\/**\n * \u68c0\u67e5\u662f\u5426\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\n * @return bool\n *\/\npublic function inTransaction(): bool;\n\n\/**\n * \u8fd4\u56de\u6700\u540e\u63d2\u5165\u884c\u7684ID\u6216\u5e8f\u5217\u503c\n *\n * @param string $name\n *\n * @return string\n *\/\npublic function lastInsertId(string $name = null);\n\n\/**\n * \u8fd4\u56de\u53d7\u4e0a\u4e00\u4e2a SQL \u8bed\u53e5\u5f71\u54cd\u7684\u884c\u6570\n * @return int\n *\/\npublic function rowCount(): int;\n\n\/**\n * \u51c6\u5907\u6267\u884c\u8bed\u53e5\u5e76\u8fd4\u56de\u4e00\u4e2a\u8bed\u53e5\u5bf9\u8c61\n *\n * @param string $sql\n * @param array  $driverOptions\n *\n * @return IStatement|bool\n *\/\npublic function prepare(string $sql, array $driverOptions = []);\n\n\/**\n * \u6267\u884c\u4e00\u6761SQL\u8bed\u53e5\uff0c\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\u96c6\u4f5c\u4e3aPDOStatement\u5bf9\u8c61\n *\n * @param string $sql\n *\n * @return IStatement|bool\n *\/\npublic function query(string $sql);\n\n\/**\n * \u83b7\u53d6\u539f\u5bf9\u8c61\u5b9e\u4f8b\n * @return object\n *\/\npublic function getInstance();\n\n\/**\n * Get \u4e8b\u52a1\u7ba1\u7406\n *\n * @return \\Imi\\Db\\Transaction\\Transaction\n *\/ \npublic function getTransaction();\u67e5\u8be2\u6784\u5efa\u5668imi \u4e2d\u6570\u636e\u5e93\u67e5\u8be2\u8fde\u8d2f\u64cd\u4f5c\u90fd\u6765\u81ea\u4e8e\u67e5\u8be2\u5668\uff0c\u67e5\u8be2\u5668\u7684\u521b\u5efa\u65b9\u5f0f\uff1ause Imi\\Db\\Db;\n$query = Db::query();\u4e8b\u52a1\u624b\u52a8\u63a7\u5236\u4e8b\u52a1\uff1a\/\/ \u5f00\u542f\u4e8b\u52a1\nDb::getInstance()-&gt;beginTransaction();\n\/\/ \u63d0\u4ea4\u4e8b\u52a1\nDb::getInstance()-&gt;commit();\n\/\/ \u56de\u6eda\u4e8b\u52a1\nDb::getInstance()-&gt;rollBack();\u83b7\u53d6\u8fde\u63a5\u987a\u5e26\u81ea\u52a8\u5f00\u542f\/\u63d0\u4ea4\/\u56de\u6eda\u4e8b\u52a1\uff1aDb::transUse(function(IDb $db){\n\n});\nDb::transUse(function(IDb $db){\n\n}, $poolName, QueryType::WRITE);Db::transUse() \u4e0d\u80fd\u5728\u56de\u8c03\u4e2d\u4f7f\u7528\u6a21\u578b\u83b7\u53d6\u8fde\u63a5\u540e\uff0c\u60f3\u8981\u4f7f\u7528\u67d0\u4e2a\u8fde\u63a5\uff0c\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\uff0c\u81ea\u52a8\u5f00\u542f\/\u63d0\u4ea4\/\u56de\u6eda\u4e8b\u52a1\uff1a$db = Db::getInstance();\nDb::trans($db, function(IDb $db){\n\n});\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u4f7f\u7528\u56de\u8c03\u6765\u4f7f\u7528\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u7684\u8d44\u6e90\uff1aDb::transContext(function(IDb $db){\n\n});\nDb::transContext(function(IDb $db){\n\n}, $poolName, QueryType::WRITE);\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u81ea\u52a8\u4e8b\u52a1\u5904\u7406@Transaction \u6ce8\u89e3\uff0c\u7c7b\uff1aImi\\Db\\Annotation\\Transaction\u8fd9\u4e2a\u6ce8\u89e3\u53ef\u4ee5\u52a0\u5728\u4efb\u610f\u65b9\u6cd5\u4e0a\uff0c\u5728\u65b9\u6cd5\u8c03\u7528\u524d\u5f00\u542f\u4e8b\u52a1\uff0c\u5728\u65b9\u6cd5\u4e2d\u629b\u51fa\u5f02\u5e38\u65f6\u56de\u6eda\u4e8b\u52a1\uff0c\u65b9\u6cd5\u6210\u529f\u8fd4\u56de\u65f6\u63d0\u4ea4\u4e8b\u52a1\u3002@Transaction@Transaction(autoCommit=&quot;\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1true\/false\uff0c\u9ed8\u8ba4\u4e3atrue&quot;)\u4e8b\u52a1\u7c7b\u578b\uff1a\u4e8b\u52a1\u5d4c\u5957\uff08\u9ed8\u8ba4\uff09@Transaction(type=TransactionType::NESTING)\u8be5\u65b9\u6cd5\u5fc5\u987b\u5728\u4e8b\u52a1\u4e2d\u88ab\u8c03\u7528@Transaction(type=TransactionType::REQUIREMENT)\u5982\u679c\u5f53\u524d\u4e0d\u5728\u4e8b\u52a1\u4e2d\u5219\u5f00\u542f\u4e8b\u52a1@Transaction(type=TransactionType::AUTO)\u90e8\u5206\u56de\u6eda\uff1a@Transaction(rollbackType=RollbackType::PART, rollbackLevels=&quot;\u56de\u6eda\u5c42\u6570\uff0c\u9ed8\u8ba4\u4e3a1&quot;)\u4e8b\u52a1\u76d1\u542c\u76d1\u542c\u63d0\u4ea4\u4e8b\u52a1\uff1a$db = Db::getInstance();\n$db-&gt;getTransaction()-&gt;onTransactionCommit(function($param){\n    $data = $param-&gt;getData();\n    $db = $data[&#039;db&#039;];\n    $level = $data[&#039;level&#039;]; \/\/ \u7b2c\u51e0\u5c42\u4e8b\u52a1\uff0c\u652f\u6301\u4e8b\u52a1\u5d4c\u5957\n});\u76d1\u542c\u56de\u6eda\u4e8b\u52a1\uff1a$db = Db::getInstance();\n$db-&gt;getTransaction()-&gt;onTransactionRollback(function($param){\n    $data = $param-&gt;getData();\n    $db = $data[&#039;db&#039;];\n    $level = $data[&#039;level&#039;]; \/\/ \u7b2c\u51e0\u5c42\u4e8b\u52a1\uff0c\u652f\u6301\u4e8b\u52a1\u5d4c\u5957\n});\u6307\u5b9a\u8868 (table\/from)\/\/ \u6307\u5b9a\u8868\u540d\nDb::query()-&gt;table(&#039;tb_test&#039;);\n\/\/ \u6307\u5b9a\u8868\u540d\u5e76\u4e14\u8bbe\u7f6e\u522b\u540d\nDb::query()-&gt;table(&#039;tb_test&#039;, &#039;test&#039;);\n\/\/ \u6307\u5b9a\u8868\u540d\u548c\u6570\u636e\u5e93\u540d\nDb::query()-&gt;table(&#039;tb_test&#039;, null, &#039;db1&#039;);\n\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\nDb::query()-&gt;tableRaw(&#039;tb_test&#039;);table() \u548c tableRaw() \u4e5f\u53ef\u4ee5\u4f7f\u7528 from() \u548c fromRaw() \u4ee3\u66ff\u3002distinct\/\/ \u7ed3\u679c\u552f\u4e00\nDb::query()-&gt;distinct();\n\/\/ \u7ed3\u679c\u4e0d\u552f\u4e00\nDb::query()-&gt;distinct(false);\u6307\u5b9a\u5b57\u6bb5 (field)\/\/ \u6307\u5b9a\u4e00\u4e2a\u5b57\u6bb5\nDb::query()-&gt;field(&#039;id&#039;);\n\n\/\/ \u6307\u5b9a\u591a\u4e2a\u5b57\u6bb5\uff0c\u4e5f\u652f\u6301\u8bbe\u7f6e\u522b\u540d\u3002\u7a7a\u683c\u548cas\u90fd\u652f\u6301\nDb::query()-&gt;field(&#039;id&#039;, &#039;name1 name&#039;, &#039;age1 as age&#039;);\n\n\/\/ \u548c\u4e0a\u9762\u7684\u7528\u6cd5\u7b49\u540c\nDb::query()-&gt;field([&#039;id&#039;, &#039;name1 name&#039;, &#039;age1 as age&#039;]);\n\n\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\nDb::query()-&gt;fieldRaw(&#039;id, name1 name, age1 as age&#039;);\u6761\u4ef6 wherewhere\/\/ id = 1\nDb::query()-&gt;where(&#039;id&#039;, &#039;=&#039;, 1);\n\n\/\/ id &gt; 1\nDb::query()-&gt;where(&#039;id&#039;, &#039;&gt;&#039;, 1);\n\n\/\/ title like &#039;%test%&#039;\nDb::query()-&gt;where(&#039;title&#039;, &#039;like&#039;, &#039;%test%&#039;);\n\n\/\/ id between 1 and 10\nDb::query()-&gt;where(&#039;id&#039;, &#039;between&#039;, [1, 10]);\n\n\/\/ id not between 1 and 10\nDb::query()-&gt;where(&#039;id&#039;, &#039;not between&#039;, [1, 10]);\n\n\/\/ or id = 1\nDb::query()-&gt;where(&#039;id&#039;, &#039;=&#039;, 1, &#039;or&#039;);\nDb::query()-&gt;orWhere(&#039;id&#039;, &#039;=&#039;, 1);\n\n\/\/ JSON \u7c7b\u578b\u5b57\u6bb5\u6761\u4ef6\nDb::query()-&gt;where(&#039;field1-&gt;uid&#039;, &#039;=&#039;, 1);TP \u98ce\u683c where\/\/ select * from `tb_test` where (`id` = 1 or (`id` = 2 ) and `title` like &#039;%test%&#039; and `age` &gt; 18 and (`id` = 2 or (`id` = 3 ) ) )\nDb::query()-&gt;from(&#039;tb_test&#039;)-&gt;whereEx([\n    &#039;id&#039;    =&gt;    1,\n    &#039;or&#039;    =&gt;    [\n        &#039;id&#039;    =&gt;    2,\n    ],\n    &#039;title&#039;    =&gt;    [&#039;like&#039;, &#039;%test%&#039;],\n    &#039;age&#039;    =&gt;    [&#039;&gt;&#039;, 18],\n    &#039;and&#039;   =&gt;  [\n        &#039;id&#039;    =&gt;  2,\n        &#039;or&#039;    =&gt;  [\n            &#039;id&#039;    =&gt;  3,\n        ]\n    ]\n]);whereRaw\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\nDb::query()-&gt;whereRaw(&#039;id &gt;= 1&#039;);\n\/\/ \u4f20\u5165\u53c2\u6570\u539f\u6837\u4ee3\u5165\u5230SQL\u4e2d\uff0c\u5e76\u4e14\u4e3aor\u6761\u4ef6\nDb::query()-&gt;whereRaw(&#039;id &gt;= 1&#039;, &#039;or&#039;);\nDb::query()-&gt;orWhereRaw(&#039;id &gt;= 1&#039;);whereBrackets\/\/ where id = 1 or (age &lt; 14)\nDb::query()-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;whereBrackets(function(){\n    \/\/ \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\n    return &#039;age &lt; 14&#039;;\n}, &#039;or&#039;);\n\n\/\/ where id = 1 or (age &lt; 14)\nDb::query()-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;whereBrackets(function(){\n    \/\/ \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\n    return new \\Imi\\Db\\Query\\Where\\Where(&#039;age&#039;, &#039;&lt;&#039;, 14);\n}, &#039;or&#039;);\nDb::query()-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;orWhereBrackets(function(){\n    \/\/ \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32\n    return new \\Imi\\Db\\Query\\Where\\Where(&#039;age&#039;, &#039;&lt;&#039;, 14);\n});whereStruct\/\/ or age &lt; 14\nDb::query()-&gt;whereStruct(new \\Imi\\Db\\Query\\Where\\Where(&#039;age&#039;, &#039;&lt;&#039;, 14), &#039;or&#039;);\nDb::query()-&gt;orWhereStruct(new \\Imi\\Db\\Query\\Where\\Where(&#039;age&#039;, &#039;&lt;&#039;, 14));\u5176\u5b83\/\/ or age between 1 and 14\nDb::query()-&gt;whereBetween(&#039;age&#039;, 1, 14, &#039;or&#039;);\nDb::query()-&gt;orWhereBetween(&#039;age&#039;, 1, 14);\n\n\/\/ or age not between 1 and 14\nDb::query()-&gt;whereNotBetween(&#039;age&#039;, 1, 14, &#039;or&#039;);\nDb::query()-&gt;orWhereNotBetween(&#039;age&#039;, 1, 14);\n\n\/\/ or age in (1,2,3)\nDb::query()-&gt;whereIn(&#039;age&#039;, [1, 2, 3], &#039;or&#039;);\nDb::query()-&gt;orWhereIn(&#039;age&#039;, [1, 2, 3]);\n\n\/\/ or age not in (1,2,3)\nDb::query()-&gt;whereNotIn(&#039;age&#039;, [1, 2, 3], &#039;or&#039;);\nDb::query()-&gt;orWhereNotIn(&#039;age&#039;, [1, 2, 3]);\n\n\/\/ or age is null\nDb::query()-&gt;whereIsNull(&#039;age&#039;, &#039;or&#039;);\nDb::query()-&gt;orWhereIsNull(&#039;age&#039;);\n\n\/\/ or age is not null\nDb::query()-&gt;whereIsNotNull(&#039;age&#039;, &#039;or&#039;);\nDb::query()-&gt;orWhereIsNotNull(&#039;age&#039;);JSON \u5b57\u6bb5\u652f\u6301\u770b\u5982\u4e0b\u4ee3\u7801\uff0cdata\u4e3ajson\u7c7b\u578b\u5b57\u6bb5\uff0c\u67e5\u8be2json\u5bf9\u8c61\u4e2d\u7684member.age\u4e3a11\u7684\u8bb0\u5f55Db::query()-&gt;where(&#039;data-&gt;member.age&#039;, &#039;=&#039;, 11)-&gt;select();join\/\/ select * from tb_test1 left join tb_test2 on tb_test1.aid = tb_test2.bid\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;join(&#039;tb_test2&#039;, &#039;tb_test1.aid&#039;, &#039;=&#039;, &#039;tb_test2.bid&#039;);\n\/\/ select * from tb_test1 left join tb_test2 as test2 on tb_test1.aid = test2.bid\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;join(&#039;tb_test2&#039;, &#039;tb_test1.aid&#039;, &#039;=&#039;, &#039;test2.bid&#039;, &#039;test&#039;);\n\/\/ select * from tb_test1 right join tb_test2 on tb_test1.aid = tb_test2.bid and tb_test1.age &gt; 14\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;join(&#039;tb_test2&#039;, &#039;tb_test1.aid&#039;, &#039;=&#039;, &#039;tb_test2.bid&#039;, null, new \\Imi\\Db\\Query\\Where\\Where(&#039;tb_test1.age&#039;, &#039;&gt;&#039;, &#039;14&#039;), &#039;right&#039;);\n\n\/\/ select * from tb_test1 left join tb_test2 on tb_test1.aid = tb_test2.bid\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;joinRaw(&#039;left join tb_test2 on tb_test1.aid = tb_test2.bid&#039;);\n\n\/\/ \u4e0b\u9762\u4e09\u79cd\u7528\u6cd5\uff0c\u7b2c5\u4e2a\u53c2\u6570\u90fd\u652f\u6301\u4f20Where\n\/\/ left join\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;leftJoin(&#039;tb_test2&#039;, &#039;tb_test1.aid&#039;, &#039;=&#039;, &#039;tb_test2.bid&#039;);\n\/\/ right join\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;rightJoin(&#039;tb_test2&#039;, &#039;tb_test1.aid&#039;, &#039;=&#039;, &#039;tb_test2.bid&#039;);\n\/\/ cross join\nDb::query()-&gt;table(&#039;tb_test1&#039;)-&gt;crossJoin(&#039;tb_test2&#039;, &#039;tb_test1.aid&#039;, &#039;=&#039;, &#039;tb_test2.bid&#039;);order\/\/ order by id asc, age desc\nDb::query()-&gt;order(&#039;id&#039;)-&gt;order(&#039;age&#039;, &#039;desc&#039;);\n\n\/\/ order by id desc\nDb::query()-&gt;orderRaw(&#039;id desc&#039;);\n\n\/\/ JSON \u7c7b\u578b\u53c2\u6570\u6392\u5e8f\nDb::query()-&gt;order(&#039;field1-&gt;uid&#039;, &#039;desc&#039;);group by\/\/ group by id, name\nDb::query()-&gt;group(&#039;id&#039;, &#039;name&#039;);\n\n\/\/ group by sum(id)\nDb::query()-&gt;groupRaw(&#039;sum(id)&#039;);havinghaving()\u7528\u6cd5\u540cwhere()havingRaw()\u7528\u6cd5\u540cwhereRaw()havingBrackets()\u7528\u6cd5\u540cwhereBrackets()havingStruct()\u7528\u6cd5\u540cwhereStruct()\u5206\u9875\u67e5\u8be2\/\/ limit 900, 100\nDb::query()-&gt;page(10, 100);\n\n\/\/ limit 10, 1\nDb::query()-&gt;offset(10)-&gt;limit(1);\n\n\/\/ limit 1\nDb::query()-&gt;limit(1);\u5206\u9875\u67e5\u8be2\u5e26\u6269\u5c55\u5b57\u6bb5\u67e5\u8be2\u603b\u8bb0\u5f55\u6570\u3001\u603b\u9875\u6570\uff1a$page = 1;\n$count = 10;\n$data = Db::query()-&gt;from(&#039;xxxtable&#039;)-&gt;paginate($page, $count);\n\n$data-&gt;getList(); \/\/ \u5217\u8868\u6570\u636e\n$data-&gt;getTotal(); \/\/ \u603b\u8bb0\u5f55\u6570\n$data-&gt;getLimit(); \/\/ $count === 10\n$data-&gt;getPageCount(); \/\/ \u603b\u9875\u6570\n\nvar_dump($data-&gt;toArray()); \/\/ \u8f6c\u6570\u7ec4\nvar_dump(json_encode($data)); \/\/ \u652f\u6301\u5e8f\u5217\u5316\n\/\/ \u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a\n[\n    &#039;list&#039;          =&gt; [],\n    &#039;total&#039;         =&gt; 100,\n    &#039;limit&#039;         =&gt; 10,\n    &#039;page_count&#039;    =&gt; 10,\n]\u4e0d\u67e5\u8be2\u603b\u8bb0\u5f55\u6570\u3001\u603b\u9875\u6570\uff1a$page = 1;\n$count = 10;\n$data = Db::query()-&gt;from(&#039;xxxtable&#039;)-&gt;paginate($page, $count, [\n    &#039;total&#039; =&gt;  false,\n]);\nvar_dump($data-&gt;toArray()); \/\/ \u8f6c\u6570\u7ec4\nvar_dump(json_encode($data)); \/\/ \u652f\u6301\u5e8f\u5217\u5316\n\/\/ \u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a\n[\n    &#039;list&#039;          =&gt; [],\n    &#039;limit&#039;         =&gt; 10,\n]\u67e5\u8be2\u6267\u884c\u67e5\u8be2\u8bb0\u5f55\u67e5\u8be2\u5355\u884c$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;select();\n$result-&gt;get(); \/\/ \u6570\u7ec4\n$result-&gt;get($className); \/\/ $className\u5bf9\u5e94\u7684\u7c7b\u5bf9\u8c61\u67e5\u8be2\u591a\u884c$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;select();\n$result-&gt;getArray(); \/\/ \u6570\u7ec4\u5185\u5d4c\u5957\u6570\u7ec4\n$result-&gt;getArray($className); \/\/ \u6570\u7ec4\u5185\u5d4c\u5957$className\u5bf9\u5e94\u7684\u7c7b\u5bf9\u8c61\n$result-&gt;getRowCount(); \/\/ \u83b7\u53d6\u67e5\u8be2\u51fa\u7684\u8bb0\u5f55\u884c\u6570\u805a\u5408\u51fd\u6570\/\/ count(*)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;count();\n\n\/\/ count(id)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;count(&#039;id&#039;);\n\n\/\/ sum(id)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;sum(&#039;id&#039;);\n\n\/\/ avg(id)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;avg(&#039;id&#039;);\n\n\/\/ max(id)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;max(&#039;id&#039;);\n\n\/\/ min(id)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;min(&#039;id&#039;);\n\n\/\/ \u5176\u5b83\u81ea\u5b9a\u4e49\uff1atest(id)\nDb::query()-&gt;table(&#039;tb_test&#039;)-&gt;aggregate(&#039;test&#039;, &#039;id&#039;);\u63d2\u5165\u8bb0\u5f55\/\/ insert into tb_test(name, age) values(&#039;yurun&#039;, 666)\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;insert([\n    &#039;name&#039;    =&gt;    &#039;yurun&#039;,\n    &#039;age&#039;    =&gt;    666,\n]);\n\n\/\/ insert into tb_test values(&#039;yurun&#039;, 666)\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;insert([\n    &#039;yurun&#039;,666,\n]);\n\n$result-&gt;isSuccess(); \/\/ SQL\u662f\u5426\u6267\u884c\u6210\u529f\n$result-&gt;getLastInsertId(); \/\/ \u83b7\u53d6\u6700\u540e\u63d2\u5165\u7684ID\n$result-&gt;getAffectedRows(); \/\/ \u83b7\u53d6\u5f71\u54cd\u884c\u6570\u6279\u91cf\u63d2\u5165$result = Db::query()-&gt;from(&#039;test&#039;)-&gt;batchInsert([\n    [&#039;name&#039;=&gt;&#039;a&#039;],\n    [&#039;name&#039;=&gt;&#039;b&#039;],\n    [&#039;name&#039;=&gt;&#039;c&#039;],\n]);\n$result-&gt;isSuccess(); \/\/ SQL\u662f\u5426\u6267\u884c\u6210\u529f\n$result-&gt;getAffectedRows(); \/\/ \u83b7\u53d6\u5f71\u54cd\u884c\u6570\u66f4\u65b0\u8bb0\u5f55\/\/ update tb_test set name = &#039;yurun&#039;, age = 666 where id = 1\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;update([\n    &#039;name&#039;    =&gt;    &#039;yurun&#039;,\n    &#039;age&#039;    =&gt;    666,\n    \/\/ JSON \u7c7b\u578b\u53c2\u6570\n    &#039;field1-&gt;name&#039;        =&gt; &#039;bbb&#039;, \/\/ \u4fee\u6539 name\n    &#039;field1-&gt;list2&#039;       =&gt; [1, 2, 3], \/\/ \u4fee\u6539 list2\uff0c\u652f\u6301\u6570\u7ec4\u3001\u5bf9\u8c61\n    &#039;field1-&gt;list1[0].id&#039; =&gt; &#039;2&#039;, \/\/ \u652f\u6301\u5bf9\u6570\u7ec4\u4e2d\u6307\u5b9a\u6210\u5458\u3001\u5bf9\u8c61\u5c5e\u6027\u8d4b\u503c\uff0c\u652f\u6301\u65e0\u9650\u7ea7\n]);\n\n\/\/ $result\u4f7f\u7528\u65b9\u6cd5\u540c\u4e0a\u66ff\u6362\u6570\u636e\/\/ replace into tb_test set id = 1, name = &#039;yurun&#039;, age = 666\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;replace([\n    &#039;id&#039;    =&gt;    1,\n    &#039;name&#039;    =&gt;    &#039;yurun&#039;,\n    &#039;age&#039;    =&gt;    666,\n]);\u9012\u589e\/\u9012\u51cf\/\/ score \u9012\u589e 1\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)\n                     -&gt;where(&#039;id&#039;, &#039;=&#039;, 1)\n                     -&gt;setFieldInc(&#039;score&#039;)\n                     -&gt;update();\n\n\/\/ score \u9012\u589e 10\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)\n                     -&gt;where(&#039;id&#039;, &#039;=&#039;, 1)\n                     -&gt;setFieldInc(&#039;score&#039;, 10)\n                     -&gt;update();\n\n\/\/ score \u9012\u51cf 1\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)\n                     -&gt;where(&#039;id&#039;, &#039;=&#039;, 1)\n                     -&gt;setFieldDec(&#039;score&#039;)\n                     -&gt;update();\n\n\/\/ score \u9012\u51cf 10\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)\n                     -&gt;where(&#039;id&#039;, &#039;=&#039;, 1)\n                     -&gt;setFieldDec(&#039;score&#039;, 10)\n                     -&gt;update();update\/insert\/replace\u65f6\u4f7f\u7528\u8868\u8fbe\u5f0f\/\/ update tb_test set score = score + 1 where id = 1\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)\n                     -&gt;where(&#039;id&#039;, &#039;=&#039;, 1)\n                     -&gt;setFieldExp(&#039;score&#039;, &#039;score + 1&#039;)\n                     -&gt;update();\u5220\u9664\u8bb0\u5f55\/\/ delete from tb_test where id = 1\n$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;delete();\n\n\/\/ $result\u4f7f\u7528\u65b9\u6cd5\u540c\u4e0a\u52a0\u9501\u6392\u5b83\u9501\uff1ause Imi\\Db\\Query\\Lock\\MysqlLock;\nDb::query()-&gt;from(&#039;tb_xxx&#039;)-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;lock(MysqlLock::FOR_UPDATE)-&gt;select()-&gt;get();\u5171\u4eab\u9501\uff1ause Imi\\Db\\Query\\Lock\\MysqlLock;\nDb::query()-&gt;from(&#039;tb_xxx&#039;)-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;lock(MysqlLock::SHARED)-&gt;select()-&gt;get();\u76f4\u63a5\u6267\u884cSQL$result = Db::query()-&gt;execute(&#039;select * from tb_test&#039;));\n\n\/\/ $result\u4f7f\u7528\u65b9\u6cd5\u540c\u4e0a\u53c2\u6570\u7ed1\u5b9a\u590d\u6742\u7684\u67e5\u8be2\u65f6\uff0c\u96be\u514d\u9700\u8981\u62fc\u63a5 SQL\uff0c\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u53c2\u6570\u7ed1\u5b9a\u6765\u9632\u6b62\u6ce8\u5165\u4e86\uff01\/\/ where id = 123\n$result = Db::query()-&gt;whereRaw(&#039;id = ?&#039;)-&gt;bindValue(1, 123);\n$result = Db::query()-&gt;whereRaw(&#039;id = :val&#039;)-&gt;bindValue(&#039;:val&#039;, 123);\n\n\/\/ \u6279\u91cf\u7ed1\u5b9a\n$result = Db::query()-&gt;bindValues([\n    &#039;:name&#039;    =&gt;    &#039;yurun&#039;,\n    &#039;:age&#039;    =&gt;    666,\n])-&gt;execute(&#039;select * from tb_test where name = :name and age = :age&#039;);\u8bbe\u7f6e\/\u83b7\u53d6 Result \u7ed3\u679c\u96c6\u7c7b\u540d$query = Db::query();\n\/\/ \u83b7\u53d6\nvar_dump($query-&gt;getResultClass());\n\n\/\/ \u8bbe\u7f6e\n$query-&gt;setResultClass(\\Imi\\Db\\Query\\Result::class);Result \u7528\u6cd5$result = Db::query()-&gt;table(&#039;tb_test&#039;)-&gt;select();\u662f\u5426\u6267\u884c\u6210\u529f$success = $result-&gt;isSuccess(); \/\/ true\/false\u83b7\u53d6\u6700\u540e\u63d2\u5165\u7684ID\u7528\u4e8e\u83b7\u53d6\u65b0\u589e\u8bb0\u5f55\u7684\u81ea\u589e\u5b57\u6bb5\u503c$lastInsertId = $result-&gt;getLastInsertId(); \/\/ int\u83b7\u53d6\u5f71\u54cd\u884c\u6570$rows = $result-&gt;getAffectedRows();update \u65f6\uff0c\u5982\u679c\u6ca1\u6709\u503c\u88ab\u6539\u53d8\uff0c\u53ef\u80fd\u4f1a\u8fd4\u56de0\u8fd4\u56de\u4e00\u884c\u6570\u636e\u8fd4\u56de\u6570\u7ec4$dataArray = $result-&gt;get();\u8fd4\u56de\u5bf9\u8c61\u5b9e\u4f8b\u5316\u8fd9\u4e2a\u7c7b\u65f6\uff0c\u628a\u6570\u7ec4\u4f20\u5165\u6784\u9020\u65b9\u6cd5$dataArray = $result-&gt;get(XXXModel::class);\u8fd4\u56de\u6570\u7ec4\u5217\u8868\u6210\u5458\u4e3a\u6570\u7ec4$list = $result-&gt;getArray();\u6210\u5458\u4e3a\u5bf9\u8c61$list = $result-&gt;getArray(XXXModel::class);\u83b7\u53d6\u4e00\u5217$ids = Db::query()-&gt;field(&#039;id&#039;)-&gt;select()-&gt;getColumn();\n\/\/ \u7ed3\u679c\u683c\u5f0f\uff1a[1, 2, 3]\u83b7\u53d6\u6807\u91cf\u7ed3\u679c$name = Db::query()-&gt;field(&#039;name&#039;)-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;select()-&gt;getScalar();\u83b7\u53d6\u8bb0\u5f55\u884c\u6570\u5f97\u5230\u53d6\u56de\u591a\u5c11\u6761\u8bb0\u5f55$rowCount = $result-&gt;getRowCount();\u83b7\u53d6\u6267\u884c\u7684SQL$sql = $result-&gt;getSql();\u83b7\u53d6\u7ed3\u679c\u96c6$statement = $result-&gt;getStatement(); \/\/ \\Imi\\Db\\Interfaces\\IStatement"},{"id":82,"title":"SQL \u76d1\u542c","pageTitle":"SQL \u76d1\u542c","url":"components\/db\/sqlListener.html","content":"SQL \u76d1\u542c\u8bf4\u660e\u8981\u4f7f\u7528 SQL \u76d1\u542c\u529f\u80fd\uff0c\u5fc5\u987b\u5148\u5f00\u542f\uff0c\u5e76\u4e14\u4e0d\u63a8\u8350\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528\u3002\u5f00\u542f\u65b9\u5f0f\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 beans \u4e2d\u52a0\u5165\uff1a&#039;DbQueryLog&#039; =&gt; [\n    &#039;enable&#039; =&gt; true,\n]\u4e8b\u4ef6SQL \u6267\u884c\u4e8b\u4ef6\u540d\uff1aIMI.DB.EXECUTE\u6bcf\u4e00\u4e2a SQL \u8bed\u53e5\u6267\u884c\u540e\u90fd\u4f1a\u89e6\u53d1\u8be5\u4e8b\u4ef6\u3002\u793a\u4f8b\uff1a&lt;?php\n\nnamespace Imi\\Test\\Component\\Db\\Listener;\n\nuse Imi\\Bean\\Annotation\\Listener;\nuse Imi\\Db\\Event\\Param\\DbExecuteEventParam;\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Log\\Log;\n\n\/**\n * @Listener(&quot;IMI.DB.EXECUTE&quot;)\n *\/\nclass DbExecuteListener implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5.\n     *\n     * @param DbExecuteEventParam $e\n     *\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        Log::info(sprintf(&#039;[%ss] %s&#039;, round($e-&gt;time, 3), $e-&gt;sql));\n    }\n}\u51c6\u5907 SQL \u8bed\u53e5\u4e8b\u4ef6\u540d\uff1aIMI.DB.PREPARE\u6bcf\u4e00\u4e2a SQL \u8bed\u53e5\u51c6\u5907\u540e\u90fd\u4f1a\u89e6\u53d1\u8be5\u4e8b\u4ef6\u3002\u793a\u4f8b\uff1a&lt;?php\n\nnamespace Imi\\Test\\Component\\Db\\Listener;\n\nuse Imi\\Bean\\Annotation\\Listener;\nuse Imi\\Db\\Event\\Param\\DbPrepareEventParam;\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Log\\Log;\n\n\/**\n * @Listener(&quot;IMI.DB.PREPARE&quot;)\n *\/\nclass DbPrepareListener implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5.\n     *\n     * @param DbPrepareEventParam $e\n     *\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        Log::info(sprintf(&#039;[prepare] %s&#039;, $e-&gt;sql));\n    }\n}"},{"id":115,"title":"\u4e8b\u4ef6\u76d1\u542c","pageTitle":"\u4e8b\u4ef6\u76d1\u542c","url":"components\/event\/index.html","content":"\u4e8b\u4ef6\u76d1\u542c\u5168\u5c40\u4e8b\u4ef6\u4e8b\u4ef6\u76d1\u542c\u6ce8\u89e3\u76d1\u542c\u4ee5imi\/src\/Listener\/Init.php\u4e3a\u4f8b&lt;?php\nnamespace Imi\\Listener;\n\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Bean\\Annotation\\Listener;\n\n\/**\n * @Listener(eventName=&quot;IMI.INITED&quot;,priority=PHP_INT_MAX)\n *\/\nclass Init implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param EventParam $e\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        \/\/ ...\n    }\n}\u9996\u5148\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u7c7b\u540d\u548c\u4f4d\u7f6e\u65e0\u6240\u8c13\uff0c\u53ea\u8981\u914d\u7f6e\u4e86beanScan\u80fd\u88ab\u626b\u63cf\u5230\u5373\u53ef\u3002\u7c7b\u5fc5\u987b\u5b9e\u73b0IEventListener\u63a5\u53e3\u548cpublic function handle(EventParam $e)\u65b9\u6cd5\u3002\u7136\u540e\u5728\u7c7b\u4e0a\u5199@Listener\u6ce8\u89e3\u3002\u6ce8\u89e3\u6709\u4e24\u4e2a\u53c2\u6570\uff1aeventName\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u540d\u79f0priority\u4e8b\u4ef6\u89e6\u53d1\u540e\u6267\u884c\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u5b57\u8d8a\u5927\u8d8a\u5148\u6267\u884c\uff0c\u540c\u6837\u5927\u6267\u884c\u987a\u5e8f\u4e0d\u4e00\u5b9a\u4ee3\u7801\u76d1\u542c\u9664\u4e86\u4f7f\u7528\u6ce8\u89e3\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5199\u4ee3\u7801\u624b\u52a8\u76d1\u542cuse Imi\\Event\\Event;\n\nEvent::on(&#039;\u4e8b\u4ef6\u540d&#039;, function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n});\n\n$priority = 0;\nEvent::on(&#039;\u4e8b\u4ef6\u540d&#039;, function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n}, $priority);\n\n\/\/ \u76d1\u542c\u53ea\u89e6\u53d1\u4e00\u6b21\nEvent::one(&#039;\u4e8b\u4ef6\u540d&#039;, function(){});\n\n\/\/ \u53d6\u6d88\u4e8b\u4ef6\nEvent::off(&#039;\u4e8b\u4ef6\u540d&#039;, $callable);on()\u3001one()\u3001off() \u65b9\u6cd5\u8fd8\u652f\u6301\u4f20\u5165\u591a\u4e2a\u4e8b\u4ef6\uff1aEvent::on([&#039;e1&#039;, &#039;e2&#039;], function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n});\u53d6\u6d88\u4e8b\u4ef6\u6240\u6709\u76d1\u542c\uff1aEvent::off(&#039;\u4e8b\u4ef6\u540d&#039;);\nEvent::off([&#039;\u4e8b\u4ef6\u540d1&#039;, &#039;\u4e8b\u4ef6\u540d2&#039;]);\u81ea\u5b9a\u4e49\u4e8b\u4ef6use Imi\\Event\\Event;\n\nEvent::trigger(&#039;\u4e8b\u4ef6\u540d\u79f0&#039;, &#039;\u4f20\u5165\u4e8b\u4ef6\u56de\u8c03\u7684\u6570\u636e&#039;, &#039;\u76ee\u6807\u5bf9\u8c61&#039;, &#039;\u53c2\u6570\u7c7b\uff0c\u9ed8\u8ba4\u4e3aEventParam::class&#039;);\u5c40\u90e8\u4e8b\u4ef6\u5c40\u90e8\u4e8b\u4ef6\u5c31\u662f\u5728\u67d0\u4e2a\u7c7b\u5b9e\u4f8b\u7684\u4e8b\u4ef6\u3002\u4e8b\u4ef6\u76d1\u542c\u6ce8\u89e3\u76d1\u542c\u4ee5imi\/src\/Server\/Http\/Listener\/BeforeRequest.php\u4e3a\u4f8b&lt;?php\nnamespace Imi\\Server\\Http\\Listener;\n\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\RequestEventParam;\nuse Imi\\Server\\Event\\Listener\\IRequestEventListener;\n\n\/**\n * request\u4e8b\u4ef6\u524d\u7f6e\u5904\u7406\n * @ClassEventListener(className=&quot;Imi\\Server\\Http\\Server&quot;,eventName=&quot;request&quot;,priority=PHP_INT_MAX)\n *\/\nclass BeforeRequest implements IRequestEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param RequestEventParam $e\n     * @return void\n     *\/\n    public function handle(RequestEventParam $e)\n    {\n        \/\/ ...\n    }\n}\u9996\u5148\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u7c7b\u540d\u548c\u4f4d\u7f6e\u65e0\u6240\u8c13\uff0c\u53ea\u8981\u914d\u7f6e\u4e86beanScan\u80fd\u88ab\u626b\u63cf\u5230\u5373\u53ef\u3002\u7c7b\u5fc5\u987b\u5b9e\u73b0\u5bf9\u5e94\u63a5\u53e3\u548chandle()\u65b9\u6cd5\uff0c\u6bcf\u4e2a\u7c7b\u7684\u4e8b\u4ef6\u5b9a\u4e49\u4e0d\u540c\u3002\u7136\u540e\u5728\u7c7b\u4e0a\u5199@ClassEventListener\u6ce8\u89e3\u3002\u6ce8\u89e3\u53c2\u6570\u5982\u4e0b\uff1aclassName\u7c7b\u540deventName\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u540d\u79f0priority\u4e8b\u4ef6\u89e6\u53d1\u540e\u6267\u884c\u7684\u4f18\u5148\u7ea7\uff0c\u6570\u5b57\u8d8a\u5927\u8d8a\u5148\u6267\u884c\uff0c\u540c\u6837\u5927\u6267\u884c\u987a\u5e8f\u4e0d\u4e00\u5b9a\u4ee3\u7801\u76d1\u542c$object-&gt;on(&#039;\u4e8b\u4ef6\u540d&#039;, function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n});\n\n$priority = 0;\n$object-&gt;on(&#039;\u4e8b\u4ef6\u540d&#039;, function(){\n    \/\/ \u4e8b\u4ef6\u56de\u8c03\n}, $priority);\n\n\/\/ \u76d1\u542c\u53ea\u89e6\u53d1\u4e00\u6b21\n$object-&gt;one(&#039;\u4e8b\u4ef6\u540d&#039;, function(){});\n\n\/\/ \u53d6\u6d88\u4e8b\u4ef6\n$object-&gt;off(&#039;\u4e8b\u4ef6\u540d&#039;, $callable);\n\u81ea\u5b9a\u4e49\u4e8b\u4ef6$object-&gt;trigger(&#039;\u4e8b\u4ef6\u540d\u79f0&#039;, &#039;\u4f20\u5165\u4e8b\u4ef6\u56de\u8c03\u7684\u6570\u636e&#039;, &#039;\u76ee\u6807\u5bf9\u8c61&#039;, &#039;\u53c2\u6570\u7c7b\uff0c\u9ed8\u8ba4\u4e3aEventParam::class&#039;);"},{"id":109,"title":"\u95e8\u9762 (Facade)","pageTitle":"\u95e8\u9762 (Facade)","url":"components\/facade\/index.html","content":"\u95e8\u9762 (Facade)imi \u73b0\u5df2\u652f\u6301\u95e8\u9762 (Facade) \u7279\u6027\uff0c\u652f\u6301\u4e3aBean\u5bf9\u8c61\u63d0\u4f9b\u4e00\u4e2a\u9759\u6001\u8c03\u7528\u65b9\u6cd5\u7684\u7c7b\u3002\u793a\u4f8b\u5047\u8bbe\u6709\u8fd9\u4e48\u4e00\u4e2a\u7c7b\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Facade;\n\nuse Imi\\Bean\\Annotation\\Bean;\n\n\/**\n * @Bean(&quot;FacadeA&quot;)\n *\/\nclass A\n{\n    public function add($a, $b)\n    {\n        return $a + $b;\n    }\n\n}\u5b9a\u4e49 Facade \u7c7b\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Facade;\n\nuse Imi\\Facade\\BaseFacade;\nuse Imi\\Facade\\Annotation\\Facade;\n\n\/**\n * @Facade(&quot;FacadeA&quot;)\n * @method mixed add($a, $b)\n *\/\nabstract class FacadeA extends BaseFacade\n{\n\n}\u7ee7\u627f Imi\\Facade\\BaseFacade \u7c7b\uff0c\u7136\u540e\u4f7f\u7528@Facade\u6ce8\u89e3\u7c7b\u5b9a\u4e49\u7ed1\u5b9a\u5230\u54ea\u4e2a\u7c7b\u3002\u4f7f\u7528\uff1ause Imi\\Test\\Component\\Facade\\FacadeA;\nFacadeA::add(1, 2); \/\/ 3@Facade \u6ce8\u89e3class Facade extends Base\n{\n    \/**\n     * \u53ea\u4f20\u4e00\u4e2a\u53c2\u6570\u65f6\u7684\u53c2\u6570\u540d\n     * @var string\n     *\/\n    protected $defaultFieldName = &#039;class&#039;;\n\n    \/**\n     * \u7c7b\u540d\uff0c\u652f\u6301 Bean \u540d\n     *\n     * @var string\n     *\/\n    public $class;\n\n    \/**\n     * \u4e3a true \u65f6\uff0c\u4f7f\u7528\u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u7684 Bean \u5bf9\u8c61\n     *\n     * @var boolean\n     *\/\n    public $request = false;\n\n    \/**\n     * \u5b9e\u4f8b\u5316\u53c2\u6570\n     *\n     * @var array\n     *\/\n    public $args = [];\n\n}Facade \u751f\u6210\u5668\u67e5\u770b\u5e2e\u52a9\uff1aimi generate\/facade -h"},{"id":122,"title":"\u70ed\u66f4\u65b0","pageTitle":"\u70ed\u66f4\u65b0","url":"components\/hotupdate\/index.html","content":"\u70ed\u66f4\u65b0\u7531\u4e8e imi \u57fa\u4e8e Swoole \u5e38\u9a7b\u5185\u5b58\uff0c\u6240\u4ee5 PHP \u7684\u4e00\u5927\u7279\u70b9\u70ed\u66f4\u65b0\u5c31\u6ca1\u6709\u4e86\u3002\u4e3a\u6b64\uff0cimi \u4e2d\u5b9e\u73b0\u4e86\u4e1a\u52a1\u4ee3\u7801\u7684\u70ed\u66f4\u65b0\uff0c\u65b9\u4fbf\u5f00\u53d1\u8c03\u8bd5\u3001\u52a8\u6001\u90e8\u7f72\uff0c\u652f\u6301\u5e73\u6ed1\u91cd\u8f7d\u3002\u6709\u4e86\u70ed\u66f4\u65b0\uff0c\u5f00\u53d1\u65f6\u53ea\u9700\u8981\u4fdd\u5b58\u4ee3\u7801\uff0c\u77ed\u77ed\u51e0\u79d2\u751a\u81f3\u4e00\u77ac\u95f4\uff0c\u5237\u65b0\u9875\u9762\uff0c\u5c31\u53ef\u4ee5\u7acb\u5373\u770b\u5230\u6548\u679c\uff01\u914d\u7f6eimi \u9ed8\u8ba4\u5f00\u542f\u4e86\u70ed\u66f4\u65b0\uff0c\u5982\u679c\u9700\u8981\u5173\u95ed\u6216\u8005\u4e2a\u6027\u5316\u8bbe\u7f6e\u8bf7\u770b\u4e0b\u6587\uff1a\u70ed\u66f4\u65b0\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684beans\u8282\u914d\u7f6e\u3002\u8be6\u89c1\u4e0b\u9762\u7684\u6ce8\u91ca\uff1a&#039;hotUpdate&#039;    =&gt;    [\n    \/\/ &#039;status&#039;    =&gt;    false, \/\/ \u5173\u95ed\u70ed\u66f4\u65b0\u53bb\u9664\u6ce8\u91ca\uff0c\u4e0d\u8bbe\u7f6e\u5373\u4e3a\u5f00\u542f\uff0c\u5efa\u8bae\u751f\u4ea7\u73af\u5883\u5173\u95ed\n\n    \/\/ --- \u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u76d1\u63a7 ---\n    \/\/ &#039;monitorClass&#039;    =&gt;    \\Imi\\HotUpdate\\Monitor\\FileMTime::class,\n    \/\/ &#039;timespan&#039;    =&gt;    1, \/\/ \u68c0\u6d4b\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n\n    \/\/ --- Inotify \u6269\u5c55\u76d1\u63a7 ---\n    \/\/ &#039;monitorClass&#039;    =&gt;    \\Imi\\HotUpdate\\Monitor\\Inotify::class,\n    \/\/ &#039;timespan&#039;    =&gt;    0, \/\/ \u68c0\u6d4b\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u4f7f\u7528\u6269\u5c55\u5efa\u8bae\u8bbe\u4e3a0\u6027\u80fd\u66f4\u4f73\n\n    \/\/ &#039;includePaths&#039;    =&gt;    [], \/\/ \u8981\u5305\u542b\u7684\u8def\u5f84\u6570\u7ec4\n    \/\/ &#039;excludePaths&#039;    =&gt;    [], \/\/ \u8981\u6392\u9664\u7684\u8def\u5f84\u6570\u7ec4\uff0c\u652f\u6301\u901a\u914d\u7b26*\n    \/\/ &#039;defaultPath&#039;    =&gt;    [], \/\/ \u8bbe\u4e3a\u6570\u7ec4\u5219\u8986\u76d6\u9ed8\u8ba4\u7684\u76d1\u63a7\u8def\u5f84\n],\u9ed8\u8ba4\u662f\u6839\u636e\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u76d1\u63a7\uff0c\u5efa\u8bae\u6709\u6761\u4ef6\u7684\u4e0a Inotify \u6269\u5c55\uff0c\u6027\u80fd\u66f4\u4f73\uff01\u6ce8\u610f\uff1a\u5982\u679c\u547d\u540d\u7a7a\u95f4\u52a0\u5165\u5230\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 beanScan\uff0c\u70ed\u66f4\u65b0\u662f\u65e0\u6cd5\u751f\u6548\u7684\uff01\u5fc5\u987b\u52a0\u5165\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 beanScan\uff01"},{"id":30,"title":"404\u5904\u7406","pageTitle":"404\u5904\u7406","url":"components\/httpserver\/404.html","content":"404\u5904\u7406\u5f53\u6ca1\u6709\u5339\u914d\u7684\u8def\u7531\uff0c\u8fd9\u65f6\u5019\u53ef\u80fd\u4f1a\u9700\u8981404\u5904\u7406\u3002\u6846\u67b6\u9ed8\u8ba4\u7684404\u5904\u7406\u4e3a\u72b6\u6001\u7801\u8bbe\u4e3a404\uff0c\u5982\u679c\u9700\u8981\u81ea\u5b9a\u4e49\u5904\u7406\uff0c\u9700\u8981\u7f16\u5199\u81ea\u5b9a\u4e49\u5904\u7406\u7c7b\u3002\u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    &#039;beans&#039;    =&gt;    [\n        &#039;HttpNotFoundHandler&#039;    =&gt;    [\n            \/\/ \u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\n            &#039;handler&#039;    =&gt;    \\xxx\\HttpNotFoundHandler::class,\n        ],\n    ],\n];\u7f16\u5199\u5904\u7406\u5668\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u5b9e\u73b0IHttpNotFoundHandler\u63a5\u53e3\uff0chandle()\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3aResponse\u5bf9\u8c61\u3002&lt;?php\nclass HttpNotFoundHandler implements IHttpNotFoundHandler\n{\n    public function handle(RequestHandlerInterface $requesthandler, ServerRequestInterface $request, ResponseInterface $response): ResponseInterface\n    {\n        return $response-&gt;withStatus(StatusCode::NOT_FOUND);\n    }\n}"},{"id":22,"title":"AOP \u62e6\u622a\u8bf7\u6c42","pageTitle":"AOP \u62e6\u622a\u8bf7\u6c42","url":"components\/httpserver\/aop.html","content":"AOP \u62e6\u622a\u8bf7\u6c42\u5728 imi \u4e2d\u66f4\u52a0\u63a8\u8350\u4f7f\u7528 AOP \u6765\u62e6\u622a\u8bf7\u6c42\u3002\u4e0d\u8981\u5fd8\u8bb0\u628a Aspect \u7c7b\u52a0\u5165 beanScan\uff01Demo&lt;?php\nnamespace ImiApp\\ApiServer\\Aop;\n\nuse Imi\\RequestContext;\nuse Imi\\Aop\\Annotation\\Around;\nuse Imi\\Aop\\Annotation\\Aspect;\nuse Imi\\Aop\\Annotation\\PointCut;\nuse Imi\\Aop\\AroundJoinPoint;\nuse Imi\\Util\\Http\\Consts\\MediaType;\nuse Imi\\Util\\Http\\Consts\\ResponseHeader;\n\n\/**\n * \u62e6\u622a\u63a7\u5236\u5668\u52a8\u4f5c\u8bf7\u6c42 Demo\n * \n * @Aspect\n *\/\nclass Fuck\n{\n    \/**\n     * \u76f4\u63a5\u83b7\u53d6 Response \u5bf9\u8c61\uff0c\u5f3a\u884c\u8f93\u51fa\n     * \n     * @PointCut(\n     *         allow={\n     *             &quot;ImiApp\\ApiServer\\Controller\\IndexController::fuck1&quot;,\n     *         }\n     * )\n     * @Around\n     *\n     * @return void\n     *\/\n    public function fuck1(AroundJoinPoint $joinPoint)\n    {\n        \/** @var \\Imi\\Server\\Http\\Message\\Response $response *\/\n        $response = RequestContext::get(&#039;response&#039;);\n        $response-&gt;withHeader(ResponseHeader::CONTENT_TYPE, MediaType::APPLICATION_JSON_UTF8)\n                 -&gt;write(json_encode([\n                    &#039;result&#039; =&gt; &#039;fuck1&#039;,\n                 ]))\n                 -&gt;send();\n        \/\/ \u5982\u679c\u9700\u8981\u6267\u884c\u539f\u52a8\u4f5c\u65b9\u6cd5\uff0c\u53ef\u4ee5\u53bb\u6389\u6ce8\u91ca\n        \/\/ $returnValue = $joinPoint-&gt;proceed();\n        \/\/ return $returnValue; \/\/ \u8fd4\u56de\u539f\u8fd4\u56de\u503c\n    }\n\n    \/**\n     * \u5f3a\u884c\u4fee\u6539\u8fd4\u56de\u503c\n     * \n     * @PointCut(\n     *         allow={\n     *             &quot;ImiApp\\ApiServer\\Controller\\IndexController::fuck2&quot;,\n     *         }\n     * )\n     * @Around\n     *\n     * @return void\n     *\/\n    public function fuck2(AroundJoinPoint $joinPoint)\n    {\n        \/\/ \u5982\u679c\u9700\u8981\u6267\u884c\u539f\u52a8\u4f5c\u65b9\u6cd5\uff0c\u53ef\u4ee5\u53bb\u6389\u6ce8\u91ca\n        \/\/ $returnValue = $joinPoint-&gt;proceed();\n        \/\/ return $returnValue; \/\/ \u8fd4\u56de\u539f\u8fd4\u56de\u503c\n\n        \/\/ \u5f3a\u884c\u4fee\u6539\u8fd4\u56de\u503c\n        return [\n            &#039;result&#039; =&gt; &#039;fuck2&#039;,\n        ];\n    }\n}"},{"id":"645b0b4a537478.11579114","title":"","pageTitle":"","url":"components\/httpserver\/config.html","content":""},{"id":24,"title":"\u63a7\u5236\u5668","pageTitle":"\u63a7\u5236\u5668","url":"components\/httpserver\/controller.html","content":"\u63a7\u5236\u5668\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u63a7\u5236\u5668\u4ee3\u7801\u3002\u57fa\u672c\u63a7\u5236\u5668&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller\n *\/\nclass Index extends HttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write(&#039;hello imi!&#039;);\n    }\n}\u8bbf\u95ee\u5730\u5740\uff1ahttp:\/\/localhost:{port}\/\u8f93\u51fa\u5185\u5bb9\uff1ahello imi!\u5355\u4f8b\u63a7\u5236\u5668\u7528\u6cd5\u5b8c\u5168\u4e00\u81f4\uff0c\u9002\u5408\u7528\u4e8e\u5355\u4f8b\u63a7\u5236\u5668\u573a\u666f\uff0c\u5bf9\u8c61\u5185\u90e8\u534f\u7a0b\u4e0a\u4e0b\u6587\u81ea\u52a8\u5207\u6362&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\SingletonHttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller(singleton=true)\n *\/\nclass Index extends SingletonHttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write(&#039;hello imi!&#039;);\n    }\n}\u8bbf\u95ee\u5730\u5740\uff1ahttp:\/\/localhost:{port}\/\u8f93\u51fa\u5185\u5bb9\uff1ahello imi!\u5c5e\u6027$request\u8bf7\u6c42\u4fe1\u606f\u5bf9\u8c61\uff0c\u53ef\u4ee5\u7528\u4e8e\u83b7\u53d6\u53c2\u6570\u3001\u8bf7\u6c42\u5934\u7b49\uff0c\u9075\u5faa PSR-7 \u6807\u51c6\u3002\u8be5\u5bf9\u8c61\u540c\u6837\u53ef\u4ee5\u7528\u5982\u4e0b\u65b9\u6cd5\u5168\u5c40\u8c03\u7528\uff1a\/** @var \\Imi\\Server\\Http\\Message\\Request $request *\/\n$request = \\Imi\\RequestContext::get(&#039;request&#039;);\u83b7\u53d6 GET \u53c2\u6570public function get($name = null, $default = null)\u5f53$name\u4e3anull\u65f6\uff0c\u8fd4\u56de\u5168\u90e8\u83b7\u53d6 POST \u53c2\u6570public function post($name = null, $default = null)\u83b7\u53d6 REQUEST \u53c2\u6570request \u6570\u636e\u5305\u542b get\/post\/cookiepublic function request($name = null, $default = null)\u5f53$name\u4e3anull\u65f6\uff0c\u8fd4\u56de\u5168\u90e8\u83b7\u53d6 JSON\/XML \u4f20\u53c2\u6570\u636epublic function getParsedBody()\u662f\u5426\u5b58\u5728 GET \u53c2\u6570public function hasGet($name)\u662f\u5426\u5b58\u5728 POST \u53c2\u6570public function hasPost($name)\u662f\u5426\u5b58\u5728 REQUEST \u53c2\u6570request \u6570\u636e\u5305\u542b get\/post\/cookiepublic function hasRequest($name)\u83b7\u53d6\u6240\u6709 Cookiepublic function getCookieParams()\u83b7\u53d6 Cookie \u503cpublic function getCookie($name, $default = null)\u83b7\u53d6\u6240\u6709\u8bf7\u6c42\u5934public function getHeaders()\u8bf7\u6c42\u5934\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199public function hasHeader($name)\u83b7\u53d6\u8bf7\u6c42\u5934\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u652f\u6301\u540c\u540d\uff0c\u8fd4\u56de\u6570\u7ec4public function getHeader($name)\u83b7\u53d6\u8bf7\u6c42\u5934\uff0c\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u652f\u6301\u540c\u540d\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32public function getHeaderLine($name)\u83b7\u53d6\u8bf7\u6c42\u65b9\u6cd5 (GET\/POST\u7b49)public function getMethod()\u83b7\u53d6 HTTP \u534f\u8bae\u7248\u672cpublic function getProtocolVersion()\u83b7\u53d6\u8bf7\u6c42\u5730\u5740public function getUri()\u534f\u8bae\u4f1a\u6839\u636e\u5f53\u524d\u670d\u52a1\u5668\u662f\u5426\u542f\u7528 ssl \u5224\u65ad\uff0c\u652f\u6301\u534f\u8bae\uff1ahttp\/https\/ws\/wss\u83b7\u53d6 imi \u4e2d\u5bf9\u5e94\u670d\u52a1\u5668\u7684\u5bf9\u8c61public function getServerInstance(): \\Imi\\Server\\Http\\Server\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6public function getUploadedFiles()\u8fd4\u56de\u503c\u4e3aImi\\Server\\Http\\Message\\UploadedFile\u6570\u7ec4\u7b80\u5355\u793a\u4f8b\uff1aforeach ($request-&gt;getUploadedFiles() as $k =&gt; $file)\n{\n    if (0 === $file-&gt;getError())\n    {\n        $file-&gt;moveTo(&#039;\u4e0a\u4f20\u6587\u4ef6\u4fdd\u5b58\u8def\u5f84&#039;);\n    }\n    else\n    {\n        throw new \\RuntimeException(sprintf(&#039;\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25\uff0c\u9519\u8bef\u7801\uff1a%s&#039;, $file-&gt;getError()));\n    }\n    \/\/ \u83b7\u53d6\u4e34\u65f6\u6587\u4ef6\u540d\n    $tmpFileName = $file-&gt;getTmpFileName();\n}\u83b7\u53d6 Server \u4fe1\u606fvar_dump($this-&gt;request-&gt;getServerParams());\nvar_dump($this-&gt;request-&gt;getServerParam(&#039;path_info&#039;));\u8f93\u51fa\uff1aarray(11) {\n  [&quot;request_method&quot;]=&gt;\n  string(3) &quot;GET&quot;\n  [&quot;request_uri&quot;]=&gt;\n  string(47) &quot;\/xxx.html&quot;\n  [&quot;path_info&quot;]=&gt;\n  string(47) &quot;\/xxx.html&quot;\n  [&quot;request_time&quot;]=&gt;\n  int(1538010416)\n  [&quot;request_time_float&quot;]=&gt;\n  float(1538010417.6185)\n  [&quot;server_port&quot;]=&gt;\n  int(8080)\n  [&quot;remote_port&quot;]=&gt;\n  int(62687)\n  [&quot;remote_addr&quot;]=&gt;\n  string(9) &quot;127.0.0.1&quot;\n  [&quot;master_time&quot;]=&gt;\n  int(1538010416)\n  [&quot;server_protocol&quot;]=&gt;\n  string(8) &quot;HTTP\/1.1&quot;\n  [&quot;server_software&quot;]=&gt;\n  string(18) &quot;swoole-http-server&quot;\n}\nstring(47) &quot;\/xxx.html&quot;\u83b7\u53d6\u5ba2\u6237\u7aefIP\u5730\u5740$ip = $this-&gt;request-&gt;getServerParam(&#039;remote_addr&#039;);\u83b7\u53d6 Swoole Request \u5bf9\u8c61\/** @var \\Swoole\\Http\\Request $swooleRequest *\/\n$swooleRequest = $this-&gt;request-&gt;getSwooleRequest();$response\u54cd\u5e94\u5bf9\u8c61\uff0c\u9075\u5faa PSR-7 \u6807\u51c6\u3002\u8be5\u5bf9\u8c61\u540c\u6837\u53ef\u4ee5\u7528\u5982\u4e0b\u65b9\u6cd5\u5168\u5c40\u8c03\u7528\uff1a\/** @var \\Imi\\Server\\Http\\Message\\Response $request *\/\n$response = \\Imi\\RequestContext::get(&#039;response&#039;);\u76f4\u63a5\u5bf9\u8be5\u5bf9\u8c61\u64cd\u4f5c\u65e0\u6548\uff0c\u9700\u8981\u5982\u4e0b\u4f7f\u7528\u624d\u53ef\u3002\u64cd\u4f5c\u540e\u8d4b\u503c\uff1apublic function action()\n{\n $this-&gt;response = $this-&gt;response-&gt;write(&#039;hello imi!&#039;);\n}\u64cd\u4f5c\u540e\u8fd4\u56depublic function action()\n{\n return $this-&gt;response-&gt;write(&#039;hello imi!&#039;);\n}\u91cd\u5b9a\u5411public function redirect($url, $status = StatusCode::FOUND)$status \u662f\u72b6\u6001\u7801\uff0c\u9ed8\u8ba4302\uff0c\u53ef\u4ee5\u4f7f\u7528StatusCode::XXX\u5e38\u91cf\u8f93\u51fa\u5185\u5bb9public function write(string $content)\u6e05\u7a7a\u8f93\u51fa\u7f13\u51b2\u533apublic function clear()\u8bbe\u7f6eCookiepublic function withCookie($key, $value, $expire = 0, $path = &#039;\/&#039;, $domain = &#039;&#039;, $secure = false, $httponly = false)\u53d1\u9001\u6240\u6709\u54cd\u5e94\u6570\u636epublic function send()\u53d1\u9001\u6587\u4ef6\uff0c\u4e00\u822c\u7528\u4e8e\u6587\u4ef6\u4e0b\u8f7d\/**\n * \u53d1\u9001\u6587\u4ef6\uff0c\u4e00\u822c\u7528\u4e8e\u6587\u4ef6\u4e0b\u8f7d\n * @param string $filename \u8981\u53d1\u9001\u7684\u6587\u4ef6\u540d\u79f0\uff0c\u6587\u4ef6\u4e0d\u5b58\u5728\u6216\u6ca1\u6709\u8bbf\u95ee\u6743\u9650sendfile\u4f1a\u5931\u8d25\n * @param integer $offset \u4e0a\u4f20\u6587\u4ef6\u7684\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u6307\u5b9a\u4ece\u6587\u4ef6\u7684\u4e2d\u95f4\u90e8\u5206\u5f00\u59cb\u4f20\u8f93\u6570\u636e\u3002\u6b64\u7279\u6027\u53ef\u7528\u4e8e\u652f\u6301\u65ad\u70b9\u7eed\u4f20\u3002\n * @param integer $length \u53d1\u9001\u6570\u636e\u7684\u5c3a\u5bf8\uff0c\u9ed8\u8ba4\u4e3a\u6574\u4e2a\u6587\u4ef6\u7684\u5c3a\u5bf8\n * @return static\n *\/\npublic function sendFile(string $filename, int $offset = 0, int $length = 0)\u662f\u5426\u5df2\u7ed3\u675f\u8bf7\u6c42public function isEnded()\u83b7\u53d6swoole\u54cd\u5e94\u5bf9\u8c61public function getSwooleResonse(): \\swoole_http_response\u83b7\u53d6\u5bf9\u5e94\u7684\u670d\u52a1\u5668public function getServerInstance(): \\Imi\\Server\\Http\\Server\u8bbe\u7f6e\u72b6\u6001\u7801public function withStatus($code, $reasonPhrase = &#039;&#039;)\u8bbe\u7f6e\u8fd4\u56de\u5934public function withHeader($name, $value)$reponse-&gt;withHeader(&#039;test&#039;, &#039;v1&#039;);\n$reponse-&gt;withHeader(&#039;test&#039;, [&#039;v2&#039;, &#039;v3&#039;]);\n\/\/ \u6700\u7ec8header\u4e2dtest\u4e3av2,v3\u6dfb\u52a0\u8fd4\u56de\u5934public function withAddedHeader($name, $value)$reponse-&gt;withAddedHeader(&#039;test&#039;, &#039;v1&#039;);\n$reponse-&gt;withAddedHeader(&#039;test&#039;, [&#039;v2&#039;, &#039;v3&#039;]);\n\/\/ \u6700\u7ec8header\u4e2dtest\u4e3av1,v2,v3\u83b7\u53d6 Swoole Response \u5bf9\u8c61\/** @var \\Swoole\\Http\\Response $swooleResponse *\/\n$swooleResponse = $this-&gt;request-&gt;getSwooleResponse();"},{"id":19,"title":"\u9ad8\u6027\u80fd Http \u670d\u52a1","pageTitle":"\u9ad8\u6027\u80fd Http \u670d\u52a1","url":"components\/httpserver\/coServer.html","content":"\u9ad8\u6027\u80fd Http \u670d\u52a1imi v1.0.13 \u7248\u672c\u65b0\u589e\u4e86\u4e00\u4e2a Swoole\\Coroutine\\Http\\Server \u5b9e\u73b0\u7684\u534f\u7a0b\u670d\u52a1\u5668\u3002\u9700\u8981 Swoole 4.4+ \u624d\u53ef\u4f7f\u7528\u8be5\u7279\u6027\u3002\u8be5\u7279\u6027\u662f\u53ef\u9009\u7684\uff0c\u4e0d\u5f71\u54cd\u4ee5\u524d\u4f7f\u7528\u7684\u670d\u52a1\u5668\u6a21\u5f0f\u3002\u4f7f\u7528\u534f\u7a0b\u670d\u52a1\u5668\u7279\u6027\uff0c\u4f9d\u9760 Linux \u7cfb\u7edf\u7684\u7aef\u53e3\u91cd\u7528\u673a\u5236\uff0c\u7cfb\u7edf\u7ea7\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u53ef\u4ee5\u8ba9\u4f60\u7684\u591a\u8fdb\u7a0b Http \u670d\u52a1\u5904\u7406\u8bf7\u6c42\u7684\u80fd\u529b\u5f97\u5230\u63d0\u5347\u3002\u4f7f\u7528 ab\uff0c\u672c\u673a-&gt;\u865a\u62df\u673a\uff08\u53cc\u6838+2\u8fdb\u7a0b\uff09\u538b\u6d4bHello World \u9875\u9762\uff0c\u76f8\u6bd4\u4e4b\u524d\u7684\u670d\u52a1\u5668\u6a21\u5f0f\u5927\u6982\u6709 80% \u7684\u6027\u80fd\u63d0\u5347\u3002\u8be5\u6570\u636e\u4ec5\u4f9b\u53c2\u8003\uff0c\u4e0d\u540c\u914d\u7f6e\u3001\u73af\u5883\u3001\u4e1a\u52a1\u4ee3\u7801\u8dd1\u51fa\u6765\u7684\u6570\u5b57\u4f1a\u6709\u5dee\u8ddd\uff0c\u4f46\u5f88\u660e\u663e\uff0c\u534f\u7a0b\u670d\u52a1\u5668\u53ef\u4ee5\u5b9e\u73b0\u66f4\u9ad8\u6027\u80fd\u7684 Http \u670d\u52a1\u3002\u4f7f\u7528\u65b9\u5f0f\u6211\u4eec\u901a\u5e38\u4f7f\u7528 vendor\/bin\/imi server\/start \u6765\u542f\u52a8\u670d\u52a1\u5668\u542f\u52a8\u4e3b\u670d\u52a1\u5668\uff1avendor\/bin\/imi server\/start -name main\u542f\u52a8\u5b50\u670d\u52a1\u5668\uff1avendor\/bin\/imi server\/start -name \u5b50\u670d\u52a1\u5668\u540d\u6307\u5b9a\u8fdb\u7a0b\u6570\uff1a\u542f\u52a8\u4e3b\u670d\u52a1\u5668\uff1avendor\/bin\/imi server\/start -name main -workerNum 4\u8fdb\u7a0b\u6570\u53c2\u6570\u662f\u53ef\u4ee5\u5ffd\u7565\u7684\uff0c\u4f18\u5148\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 @app.mainServer.configs.worker_num \u914d\u7f6e\uff0c\u5982\u679c\u8be5\u914d\u7f6e\u9879\u4e0d\u5b58\u5728\u5219\u4f7f\u7528 CPU \u6838\u5fc3\u6570\u4f5c\u4e3a\u8fdb\u7a0b\u6570\u91cf\u3002\u4f18\u7f3a\u70b9\u6bd4\u8f83\u4f18\u70b9\ud83d\udc4d\u9ad8\u6027\u80fd\uff0cLinux \u7cfb\u7edf\u7ea7\u7684\u8d1f\u8f7d\u5747\u8861\ud83d\udcaa\u9ad8\u5ea6\u53ef\u63a7\uff0c\u4f7f\u7528 imi \u81ea\u7814\u8fdb\u7a0b\u6c60\u7ef4\u62a4 Worker \u8fdb\u7a0b\u2615\u65e0\u7f1d\u652f\u6301\uff0c\u4e1a\u52a1\u4ee3\u7801\u65e0\u9700\u505a\u4efb\u4f55\u66f4\u6539\uff0c\u5373\u53ef\u4eab\u53d7\u5230\u9ad8\u6027\u80fd\u7f3a\u70b9\u4e0d\u652f\u6301 Task \u7279\u6027\u4e0d\u652f\u6301\u76d1\u542c\u591a\u7aef\u53e3\u3001\u591a\u534f\u8bae\u603b\u7ed3\u4f7f\u7528\u8be5\u7279\u6027\uff0c\u53ef\u4ee5\u4eab\u53d7\u5230\u9ad8\u6027\u80fd\u5e26\u6765\u7684\u597d\u5904\uff0c\u4f46\u662f\u65e0\u6cd5\u4f7f\u7528 Task\uff0c\u4ee5\u53ca\u591a\u7aef\u53e3\u591a\u534f\u8bae\u76d1\u542c\u3002\u5bf9\u4e8e\u5f00\u53d1 Http API \u7684\u573a\u666f\u6765\u8bb2\uff0c\u662f\u975e\u5e38\u9002\u5408\u7528\u8fd9\u4e2a\u7279\u6027\u7684\u3002\u72ec\u5360\u4e8b\u4ef6IMI.CO_SERVER.START\u534f\u7a0b\u670d\u52a1\u5668\u5f00\u59cb\u4e8b\u4ef6\u53ef\u901a\u8fc7 $e-&gt;getTarget() \u83b7\u53d6 CoServer \u5bf9\u8c61\u3002"},{"id":35,"title":"\u8de8\u57df\u548c OPTIONS \u8bf7\u6c42","pageTitle":"\u8de8\u57df\u548c OPTIONS \u8bf7\u6c42","url":"components\/httpserver\/cros.html","content":"\u8de8\u57df\u548c OPTIONS \u8bf7\u6c42imi \u6846\u67b6\u5185\u7f6e\u4e86\u4e00\u4e2a OptionsMiddleware \u4e2d\u95f4\u4ef6\uff0c\u7528\u4e8e\u89e3\u51b3\u4f7f\u7528 application\/json \u8bf7\u6c42\u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u5148\u53d1\u9001\u4e00\u4e2a OPTIONS \u8bf7\u6c42\u3002\u5e76\u4e14\u53ef\u4ee5\u89e3\u51b3\u8de8\u57df\u5934\u95ee\u9898\u3002\u7c7b\u540d\uff1a\\Imi\\Server\\Http\\Middleware\\OptionsMiddleware\u522b\u540d\uff1aOptionsMiddleware\u4e2d\u95f4\u4ef6\u4f7f\u7528\u65b9\u6cd5\uff1ahttps:\/\/doc.imiphp.com\/components\/httpserver\/middleware.html\u53c2\u6570\u8bbe\u7f6e\u4e00\u822c\u6765\u8bb2\uff0c\u9ed8\u8ba4\u7684\u914d\u7f6e\u8db3\u4ee5\u6ee1\u8db3\u7edd\u5927\u90e8\u5206\u573a\u666f\u3002\u5982\u679c\u6709\u7279\u6b8a\u9700\u6c42\uff0c\u4f60\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u914d\u7f6e\u4e2d\u7684 beans.OptionsMiddleware \u4e2d\u914d\u7f6e\u8be5\u4e2d\u95f4\u4ef6\u7684\u53c2\u6570\u3002\u4e0b\u9762\u7ed9\u51fa\u7684\u662f\u9ed8\u8ba4\u53c2\u6570\u503c\uff1a[\n    &#039;beans&#039; =&gt;  [\n        &#039;OptionsMiddleware&#039; =&gt;  [\n            \/\/ \u8bbe\u7f6e\u5141\u8bb8\u7684 Origin\uff0c\u4e3a null \u65f6\u5141\u8bb8\u6240\u6709\uff0c\u4e3a\u6570\u7ec4\u65f6\u5141\u8bb8\u591a\u4e2a\n            &#039;allowOrigin&#039;       =&gt;  null,\n            \/\/ \u5141\u8bb8\u7684\u8bf7\u6c42\u5934\n            &#039;allowHeaders&#039;      =&gt;  &#039;Authorization, Content-Type, Accept, Origin, If-Match, If-Modified-Since, If-None-Match, If-Unmodified-Since, X-Requested-With, X-Id, X-Token, Cookie&#039;,\n            \/\/ \u5141\u8bb8\u7684\u8de8\u57df\u8bf7\u6c42\u5934\n            &#039;exposeHeaders&#039;     =&gt;  &#039;Authorization, Content-Type, Accept, Origin, If-Match, If-Modified-Since, If-None-Match, If-Unmodified-Since, X-Requested-With, X-Id, X-Token, Cookie&#039;,\n            \/\/ \u5141\u8bb8\u7684\u8bf7\u6c42\u65b9\u6cd5\n            &#039;allowMethods&#039;      =&gt;  &#039;GET, POST, PATCH, PUT, DELETE&#039;,\n            \/\/ \u662f\u5426\u5141\u8bb8\u8de8\u57df Cookie\n            &#039;allowCredentials&#039;  =&gt;  &#039;true&#039;,\n            \/\/ \u5f53\u8bf7\u6c42\u4e3a OPTIONS \u65f6\uff0c\u662f\u5426\u4e2d\u6b62\u540e\u7eed\u4e2d\u95f4\u4ef6\u548c\u8def\u7531\u903b\u8f91\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u4e3a true\n            &#039;optionsBreak&#039;      =&gt;  true,\n        ],\n    ],\n]"},{"id":29,"title":"\u9519\u8bef\u5f02\u5e38\u5904\u7406","pageTitle":"\u9519\u8bef\u5f02\u5e38\u5904\u7406","url":"components\/httpserver\/error.html","content":"\u9519\u8bef\u5f02\u5e38\u5904\u7406\u5f53\u7a0b\u5e8f\u51fa\u73b0\u9519\u8bef\u6216\u8005\u5f02\u5e38\u65f6\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u5e0c\u671b\u5728\u5f00\u53d1\u65f6\u8f93\u51fa\u62a5\u9519\u4fe1\u606f\uff0c\u5728\u751f\u4ea7\u73af\u5883\u65f6\u9690\u85cf\u8be6\u7ec6\u7684\u4fe1\u606f\u3002\u5728 imi \u4e2d\uff0c\u63d0\u4f9b\u4e86 Http \u670d\u52a1\u7684\u9519\u8bef\u5f02\u5e38\u9ed8\u8ba4\u5904\u7406\u5668\u652f\u6301\u3002\u9ed8\u8ba4 Http \u9519\u8bef\u5904\u7406\u5668\uff1aImi\\Server\\Http\\Error\\JsonErrorHandler\u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    &#039;beans&#039;    =&gt;    [\n        &#039;HttpErrorHandler&#039;    =&gt;    [\n            \/\/ \u6307\u5b9a\u9ed8\u8ba4\u5904\u7406\u5668\n            &#039;handler&#039;    =&gt;    \\Imi\\Server\\Http\\Error\\JsonErrorHandler::class,\n        ],\n    ],\n];\u5904\u7406\u5668\u53c2\u6570\u8bbe\u7f6ereturn [\n    &#039;beans&#039;    =&gt;    [\n        \\Imi\\Server\\Http\\Error\\JsonErrorHandler::class    =&gt;    [\n            \/\/ debug \u4e3a false\u65f6\u4e5f\u663e\u793a\u9519\u8bef\u4fe1\u606f\n            &#039;releaseShow&#039;    =&gt;    false,\n            \/\/ \u53d6\u6d88\u7ee7\u7eed\u629b\u51fa\u5f02\u5e38\uff0c\u4e5f\u4e0d\u4f1a\u8bb0\u5f55\u65e5\u5fd7\n            &#039;cancelThrow&#039;    =&gt;    true,\n        ],\n    ],\n];\u7f16\u5199\u5904\u7406\u5668\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u5b9e\u73b0IErrorHandler\u63a5\u53e3\uff0chandle()\u65b9\u6cd5\u8fd4\u56de\u503c\u4e3atrue\u65f6\u5219\u53d6\u6d88\u7ee7\u7eed\u629b\u51fa\u5f02\u5e38\u3002&lt;?php\nnamespace Imi\\Server\\Http\\Error;\n\nuse Imi\\App;\nuse Imi\\RequestContext;\nuse Imi\\Util\\Format\\Json;\nuse Imi\\Util\\Http\\Consts\\MediaType;\nuse Imi\\Util\\Http\\Consts\\RequestHeader;\n\nclass JsonErrorHandler implements IErrorHandler\n{\n    \/**\n     * debug \u4e3a false\u65f6\u4e5f\u663e\u793a\u9519\u8bef\u4fe1\u606f\n     * @var boolean\n     *\/\n    protected $releaseShow = false;\n\n    \/**\n     * \u53d6\u6d88\u7ee7\u7eed\u629b\u51fa\u5f02\u5e38\n     * @var boolean\n     *\/\n    protected $cancelThrow = true;\n\n    public function handle(\\Throwable $throwable): bool\n    {\n        if($this-&gt;releaseShow || App::isDebug())\n        {\n            $data = [\n                &#039;message&#039;    =&gt;    $throwable-&gt;getMessage(),\n                &#039;code&#039;        =&gt;    $throwable-&gt;getCode(),\n                &#039;file&#039;        =&gt;    $throwable-&gt;getFile(),\n                &#039;line&#039;        =&gt;    $throwable-&gt;getLine(),\n                &#039;trace&#039;        =&gt;    explode(PHP_EOL, $throwable-&gt;getTraceAsString()),\n            ];\n        }\n        else\n        {\n            $data = [\n                &#039;success&#039;    =&gt;    false,\n                &#039;message&#039;    =&gt;    &#039;error&#039;,\n            ];\n        }\n        \/** @var \\Imi\\Server\\View\\Handler\\Json $jsonView *\/\n        $jsonView = RequestContext::getServerBean(&#039;JsonView&#039;);\n        $jsonView-&gt;handle($data, [], RequestContext::get(&#039;response&#039;))-&gt;send();\n\n        \/\/ \u5982\u6709\u9700\u8981\uff0c\u53ef\u4ee5\u624b\u52a8\u8bb0\u5f55\u4e0b\u65e5\u5fd7\uff1a\n        \\Imi\\App::getBean(&#039;ErrorLog&#039;)-&gt;onException($throwable);\n\n        return $this-&gt;cancelThrow;\n    }\n}"},{"id":34,"title":"Http2","pageTitle":"Http2","url":"components\/httpserver\/http2.html","content":"Http2imi v1.0.20 \u65b0\u589e\u652f\u6301\u5f00\u53d1 Http2 \u670d\u52a1\u3002\u5177\u4f53\u5f00\u53d1\u65b9\u6cd5\u548c Http\u3001WebSocket \u7c7b\u4f3c\u3002\u9700\u8981\u9664\u4e86\u9700\u8981\u52a0\u914d\u7f6e\u5916\uff0c\u8bf7\u6c42\u54cd\u5e94\u5bf9\u8c61\u662f\u4f7f\u7528 Http \u7684\u5bf9\u8c61\u3002\u5e76\u4e14\u53ef\u4ee5\u50cf\u5f00\u53d1 WebSocket \u4e00\u6837\u4f7f\u7528\u8bf7\u6c42\u4e0a\u4e0b\u6587\u5b58\u50a8\u6570\u636e\uff0c\u56e0\u4e3a Http2 \u662f\u4ee5\u5168\u53cc\u5de5\u957f\u8fde\u63a5\u7684\u65b9\u5f0f\u5de5\u4f5c\u7684\u3002\u914d\u7f6e\u65b9\u6cd5\u5728\u9879\u76ee config.php \u4e2d\u7684\u670d\u52a1\u5668\u914d\u7f6e\u4e2d\u52a0\u5165\uff1a&#039;configs&#039;   =&gt;  [\n    &#039;open_http2_protocol&#039;   =&gt;  true,\n    \/\/ \u4e0b\u9762\u662f\u542f\u7528 https\uff0c\u5982\u679c\u9700\u8981\u5c31\u914d\u7f6e\n    \/\/ &#039;ssl_cert_file&#039;     =&gt;  &#039;\/server.crt&#039;,\n    \/\/ &#039;ssl_key_file&#039;      =&gt;  &#039;\/server.key&#039;,\n],\u5176\u5b83\u7528\u6cd5\u53c2\u8003 Http\u3001WebSocket \u5373\u53ef\u3002"},{"id":131,"title":"JWT","pageTitle":"JWT","url":"components\/httpserver\/jwt.html","content":"JWT\u4ecb\u7ecd\u5728 imi \u6846\u67b6\u4e2d\u975e\u5e38\u65b9\u4fbf\u5730\u63a5\u5165 jwtGithub: https:\/\/github.com\/imiphp\/imi-jwtComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-jwt&quot;: &quot;~1.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;jwt&#039;    =&gt;  &#039;Imi\\JWT&#039;,\n    ],\n]\u914d\u7f6e\u914d\u7f6e @app.beans\uff1a[\n    &#039;JWT&#039;   =&gt;  [\n        &#039;list&#039;  =&gt;  [\n            \/\/ a \u4e3a\u540d\u79f0\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u4ee5\u4e0b\u88ab\u6ce8\u91ca\u7684\u9879\u4e3a\u975e\u5fc5\u8bbe\uff0c\u4e00\u822c\u6709\u9ed8\u8ba4\u503c\n            &#039;a&#039; =&gt;  [\n                \/\/ &#039;signer&#039;    =&gt;  &#039;Hmac&#039;,      \/\/ \u7b7e\u540d\u8005\uff0c\u53ef\u9009\uff1aEcdsa\/Hmac\/Rsa\n                \/\/ &#039;algo&#039;      =&gt;  &#039;Sha256&#039;,    \/\/ \u7b97\u6cd5\uff0c\u53ef\u9009\uff1aSha256\/Sha384\/Sha512\n                \/\/ &#039;dataName&#039;  =&gt;  &#039;data&#039;,      \/\/ \u81ea\u5b9a\u4e49\u6570\u636e\u5b57\u6bb5\u540d\uff0c\u653e\u4f60\u9700\u8981\u5f80token\u91cc\u4e22\u7684\u6570\u636e\n                \/\/ &#039;audience&#039;  =&gt;  null,        \/\/ \u63a5\u6536\uff0c\u975e\u5fc5\u987b\n                \/\/ &#039;subject&#039;   =&gt;  null,        \/\/ \u4e3b\u9898\uff0c\u975e\u5fc5\u987b\n                &#039;expires&#039;   =&gt;  86400,        \/\/ \u8d85\u65f6\u79d2\u6570\n                \/\/ &#039;issuer&#039;    =&gt;  null,        \/\/ \u53d1\u884c\u4eba\uff0c\u975e\u5fc5\u987b\n                \/\/ &#039;notBefore&#039; =&gt;  null,        \/\/ \u5b9e\u9645\u65e5\u671f\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e\u672c\u503c\n                \/\/ &#039;issuedAt&#039;  =&gt;  true,        \/\/ JWT \u53d1\u51fa\u65f6\u95f4\u3002\u8bbe\u4e3a true \u5219\u4e3a\u5f53\u524d\u65f6\u95f4\uff1b\u8bbe\u4e3a false \u4e0d\u8bbe\u7f6e\uff1b\u5176\u5b83\u503c\u5219\u76f4\u63a5\u5199\u5165\n                \/\/ &#039;id&#039;        =&gt;  null,        \/\/ Token id\n                \/\/ &#039;headers&#039;   =&gt;  [],          \/\/ \u5934\n                \/\/ \u81ea\u5b9a\u4e49\u83b7\u53d6 token \u56de\u8c03\uff0c\u8fd4\u56de\u503c\u4e3a Token\u3002\u9ed8\u8ba4\u4ece Header Authorization \u4e2d\u83b7\u53d6\u3002\n                \/\/ &#039;tokenHandler&#039;  =&gt;  null,\n                &#039;privateKey&#039;    =&gt;  &#039;123456&#039;,\/\/ \u79c1\u94a5\n                &#039;publicKey&#039;     =&gt;  &#039;123456&#039;,\/\/ \u516c\u94a5\n            ],\n        ],\n    ],\n]\u751f\u6210 Token\u7b80\u5355\u751f\u6210\uff1ause \\Imi\\JWT\\Facade\\JWT;\n\/\/ \u4f60\u9700\u8981\u5f80token\u91cc\u4e22\u7684\u6570\u636e\n$data = [\n    &#039;memberId&#039;  =&gt;  19260817,\n];\n$token = JWT::getToken($data); \/\/ Token \u5bf9\u8c61\n$tokenContent = $token-&gt;toString(); \/\/ Token \u5b57\u7b26\u4e32\u6307\u5b9a\u540d\u79f0\uff1ause \\Imi\\JWT\\Facade\\JWT;\n\/\/ \u4f60\u9700\u8981\u5f80token\u91cc\u4e22\u7684\u6570\u636e\n$data = [\n    &#039;memberId&#039;  =&gt;  19260817,\n];\n$token = JWT::getToken($data, &#039;a&#039;); \/\/ Token \u5bf9\u8c61\n$tokenContent = $token-&gt;toString(); \/\/ Token \u5b57\u7b26\u4e32\u81ea\u5b9a\u4e49\u5904\u7406\uff1ause \\Imi\\JWT\\Facade\\JWT;\n\/\/ \u4f60\u9700\u8981\u5f80token\u91cc\u4e22\u7684\u6570\u636e\n$data = [\n    &#039;memberId&#039;  =&gt;  19260817,\n];\n$token = JWT::getToken($data, &#039;a&#039;, function(\\Lcobucci\\JWT\\Builder $builder){\n    \/\/ \u53ef\u4ee5\u9488\u5bf9\u8be5\u5bf9\u8c61\u505a\u4e00\u4e9b\u64cd\u4f5c\n    $builder-&gt;withClaim(&#039;aaa&#039;, &#039;bbb&#039;);\n}); \/\/ Token \u5bf9\u8c61\n$tokenContent = $token-&gt;toString(); \/\/ Token \u5b57\u7b26\u4e32\u9a8c\u8bc1 Token\u624b\u52a8\u9a8c\u8bc1\uff1ause \\Imi\\JWT\\Facade\\JWT;\n\/** @var \\Lcobucci\\JWT\\Token $token *\/\n$token = JWT::parseToken($jwt); \/\/ \u4ec5\u9a8c\u8bc1\u662f\u5426\u5408\u6cd5\n\/\/ $token = JWT::parseToken($jwt, &#039;a&#039;); \/\/ \u6307\u5b9a\u914d\u7f6e\u540d\u79f0\n$data = $token-&gt;getClaim(&#039;data&#039;); \/\/ \u83b7\u53d6\u5f80token\u91cc\u4e22\u7684\u6570\u636e\uff0cPHP &lt;= 7.3\n$data = $token-&gt;claims()-&gt;get(&#039;data&#039;); \/\/ \u83b7\u53d6\u5f80token\u91cc\u4e22\u7684\u6570\u636e\uff0cPHP &gt;= 7.4\n\n\/\/ \u9a8c\u8bc1\u6709\u6548\u671f\u3001id\u3001issuer\u3001audience\u3001subject\n$validationData = new \\Lcobucci\\JWT\\ValidationData;\n$validationData-&gt;setId(&#039;&#039;);\n$validationData-&gt;setIssuer(&#039;&#039;);\n$validationData-&gt;setAudience(&#039;&#039;);\n$validationData-&gt;setSubject(&#039;&#039;);\nif($token-&gt;validate($validationData))\n{\n    \/\/ \u5408\u6cd5\n}\nelse\n{\n    \/\/ \u4e0d\u5408\u6cd5\n}\u6ce8\u89e3\u9a8c\u8bc1\uff1a&lt;?php\nnamespace Imi\\JWT\\Test\\Test;\n\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\JWT\\Annotation\\JWTValidation;\n\n\/**\n * @Bean(&quot;A&quot;)\n *\/\nclass A\n{\n    \/**\n     * @JWTValidation(tokenParam=&quot;token&quot;, dataParam=&quot;data&quot;)\n     *\n     * @param \\Lcobucci\\JWT\\Token $token\n     * @param \\stdClass $data\n     * @return array\n     *\/\n    public function test($token = null, $data = null)\n    {\n        return [$token, $data];\n    }\n\n}@JWTValidationJWT \u9a8c\u8bc1\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660enameJWT \u914d\u7f6e\u540d\u79f0id\u9a8c\u8bc1 ID\u3002\u4e3a null \u5219\u4f7f\u7528\u914d\u7f6e\u4e2d\u7684\u503c\u9a8c\u8bc1\uff1b\u4e3a false \u5219\u4e0d\u9a8c\u8bc1issuer\u9a8c\u8bc1\u53d1\u884c\u4eba\u3002\u4e3a null \u5219\u4f7f\u7528\u914d\u7f6e\u4e2d\u7684\u503c\u9a8c\u8bc1\uff1b\u4e3a false \u5219\u4e0d\u9a8c\u8bc1audience\u9a8c\u8bc1\u63a5\u6536\u3002\u4e3a null \u5219\u4f7f\u7528\u914d\u7f6e\u4e2d\u7684\u503c\u9a8c\u8bc1\uff1b\u4e3a false \u5219\u4e0d\u9a8c\u8bc1subject\u9a8c\u8bc1\u4e3b\u9898\u3002\u4e3a null \u5219\u4f7f\u7528\u914d\u7f6e\u4e2d\u7684\u503c\u9a8c\u8bc1\uff1b\u4e3a false \u5219\u4e0d\u9a8c\u8bc1tokenParamToken \u5bf9\u8c61\u6ce8\u5165\u7684\u53c2\u6570\u540d\u79f0dataParam\u6570\u636e\u6ce8\u5165\u7684\u53c2\u6570\u540d\u79f0Rsa\u914d\u7f6e\u914d\u7f6e @app.beans\uff1a\u6253\u5f00Git Bash Here \u7528openssl\u751f\u6210\u79c1\u5319\u6587\u4ef6openssl genrsa -out pri_key.pem 1024\u6839\u636e\u79c1\u5319\u6587\u4ef6\u751f\u6210\u516c\u5319openssl rsa -in pri_key.pem -pubout -out pub_key.pem\u590d\u5236\u6587\u4ef6\u5185\u5bb9\u5230\u914d\u7f6e\u4e0a[\n    &#039;JWT&#039;   =&gt;  [\n        &#039;list&#039;  =&gt;  [\n            \/\/ a \u4e3a\u540d\u79f0\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u4ee5\u4e0b\u88ab\u6ce8\u91ca\u7684\u9879\u4e3a\u975e\u5fc5\u8bbe\uff0c\u4e00\u822c\u6709\u9ed8\u8ba4\u503c\n            &#039;b&#039; =&gt;  [\n                &#039;signer&#039;    =&gt;  &#039;Rsa&#039;,      \/\/ \u7b7e\u540d\u8005\uff0c\u53ef\u9009\uff1aEcdsa\/Hmac\/Rsa\n                &#039;algo&#039;      =&gt;  &#039;Sha256&#039;,    \/\/ \u7b97\u6cd5\uff0c\u53ef\u9009\uff1aSha256\/Sha384\/Sha512\n                \/\/ &#039;dataName&#039;  =&gt;  &#039;data&#039;,      \/\/ \u81ea\u5b9a\u4e49\u6570\u636e\u5b57\u6bb5\u540d\uff0c\u653e\u4f60\u9700\u8981\u5f80token\u91cc\u4e22\u7684\u6570\u636e\n                \/\/ &#039;audience&#039;  =&gt;  null,        \/\/ \u63a5\u6536\uff0c\u975e\u5fc5\u987b\n                \/\/ &#039;subject&#039;   =&gt;  null,        \/\/ \u4e3b\u9898\uff0c\u975e\u5fc5\u987b\n                &#039;expires&#039;   =&gt;  86400,        \/\/ \u8d85\u65f6\u79d2\u6570\n                \/\/ &#039;issuer&#039;    =&gt;  null,        \/\/ \u53d1\u884c\u4eba\uff0c\u975e\u5fc5\u987b\n                \/\/ &#039;notBefore&#039; =&gt;  null,        \/\/ \u5b9e\u9645\u65e5\u671f\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e\u672c\u503c\n                \/\/ &#039;issuedAt&#039;  =&gt;  true,        \/\/ JWT \u53d1\u51fa\u65f6\u95f4\u3002\u8bbe\u4e3a true \u5219\u4e3a\u5f53\u524d\u65f6\u95f4\uff1b\u8bbe\u4e3a false \u4e0d\u8bbe\u7f6e\uff1b\u5176\u5b83\u503c\u5219\u76f4\u63a5\u5199\u5165\n                \/\/ &#039;id&#039;        =&gt;  null,        \/\/ Token id\n                \/\/ &#039;headers&#039;   =&gt;  [],          \/\/ \u5934\n                \/\/ \u81ea\u5b9a\u4e49\u83b7\u53d6 token \u56de\u8c03\uff0c\u8fd4\u56de\u503c\u4e3a Token\u3002\u9ed8\u8ba4\u4ece Header Authorization \u4e2d\u83b7\u53d6\u3002\n                \/\/ &#039;tokenHandler&#039;  =&gt;  null,\n                &#039;privateKey&#039;    =&gt;  &#039;-----BEGIN RSA PRIVATE KEY-----\nMIICXwIBAAKBgQDXj+GqRbpV2n2H1iOdnXwtvv6K+W7g9VqCQv7cf\/DobqOH8cA7\n8jjsujk51ovklZl5q7NR\/sr4se9ghYH3QecLKKeMZeSQh+4LJubdkAbv+0Wmig\/Y\niAGTtJrK55OfVoVAJeCrMLERWPHvpnLBF\/VoCjy0PwuExVEpA6dwqiD0xQIDAQAB\nAoGBALeTLNdZMmrS+3ym\/QXJjGtY8GViLu8dg8rTS0B1JLCNKG8pjlB+48OWhA2h\njNlKHb3kX35AwpIw1m8Yw6nSUfM6uN0rL86IaHx6OzpB5ltWodXmHISATYcZ9Xn7\n5+dKRqpGPW5QR7N8lPrHGRN69o74bT4X7DVyZzsdfjgOna0xAkEA7GVmUjVFUg7B\n8KsypQKwDXF5kMNoC3CSjdQTBgSYXNjo1kQjBGoDgPlcEhbV0Ishw4z7sGdxnvkc\nid4KbnkwrwJBAOlwLsFDn7eXmVcmRb7s2enXkUdfp8gXzg57VFcxZ5UML1P6vilH\nF4LpJjqtluZGbvA7oD3dkaks7POkt0mgxssCQQDaB2fI+KL33O6Y530tXf48V+WU\nU\/W5X1l8ABaPnVtdfx24yV02rASRRuvZL0CDOF+quXRFrhLIWeAtdCJQ4+u3AkEA\ngVHGdQZTas+vARqQtM5dgjALqXCScETPwDIObSdPbMCNT4au5gseOUWUChm0aOlH\n+AnwIZWnZgMfWXI8n6tTtQJBAKGVtbVsmwZN+5UDLziwWR6VLcZCzymocbJZ\/PGi\ne49lnvOMZXg+9uLaQBiKCUqftQXaaFKj06hox6+25Rw1T0g=\n-----END RSA PRIVATE KEY-----\n&#039;,\/\/ \u79c1\u94a5\n                &#039;publicKey&#039;     =&gt;  &#039;-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDXj+GqRbpV2n2H1iOdnXwtvv6K\n+W7g9VqCQv7cf\/DobqOH8cA78jjsujk51ovklZl5q7NR\/sr4se9ghYH3QecLKKeM\nZeSQh+4LJubdkAbv+0Wmig\/YiAGTtJrK55OfVoVAJeCrMLERWPHvpnLBF\/VoCjy0\nPwuExVEpA6dwqiD0xQIDAQAB\n-----END PUBLIC KEY-----&#039;,\/\/ \u516c\u94a5\n            ],\n        ],\n    ],\n]"},{"id":33,"title":"\u6700\u5927\u8bf7\u6c42\u6267\u884c\u65f6\u95f4","pageTitle":"\u6700\u5927\u8bf7\u6c42\u6267\u884c\u65f6\u95f4","url":"components\/httpserver\/maxExecuteTime.html","content":"\u6700\u5927\u8bf7\u6c42\u6267\u884c\u65f6\u95f4\u5728 php-fpm \u4e2d\u6709 max_execution_time \u8fd9\u4e2a\u9009\u9879\uff0c\u7528\u6765\u9650\u5b9a\u8bf7\u6c42\u6700\u5927\u6267\u884c\u65f6\u95f4\u3002imi \u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u7528\u4ee5\u652f\u6301\u8bbe\u7f6e\u6700\u5927\u8bf7\u6c42\u6267\u884c\u65f6\u95f4\uff0c\u5982\u679c\u8d85\u65f6\u53ef\u4ee5\u505a\u63d0\u524d\u8fd4\u56de\u7ed3\u679c\u7684\u5904\u7406\u3002\u4f7f\u7528\u65b9\u6cd5\u542f\u7528\u5728\u670d\u52a1\u5668\u914d\u7f6e beans \u8282\u4e2d\u914d\u7f6e\u4e2d\u95f4\u4ef6ExecuteTimeoutMiddleware\uff1a[\n    &#039;HttpDispatcher&#039;    =&gt;    [\n        &#039;middlewares&#039;    =&gt;    [\n            &#039;ExecuteTimeoutMiddleware&#039;,\n        ],\n    ],\n]\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u5728\u670d\u52a1\u5668\u914d\u7f6e beans \u8282\u4e2d\u914d\u7f6e\u4e2d\u95f4\u4ef6ExecuteTimeoutMiddleware\uff1a[\n    &#039;ExecuteTimeoutMiddleware&#039; =&gt;  [\n        &#039;maxExecuteTime&#039;    =&gt;  3000,\n        &#039;handler&#039;           =&gt;  \\Imi\\Server\\Http\\Error\\ExecuteTimeoutHandler::class,\n    ],\n]\u4e0a\u9762\u7684 handler \u4e3a imi \u5185\u7f6e\u7684\u5904\u7406\u5668\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u72b6\u6001\u7801\u3002\u81ea\u5b9a\u4e49\u8d85\u65f6\u5904\u7406\u5668\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u5b9e\u73b0 Imi\\Server\\Http\\Error\\IExecuteTimeoutHandler\u63a5\u53e3\u3002\u5b9e\u73b0\u65b9\u6cd5\uff1apublic function handle(Request $request, Response $response)\u76ee\u524d Swoole \u4e0d\u5141\u8bb8\u5f3a\u884c\u505c\u6b62\u6b63\u5728\u6267\u884c\u7684\u534f\u7a0b\uff0c\u6240\u4ee5\u53ea\u662f\u63d0\u524d\u54cd\u5e94\u5185\u5bb9\uff0c\u800c\u5e76\u4e0d\u662f\u4e2d\u65ad\u4efb\u52a1\u6267\u884c\uff0c\u8bf7\u77e5\u6653\u3002"},{"id":23,"title":"\u4e2d\u95f4\u4ef6","pageTitle":"\u4e2d\u95f4\u4ef6","url":"components\/httpserver\/middleware.html","content":"\u4e2d\u95f4\u4ef6imi \u6846\u67b6\u9075\u5faa PSR-7\u3001PSR-15 \u6807\u51c6\uff0c\u4f7f\u7528\u4e2d\u95f4\u4ef6\u6765\u5b9e\u73b0\u8def\u7531\u3002\u4e2d\u95f4\u4ef6\u53ef\u4ee5\u5bf9\u6574\u4e2a\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406imi \u7684\u8def\u7531\u5339\u914d\u3001\u6267\u884c\u52a8\u4f5c\u3001\u54cd\u5e94\u8f93\u51fa\uff0c\u90fd\u662f\u4f9d\u8d56\u4e2d\u95f4\u4ef6\u5b9e\u73b0\uff0c\u5fc5\u8981\u7684\u65f6\u5019\u4f60\u751a\u81f3\u53ef\u4ee5\u628a imi \u5185\u7f6e\u5b9e\u73b0\u66ff\u6362\u6389\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6\u5b9e\u73b0\u63a5\u53e3\uff1aPsr\\Http\\Server\\MiddlewareInterface\u65b9\u6cd5\uff1apublic function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface\u5148\u6267\u884c\u5176\u5b83\u4e2d\u95f4\u4ef6\uff1a$response = $handler-&gt;handle($request);use Imi\\Bean\\Annotation\\Bean;\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Server\\RequestHandlerInterface;\nuse Psr\\Http\\Server\\MiddlewareInterface;\n\n\/**\n * @Bean\n *\/\nclass TestMiddleware implements MiddlewareInterface\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     * @param ServerRequestInterface $request\n     * @param RequestHandlerInterface $handler\n     * @return ResponseInterface\n     *\/\n    public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface\n    {\n        \/\/ \u524d\u7f6e\u5904\u7406\n        \n        \/\/ \u5148\u6267\u884c\u5176\u5b83\u4e2d\u95f4\u4ef6\n        $response = $handler-&gt;handle($request);\n        \n        \/\/ \u540e\u7f6e\u5904\u7406\n        \n        return $response;\n    }\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    &#039;beans&#039;    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        &#039;HttpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Session\\Middleware\\HttpSessionMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528class Index extends HttpController\n{\n    \/**\n     * PHP \u539f\u751f\u6a21\u7248\u5f15\u64ce\u6f14\u793a\n     * \u8bbf\u95ee\uff1ahttp:\/\/127.0.0.1:8080\/\n     * \n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     * @View(template=&quot;index&quot;)\n     * \n     * \u5355\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6d4f\u89c8\u5668 F12 \u770bResponse Header\uff1a\n     * @Middleware(\\ImiDemo\\HttpDemo\\Middlewares\\PoweredBy::class)\n     * @return void\n     *\/\n    public function index()\n    {\n        return [\n            &#039;title&#039;        =&gt;    &#039;hello imi&#039;,\n            &#039;content&#039;    =&gt;    &#039;imi is very six&#039;,\n        ];\n    }\n\n    \/**\n     * \u65e0@View\u6ce8\u89e3\uff0c\u4e0d\u7528\u5199\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u6e32\u67d3\u6a21\u7248\n     * \u8bbf\u95ee\uff1ahttp:\/\/127.0.0.1:8080\/Index\/test\n     * \n     * @Action\n     * \n     * \u591a\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6d4f\u89c8\u5668 F12 \u770bResponse Header\uff1a\n     * @Middleware({\n     * \\ImiDemo\\HttpDemo\\Middlewares\\PoweredBy::class,\n     * \\ImiDemo\\HttpDemo\\Middlewares\\Test::class\n     * })\n     * \n     * @return void\n     *\/\n    public function test()\n    {\n\n    }\n}\u5982\u4e0a\u4ee3\u7801\uff0cindex()\u65b9\u6cd5\u4e2d\u7684@Middleware\u662f\u8bbe\u7f6e\u5355\u4e2a\u3002test()\u65b9\u6cd5\u4e2d\u7684\u662f\u8bbe\u7f6e\u591a\u4e2a\u4e2d\u95f4\u4ef6\u3002\u5177\u4f53\u8bf7\u770bimi-demo\u9879\u76ee\u4ee3\u7801\u3002\u914d\u7f6e\u8def\u7531\u4f7f\u7528\u4efb\u4f55\u7c7b\u578b\u7684\u8def\u7531\u914d\u7f6e\u90fd\u662f\u52a0middlewares\u8282\u6765\u5b9e\u73b0\u6307\u5b9a\u5c40\u90e8\u4e2d\u95f4\u4ef6\u3002[\n    &#039;route&#039;    =&gt;    [\n        &#039;url&#039;    =&gt;    &#039;\/callback2&#039;,\n    ],\n    &#039;callback&#039;    =&gt;    new RouteCallable(&#039;\\Test&#039;, &#039;abc&#039;),\n    &#039;middlewares&#039;    =&gt;    [\n        \\ImiDemo\\HttpDemo\\Middlewares\\PoweredBy::class,\n    ],\n],\u4e2d\u95f4\u4ef6\u5206\u7ec4\u670d\u52a1\u5668 config.php\uff1areturn [\n    &#039;middleware&#039;    =&gt;  [\n        &#039;groups&#039;    =&gt;  [\n            \/\/ \u7ec4\u540d\n            &#039;test&#039;  =&gt;  [\n                \/\/ \u4e2d\u95f4\u4ef6\u5217\u8868\n                \\Imi\\Test\\HttpServer\\ApiServer\\Middleware\\Middleware4::class,\n            ],\n        ],\n    ],\n];\u4f7f\u7528\uff1a@Middleware(&quot;@test&quot;)\u6ce8\u5165\u4fee\u6539\u6838\u5fc3\u52a8\u4f5c\u4e2d\u95f4\u4ef6\u670d\u52a1\u5668 config.php:[\n    &#039;beans&#039; =&gt;  [\n        &#039;ActionWrapMiddleware&#039;  =&gt;  [\n            &#039;actionMiddleware&#039;  =&gt;  &#039;\u81ea\u5b9a\u4e49&#039;,\n        ],\n    ],\n]"},{"id":25,"title":"RESTful","pageTitle":"RESTful","url":"components\/httpserver\/restful.html","content":"RESTful\u4f7f\u7528 imi \u63d0\u4f9b\u7684\u8def\u7531\u8bf7\u6c42\u65b9\u6cd5\u5224\u65ad\uff0c\u53ef\u4ee5\u5b9e\u73b0 RESTful \u98ce\u683c\u7684 api \u5f00\u53d1\u3002RESTful \u98ce\u683c\u63a7\u5236\u5668\u793a\u4f8b (query\/find\/create\/update\/delete)\uff1a&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Controller;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\View\\Annotation\\View;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * @Controller(prefix=&quot;\/rest&quot;)\n *\/\nclass Rest extends HttpController\n{\n    \/**\n     * query\n     * \n     * @Action\n     * @Route(url=&quot;&quot;, method={&quot;GET&quot;})\n     * @return void\n     *\/\n    public function query()\n    {\n        return [1, 2, 3];\n    }\n    \n    \/**\n     * find\n     * \n     * @Action\n     * @Route(url=&quot;.\/{id}&quot;, method={&quot;GET&quot;})\n     * \n     * @param int $id\n     * @return void\n     *\/\n    public function find($id)\n    {\n        return [\n            &#039;id&#039;    =&gt;    $id,\n        ];\n    }\n\n    \/**\n     * create\n     * \n     * @Action\n     * @Route(url=&quot;&quot;, method={&quot;POST&quot;})\n     * @return void\n     *\/\n    public function create()\n    {\n        return [\n            &#039;operation&#039;    =&gt;    &#039;create&#039;,\n            &#039;postData&#039;    =&gt;    $this-&gt;request-&gt;getParsedBody(),\n            &#039;success&#039;    =&gt;    true,\n        ];\n    }\n\n    \/**\n     * update\n     * \n     * @Action\n     * @Route(url=&quot;.\/{id}&quot;, method={&quot;PUT&quot;})\n     * \n     * @param int $id\n     * @return void\n     *\/\n    public function update($id)\n    {\n        return [\n            &#039;id&#039;        =&gt;    $id,\n            &#039;operation&#039;    =&gt;    &#039;update&#039;,\n            &#039;success&#039;    =&gt;    true,\n        ];\n    }\n\n    \/**\n     * delete\n     * \n     * @Action\n     * @Route(url=&quot;.\/{id}&quot;, method={&quot;DELETE&quot;})\n     * \n     * @param int $id\n     * @return void\n     *\/\n    public function delete($id)\n    {\n        return [\n            &#039;id&#039;        =&gt;    $id,\n            &#039;operation&#039;    =&gt;    &#039;delete&#039;,\n            &#039;success&#039;    =&gt;    true,\n        ];\n    }\n}"},{"id":20,"title":"\u8def\u7531","pageTitle":"\u8def\u7531","url":"components\/httpserver\/route.html","content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    &#039;beans&#039; =&gt;  [\n        &#039;HttpDispatcher&#039;    =&gt;  [\n            &#039;middlewares&#039;   =&gt;  [\n                \\Imi\\Server\\Http\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u8def\u7531\u914d\u7f6ereturn [\n    &#039;beans&#039; =&gt; [\n        &#039;HttpRoute&#039; =&gt; [\n            \/\/ url\u5339\u914d\u7f13\u5b58\u6570\u91cf\uff0c\u9ed8\u8ba41024\n            &#039;urlCacheNumber&#039; =&gt; 1024,\n            \/\/ \u5168\u5c40\u5ffd\u7565 URL \u8def\u7531\u5927\u5c0f\u5199\n            &#039;ignoreCase&#039;     =&gt; false,\n            \/\/ \u5168\u5c40\u652f\u6301\u667a\u80fd\u5c3e\u90e8\u659c\u6760\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\u90fd\u5339\u914d\n            &#039;autoEndSlash&#039;   =&gt; false,\n        ],\n    ],\n];\u6ce8\u89e3\u8bf4\u660e@Controller\u6ce8\u91ca\u76ee\u6807\uff1a\u7c7b\u8868\u660e\u4e00\u4e2a\u7c7b\u662f\u63a7\u5236\u5668\u7c7b\u5c5e\u6027\u540d\u79f0\u8bf4\u660eprefix\u52a8\u4f5c\u914d\u7f6e\u7684\u8bbf\u95ee\u5730\u5740\u524d\u7f00\uff0c\u5982\u679c\u52a8\u4f5c\u914d\u7f6e\u7684\u8bbf\u95ee\u5730\u5740\u89c4\u5219\u4ee5\/\u5f00\u59cb\uff0c\u5219\u672c\u5c5e\u6027\u65e0\u6548singleton\u662f\u5426\u4e3a\u5355\u4f8b\u63a7\u5236\u5668\uff0c\u9ed8\u8ba4\u4e3a null \u65f6\u53d6 '@server.\u670d\u52a1\u5668\u540d.controller.singleton'server\u6307\u5b9a\u5f53\u524d\u63a7\u5236\u5668\u5141\u8bb8\u54ea\u4e9b\u670d\u52a1\u5668\u4f7f\u7528\u3002\u652f\u6301\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\uff0c\u9ed8\u8ba4\u4e3a null \u5219\u4e0d\u9650\u5236@Route\u6ce8\u91ca\u76ee\u6807\uff1a\u65b9\u6cd5\u6307\u5b9a\u8def\u7531\u89c4\u5219\u5c5e\u6027\u540d\u79f0\u8bf4\u660eurl\u8bf7\u6c42\u5730\u5740\u89c4\u5219\u3002\u4ee5\/\u5f00\u5934\u5219\u5ffd\u89c6@Controller\u4e2d\u7684prefix\u4e3a\u7a7a\u6216\u4ee5.\/\u5f00\u5934\u5219\u5728@Controller\u4e2d\u7684prefix\u540e\u52a0\u4e0a\u8def\u7531\u5b9a\u4e49\u652f\u6301\u4ee3\u5165{name}\u5f62\u5f0f\u5360\u4f4d\u7b26\uff0c\u5339\u914d\u51fa\u6765\u7684\u503c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u52a8\u4f5c\u652f\u6301\u6b63\u5219\u5199\u6cd5\uff1a{id:\\d+}method\u5982\u679c\u8bbe\u7f6e\u4e86method\uff0c\u5219\u8bf7\u6c42\u65b9\u6cd5\u5fc5\u987b\u5728method\u5217\u8868\u4e2d\u624d\u53ef\u4ee5\u8fdb\u5230\u52a8\u4f5c\u3002\u652f\u6301\u5b57\u7b26\u4e32\u548c\u6570\u7ec4\u3002\u5982\uff1a&quot;GET&quot;\u6216{&quot;GET&quot;, &quot;POST&quot;}domain\u5224\u65ad\u57df\u540d\uff0c\u53ea\u6709\u7b26\u5408\u6761\u4ef6\u624d\u5141\u8bb8\u8bbf\u95ee\u3002\u652f\u6301\u5b57\u7b26\u4e32\u548c\u6570\u7ec4\uff0c\u652f\u6301{name}\u5f62\u5f0f\u5360\u4f4d\u7b26\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u52a8\u4f5cparamsGet\u5224\u65adGET\u53c2\u6570\uff0c\u53ea\u6709\u7b26\u5408\u6761\u4ef6\u624d\u5141\u8bb8\u8bbf\u95ee\u3002\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\u3002id=100\u5fc5\u987b\u5305\u542bid\uff0c\u5e76\u4e14\u503c\u4e3a100id!=100\u6216id&lt;&gt;100\u5fc5\u987b\u5305\u542bid\uff0c\u5e76\u4e14\u503c\u4e0d\u4e3a100id\u5fc5\u987b\u5305\u542bid\u53c2\u6570!id\u5fc5\u987b\u4e0d\u5305\u542bid\u53c2\u6570[&quot;id&quot; =&gt; &quot;\\d+&quot;]\u652f\u6301\u6b63\u5219paramsPost\u5224\u65adPOST\u53c2\u6570\uff0c\u7528\u6cd5\u540cparamsGetparamsBody\u5224\u65ad JSON\u3001XML \u53c2\u6570\uff0c\u7528\u6cd5\u540cparamsGetparamsBodyMultiLevelJSON\u3001XML\u53c2\u6570\u6761\u4ef6\u652f\u6301\u4ee5 . \u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u652f\u6301\u591a\u7ea7\u53c2\u6570\u83b7\u53d6\uff0c\u9ed8\u8ba4\u4e3atrueheader\u5224\u65ad\u8bf7\u6c42\u5934\uff0c\u7528\u6cd5\u540cparamsGetrequestMime\u8bf7\u6c42\u7684mime\u7c7b\u578b\u5224\u65ad\u5224\u65ad\u8bf7\u6c42\u5934\u4e2d\u7684Content-Type\u4e2d\u662f\u5426\u5305\u542b\u8fd9\u4e9bmime\u7c7b\u578b\u4e4b\u4e00\u652f\u6301\u5b57\u7b26\u4e32\u548c\u5b57\u7b26\u4e32\u6570\u7ec4ignoreCase\u5ffd\u7565\u8bf7\u6c42\u5730\u5740\u5927\u5c0f\u5199null-\u53d6HttpRoute\u4e2d\u9ed8\u8ba4\u503ctrue-\u5ffd\u7565\u5927\u5c0f\u5199false-\u4e25\u683c\u5224\u65adautoEndSlash\u667a\u80fd\u5c3e\u90e8\u659c\u6760\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\u90fd\u5339\u914dnull-\u53d6HttpRoute\u4e2d\u9ed8\u8ba4\u503ctrue-\u5ffd\u7565\u5927\u5c0f\u5199false-\u4e25\u683c\u5224\u65ad@Action\u6ce8\u91ca\u76ee\u6807\uff1a\u65b9\u6cd5\u8868\u660e\u4e00\u4e2a\u65b9\u6cd5\u662f\u52a8\u4f5c\u5c5e\u6027\uff1a\u65e0\u5982\u4e0b\u4ee3\u7801\u6240\u793a\uff0c\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u63a7\u5236\u5668+\u8def\u7531\u6ce8\u89e3\u4ee3\u7801\u3002&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller\n *\/\nclass Index extends HttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write(&#039;hello imi!&#039;);\n    }\n}\u8bbf\u95ee\u5730\u5740\uff1ahttp:\/\/localhost:{port}\/\u8f93\u51fa\u5185\u5bb9\uff1ahello imi!\u914d\u7f6e\u8def\u7531\u914d\u7f6e\u5fc5\u987b\u5199\u5728\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u4f60\u5199\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u662f\u65e0\u6548\u7684\u3002\u8def\u7531\u914d\u7f6e\u652f\u6301\u4e09\u79cd\u65b9\u5f0f\uff1a\u4f20\u7edf\u3001\u56de\u8c03\u3001\u8def\u7531\u56de\u8c03&lt;?php\nreturn [\n    &#039;route&#039; =&gt; [\n        \/\/ \u4f20\u7edf\u65b9\u5f0f\uff0c\u76f4\u63a5\u6307\u5b9a\u63a7\u5236\u5668\u3001\u65b9\u6cd5\u3001\u8def\u7531\uff0c\u548c\u6ce8\u89e3\u65b9\u5f0f\u6bd4\u8f83\u7c7b\u4f3c\n        [\n            &#039;controller&#039; =&gt; \\ImiDemo\\HttpDemo\\MainServer\\Controller\\Test::class,\n            &#039;method&#039; =&gt; &#039;index&#039;,\n            &#039;route&#039; =&gt; [\n                &#039;url&#039; =&gt; &#039;\/test&#039;,\n                \/\/ &#039;method&#039;    =&gt;    &#039;PUT&#039;,\n                \/\/ &#039;method&#039;    =&gt;    [&#039;GET&#039;, &#039;POST&#039;],\n                \/\/ &#039;domain&#039;    =&gt;    &#039;{name}.xxx.com&#039;,\n            ],\n        ],\n        \/\/ \u56de\u8c03\u65b9\u5f0f\uff0c\u7ed9callback\u6307\u5b9a\u4e00\u4e2acallable\u7c7b\u578b\n        [\n            &#039;route&#039; =&gt; [\n                &#039;url&#039; =&gt; &#039;\/callback1&#039;,\n            ],\n            &#039;callback&#039; =&gt; function () {\n                return RequestContext::get(&#039;response&#039;)-&gt;write(&#039;callback1&#039;);\n            },\n        ],\n        \/\/ \u8def\u7531\u56de\u8c03\u65b9\u5f0f\uff0cnew RouteCallable(\u7c7b\u540d, \u65b9\u6cd5\u540d)\n        [\n            &#039;route&#039; =&gt; [\n                &#039;url&#039; =&gt; &#039;\/callback2&#039;,\n            ],\n            &#039;callback&#039; =&gt; new RouteCallable(&#039;\\Test&#039;, &#039;abc&#039;),\n        ],\n        \/\/ \u5339\u914dURL\uff0c\u628ainterface\u4ee3\u5165\u5230\u7c7b\u3001\u65b9\u6cd5\u540d\u4e2d\n        [\n            &#039;controller&#039; =&gt; &#039;\\ImiDemo\\HttpDemo\\MainServer\\Controller\\Test{$interface}&#039;,\n            &#039;method&#039; =&gt; &#039;{$interface}&#039;,\n            &#039;route&#039; =&gt; [\n                &#039;url&#039; =&gt; &#039;\/test\/{interface}&#039;,\n            ],\n        ],\n        \/\/ \u61d2\u4eba\u514d\u53bb\u5199@Controller\u548c@Action\u6ce8\u89e3\u7684\u9ebb\u70e6\n        [\n            &#039;controller&#039;    =&gt;    &#039;\\ImiDemo\\HttpDemo\\MainServer\\Controller\\{$controller}&#039;,\n            &#039;method&#039;        =&gt;    &#039;{$action}&#039;,\n            &#039;route&#039;    =&gt;    [\n                &#039;url&#039;    =&gt;    &#039;\/{controller}\/{action}&#039;,\n            ],\n        ],\n    ]\n];\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get(&#039;routeResult&#039;);$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\Http\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\Route\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * WebSocket \u914d\u7f6e\n *\n * @var array\n *\/\npublic $wsConfig = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":26,"title":"Session","pageTitle":"Session","url":"components\/httpserver\/session.html","content":"Sessionimi \u7684 Http Session \u76ee\u524d\u5185\u5d4c\u652f\u6301\u6587\u4ef6\u548c Redis \u4e24\u79cd\u5b58\u50a8\u65b9\u5f0f\uff0c\u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u81ea\u884c\u6269\u5c55\u66f4\u591a\u5b58\u50a8\u65b9\u5f0f\u3002\u5982\u679c\u60f3\u8981\u542f\u7528 Session\uff0c\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fdb\u884c\u8bbe\u7f6e\u3002\u914d\u7f6e\u5728\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\uff1areturn [\n    &#039;beans&#039;    =&gt;    [\n        &#039;SessionManager&#039;    =&gt;    [\n            \/\/ \u6307\u5b9a Session \u5b58\u50a8\u9a71\u52a8\u7c7b\n            &#039;handlerClass&#039;    =&gt;    \\Imi\\Server\\Session\\Handler\\File::class,\n        ],\n        &#039;SessionConfig&#039;    =&gt;    [\n            \/\/ session \u540d\u79f0\uff0c\u9ed8\u8ba4\u4e3aimisid\n            &#039;name&#039;    =&gt;    &#039;imisid&#039;,\n            \/\/ \u6bcf\u6b21\u8bf7\u6c42\u5b8c\u6210\u540e\u89e6\u53d1\u5783\u573e\u56de\u6536\u7684\u6982\u7387\uff0c\u9ed8\u8ba4\u4e3a1%\uff0c\u53ef\u53d6\u503c0~1.0\uff0c\u6982\u7387\u4e3a0%~100%\n            &#039;gcProbability&#039;    =&gt;    0.01,\n            \/\/ \u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u9ed8\u8ba430\u5929\uff0c\u5355\u4f4d\u79d2\n            &#039;maxLifeTime&#039;=&gt;    86400 * 30,\n            \/\/ session \u524d\u7f00\n            &#039;prefix&#039; =&gt; null,\n        ],\n        &#039;SessionCookie&#039;    =&gt;    [\n            \/\/ \u662f\u5426\u542f\u7528 Cookie\n            &#039;enable&#039;    =&gt;  true,\n            \/\/ Cookie \u7684 \u751f\u547d\u5468\u671f\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\n            &#039;lifetime&#039;    =&gt;    0,\n            \/\/ \u6b64 cookie \u7684\u6709\u6548 \u8def\u5f84\u3002 on the domain where \u8bbe\u7f6e\u4e3a\u201c\/\u201d\u8868\u793a\u5bf9\u4e8e\u672c\u57df\u4e0a\u6240\u6709\u7684\u8def\u5f84\u6b64 cookie \u90fd\u53ef\u7528\u3002\n            &#039;path&#039;        =&gt;    &#039;\/&#039;,\n            \/\/ Cookie \u7684\u4f5c\u7528 \u57df\u3002 \u4f8b\u5982\uff1a\u201cwww.php.net\u201d\u3002 \u5982\u679c\u8981\u8ba9 cookie \u5728\u6240\u6709\u7684\u5b50\u57df\u4e2d\u90fd\u53ef\u7528\uff0c\u6b64\u53c2\u6570\u5fc5\u987b\u4ee5\u70b9\uff08.\uff09\u5f00\u5934\uff0c\u4f8b\u5982\uff1a\u201c.php.net\u201d\u3002\n            &#039;domain&#039;    =&gt;    &#039;&#039;,\n            \/\/ \u8bbe\u7f6e\u4e3a TRUE \u8868\u793a cookie \u4ec5\u5728\u4f7f\u7528 \u5b89\u5168 \u94fe\u63a5\u65f6\u53ef\u7528\u3002\n            &#039;secure&#039;    =&gt;    false,\n            \/\/ \u8bbe\u7f6e\u4e3a TRUE \u8868\u793a PHP \u53d1\u9001 cookie \u7684\u65f6\u5019\u4f1a\u4f7f\u7528 httponly \u6807\u8bb0\u3002\n            &#039;httponly&#039;    =&gt;    false,\n        ],\n        \/\/ \u914d\u7f6e\u4e2d\u95f4\u4ef6\n        &#039;HttpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \/\/ Session \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Session\\Middleware\\HttpSessionMiddleware::class,\n            ],\n        ],\n    ],\n];\u5176\u4e2d\u6bcf\u4e00\u79cd\u5b58\u50a8\u65b9\u5f0f\u8fd8\u6709\u7279\u522b\u7684\u914d\u7f6e\u9879\uff0c\u8bf7\u770b\u4e0b\u6587\u3002\u6587\u4ef6\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6-&gt;beans\u4e2d\u52a0\u5165\uff1a&#039;beans&#039;    =&gt;    [\n    &#039;SessionFile&#039;    =&gt;    [\n        &#039;savePath&#039;    =&gt;    &#039;Session\u6587\u4ef6\u5b58\u50a8\u8def\u5f84&#039;,\n    ]\n]\u6587\u4ef6 Session \u672a\u6765\u4e0d\u652f\u6301\u5206\u5e03\u5f0f\uff0c\u63a8\u8350\u4f7f\u7528 Redis\uff01Redis&#039;beans&#039;    =&gt;    [\n    &#039;SessionRedis&#039;    =&gt;    [\n        \/\/ Redis\u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;poolName&#039;    =&gt;    &#039;&#039;,\n        \/\/ Redis\u4e2d\u5b58\u50a8\u7684key\u524d\u7f00\uff0c\u53ef\u4ee5\u7528\u4e8e\u591a\u7cfb\u7edfsession\u7684\u5206\u79bb\n        \/\/ &#039;keyPrefix&#039;    =&gt;    &#039;imi:&#039;,\n    ]\n]Session \u5b58\u50a8\u5e8f\u5217\u5316\u65b9\u5f0f\u914d\u7f6e\u6839\u636e\u4f60\u9009\u7528\u7684\u5b58\u50a8\u9a71\u52a8\u7c7b\uff0c\u914d\u7f6e\u5728\u5bf9\u5e94\u7684\u8282\u91cc\uff0c\u4e0b\u9762\u4ee5\u6587\u4ef6\u9a71\u52a8\u6f14\u793a&#039;beans&#039;    =&gt;    [\n    &#039;SessionFile&#039;    =&gt;    [\n        &#039;formatHandlerClass&#039;    =&gt;    \\Imi\\Util\\Format\\PhpSerialize::class,\n    ]\n]\u53ef\u4ee5\u9009\u7528\u7684\u5e8f\u5217\u5316\u7c7b\uff1aJSON:\\Imi\\Util\\Format\\Json::classPHP\u5e8f\u5217\u5316:\\Imi\\Util\\Format\\PhpSerialize::classPHP Session \u5e8f\u5217\u5316:\\Imi\\Util\\Format\\PhpSession::class \uff08\u517c\u5bb9 php-fpm \u9ed8\u8ba4\u7684 Session \u5b58\u50a8\u683c\u5f0f\uff09\u4f7f\u7528\u5f15\u5165 Session \u7c7buse Imi\\Server\\Session\\Session;\u8bfb\u53d6\/\/ \u83b7\u53d6\u503c\nSession::get(&#039;aaa&#039;);\n\/\/ \u83b7\u53d6\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de\u9ed8\u8ba4\u503c\nSession::get(&#039;aaa&#039;, &#039;default value&#039;);\n\/\/ \u83b7\u53d6$session[&#039;a&#039;][&#039;b&#039;]\u7684\u503c\nSession::get(&#039;a.b&#039;);\n\/\/ \u83b7\u53d6$session[\u524d\u7f00][&#039;aaa&#039;]\u7684\u503c\uff0c\u524d\u7f00\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\nSession::get(&#039;@.aaa&#039;);\u5199\u5165Session::set($name, $value)\u5220\u9664Session::delete($name)\u8bfb\u53d6\u5e76\u5220\u9664Session::once($name, $default = false)\u6e05\u7a7aSession::clear();\u81ea\u5b9a\u4e49 Session ID \u83b7\u53d6\u65b9\u5f0fconfig.php:[\n    &#039;beans&#039;    =&gt;    [\n        \\Imi\\Server\\Session\\Middleware\\HttpSessionMiddleware::class =&gt; [\n            &#039;sessionIdHandler&#039;    =&gt;    function(\\Imi\\Server\\Http\\Message\\Request $request){\n                \/\/ \u4e3e\u4f8b\uff0c\u6bd4\u5982\u5e0c\u671b\u4ece header \u4e2d\u83b7\u53d6\n                return $request-&gt;getHeaderLine(&#039;X-Session-ID&#039;);\n            },\n        ],\n    ],\n]"},{"id":32,"title":"\u8d85\u5168\u5c40\u53d8\u91cf","pageTitle":"\u8d85\u5168\u5c40\u53d8\u91cf","url":"components\/httpserver\/superGlobals.html","content":"\u8d85\u5168\u5c40\u53d8\u91cf\u4e00\u822c\u6765\u8bb2\uff0c\u5728 Swoole \u9879\u76ee\u4e2d\uff0c\u4f60\u662f\u65e0\u6cd5\u4f7f\u7528 $_GET\u3001$_POST\u7b49\u8d85\u5168\u5c40\u53d8\u91cf\u7684\u3002\u81ea imi v1.0.15 \u7248\u672c\u5f00\u59cb\u652f\u6301\uff0c\u542f\u7528\u65b9\u6cd5\uff1a\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u7684 beans \u4e2d\u52a0\u5165\uff1a[\n    &#039;SuperGlobals&#039;  =&gt;  [\n        &#039;enable&#039;    =&gt;  true,\n    ],\n]"},{"id":"645b0b4a57c179.61858621","title":"","pageTitle":"","url":"components\/httpserver\/tcp-fu-wu-qi.html","content":""},{"id":31,"title":"HTTP \u9a8c\u8bc1\u5668","pageTitle":"HTTP \u9a8c\u8bc1\u5668","url":"components\/httpserver\/validation.html","content":"HTTP \u9a8c\u8bc1\u5668\u8bf7\u5148\u9605\u8bfb \u9a8c\u8bc1\u5668 \u7ae0\u8282\uff0cHTTP \u9a8c\u8bc1\u5668\u57fa\u4e8e\u9a8c\u8bc1\u5668\u6269\u5c55\uff0c\u57fa\u672c\u4f7f\u7528\u65b9\u5f0f\u76f8\u4f3c\u3002\u9996\u5148\uff0cHTTP \u9a8c\u8bc1\u5668\u662f@HttpValidation\u6ce8\u89e3\uff0c\u5b83\u53ea\u80fd\u5199\u5728\u65b9\u6cd5\u4e0a\u3002\u5199\u4e86\u8fd9\u4e2a\u6ce8\u89e3\uff0c\u5728action\u65b9\u6cd5\u8c03\u7528\u524d\u4f1a\u89e6\u53d1\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u5931\u8d25\u540c\u6837\u7684\u629b\u51fa\u5f02\u5e38\u53e6\u5916\uff0c\u9a8c\u8bc1\u89c4\u5219\u6ce8\u89e3\uff0c\u5982@Required\u7b49\u7684name\u5c5e\u6027\u7528\u6cd5\u4e5f\u7565\u6709\u4e0d\u540c\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528$get\u3001$post\u3001$body\u3001$headers\u3001$cookie\u3001$session\u3001$this\u540e\u9762\u8ddf\u4e0a.\u53c2\u6570\u540d\u6307\u5b9a\u53c2\u6570\uff0c\u5176\u4e2dget\u548cpost\u81ea\u7136\u4e0d\u7528\u591a\u8bf4\uff0c\u8fd9body\u7684\u7528\u5904\u5c31\u662f\uff0c\u6bd4\u5982\u53c2\u6570\u662f\u4ee5json\u4e3abody\u4f20\u7ed9\u4f60\u7684\uff0c\u4ed6\u4f1a\u81ea\u52a8\u7ed9\u4f60json_decode\uff0c\u4f60\u7528$body\u5c31\u53ef\u4ee5\u6307\u5b9a\u4e86\u3002$this \u4ee3\u8868\u662f\u5f53\u524d\u63a7\u5236\u5668\u5bf9\u8c61\u3002\u8fd8\u6709\u4e00\u4e2a@ExtractData\u6ce8\u89e3\uff0c\u5b83\u53ef\u4ee5\u628aget\/post\/body\u4e2d\u7684\u53c2\u6570\u5bfc\u51fa\u5230action\u65b9\u6cd5\u7684\u53c2\u6570\u4e2d\u3002@ExtractData\u6ce8\u89e3\u53ef\u4ee5\u72ec\u7acb\u4f7f\u7528\uff0c\u4e0d\u4f9d\u8d56@HttpValidation\u6ce8\u89e3\uff0c\u4f46\u53ea\u80fd\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\u3002\u5982\u4e0b\u65b9\u6cd5\u6240\u793a\uff1a\/**\n * http\u53c2\u6570\u9a8c\u8bc1\u6d4b\u8bd5\n * \n * @Action\n * \n * @HttpValidation\n * \n * @Required(name=&quot;$get.id&quot;, message=&quot;\u7528\u6237ID\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Integer(name=&quot;$get.id&quot;, min=&quot;1&quot;, message=&quot;\u7528\u6237ID\u4e0d\u7b26\u5408\u89c4\u5219&quot;)\n * @Required(name=&quot;$get.name&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Text(name=&quot;$get.name&quot;, min=&quot;2&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u957f\u5ea6\u4e0d\u5f97\u5c11\u4e8e2\u4f4d&quot;)\n * @Required(name=&quot;$get.age&quot;, default=-1)\n * \n * @ExtractData(name=&quot;$get.id&quot;, to=&quot;id&quot;)\n * @ExtractData(name=&quot;$get.name&quot;, to=&quot;name&quot;)\n * @ExtractData(name=&quot;$get.age&quot;, to=&quot;age&quot;)\n *\n * @return void\n *\/\npublic function httpValidation($id, $name, $age)\n{\n    return compact(&#039;id&#039;, &#039;name&#039;, &#039;age&#039;);\n}"},{"id":28,"title":"\u89c6\u56fe","pageTitle":"\u89c6\u56fe","url":"components\/httpserver\/view.html","content":"\u89c6\u56fe\u5728\u524d\u9762\u8bb2\u5230\u7684\u4f8b\u5b50\u4e2d\uff0c\u51e0\u4e4e\u90fd\u662f\u76f4\u63a5\u5bf9$response\u8fdb\u884c\u64cd\u4f5c\uff0c\u7136\u800c\u5b9e\u9645\u4e0a\u5f88\u5c11\u9700\u8981\u5bf9\u5176\u76f4\u63a5\u64cd\u4f5c\u7684\u60c5\u51b5\u3002\u5728 imi \u4e2d\u53ef\u4ee5\u4f7f\u7528\u89c6\u56fe\u6765\u51b3\u5b9a\u54cd\u5e94\u5185\u5bb9\u548c\u683c\u5f0f\uff0c\u5305\u62ecJSON\u3001XML\u3001\u6a21\u7248\u6e32\u67d3\u5728\u5185\u7684 imi \u8ba4\u4e3a\u90fd\u662f\u89c6\u56fe\uff0c\u89c6\u56fe\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u6ce8\u89e3\u6765\u8bbe\u7f6e\u3002&lt;?php\nnamespace Test;\n\nuse Imi\\Controller\\HttpController;\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Server\\Route\\Annotation\\Controller;\nuse Imi\\Server\\View\\Annotation\\View;\n\n\/**\n * \u4e00\u4e2a\u7b80\u5355\u7684\u63a7\u5236\u5668\n * @Controller\n * @View(renderType=&quot;json&quot;)\n *\/\nclass Index extends HttpController\n{\n    \/**\n     * \u4e00\u4e2a\u52a8\u4f5c\n     * @Action\n     * @Route(url=&quot;\/&quot;)\n     * @View(renderType=&quot;html&quot;, template=&quot;index&quot;)\n     *\/\n    public function index()\n    {\n        return $this-&gt;response-&gt;write(&#039;hello imi!&#039;);\n    }\n}\u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c@View\u6ce8\u89e3\u53ef\u4ee5\u5199\u5728\u7c7b\u548c\u65b9\u6cd5\u7684\u6ce8\u91ca\u4e2d\u3002\u7c7b\u6ce8\u89e3\u4ee3\u8868\u9488\u5bf9\u6240\u6709\u52a8\u4f5c\u8bbe\u5b9a\u7684\u89c6\u56fe\u914d\u7f6e\uff0c\u5728\u5355\u4e2a\u65b9\u6cd5\u4e0a\u5199\u6ce8\u89e3\uff0c\u4f1a\u8986\u76d6\u7c7b\u6ce8\u89e3\u3002json\/**\n * @Action\n * @View(renderType=&quot;json&quot;)\n *\/\npublic function index()\n{\n    \/\/ \u6570\u7ec4\n    $jsonData = [\n        &#039;id&#039;    =&gt;    1,\n        &#039;name&#039;    =&gt;    &#039;imi&#039;,\n    ];\n    \/\/ \u5bf9\u8c61\n    \/\/ $jsonData = new stdClass;\n    \/\/ $jsonData-&gt;name = &#039;imi&#039;;\n    return $jsonData;\n}\u53ef\u9009\u914d\u7f6ereturn [\n    &#039;beans&#039;        =&gt;    [\n        &#039;JsonView&#039;    =&gt;    [\n            \/\/ json_encode \u7684\u53c2\u6570\u503c\u914d\u7f6e\n            &#039;options&#039;    =&gt;    0,\n            &#039;depth&#039;        =&gt;    512,\n        ]\n    ]\n];xml\/**\n * @Action\n * @View(renderType=&quot;xml&quot;)\n *\/\npublic function index()\n{\n    \/\/ DOMDocument\n    $xml = new \\DOMDocument();\n    $xml-&gt;loadXML($xmlString);\n    \n    \/\/ SimpleXMLElement\n    $xml = \\simplexml_load_string($xmlString);\n    \n    return $xml;\n}\u6a21\u7248\u6e32\u67d3\u5fc5\u9009\u914d\u7f6ereturn [\n    &#039;beans&#039;        =&gt;    [\n        &#039;HtmlView&#039;    =&gt;    [\n            &#039;templatePath&#039;    =&gt;    &#039;\u6a21\u7248\u6587\u4ef6\u6839\u8def\u5f84&#039;,\n            \/\/ \u652f\u6301\u7684\u6a21\u7248\u6587\u4ef6\u6269\u5c55\u540d\uff0c\u4f18\u5148\u7ea7\u6309\u5148\u540e\u987a\u5e8f\n            \/\/ &#039;fileSuffixs&#039;        =&gt;    [\n                &#039;tpl&#039;,\n                &#039;html&#039;,\n                &#039;php&#039;\n            ],\n        ]\n    ]\n];\u4f7f\u7528\u65b9\u5f0f\u901a\u8fc7\u6ce8\u89e3\u914d\u7f6e\/**\n * @Action\n * @View(renderType=&quot;html&quot;, template=&quot;a\/b&quot;)\n *\/\npublic function index()\n{\n    return [\n        &#039;content&#039;    =&gt;    &#039;hello imi&#039;,\n    ];\n}\u8bed\u53e5\u52a8\u6001\u6e32\u67d3\/**\n * @Action\n *\/\npublic function index()\n{\n    return $this-&gt;__render(&#039;a\/b&#039;, [\n        &#039;content&#039;    =&gt;    &#039;hello imi&#039;,\n    ]);\n}\u6a21\u7248\u6587\u4ef6\u6a21\u7248\u6587\u4ef6\u6839\u8def\u5f84\/a\/b.html&lt;?=$content?&gt;\u8fd0\u884c\u7ed3\u679c\uff1ahello imiimi \u6ca1\u6709\u9020\u6a21\u7248\u5f15\u64ce\u7684\u8f6e\u5b50\uff0c\u662f\u56e0\u4e3a\u73b0\u5728 PHP \u6e32\u67d3 HTML \u7684\u573a\u666f\u8d8a\u6765\u8d8a\u5c11\uff0c\u5982\u679c\u6709\u9700\u8981\u4e5f\u53ef\u4ee5\u81ea\u5df1\u96c6\u6210\u5176\u5b83\u5f00\u6e90\u6a21\u7248\u5f15\u64ce\u3002\u5176\u5b83\u5728\u63a7\u5236\u5668-\u52a8\u4f5c\u4e2d\uff0c\u9664\u4e86\u8fd4\u56de\u6570\u636e\uff0c\u4f60\u8fd8\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de$this-&gt;response\uff0c\u5982\uff1areturn $this-&gt;response-&gt;write(&#039;hello world&#039;);\u4f60\u8fd8\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de@View\u7684\u6ce8\u89e3\u7c7b\u5b9e\u4f8b\uff1areturn new \\Imi\\Server\\View\\Annotation\\View([\n    &#039;template&#039;    =&gt;    &#039;index&#039;,\n    &#039;renderType&#039;=&gt;    &#039;html&#039;,\n    &#039;data&#039;        =&gt;    [\n        &#039;name&#039;    =&gt;    &#039;imi&#039;,\n    ],\n]);"},{"id":124,"title":"imi \u7ec4\u4ef6\u5217\u8868\u4e00\u89c8","pageTitle":"imi \u7ec4\u4ef6\u5217\u8868\u4e00\u89c8","url":"components\/list.html","content":"imi \u7ec4\u4ef6\u5217\u8868\u4e00\u89c8MQTTRPCgRPCHprose\u6d88\u606f\u961f\u5217AMQPKafkaJWT\u6743\u9650\u63a7\u5236Smarty \u6a21\u7248\u5f15\u64ce\u9650\u6d41\u8de8\u8fdb\u7a0b\u53d8\u91cf\u5171\u4eab\u96ea\u82b1\u7b97\u6cd5\u53d1\u53f7\u5668Swagger API \u6587\u6863\u751f\u6210Swoole Tracker"},{"id":114,"title":"AtomicLock","pageTitle":"AtomicLock","url":"components\/lock\/atomic.html","content":"AtomicLockAtomicLock \u662f\u5355\u673a\u8fdb\u7a0b\u9501\uff0c\u4f1a\u963b\u585e\u3002\u4f7f\u7528\u524d\u9700\u8981\u914d\u7f6e Atomic\u3002\u6ce8\u610f\uff01\u4f1a\u963b\u585e\u5f53\u524d\u8fdb\u7a0b\uff0c\u4e0d\u5efa\u8bae\u5728 worker \u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff01\u7c7b\uff1aImi\\Lock\\Handler\\AtomicBean \u540d\uff1aAtomicLock\u53ef\u914d\u7f6e\u53c2\u6570\/**\n * \u9501\u7684\u552f\u4e00 ID\n *\n * @var string\n *\/\nprotected $id;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\nprotected $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\nprotected $lockExpire = 3000;\n\n\/**\n * \u914d\u7f6e\u7684 Atomic \u540d\u79f0\n *\n * @var string\n *\/\npublic $atomicName;\n\n\/**\n * \u540c\u65f6\u83b7\u5f97\u9501\u7684\u6570\u91cf\n * \n * @var int\n *\/\npublic $quantity = 1;\n\u914d\u7f6e\u793a\u4f8b\/\/ \u9501\n&#039;lock&#039;  =&gt;[\n    &#039;list&#039;  =&gt;  [\n        &#039;atomic&#039; =&gt;  [\n            &#039;class&#039; =&gt;  &#039;AtomicLock&#039;,\n            &#039;options&#039;   =&gt;  [\n                &#039;atomicName&#039;    =&gt;  &#039;atomicLock&#039;,\n            ],\n        ],\n    ],\n],"},{"id":112,"title":"\u9501","pageTitle":"\u9501","url":"components\/lock\/index.html","content":"\u9501\u9501\uff08Lock\uff09\uff0c\u5728\u5e76\u53d1\u5904\u7406\uff0c\u9632\u6b62\u51b2\u7a81\u7684\u573a\u666f\u975e\u5e38\u5e38\u7528\u3002\u5728 imi \u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\uff0c\u6216\u8005\u81ea\u5df1\u5b9e\u4f8b\u5316Lock\u7c7b\u6765\u5b9e\u73b0\u52a0\u9501\u5904\u7406\u3002\u9664\u4e86\u5185\u7f6e\u7684\u9501\u9a71\u52a8\u5916\uff0c\u4f60\u53ef\u4ee5\u5b9e\u73b0Imi\\Lock\\Handler\\ILockHandler\u63a5\u53e3\uff0c\u6765\u5b9e\u73b0\u5176\u4ed6\u65b9\u5f0f\u7684\u9501\u3002\u914d\u7f6e\u7528\u6cd5\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u914d\u7f6e\u8bf4\u660e\/\/ \u9501\n&#039;lock&#039;  =&gt;[\n    &#039;list&#039;  =&gt;  [\n        \/\/ \u9501 ID =&gt; \u914d\u7f6e\n        &#039;redis&#039; =&gt;  [\n            &#039;class&#039; =&gt;  &#039;RedisLock&#039;, \/\/ Handler \u7c7b Bean \u540d\u6216\u5b8c\u6574\u7c7b\u540d\n            &#039;options&#039;   =&gt;  [\n                \/\/ Handler \u7c7b\u6240\u9700\u914d\u7f6e\n                &#039;poolName&#039;  =&gt;  &#039;redis_test&#039;,\n            ],\n        ],\n    ],\n],\u4f7f\u7528\u8bf4\u660e\u987a\u5e8f\u7528\u6cd5\uff1ause Imi\\Lock\\Lock;\n$lockId = &#039;&#039;; \/\/ \u4f60\u5b9a\u4e49\u7684ID\nif(Lock::lock($lockId))\n{\n    try {\n        \/\/ \u5e72\u4e00\u4e9b\u4e8b\u60c5\n    } catch(\\Throwable $th) {\n        throw $th;\n    } finally {\n        Lock::unlock($lockId);\n    }\n}\u56de\u8c03\u7528\u6cd5\uff08\u65e0\u9700\u624b\u52a8\u91ca\u653e\u9501\uff09\uff1a$result = Lock::lock($lockId, function(){\n    \/\/ \u6267\u884c\u4efb\u52a1\n}, function(){\n    \/\/ return \u975enull\u5219\u4e0d\u6267\u884c\u4efb\u52a1\n    \/\/ \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\n    \/\/ \u8fd9\u4e2a\u56de\u8c03\u53ef\u4ee5\u4e0d\u4f20\n});\nif($result)\n{\n    \/\/ \u52a0\u9501\u5e76\u6267\u884c\u6210\u529f\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\n}\u83b7\u53d6 Handler \u5bf9\u8c61\uff1a$lock = Lock::getInstance($lockId);\n$lock-&gt;lock(); \/\/ \u4f7f\u7528\u65b9\u6cd5\u53c2\u8003\u4e0b\u9762\u7684\u201c\u5b9e\u4f8b\u5316\u4f7f\u7528\u65b9\u6cd5\u201d\u6ce8\u89e3\u4f7f\u7528@Lockable\u65e0\u9700\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u652f\u6301\u53c2\u6570\uff1a\/**\n * \u9501ID\n * \u652f\u6301{id}\u3001{data.name}\u5f62\u5f0f\uff0c\u4ee3\u5165\u53c2\u6570\n * \u5982\u679c\u4e3anull\uff0c\u5219\u4f7f\u7528\u7c7b\u540d+\u65b9\u6cd5\u540d+\u5168\u90e8\u53c2\u6570\uff0c\u5e8f\u5217\u5316\u540ehash\n *\n * @var string|null\n *\/\npublic $id;\n\n\/**\n * \u9501\u7c7b\u578b\uff0c\u5982\uff1aRedisLock\n * \u4e3anull\u5219\u4f7f\u7528\u9ed8\u8ba4\u9501\u7c7b\u578b\uff08@currentServer.lock.defaultType\uff09\n *\n * @var string|null\n *\/\npublic $type;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\npublic $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\npublic $lockExpire = 3000;\n\n\/**\n * \u9501\u521d\u59cb\u5316\u53c2\u6570\n *\n * @var array\n *\/\npublic $options = [];\n\n\/**\n * \u5f53\u83b7\u5f97\u9501\u540e\u6267\u884c\u7684\u56de\u8c03\u3002\u8be5\u56de\u8c03\u8fd4\u56de\u975e null \u5219\u4e0d\u6267\u884c\u52a0\u9501\u540e\u7684\u65b9\u6cd5\uff0c\u672c\u56de\u8c03\u7684\u8fd4\u56de\u503c\u5c06\u4f5c\u4e3a\u8fd4\u56de\u503c\n * \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\uff0c\u83b7\u5f97\u9501\u540e\u518d\u505a\u4e00\u6b21\u68c0\u6d4b\n * \u5982\u679c\u4e3a{&quot;$this&quot;, &quot;methodName&quot;}\u683c\u5f0f\uff0c$this\u5c06\u4f1a\u88ab\u66ff\u6362\u4e3a\u5f53\u524d\u7c7b\uff0c\u65b9\u6cd5\u5fc5\u987b\u4e3a public \u6216 protected\n * \n * @var callable\n *\/\npublic $afterLock;\u7528\u6cd5\u793a\u4f8b\u6700\u7b80\u5355\u7684\u9501\uff1a\u53ea\u6307\u5b9aid\uff0c\u5176\u5b83\u5168\u90e8\u9ed8\u8ba4\u503c@Lockable(id=&quot;\u9501ID&quot;)\u5b9a\u4e49\u6267\u884c\u4efb\u52a1\u524d\u7684\u64cd\u4f5c\uff1aclass Test\n{\n    \/**\n     * @Lockable(id=&quot;\u9501ID&quot;, afterLock={&quot;$this&quot;, &quot;check&quot;})\n     *\/\n    public function index()\n    {\n        return 1;\n    }\n\n    protected function check()\n    {\n        return 2;\n    }\n\n    \/**\n     * @Lockable(id=&quot;\u9501ID&quot;, afterLock={&quot;$this&quot;, &quot;check2&quot;})\n     *\/\n    public function index2()\n    {\n        return 3;\n    }\n\n    protected function check2()\n    {\n        \n    }\n}\n\n$result = App::getBean(&#039;Test&#039;)-&gt;index();\necho $result, PHP_EOL; \/\/ 2\n\n$result = App::getBean(&#039;Test&#039;)-&gt;index2();\necho $result, PHP_EOL; \/\/ 3\u5b9e\u4f8b\u5316\u4f7f\u7528\u65b9\u6cd5\u65e0\u9700\u5728\u914d\u7f6e\u4e2d\u9884\u5b9a\u4e49\u987a\u5e8f\u7528\u6cd5$redisLock = new \\Imi\\Lock\\Handler\\Redis(&#039;\u9501ID&#039;, [\n    &#039;poolName&#039;  =&gt; &#039;redis&#039;, \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u9ed8\u8ba4\u53d6redis.default\u914d\u7f6e\n    &#039;db&#039;        =&gt;  1, \/\/ Redis \u51e0\u53f7\u5e93\uff0c\u9ed8\u8ba40\n    &#039;waitSleepTime&#039; =&gt;  20, \/\/ \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n    &#039;keyPrefix&#039; =&gt;  &#039;imi:lock:&#039;, \/\/ Redis key \u524d\u7f6e\n]);\n\nif($redisLock-&gt;lock())\n{\n    \/\/ \u52a0\u9501\u540e\u7684\u5904\u7406\n\n    \/\/ \u89e3\u9501\n    $redisLock-&gt;unlock();\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\u7684\u5904\u7406\n}\u56de\u8c03\u7528\u6cd5$redisLock = new \\Imi\\Lock\\Handler\\Redis(&#039;\u9501ID&#039;, [\n    &#039;poolName&#039;  =&gt; &#039;redis&#039;, \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u9ed8\u8ba4\u53d6redis.default\u914d\u7f6e\n    &#039;db&#039;        =&gt;  1, \/\/ Redis \u51e0\u53f7\u5e93\uff0c\u9ed8\u8ba40\n    &#039;waitSleepTime&#039; =&gt;  20, \/\/ \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n    &#039;keyPrefix&#039; =&gt;  &#039;imi:lock:&#039;, \/\/ Redis key \u524d\u7f6e\n]);\n\n\/\/ \u6267\u884c\u540e\u81ea\u52a8\u89e3\u9501\n$result = $redisLock-&gt;lock(function(){\n    \/\/ \u6267\u884c\u4efb\u52a1\n}, function(){\n    \/\/ return \u975enull\u5219\u4e0d\u6267\u884c\u4efb\u52a1\n    \/\/ \u4e00\u822c\u7528\u4e8e\u9632\u6b62\u7f13\u5b58\u51fb\u7a7f\n});\n\nif($result)\n{\n    \/\/ \u52a0\u9501\u5e76\u6267\u884c\u6210\u529f\n}\nelse\n{\n    \/\/ \u52a0\u9501\u5931\u8d25\n}"},{"id":113,"title":"RedisLock","pageTitle":"RedisLock","url":"components\/lock\/redis.html","content":"RedisLockRedisLock \u662f\u652f\u6301\u5206\u5e03\u5f0f\u7684\u9501\u3002\u4f7f\u7528\u524d\u9700\u8981\u914d\u7f6e Redis \u8fdb\u7a0b\u6c60\u3002\u7c7b\uff1aImi\\Lock\\Handler\\RedisBean \u540d\uff1aRedisLock\u53ef\u914d\u7f6e\u53c2\u6570\/**\n * \u9501\u7684\u552f\u4e00 ID\n *\n * @var string\n *\/\nprotected $id;\n\n\/**\n * \u7b49\u5f85\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\uff0c0\u4e3a\u4e0d\u9650\u5236\n * \n * @var int\n *\/\nprotected $waitTimeout = 3000;\n\n\/**\n * \u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\nprotected $lockExpire = 3000;\n\n\/**\n * Redis \u8fde\u63a5\u6c60\u540d\u79f0\n *\n * @var string\n *\/\npublic $poolName;\n\n\/**\n * Redis \u51e0\u53f7\u5e93\n *\n * @var integer\n *\/\npublic $db = 0;\n\n\/**\n * \u83b7\u5f97\u9501\u6bcf\u6b21\u5c1d\u8bd5\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n * \n * @var int\n *\/\npublic $waitSleepTime = 20;\n\n\/**\n * Redis key\n *\n * @var string\n *\/\npublic $key;\n\n\/**\n * Redis key \u524d\u7f6e\n *\n * @var string\n *\/\npublic $keyPrefix = &#039;imi:lock:&#039;;\n\u914d\u7f6e\u793a\u4f8b\/\/ \u9501\n&#039;lock&#039;  =&gt;[\n    &#039;list&#039;  =&gt;  [\n        &#039;redis&#039; =&gt;  [\n            &#039;class&#039; =&gt;  &#039;RedisLock&#039;,\n            &#039;options&#039;   =&gt;  [\n                &#039;poolName&#039;  =&gt;  &#039;redis_test&#039;,\n            ],\n        ],\n    ],\n],"},{"id":107,"title":"\u65e5\u5fd7","pageTitle":"\u65e5\u5fd7","url":"components\/log\/index.html","content":"\u65e5\u5fd7imi \u4e2d\u7684\u7f13\u5b58\uff0c\u7b26\u5408PSR-3\u89c4\u8303\u3002\u4f7f\u7528\u65f6\u9700\u8981\u5148\u914d\u7f6e\u9a71\u52a8\u548c\u5b9e\u4f8b\u3002\u5141\u8bb8\u6709\u591a\u4e2a\u540c\u7c7b\u578b\u5904\u7406\u5668\u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u5355\u72ec\u8bbe\u7f6e\u8981\u5904\u7406\u7684\u65e5\u5fd7\u7b49\u7ea7\uff0c\u975e\u5e38\u7075\u6d3b\u3002\u914d\u7f6e\u63a7\u5236\u53f0\u65e5\u5fd7return [\n    &#039;beans&#039;    =&gt;    [\n        &#039;Logger&#039;    =&gt;    [\n            &#039;exHandlers&#039;    =&gt;    [\n                [\n                    &#039;class&#039;        =&gt;    \\Imi\\Log\\Handler\\File::class,\n                    &#039;options&#039;    =&gt;    [\n                        \/* \u65e5\u5fd7\u516c\u5171\u914d\u7f6e-\u5f00\u59cb *\/\n                        \/\/ \u5141\u8bb8\u8bb0\u5f55\u7684\u65e5\u5fd7\u7b49\u7ea7\u4eec\n                        &#039;levels&#039;    =&gt;    \\Imi\\Log\\LogLevel::ALL,\n                        \/\/ \u65e5\u5fd7\u7f13\u5b58\u6570\u91cf\uff0c\u5f53\u65e5\u5fd7\u8fbe\u5230\u6307\u5b9a\u6761\u6570\u65f6\uff0c\u6267\u884c\u6279\u91cf\u5199\u5165\u64cd\u4f5c\uff0c\u51cf\u5c11\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u9ed8\u8ba40\uff0c\u6bcf\u6b21\u90fd\u5199\u5165\n                        \/\/ &#039;logCacheNumber&#039;    =&gt;    0,\n                        \/\/ \u65e5\u5fd7\u683c\u5f0f\n                        \/\/ &#039;format&#039;    =&gt;    &#039;{Y}-{m}-{d} {H}:{i}:{s} [{level}] {message}&#039;,\n                        \/\/ \u8c03\u7528\u8ddf\u8e2a\u683c\u5f0f\n                        \/\/ &#039;traceFormat&#039;    =&gt;    &#039;#{index}  {call} called at [{file}:{line}]&#039;,\n                        \/\/ \u9650\u5236\u65e5\u5fd7\u7684 trace \u6761\u76ee\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a -1 \u4e0d\u9650\u5236\n                        \/\/ &#039;traceLimit&#039; =&gt;  -1,\n                        \/* \u65e5\u5fd7\u516c\u5171\u914d\u7f6e-\u7ed3\u675f *\/\n\n                        \/**\n                         * \u8981\u4fdd\u5b58\u7684\u6587\u4ef6\u540d\n                         * \u652f\u6301\u4f7f\u7528date()\u51fd\u6570\u4e2d\u6240\u6709\u7684\u683c\u5f0f\uff0c\u5982\u7ecf\u5178\u5e74\u6708\u65e5\uff1alogs\/{y}-{m}-{d}.log\n                         * \u5982\u679c\u6587\u4ef6\u4f53\u79ef\u8d85\u51fa\u9650\u5236\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u7f16\u53f7\u6587\u4ef6\uff0c\u5982\uff1a\u7b2c\u4e00\u4e2a\u6587\u4ef62018-01-01.log\uff0c\u7b2c\u4e8c\u4e2a\u6587\u4ef62018-01-01(1).log\uff0c\u7b2c\u4e09\u4e2a\u6587\u4ef62018-01-01(2).log\n                         *\/\n                        &#039;fileName&#039;    =&gt;    dirname(__DIR__, 3) . &#039;\/log.log&#039;,\n                        \/\/ \u5355\u6587\u4ef6\u6700\u5927\u4f53\u79ef\uff0c\u5355\u4f4d\u5b57\u8282\uff0c\u9ed8\u8ba41G\n                        \/\/ &#039;maxSize&#039;    =&gt;    1073741824,\n                    ],\n                ]\n            ],\n        ],\n    ]\n];\u6587\u4ef6\u65e5\u5fd7return [\n    &#039;beans&#039;    =&gt;    [\n        &#039;Logger&#039;    =&gt;    [\n            &#039;exHandlers&#039;    =&gt;    [\n                [\n                    &#039;class&#039;        =&gt;    \\Imi\\Log\\Handler\\File::class,\n                    &#039;options&#039;    =&gt;    [\n                        \/\/ \u652f\u6301\u540c\u4e0a\u7684\u516c\u5171\u914d\u7f6e\n\n                        \/**\n                         * \u8981\u4fdd\u5b58\u7684\u6587\u4ef6\u540d\n                         * \u652f\u6301\u4f7f\u7528date()\u51fd\u6570\u4e2d\u6240\u6709\u7684\u683c\u5f0f\uff0c\u5982\u7ecf\u5178\u5e74\u6708\u65e5\uff1alogs\/{y}-{m}-{d}.log\n                         * \u5982\u679c\u6587\u4ef6\u4f53\u79ef\u8d85\u51fa\u9650\u5236\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u7f16\u53f7\u6587\u4ef6\uff0c\u5982\uff1a\u7b2c\u4e00\u4e2a\u6587\u4ef62018-01-01.log\uff0c\u7b2c\u4e8c\u4e2a\u6587\u4ef62018-01-01(1).log\uff0c\u7b2c\u4e09\u4e2a\u6587\u4ef62018-01-01(2).log\n                         *\/\n                        &#039;fileName&#039;    =&gt;    dirname(__DIR__, 3) . &#039;\/log.log&#039;,\n                        \/\/ \u5355\u6587\u4ef6\u6700\u5927\u4f53\u79ef\uff0c\u5355\u4f4d\u5b57\u8282\uff0c\u9ed8\u8ba41G\n                        \/\/ &#039;maxSize&#039;    =&gt;    1073741824,\n                        \n                    ],\n                ]\n            ],\n        ],\n    ]\n];\u6846\u67b6\u9ed8\u8ba4\u65e5\u5fd7\u5904\u7406return [\n    &#039;beans&#039;    =&gt;    [\n        &#039;Logger&#039;    =&gt;    [\n            &#039;coreHandlers&#039;    =&gt;    [\n                \/\/ \u8fd9\u91cc\u914d\u7f6e\uff0c\u6216\u8005\u6e05\u7a7a\n            ],\n        ],\n    ]\n];\u914d\u7f6e\u4e2d\u53ef\u9009\u53d8\u91cf\u8bf4\u660e\u9996\u5148\uff0c\u6240\u6709\u652f\u6301\u4f20\u5165{xxx}\u5f62\u5f0f\u7684\u683c\u5f0f\u4e2d\uff0c\u90fd\u652f\u6301date()\u51fd\u6570\u652f\u6301\u7684\u683c\u5f0f\uff0c\u5982Y-m-d\u7b49\u3002formatmessage \u65e5\u5fd7\u6d88\u606flevel \u65e5\u5fd7\u7b49\u7ea7timestamp \u65e5\u5fd7\u65f6\u95f4\u6233\uff0c\u7cbe\u5ea6\uff1a\u79d2trace \u4ee3\u7801\u8c03\u7528\u8ddf\u8e2alastTraceFormat\u53c2\u8003debug_backtrace()\u51fd\u6570\u8fd4\u56de\u5b57\u6bb5\u3002call \u8c03\u7528\u8ddf\u8e2atraceFormatcall \u8c03\u7528\u8ddf\u8e2aindex \u987a\u5e8f\u4f7f\u7528use Imi\\Log\\Log;\nuse Imi\\Log\\LogLevel;\n\nLog::log(LogLevel::INFO, &#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\n\/\/ \u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u9009\u4f20\u5165\u6570\u636e\uff0c\u4e5f\u53ef\u4ee3\u5165\u4e0a\u9762\u7684\u53d8\u91cf\nLog::log(LogLevel::INFO, &#039;\u65e5\u5fd7\u5185\u5bb9&#039;, []);\n\n\/\/ \u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u9009\u4f20\u5165\u6570\u636e\uff0c\u4e5f\u53ef\u4ee3\u5165\u4e0a\u9762\u7684\u53d8\u91cf\nLog::emergency(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;, []);\n\nLog::alert(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\nLog::critical(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\nLog::error(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\nLog::warning(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\nLog::notice(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\nLog::info(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\nLog::debug(&#039;\u65e5\u5fd7\u5185\u5bb9&#039;);\u76f4\u63a5\u8bb0\u5f55\u5f02\u5e38\u65e5\u5fd7\uff1atry {\n    throw new \\RuntimeException(&#039;test&#039;);\n} catch(\\Throwable $th) {\n    App::getBean(&#039;ErrorLog&#039;)-&gt;onException($th);\n}"},{"id":129,"title":"AMQP","pageTitle":"AMQP","url":"components\/mq\/amqp.html","content":"AMQP\u4ecb\u7ecd\u652f\u6301\u5728 imi \u6846\u67b6\u4e2d\u4f7f\u7528 \u652f\u6301 AMQP \u534f\u8bae\u7684\u6d88\u606f\u961f\u5217\uff0c\u5982\uff1aRabbitMQ\u652f\u6301\u6d88\u606f\u53d1\u5e03\u548c\u6d88\u8d39Github: https:\/\/github.com\/imiphp\/imi-amqpComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-amqp&quot;: &quot;^1.0.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u8bf4\u660e\u53ef\u4ee5\u53c2\u8003 example \u76ee\u5f55\u793a\u4f8b\uff0c\u5305\u62ec\u5b8c\u6574\u7684\u6d88\u606f\u53d1\u5e03\u548c\u6d88\u8d39\u529f\u80fd\u3002\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u7ec4\u4ef6\n        &#039;AMQP&#039;   =&gt;  &#039;Imi\\AMQP&#039;,\n    ],\n]\u8fde\u63a5\u6c60\u914d\u7f6e\uff1a[\n    &#039;pools&#039;    =&gt;    [\n        &#039;rabbit&#039;    =&gt;  [\n            &#039;sync&#039;    =&gt;    [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\AMQP\\Pool\\AMQPSyncPool::class,\n                    &#039;config&#039;    =&gt;    [\n                        &#039;maxResources&#039;    =&gt;    10,\n                        &#039;minResources&#039;    =&gt;    0,\n                    ],\n                ],\n                &#039;resource&#039;    =&gt;    [\n                    &#039;host&#039;      =&gt; &#039;127.0.0.1&#039;,\n                    &#039;port&#039;      =&gt; 5672,\n                    &#039;user&#039;      =&gt; &#039;guest&#039;,\n                    &#039;password&#039;  =&gt; &#039;guest&#039;,\n                ]\n            ],\n            &#039;async&#039;    =&gt;    [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\AMQP\\Pool\\AMQPCoroutinePool::class,\n                    &#039;config&#039;    =&gt;    [\n                        &#039;maxResources&#039;    =&gt;    10,\n                        &#039;minResources&#039;    =&gt;    1,\n                    ],\n                ],\n                &#039;resource&#039;    =&gt;    [\n                    &#039;host&#039;      =&gt; &#039;127.0.0.1&#039;,\n                    &#039;port&#039;      =&gt; 5672,\n                    &#039;user&#039;      =&gt; &#039;guest&#039;,\n                    &#039;password&#039;  =&gt; &#039;guest&#039;,\n                ]\n            ],\n        ],\n    ]\n]\u9ed8\u8ba4\u8fde\u63a5\u6c60\uff1a[\n    &#039;beans&#039; =&gt;  [\n        &#039;AMQP&#039;  =&gt;  [\n            &#039;defaultPoolName&#039;   =&gt;  &#039;rabbit&#039;,\n        ],\n    ],\n]\u8fde\u63a5\u914d\u7f6e\u9879\u5c5e\u6027\u540d\u79f0\u8bf4\u660ehost\u4e3b\u673aport\u7aef\u53e3user\u7528\u6237\u540dvhostvhost\uff0c\u9ed8\u8ba4\/insistinsistloginMethod\u9ed8\u8ba4AMQPLAINloginResponseloginResponselocale\u9ed8\u8ba4en_USconnectionTimeout\u8fde\u63a5\u8d85\u65f6readWriteTimeout\u8bfb\u5199\u8d85\u65f6keepalivekeepalive\uff0c\u9ed8\u8ba4falseheartbeat\u5fc3\u8df3\u65f6\u95f4\uff0c\u9ed8\u8ba40channelRpcTimeout\u9891\u9053 RPC \u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba40.0sslProtocolssl \u534f\u8bae\uff0c\u9ed8\u8ba4null\u6d88\u606f\u5b9a\u4e49\u7ee7\u627f Imi\\AMQP\\Message \u7c7b\uff0c\u53ef\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u5bf9\u5c5e\u6027\u4fee\u6539\u3002\u6839\u636e\u9700\u8981\u53ef\u4ee5\u8986\u76d6\u5b9e\u73b0setBodyData\u3001getBodyData\u65b9\u6cd5\uff0c\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u6d88\u606f\u7ed3\u6784\u3002&lt;?php\nnamespace ImiApp\\AMQP\\Test2;\n\nuse Imi\\AMQP\\Message;\n\nclass TestMessage2 extends Message\n{\n    \/**\n     * \u7528\u6237ID\n     *\n     * @var int\n     *\/\n    private $memberId;\n\n    \/**\n     * \u5185\u5bb9\n     *\n     * @var string\n     *\/\n    private $content;\n\n    public function __construct()\n    {\n        parent::__construct();\n        $this-&gt;routingKey = &#039;imi-2&#039;;\n        $this-&gt;format = \\Imi\\Util\\Format\\Json::class;\n    }\n\n    \/**\n     * \u8bbe\u7f6e\u4e3b\u4f53\u6570\u636e\n     *\n     * @param mixed $data\n     * @return self\n     *\/\n    public function setBodyData($data)\n    {\n        foreach($data as $k =&gt; $v)\n        {\n            $this-&gt;$k = $v;\n        }\n    }\n\n    \/**\n     * \u83b7\u53d6\u4e3b\u4f53\u6570\u636e\n     *\n     * @return mixed\n     *\/\n    public function getBodyData()\n    {\n        return [\n            &#039;memberId&#039;  =&gt;  $this-&gt;memberId,\n            &#039;content&#039;   =&gt;  $this-&gt;content,\n        ];\n    }\n\n    \/**\n     * Get \u7528\u6237ID\n     *\n     * @return int\n     *\/ \n    public function getMemberId()\n    {\n        return $this-&gt;memberId;\n    }\n\n    \/**\n     * Set \u7528\u6237ID\n     *\n     * @param int $memberId  \u7528\u6237ID\n     *\n     * @return self\n     *\/ \n    public function setMemberId(int $memberId)\n    {\n        $this-&gt;memberId = $memberId;\n\n        return $this;\n    }\n\n    \/**\n     * Get \u5185\u5bb9\n     *\n     * @return string\n     *\/ \n    public function getContent()\n    {\n        return $this-&gt;content;\n    }\n\n    \/**\n     * Set \u5185\u5bb9\n     *\n     * @param string $content  \u5185\u5bb9\n     *\n     * @return self\n     *\/ \n    public function setContent(string $content)\n    {\n        $this-&gt;content = $content;\n\n        return $this;\n    }\n\n}\u5c5e\u6027\u5217\u8868\uff1a\u540d\u79f0\u8bf4\u660e\u9ed8\u8ba4\u503cbodyData\u6d88\u606f\u4e3b\u4f53\u5185\u5bb9\uff0c\u975e\u5b57\u7b26\u4e32null properties\u5c5e\u6027[&#039;content_type&#039;  =&gt; &#039;text\/plain&#039;, &#039;delivery_mode&#039; =&gt; AMQPMessage::DELIVERY_MODE_PERSISTENT,] routingKey\u8def\u7531\u952e\u7a7a\u5b57\u7b26\u4e32 format\u5982\u679c\u8bbe\u7f6e\u4e86\uff0c\u53d1\u5e03\u7684\u6d88\u606f\u662f\u7f16\u7801\u540e\u7684bodyData\uff0c\u540c\u7406\u8bfb\u53d6\u65f6\u4e5f\u4f1a\u89e3\u7801\u3002\u5b9e\u73b0\u4e86Imi\\Util\\Format\\IFormat\u7684\u683c\u5f0f\u5316\u7c7b\u3002\u652f\u6301Json\u3001PhpSerializenull mandatorymandatory\u6807\u5fd7\u4f4dfalse immediateimmediate\u6807\u5fd7\u4f4dfalse ticketticketnull \u53d1\u5e03\u8005\u5b9a\u4e49\u5fc5\u9009\u6ce8\u89e3\uff1a@Publisher\u53ef\u9009\u6ce8\u89e3\uff1a@Queue\u3001@Exchange\u3001@Connection\u4e0d\u914d\u7f6e @Connection \u6ce8\u89e3\uff0c\u53ef\u4ee5\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u8fde\u63a5&lt;?php\nnamespace ImiApp\\AMQP\\Test;\n\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\AMQP\\Annotation\\Queue;\nuse Imi\\AMQP\\Base\\BasePublisher;\nuse Imi\\AMQP\\Annotation\\Consumer;\nuse Imi\\AMQP\\Annotation\\Exchange;\nuse Imi\\AMQP\\Annotation\\Publisher;\nuse Imi\\AMQP\\Annotation\\Connection;\n\n\/**\n * @Bean(&quot;TestPublisher&quot;)\n * @Connection(host=&quot;127.0.0.1&quot;, port=5672, user=&quot;guest&quot;, password=&quot;guest&quot;)\n * @Publisher(tag=&quot;tag-imi&quot;, queue=&quot;queue-imi-1&quot;, exchange=&quot;exchange-imi&quot;, routingKey=&quot;imi-1&quot;)\n * @Queue(name=&quot;queue-imi-1&quot;, routingKey=&quot;imi-1&quot;)\n * @Exchange(name=&quot;exchange-imi&quot;)\n *\/\nclass TestPublisher extends BasePublisher\n{\n\n}\u8be5\u7c7b\u6240\u5728\u547d\u540d\u7a7a\u95f4\u5fc5\u987b\u80fd\u88ab\u626b\u63cf\u5230\uff0c\u8981\u5728beanScan\u4e2d\u914d\u7f6e\u53d1\u5e03\u6d88\u606f\/\/ \u5b9e\u4f8b\u5316\u6784\u5efa\u6d88\u606f\n$message = new \\ImiApp\\AMQP\\Test2\\TestMessage2;\n$message-&gt;setMemberId(1);\n$message-&gt;setContent(&#039;imi niubi&#039;);\n\n\/\/ \u53d1\u5e03\u6d88\u606f\n\/** @var \\ImiApp\\AMQP\\Test\\TestPublisher $testPublisher *\/\n$testPublisher = App::getBean(&#039;TestPublisher&#039;);\n$testPublisher-&gt;publish($message);\u6d88\u8d39\u8005\u5b9a\u4e49\u5fc5\u9009\u6ce8\u89e3\uff1a@Consumer\u53ef\u9009\u6ce8\u89e3\uff1a@Queue\u3001@Exchange\u3001@Connection\u4e0d\u914d\u7f6e @Connection \u6ce8\u89e3\uff0c\u53ef\u4ee5\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u8fde\u63a5&lt;?php\nnamespace ImiApp\\AMQP\\Test;\n\nuse Imi\\Redis\\Redis;\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\AMQP\\Annotation\\Queue;\nuse Imi\\AMQP\\Base\\BaseConsumer;\nuse Imi\\AMQP\\Contract\\IMessage;\nuse Imi\\AMQP\\Annotation\\Consumer;\nuse Imi\\AMQP\\Annotation\\Exchange;\nuse Imi\\AMQP\\Enum\\ConsumerResult;\nuse Imi\\AMQP\\Annotation\\Connection;\n\n\/**\n * \u542f\u52a8\u4e00\u4e2a\u65b0\u8fde\u63a5\u6d88\u8d39\n * \n * @Bean(&quot;TestConsumer&quot;)\n * @Connection(host=&quot;127.0.0.1&quot;, port=5672, user=&quot;guest&quot;, password=&quot;guest&quot;)\n * @Consumer(tag=&quot;tag-imi&quot;, queue=&quot;queue-imi-1&quot;, message=\\ImiApp\\AMQP\\Test\\TestMessage::class)\n *\/\nclass TestConsumer extends BaseConsumer\n{\n    \/**\n     * \u6d88\u8d39\u4efb\u52a1\n     *\n     * @param \\ImiApp\\AMQP\\Test\\TestMessage $message\n     * @return void\n     *\/\n    protected function consume(IMessage $message)\n    {\n        var_dump(__CLASS__, $message-&gt;getBody(), get_class($message));\n        Redis::set(&#039;imi-amqp:consume:1:&#039; . $message-&gt;getMemberId(), $message-&gt;getBody());\n        return ConsumerResult::ACK;\n    }\n\n}\n\u6d88\u8d39\u6d88\u606f\u968f\u670d\u52a1\u542f\u52a8\u7684\u6d88\u8d39\u8fdb\u7a0b\u53ea\u4f1a\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u9002\u5408\u91cf\u5c11\u7684\u573a\u666f\u3002\u9002\u5408IO\u5bc6\u96c6\u578b\u573a\u666f\u3002\u9996\u5148\u5b9a\u4e49\u8fdb\u7a0b\uff1a&lt;?php\nnamespace ImiApp\\Process;\n\nuse Imi\\Process\\BaseProcess;\nuse Imi\\Aop\\Annotation\\Inject;\nuse Imi\\Process\\Annotation\\Process;\n\n\/**\n * @Process(name=&quot;TestProcess&quot;)\n *\/\nclass TestProcess extends BaseProcess\n{\n    \/**\n     * @Inject(&quot;TestConsumer&quot;)\n     *\n     * @var \\ImiApp\\AMQP\\Test\\TestConsumer\n     *\/\n    protected $testConsumer;\n\n    \/**\n     * @Inject(&quot;TestConsumer2&quot;)\n     *\n     * @var \\ImiApp\\AMQP\\Test2\\TestConsumer2\n     *\/\n    protected $testConsumer2;\n\n    public function run(\\Swoole\\Process $process)\n    {\n        \/\/ \u542f\u52a8\u6d88\u8d39\u8005\n        go(function(){\n            do {\n                $this-&gt;testConsumer-&gt;run();\n            } while(true);\n        });\n        go(function(){\n            do {\n                $this-&gt;testConsumer2-&gt;run();\n            } while(true);\n        });\n    }\n\n}\u7136\u540e\u5728\u9879\u76ee\u914d\u7f6e@app.beans\u4e2d\u914d\u7f6e\u6d88\u8d39\u8fdb\u7a0b[\n    &#039;AutoRunProcessManager&#039; =&gt;  [\n        &#039;processes&#039; =&gt;  [\n            &#039;TestProcess&#039;\n        ],\n    ],\n]\u542f\u52a8\u8fdb\u7a0b\u6c60\u6d88\u8d39\u9002\u5408\u8ba1\u7b97\u5bc6\u96c6\u578b\u573a\u666f\u3001\u6d88\u8d39\u91cf\u975e\u5e38\u591a\u7684\u573a\u666f\u3002\u8fdb\u7a0b\u6c60\u5199\u6cd5\u53c2\u8003\uff1ahttps:\/\/doc.imiphp.com\/components\/process-pool\/swoole.html\u542f\u52a8\u6d88\u8d39\u8005\u5199\u6cd5\u53c2\u8003\u4e0a\u9762\u7684\u5373\u53ef\u3002\u6ce8\u89e3\u8bf4\u660e@Publisher\u53d1\u5e03\u8005\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660equeue\u961f\u5217\u540d\u79f0exchange\u4ea4\u6362\u673a\u540d\u79f0routingKey\u8def\u7531\u952e@Consumer\u6d88\u8d39\u8005\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660etag\u6d88\u8d39\u8005\u6807\u7b7equeue\u961f\u5217\u540d\u79f0exchange\u4ea4\u6362\u673a\u540d\u79f0routingKey\u8def\u7531\u952emessage\u6d88\u606f\u7c7b\u540d\uff0c\u9ed8\u8ba4\uff1aImi\\AMQP\\Messagemandatorymandatory\u6807\u5fd7\u4f4dimmediateimmediate\u6807\u5fd7\u4f4dticketticket@Queue\u961f\u5217\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u961f\u5217\u540d\u79f0routingKey\u8def\u7531\u952epassive\u88ab\u52a8\u6a21\u5f0f\uff0c\u9ed8\u8ba4falsedurable\u6d88\u606f\u961f\u5217\u6301\u4e45\u5316\uff0c\u9ed8\u8ba4trueexclusive\u72ec\u5360\uff0c\u9ed8\u8ba4falseautoDelete\u81ea\u52a8\u5220\u9664\uff0c\u9ed8\u8ba4falsenowait\u662f\u5426\u975e\u963b\u585e\uff0c\u9ed8\u8ba4falsearguments\u53c2\u6570ticketticket@Exchange\u4ea4\u6362\u673a\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u4ea4\u6362\u673a\u540d\u79f0type\u7c7b\u578b\u53ef\u9009\uff1adirect\u3001fanout\u3001topic\u3001headerspassive\u88ab\u52a8\u6a21\u5f0f\uff0c\u9ed8\u8ba4falsedurable\u6d88\u606f\u961f\u5217\u6301\u4e45\u5316\uff0c\u9ed8\u8ba4trueautoDelete\u81ea\u52a8\u5220\u9664\uff0c\u9ed8\u8ba4falseinternal\u8bbe\u7f6e\u662f\u5426\u4e3arabbitmq\u5185\u90e8\u4f7f\u7528, true\u8868\u793a\u662f\u5185\u90e8\u4f7f\u7528, false\u8868\u793a\u4e0d\u662f\u5185\u90e8\u4f7f\u7528nowait\u662f\u5426\u975e\u963b\u585e\uff0c\u9ed8\u8ba4falsearguments\u53c2\u6570ticketticket@Connection\u8fde\u63a5\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660epoolName\u4e0d\u4e3a null \u65f6\uff0c\u65e0\u89c6\u5176\u4ed6\u5c5e\u6027\uff0c\u76f4\u63a5\u7528\u8be5\u8fde\u63a5\u6c60\u914d\u7f6e\u3002\u9ed8\u8ba4\u4e3anull\uff0c\u5982\u679chost\u3001port\u3001user\u3001password\u90fd\u672a\u8bbe\u7f6e\uff0c\u5219\u83b7\u53d6\u9ed8\u8ba4\u7684\u8fde\u63a5\u6c60\u3002host\u4e3b\u673aport\u7aef\u53e3user\u7528\u6237\u540dvhostvhost\uff0c\u9ed8\u8ba4\/insistinsistloginMethod\u9ed8\u8ba4AMQPLAINloginResponseloginResponselocale\u9ed8\u8ba4en_USconnectionTimeout\u8fde\u63a5\u8d85\u65f6readWriteTimeout\u8bfb\u5199\u8d85\u65f6keepalivekeepalive\uff0c\u9ed8\u8ba4falseheartbeat\u5fc3\u8df3\u65f6\u95f4\uff0c\u9ed8\u8ba40channelRpcTimeout\u9891\u9053 RPC \u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba40.0sslProtocolssl \u534f\u8bae\uff0c\u9ed8\u8ba4null"},{"id":130,"title":"Kafka","pageTitle":"Kafka","url":"components\/mq\/kafka.html","content":"Kafka\u4ecb\u7ecd\u652f\u6301\u5728 imi \u6846\u67b6\u4e2d\u4f7f\u7528 Kafka \u5ba2\u6237\u7aef\u652f\u6301\u6d88\u606f\u53d1\u5e03\u548c\u6d88\u8d39\u672c\u7ec4\u4ef6\u57fa\u4e8e \u9f99\u4e4b\u8a00 \u7ec4\u7ec7\u7684 longlang\/phpkafka \u7ec4\u4ef6\uff0c\u8be5\u7ec4\u4ef6\u7531\u5b87\u6da6\u4e3b\u5bfc\u5f00\u53d1\u3002Composer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-kafka&quot;: &quot;^1.0.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u8bf4\u660e\u53ef\u4ee5\u53c2\u8003 example \u76ee\u5f55\u793a\u4f8b\uff0c\u5305\u62ec\u5b8c\u6574\u7684\u6d88\u606f\u53d1\u5e03\u548c\u6d88\u8d39\u529f\u80fd\u3002\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u7ec4\u4ef6\n        &#039;Kafka&#039;   =&gt;  &#039;Imi\\Kafka&#039;,\n    ],\n]\u8fde\u63a5\u6c60\u914d\u7f6e\uff1a[\n    &#039;pools&#039;    =&gt;    [\n        &#039;kafka&#039;    =&gt; [\n            &#039;sync&#039;    =&gt; [\n                &#039;pool&#039;    =&gt; [\n                    &#039;class&#039;        =&gt; \\Imi\\Kafka\\Pool\\KafkaSyncPool::class,\n                    &#039;config&#039;       =&gt; [\n                        &#039;maxResources&#039;    =&gt; 10,\n                        &#039;minResources&#039;    =&gt; 0,\n                    ],\n                ],\n                &#039;resource&#039;    =&gt; [\n                    &#039;bootstrapServers&#039; =&gt; KAFKA_BOOTSTRAP_SERVERS,\n                    &#039;groupId&#039;          =&gt; &#039;test&#039;,\n                    \/\/ \u5176\u5b83\u914d\u7f6e\u8bf7\u53c2\u8003\uff1ahttps:\/\/github.com\/longyan\/phpkafka\/blob\/master\/doc\/consumer.md#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0\n                ],\n            ],\n            &#039;async&#039;    =&gt; [\n                &#039;pool&#039;    =&gt; [\n                    &#039;class&#039;        =&gt; \\Imi\\Kafka\\Pool\\KafkaCoroutinePool::class,\n                    &#039;config&#039;       =&gt; [\n                        &#039;maxResources&#039;    =&gt; 10,\n                        &#039;minResources&#039;    =&gt; 1,\n                    ],\n                ],\n                &#039;resource&#039;    =&gt; [\n                    &#039;bootstrapServers&#039; =&gt; KAFKA_BOOTSTRAP_SERVERS,\n                    &#039;groupId&#039;          =&gt; &#039;test&#039;,\n                ],\n            ],\n        ],\n    ]\n]\u9ed8\u8ba4\u8fde\u63a5\u6c60\uff1a[\n    &#039;beans&#039; =&gt;  [\n        &#039;Kafka&#039;  =&gt;  [\n            &#039;defaultPoolName&#039;   =&gt;  &#039;kafka&#039;,\n        ],\n    ],\n]\u751f\u4ea7\u8005use Imi\\Kafka\\Pool\\KafkaPool;\nuse longlang\\phpkafka\\Producer\\ProduceMessage;\n\n\/\/ \u83b7\u53d6\u751f\u4ea7\u8005\u5bf9\u8c61\n$producer = KafkaPool::getInstance();\n\n\/\/ \u53d1\u9001\n$producer-&gt;send(&#039;\u4e3b\u9898 Topic&#039;, &#039;\u6d88\u606f\u5185\u5bb9&#039;);\n\/\/ send \u65b9\u6cd5\u5b9a\u4e49\n\/\/ public function send(string $topic, ?string $value, ?string $key = null, array $headers = [], ?int $partitionIndex = null, ?int $brokerId = null): void\n\n\/\/ \u6279\u91cf\u53d1\u9001\n$producer-&gt;sendBatch([\n    new ProduceMessage($topic, &#039;v1&#039;, &#039;k1&#039;),\n    new ProduceMessage($topic, &#039;v2&#039;, &#039;k2&#039;),\n]);\n\/\/ sendBatch \u65b9\u6cd5\u5b9a\u4e49\n\/\/ public function sendBatch(ProduceMessage[] $messages, ?int $brokerId = null): void\u6d88\u8d39\u8005\u6d88\u8d39\u8005\u7c7b\uff1a&lt;?php\n\nnamespace ImiApp\\Kafka\\Test;\n\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\Kafka\\Annotation\\Consumer;\nuse Imi\\Kafka\\Base\\BaseConsumer;\nuse Imi\\Redis\\Redis;\nuse longlang\\phpkafka\\Consumer\\ConsumeMessage;\n\n\/**\n * @Bean(&quot;TestConsumer&quot;)\n * @Consumer(topic=&quot;queue-imi-1&quot;, groupId=&quot;test-consumer&quot;)\n *\/\nclass TestConsumer extends BaseConsumer\n{\n    \/**\n     * \u6d88\u8d39\u4efb\u52a1\n     *\n     * @return mixed\n     *\/\n    protected function consume(ConsumeMessage $message)\n    {\n        $messageValue = $message-&gt;getValue();\n    }\n}\u6d88\u8d39\u8fdb\u7a0b\uff1a&lt;?php\n\nnamespace ImiApp\\Process;\n\nuse Imi\\Aop\\Annotation\\Inject;\nuse Imi\\App;\nuse Imi\\Kafka\\Contract\\IConsumer;\nuse Imi\\Process\\Annotation\\Process;\nuse Imi\\Process\\BaseProcess;\n\n\/**\n * @Process(name=&quot;TestProcess&quot;)\n *\/\nclass TestProcess extends BaseProcess\n{\n    \/**\n     * @Inject(&quot;TestConsumer&quot;)\n     *\n     * @var \\ImiApp\\Kafka\\Test\\TestConsumer\n     *\/\n    protected $testConsumer;\n\n    public function run(\\Swoole\\Process $process)\n    {\n        $this-&gt;runConsumer($this-&gt;testConsumer);\n        \\Swoole\\Coroutine::yield();\n    }\n\n    private function runConsumer(IConsumer $consumer): void\n    {\n        go(function () use ($consumer) {\n            try\n            {\n                $consumer-&gt;run();\n            }\n            catch (\\Throwable $th)\n            {\n                \/** @var \\Imi\\Log\\ErrorLog $errorLog *\/\n                $errorLog = App::getBean(&#039;ErrorLog&#039;);\n                $errorLog-&gt;onException($th);\n                sleep(3);\n                $this-&gt;runConsumer($consumer);\n            }\n        });\n    }\n}\u6ce8\u89e3\u8bf4\u660e@Consumer\u6d88\u8d39\u8005\u6ce8\u89e3\u5c5e\u6027\u540d\u79f0\u8bf4\u660etopic\u4e3b\u9898\u540d\u79f0\uff0c\u652f\u6301\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u6570\u7ec4groupId\u5206\u7ec4IDpoolName\u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u4e0d\u4f20\u5219\u4f7f\u7528\u914d\u7f6e\u4e2d\u9ed8\u8ba4\u7684\u961f\u5217\u7ec4\u4ef6\u652f\u6301\u672c\u7ec4\u4ef6\u989d\u5916\u5b9e\u73b0\u4e86 imiphp\/imi-queue \u7684\u63a5\u53e3\uff0c\u53ef\u4ee5\u7528 Queue \u7ec4\u4ef6\u7684 API \u8fdb\u884c\u8c03\u7528\u3002\u53ea\u9700\u8981\u5c06\u961f\u5217\u9a71\u52a8\u914d\u7f6e\u4e3a\uff1aKafkaQueueDriver\u914d\u7f6e\u793a\u4f8b\uff1a[\n    &#039;components&#039;    =&gt;  [\n        &#039;Kafka&#039;  =&gt;  &#039;Imi\\Kafka&#039;,\n    ],\n    &#039;beans&#039; =&gt;  [\n        &#039;AutoRunProcessManager&#039; =&gt;  [\n            &#039;processes&#039; =&gt;  [\n                \/\/ \u52a0\u5165\u961f\u5217\u6d88\u8d39\u8fdb\u7a0b\uff0c\u975e\u5fc5\u987b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5199\u8fdb\u7a0b\u6d88\u8d39\n                &#039;QueueConsumer&#039;,\n            ],\n        ],\n        &#039;imiQueue&#039;  =&gt; [\n            \/\/ \u9ed8\u8ba4\u961f\u5217\n            &#039;default&#039;   =&gt; &#039;QueueTest1&#039;,\n            \/\/ \u961f\u5217\u5217\u8868\n            &#039;list&#039;  =&gt; [\n                \/\/ \u961f\u5217\u540d\u79f0\n                &#039;QueueTest1&#039; =&gt; [\n                    \/\/ \u4f7f\u7528\u7684\u961f\u5217\u9a71\u52a8\n                    &#039;driver&#039;        =&gt; &#039;KafkaQueueDriver&#039;,\n                    \/\/ \u6d88\u8d39\u534f\u7a0b\u6570\u91cf\n                    &#039;co&#039;            =&gt; 1,\n                    \/\/ \u6d88\u8d39\u8fdb\u7a0b\u6570\u91cf\uff1b\u53ef\u80fd\u4f1a\u53d7\u8fdb\u7a0b\u5206\u7ec4\u5f71\u54cd\uff0c\u4ee5\u540c\u4e00\u7ec4\u4e2d\u914d\u7f6e\u7684\u6700\u591a\u8fdb\u7a0b\u6570\u91cf\u4e3a\u51c6\n                    &#039;process&#039;       =&gt; 1,\n                    \/\/ \u6d88\u8d39\u5faa\u73af\u5c1d\u8bd5 pop \u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\uff08\u4ec5\u4f7f\u7528\u6d88\u8d39\u8005\u7c7b\u65f6\u6709\u6548\uff09\n                    &#039;timespan&#039;      =&gt; 0.1,\n                    \/\/ \u8fdb\u7a0b\u5206\u7ec4\u540d\u79f0\n                    &#039;processGroup&#039;  =&gt; &#039;a&#039;,\n                    \/\/ \u81ea\u52a8\u6d88\u8d39\n                    &#039;autoConsumer&#039;  =&gt; true,\n                    \/\/ \u6d88\u8d39\u8005\u7c7b\n                    &#039;consumer&#039;      =&gt; &#039;QueueTestConsumer&#039;,\n                    \/\/ \u9a71\u52a8\u7c7b\u6240\u9700\u8981\u7684\u53c2\u6570\u6570\u7ec4\n                    &#039;config&#039;        =&gt; [\n                        \/\/ Kafka \u8fde\u63a5\u6c60\u540d\u79f0\n                        &#039;poolName&#039; =&gt; &#039;kafka&#039;,\n                        \/\/ \u5206\u7ec4ID\uff0c\u5982\u679c\u4e0d\u4f20\u6216\u4e3anull\u5219\u4f7f\u7528\u8fde\u63a5\u6c60\u4e2d\u7684\u914d\u7f6e\n                        &#039;groupId&#039;  =&gt; &#039;g1&#039;,\n                    ],\n                ],\n            ],\n        ],\n    ]\n]\u6d88\u8d39\u8005\u7c7b\u5199\u6cd5\uff0c\u4e0eimi-queue\u7ec4\u4ef6\u7528\u6cd5\u4e00\u81f4\u3002"},{"id":128,"title":"Redis \u6d88\u606f\u961f\u5217","pageTitle":"Redis \u6d88\u606f\u961f\u5217","url":"components\/mq\/redis.html","content":"Redis \u6d88\u606f\u961f\u5217\u4ecb\u7ecdimi \u6846\u67b6\u7684\u961f\u5217\u7ec4\u4ef6\uff0c\u4f7f\u7528 Redis \u4f5c\u4e3a\u6301\u4e45\u5316\u652f\u6301\u7684\u7279\u6027\uff1a\u6d88\u606f\u6301\u4e45\u5316\u5206\u5e03\u5f0f\u5ef6\u65f6\u6d88\u606fACK \u673a\u5236\u6d88\u8d39\u8d85\u65f6\u673a\u5236\u5931\u8d25\/\u8d85\u65f6\u6d88\u606f\u91cd\u65b0\u6d88\u8d39\u9879\u76ee\u5730\u5740\uff1ahttps:\/\/github.com\/imiphp\/imi-queueComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-queue&quot;: &quot;^1.0.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u8bf4\u660e\u963f\u91cc\u4e91\u96c6\u7fa4\u7528\u6237\uff0c\u8bf7\u628a script_check_enable \u8bbe\u7f6e\u6539\u4e3a 0\u53ef\u4ee5\u53c2\u8003 example\u3001tests \u76ee\u5f55\u793a\u4f8b\u3002\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;components&#039;    =&gt;  [\n        &#039;Queue&#039;  =&gt;  &#039;Imi\\Queue&#039;,\n    ],\n    &#039;beans&#039; =&gt;  [\n        &#039;AutoRunProcessManager&#039; =&gt;  [\n            &#039;processes&#039; =&gt;  [\n                \/\/ \u52a0\u5165\u961f\u5217\u6d88\u8d39\u8fdb\u7a0b\uff0c\u975e\u5fc5\u987b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5199\u8fdb\u7a0b\u6d88\u8d39\n                &#039;QueueConsumer&#039;,\n            ],\n        ],\n        &#039;imiQueue&#039;  =&gt;  [\n            \/\/ \u9ed8\u8ba4\u961f\u5217\n            &#039;default&#039;   =&gt;  &#039;test1&#039;,\n            \/\/ \u961f\u5217\u5217\u8868\n            &#039;list&#039;  =&gt;  [\n                \/\/ \u961f\u5217\u540d\u79f0\n                &#039;test1&#039; =&gt;  [\n                    \/\/ \u4f7f\u7528\u7684\u961f\u5217\u9a71\u52a8\n                    &#039;driver&#039;        =&gt;  \\Imi\\Queue\\Driver\\RedisQueueDriver::class,\n                    \/\/ \u6d88\u8d39\u534f\u7a0b\u6570\u91cf\n                    &#039;co&#039;            =&gt;  1,\n                    \/\/ \u6d88\u8d39\u8fdb\u7a0b\u6570\u91cf\uff1b\u53ef\u80fd\u4f1a\u53d7\u8fdb\u7a0b\u5206\u7ec4\u5f71\u54cd\uff0c\u4ee5\u540c\u4e00\u7ec4\u4e2d\u914d\u7f6e\u7684\u6700\u591a\u8fdb\u7a0b\u6570\u91cf\u4e3a\u51c6\n                    &#039;process&#039;       =&gt;  1,\n                    \/\/ \u6d88\u8d39\u5faa\u73af\u5c1d\u8bd5 pop \u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    &#039;timespan&#039;      =&gt;  0.1,\n                    \/\/ \u8fdb\u7a0b\u5206\u7ec4\u540d\u79f0\n                    &#039;processGroup&#039;  =&gt;  &#039;a&#039;,\n                    \/\/ \u81ea\u52a8\u6d88\u8d39\n                    &#039;autoConsumer&#039;  =&gt;  true,\n                    \/\/ \u6d88\u8d39\u8005\u7c7b\n                    &#039;consumer&#039;      =&gt;  &#039;AConsumer&#039;,\n                    \/\/ \u9a71\u52a8\u7c7b\u6240\u9700\u8981\u7684\u53c2\u6570\u6570\u7ec4\n                    &#039;config&#039;        =&gt;  [\n                        &#039;poolName&#039;  =&gt;  &#039;redis&#039;,\n                        &#039;prefix&#039;    =&gt;  &#039;imi:queue:test:&#039;,\n                    ]\n                ],\n            ],\n        ],\n    ]\n]\u6d88\u8d39\u8005\u7c7b&lt;?php\nnamespace ImiApp\\Consumer;\n\nuse Imi\\Log\\Log;\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\Queue\\Contract\\IMessage;\nuse Imi\\Queue\\Driver\\IQueueDriver;\nuse Imi\\Queue\\Service\\BaseQueueConsumer;\n\n\/**\n * @Bean(&quot;AConsumer&quot;)\n *\/\nclass AConsumer extends BaseQueueConsumer\n{\n    \/**\n     * \u5904\u7406\u6d88\u8d39\n     * \n     * @param \\Imi\\Queue\\Contract\\IMessage $message\n     * @param \\Imi\\Queue\\Driver\\IQueueDriver $queue\n     * @return void\n     *\/\n    protected function consume(IMessage $message, IQueueDriver $queue)\n    {\n        Log::info(sprintf(&#039;[%s]%s:%s&#039;, $queue-&gt;getName(), $message-&gt;getMessageId(), $message-&gt;getMessage()));\n        $queue-&gt;success($message);\n    }\n\n}\u83b7\u53d6\u961f\u5217\u5bf9\u8c61use \\Imi\\Queue\\Facade\\Queue;\n$queue = Queue::getQueue(&#039;\u961f\u5217\u540d\u79f0&#039;);\u63a8\u9001\u6d88\u606f\u5230\u961f\u5217\u8fd4\u56de\u6d88\u606fID$message = new \\Imi\\Queue\\Model\\Message;\n$message-&gt;setMessage(&#039;\u5b57\u7b26\u4e32\u7684\u6d88\u606f\u5185\u5bb9&#039;);\n$message-&gt;setWorkingTimeout(0); \/\/ \u8bbe\u7f6e\u5de5\u4f5c\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff0c\u4e3a0\u4e0d\u9650\u5236\n$queue-&gt;push($message);\n\/\/ \u5ef6\u65f6\u6d88\u606f\uff0c\u5355\u4f4d\uff1a\u79d2\n$queue-&gt;push($message, 1.5);\u4ece\u961f\u5217\u5f39\u51fa\u4e00\u4e2a\u6d88\u606f$message = $queue-&gt;pop();\nif(null !== $message)\n{\n    \/\/ \u5c06\u6d88\u606f\u6807\u8bb0\u4e3a\u6210\u529f\n    $queue-&gt;success($message);\n\n    \/\/ \u5c06\u6d88\u606f\u6807\u8bb0\u4e3a\u5931\u8d25\n    $queue-&gt;fail($message);\n}\u5220\u9664\u6d88\u606f$message = $queue-&gt;pop();\nif(null !== $message)\n{\n    $queue-&gt;delete($message);\n}\u6e05\u7a7a\u961f\u5217use \\Imi\\Queue\\Enum\\QueueType;\n\n$queue-&gt;clear(); \/\/ \u6e05\u7a7a\u5168\u90e8\n\n\/\/ \u6e05\u7a7a\u6307\u5b9a\u7c7b\u578b\n$queue-&gt;clear([\n    QueueType::READY,   \/\/ \u51c6\u5907\u5c31\u7eea\n    QueueType::WORKING, \/\/ \u5de5\u4f5c\u4e2d\n    QueueType::FAIL,    \/\/ \u5931\u8d25\n    QueueType::TIMEOUT, \/\/ \u8d85\u65f6\n    QueueType::DELAY,   \/\/ \u51c6\u5907\u5c31\u7eea\u5ef6\u65f6\n]);\u83b7\u53d6\u961f\u5217\u72b6\u6001\/\/ \u8fd4\u56de \\Imi\\Queue\\Model\\QueueStatus \u7c7b\u578b\n$status = $queue-&gt;status();\n$status-&gt;getReady();    \/\/ \u51c6\u5907\u5c31\u7eea\u6570\u91cf\n$status-&gt;getWorking();  \/\/ \u5de5\u4f5c\u4e2d\u6570\u91cf\n$status-&gt;getFail();     \/\/ \u5931\u8d25\u6570\u91cf\n$status-&gt;getTimeout();  \/\/ \u8d85\u65f6\u6570\u91cf\n$status-&gt;getDelay();    \/\/ \u5ef6\u65f6\u6570\u91cf\u5c06\u5931\u8d25\u6d88\u606f\u6062\u590d\u5230\u961f\u5217\u8ba9\u5931\u8d25\u6d88\u606f\u53ef\u4ee5\u88ab\u91cd\u65b0\u6d88\u8d39$queue-&gt;restoreFailMessages();\u5c06\u8d85\u65f6\u6d88\u606f\u6062\u590d\u5230\u961f\u5217\u8ba9\u8d85\u65f6\u6d88\u606f\u53ef\u4ee5\u88ab\u91cd\u65b0\u6d88\u8d39$queue-&gt;restoreTimeoutMessages();\u547d\u4ee4\u884c\u5de5\u5177\u83b7\u53d6\u961f\u5217\u72b6\u6001\u547d\u4ee4\uff1abin\/imi queue\/status -queue \u961f\u5217\u540d\u79f0\u8fd4\u56de JSON\uff1a{\n    &quot;ready&quot;: 0,\n    &quot;working&quot;: 0,\n    &quot;fail&quot;: 0,\n    &quot;timeout&quot;: 0,\n    &quot;delay&quot;: 0\n}\u5c06\u5931\u8d25\u6d88\u606f\u6062\u590d\u5230\u961f\u5217\u547d\u4ee4\uff1abin\/imi queue\/restoreFail -queue \u961f\u5217\u540d\u79f0\u8fd4\u56de\u6062\u590d\u7684\u6d88\u606f\u6570\u91cf\uff1a0\u5c06\u8d85\u65f6\u6d88\u606f\u6062\u590d\u5230\u961f\u5217\u547d\u4ee4\uff1abin\/imi queue\/restoreTimeout -queue \u961f\u5217\u540d\u79f0\u8fd4\u56de\u6062\u590d\u7684\u6d88\u606f\u6570\u91cf\uff1a0"},{"id":69,"title":"MQTT \u5ba2\u6237\u7aef","pageTitle":"MQTT \u5ba2\u6237\u7aef","url":"components\/mqtt\/client.html","content":"MQTT \u5ba2\u6237\u7aef\u5b89\u88c5\uff1acomposer require imiphp\/imi-mqtt\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;components&#039;    =&gt;  [\n        &#039;MQTT&#039;  =&gt;  &#039;Imi\\MQTT&#039;,\n    ],\n]MQTT \u529f\u80fd\u8981\u6c42 PHP &gt;= 7.2\u4f7f\u7528\u4e8b\u4ef6\u76d1\u542c\u7c7b\uff1a&lt;?php\nnamespace Imi\\MQTT\\Test;\n\nuse Imi\\MQTT\\Client\\Contract\\IMQTTClientListener;\n\nclass TestClientListener implements IMQTTClientListener\n{\n    \/**\n     * \u8fde\u63a5\u786e\u8ba4\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\ConnectResponsePacket $packet\n     * @return void\n     *\/\n    public function connectACK(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\ConnectResponsePacket $packet)\n    {\n    }\n\n    \/**\n     * \u53d1\u5e03\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PublishRequestPacket $packet\n     * @return void\n     *\/\n    public function publish(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\PublishRequestPacket $packet)\n    {\n    }\n\n    \/**\n     * \u53d1\u5e03\u786e\u8ba4\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PublishAckPacket $packet\n     * @return void\n     *\/\n    public function publishAck(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\PublishAckPacket $packet)\n    {\n    }\n\n    \/**\n     * \u53d1\u5e03\u5df2\u6536\u5230\uff08\u4fdd\u8bc1\u4ea4\u4ed8\u90e8\u52061\uff09\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PublishReceivedPacket $packet\n     * @return void\n     *\/\n    public function publishReceived(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\PublishReceivedPacket $packet)\n    {\n    }\n\n    \/**\n     * \u53d1\u5e03\u91ca\u653e\uff08\u786e\u4fdd\u4ea4\u4ed8\u7684\u7b2c2\u90e8\u5206\uff09\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PublishReleasePacket $packet\n     * @return void\n     *\/\n    public function publishRelease(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\PublishReleasePacket $packet)\n    {\n    }\n\n    \/**\n     * \u53d1\u5e03\u5b8c\u6210\uff08\u4fdd\u8bc1\u4ea4\u4ed8\u7684\u7b2c3\u90e8\u5206\uff09\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PublishCompletePacket $packet\n     * @return void\n     *\/\n    public function publishComplete(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\PublishCompletePacket $packet)\n    {\n    }\n\n    \/**\n     * \u8ba2\u9605\u786e\u8ba4\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\SubscribeResponsePacket $packet\n     * @return void\n     *\/\n    public function subscribeACK(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\SubscribeResponsePacket $packet)\n    {\n    }\n\n    \/**\n     * \u53d6\u6d88\u8ba2\u9605\u786e\u8ba4\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\UnsubscribeResponsePacket $packet\n     * @return void\n     *\/\n    public function unsubscribeACK(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\UnsubscribeResponsePacket $packet)\n    {\n    }\n\n    \/**\n     * Ping \u54cd\u5e94\n     *\n     * @param \\Imi\\MQTT\\Client\\MQTTClient $client\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PingResponsePacket $packet\n     * @return void\n     *\/\n    public function ping(\\Imi\\MQTT\\Client\\MQTTClient $client, \\BinSoul\\Net\\Mqtt\\Packet\\PingResponsePacket $packet)\n    {\n    }\n}\u5ba2\u6237\u7aef\u8c03\u7528\uff1ause Imi\\MQTT\\Client\\MQTTClient;\n$client = new MQTTClient([\n    &#039;host&#039;          =&gt;  &#039;127.0.0.1&#039;,\n    &#039;port&#039;          =&gt;  8081,\n], new TestClientListener);\n$client-&gt;wait(); \/\/ \u5f00\u59cb\u5faa\u73af\u63a5\u6536\uff0c\u76f4\u5230\u5173\u95ed\u8fde\u63a5\u5ba2\u6237\u7aef\u53c2\u6570\u8868\uff1a\u53c2\u6570\u540d\u8bf4\u660ehost\u670d\u52a1\u5668\u4e3b\u673a\u540d\u79f0port\u670d\u52a1\u5668\u7aef\u53e3\u53f7timeout\u7f51\u7edc\u901a\u8baf\u8d85\u65f6\u65f6\u95f4pingTimespan\u5b9a\u65f6 ping \u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\u3002\u9ed8\u8ba4\u4e3a NULL \u5219\u4e0d\u81ea\u52a8 pingprotocol\u534f\u8bae\u7ea7\u522b\uff0c\u9ed8\u8ba44\u30023-MQIsdp;4-MQTTusername\u7528\u6237\u540dpassword\u5bc6\u7801clientId\u5ba2\u6237\u7aefIDkeepAlive\u4fdd\u6d3b\u65f6\u95f4clean\u6e05\u9664\u4f1a\u8bddwill\u9057\u5631\u6d88\u606f\uff0c\u5177\u4f53\u7ed3\u6784\u770b\u4e0b\u9762\u7684\u8868\u683cssl\u4f7f\u7528 SSL \u8fde\u63a5sslCertFile\u8bc1\u4e66\u6587\u4ef6sslKeyFile\u8bc1\u4e66\u5bc6\u94a5\u6587\u4ef6sslVerifyPeer\u9a8c\u8bc1\u670d\u52a1\u5668\u7aef\u8bc1\u4e66sslAllowSelfSigned\u5141\u8bb8\u81ea\u7b7e\u540d\u8bc1\u4e66sslHostName\u670d\u52a1\u5668\u4e3b\u673a\u540d\u79f0sslCafileCA \u8bc1\u4e66sslCapath\u8bc1\u4e66\u76ee\u5f55will \u9057\u5631\u6d88\u606f\u53c2\u6570\u8868\uff1a\u53c2\u6570\u540d\u8bf4\u660etopic\u4e3b\u9898payload\u6709\u6548\u8f7d\u8377qosLevel0-\u6700\u591a\u4e00\u6b21\u7684\u4f20\u8f93\uff1b1-\u81f3\u5c11\u4e00\u6b21\u7684\u4f20\u8f93\uff1b2-\u53ea\u6709\u4e00\u6b21\u7684\u4f20\u8f93retain\u4fdd\u7559duplicate\u91cd\u590d"},{"id":125,"title":"MQTT \u670d\u52a1\u7aef","pageTitle":"MQTT \u670d\u52a1\u7aef","url":"components\/mqtt\/server.html","content":"MQTT \u670d\u52a1\u7aefMQTT\u662f\u4e00\u4e2a\u57fa\u4e8e\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u7684\u6d88\u606f\u53d1\u5e03\/\u8ba2\u9605\u4f20\u8f93\u534f\u8bae\u3002MQTT\u534f\u8bae\u662f\u8f7b\u91cf\u3001\u7b80\u5355\u3001\u5f00\u653e\u548c\u6613\u4e8e\u5b9e\u73b0\u7684\uff0c\u8fd9\u4e9b\u7279\u70b9\u4f7f\u5b83\u9002\u7528\u8303\u56f4\u975e\u5e38\u5e7f\u6cdb\u3002\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u5305\u62ec\u53d7\u9650\u7684\u73af\u5883\u4e2d\uff0c\u5982\uff1a\u673a\u5668\u4e0e\u673a\u5668\uff08M2M\uff09\u901a\u4fe1\u548c\u7269\u8054\u7f51\uff08IoT\uff09\u3002\u5176\u5728\uff0c\u901a\u8fc7\u536b\u661f\u94fe\u8def\u901a\u4fe1\u4f20\u611f\u5668\u3001\u5076\u5c14\u62e8\u53f7\u7684\u533b\u7597\u8bbe\u5907\u3001\u667a\u80fd\u5bb6\u5c45\u3001\u53ca\u4e00\u4e9b\u5c0f\u578b\u5316\u8bbe\u5907\u4e2d\u5df2\u5e7f\u6cdb\u4f7f\u7528\u3002\u5b89\u88c5\uff1acomposer require imiphp\/imi-mqtt\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;components&#039;    =&gt;  [\n        &#039;MQTT&#039;  =&gt;  &#039;Imi\\MQTT&#039;,\n    ],\n]MQTT \u529f\u80fd\u8981\u6c42 PHP &gt;= 7.2\u914d\u7f6e\u9996\u5148\uff0c\u670d\u52a1\u5668\u914d\u7f6e\u7684type\u8bbe\u4e3aMQTT\uff0c\u5e76\u4e14\u5b9a\u4e49\u597d\u63a7\u5236\u5668\u3002\u63a7\u5236\u5668\u9700\u8981\u7ee7\u627fImi\\Server\\MQTT\\BaseMQTTController\u7c7b\uff0c\u5e76\u4e14\u5b9e\u73b0\u65b9\u6cd5\u3002\u5982\u679c\u4f60\u662f\u4e3b\u670d\u52a1\u5668\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a&#039;mainServer&#039;    =&gt;    [\n    &#039;namespace&#039;     =&gt;    &#039;ImiApp\\MQTTServer&#039;,\n    &#039;type&#039;          =&gt;    &#039;MQTT&#039;,\n    &#039;host&#039;          =&gt;    &#039;127.0.0.1&#039;,\n    &#039;port&#039;          =&gt;    8081,\n    &#039;controller&#039;    =&gt;  \\ImiApp\\MQTTServer\\Controller\\MQTTController::class,\n    \/\/ &#039;configs&#039;       =&gt;    [\n    \/\/     \/\/ \u542f\u7528 MQTTS \u914d\u7f6e\u8bc1\u4e66\n    \/\/     &#039;ssl_cert_file&#039;     =&gt;  dirname(__DIR__) . &#039;\/ssl\/server.crt&#039;,\n    \/\/     &#039;ssl_key_file&#039;      =&gt;  dirname(__DIR__) . &#039;\/ssl\/server.key&#039;,\n    \/\/ ],\n],\u5982\u679c\u4f60\u662f\u5b50\u670d\u52a1\u5668\uff0c\u914d\u7f6e\u5982\u4e0b\u4e0b\uff1a\/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n&#039;subServers&#039;        =&gt;    [\n    &#039;xxxServer&#039;    =&gt;    [\n        &#039;namespace&#039;     =&gt;    &#039;ImiApp\\MQTTServer&#039;,\n        &#039;type&#039;          =&gt;    &#039;MQTT&#039;,\n        &#039;host&#039;          =&gt;    &#039;127.0.0.1&#039;,\n        &#039;port&#039;          =&gt;    8081,\n        &#039;controller&#039;    =&gt;  \\ImiApp\\MQTTServer\\Controller\\MQTTController::class,\n        \/\/ &#039;configs&#039;       =&gt;    [\n        \/\/     \/\/ \u542f\u7528 MQTTS \u914d\u7f6e\u8bc1\u4e66\n        \/\/     &#039;ssl_cert_file&#039;     =&gt;  dirname(__DIR__) . &#039;\/ssl\/server.crt&#039;,\n        \/\/     &#039;ssl_key_file&#039;      =&gt;  dirname(__DIR__) . &#039;\/ssl\/server.key&#039;,\n        \/\/ ],\n    ],\n],\u901a\u8baf\u6570\u636e\u5305\u7c7bimi-mqtt \u57fa\u4e8e binsoul\/net-mqtt \u5f00\u53d1\uff0c\u4f7f\u7528\u7684\u90fd\u662f\u8fd9\u4e2a\u5305\u4e2d\u7684\u6570\u636e\u5305\u7ed3\u6784\u7c7b\u3002\u7c7b\u540d\u4e00\u822c\u662fBinSoul\\Net\\Mqtt\\Packet\\XXX\u5982\uff1a\\BinSoul\\Net\\Mqtt\\Packet\\SubscribeRequestPacket\u63a7\u5236\u5668&lt;?php\nnamespace ImiApp\\MQTTServer\\Controller;\n\nuse Imi\\Server\\MQTT\\BaseMQTTController;\nuse Imi\\Server\\MQTT\\Message\\ReceiveData;\nuse BinSoul\\Net\\Mqtt\\Packet\\PublishAckPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\PingRequestPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\PingResponsePacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\ConnectRequestPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\PublishReleasePacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\PublishRequestPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\ConnectResponsePacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\PublishCompletePacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\PublishReceivedPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\SubscribeRequestPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\DisconnectRequestPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\SubscribeResponsePacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\UnsubscribeRequestPacket;\nuse BinSoul\\Net\\Mqtt\\Packet\\UnsubscribeResponsePacket;\n\nclass MQTTController extends BaseMQTTController\n{\n    \/**\n     * \u8fde\u63a5\n     *\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\ConnectRequestPacket $request\n     * @param \\Imi\\Server\\MQTT\\Message\\ReceiveData $receiveData\n     * @return \\BinSoul\\Net\\Mqtt\\Packet\\ConnectResponsePacket|null\n     *\/\n    public function connect(ConnectRequestPacket $request, ReceiveData $receiveData): ?ConnectResponsePacket\n    {\n        $success = &#039;root&#039; === $request-&gt;getUsername() &amp;&amp; &#039;123456&#039; === $request-&gt;getPassword();\n        $response = new ConnectResponsePacket;\n        if($success)\n        {\n            $response-&gt;setReturnCode(0);\n        }\n        else\n        {\n            $response-&gt;setReturnCode(4);\n        }\n        return $response;\n    }\n\n    \/**\n     * \u65ad\u5f00\u8fde\u63a5\n     *\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\DisconnectRequestPacket $request\n     * @param \\Imi\\Server\\MQTT\\Message\\ReceiveData $receiveData\n     * @return void\n     *\/\n    public function disconnect(DisconnectRequestPacket $request, ReceiveData $receiveData): void\n    {\n        \n    }\n\n    \/**\n     * Ping\n     *\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PingRequestPacket $request\n     * @param \\Imi\\Server\\MQTT\\Message\\ReceiveData $receiveData\n     * @return \\BinSoul\\Net\\Mqtt\\Packet\\PingResponsePacket|null\n     *\/\n    public function ping(PingRequestPacket $request, ReceiveData $receiveData): ?PingResponsePacket\n    {\n        return new PingResponsePacket;\n    }\n\n    \/**\n     * \u53d1\u5e03\n     *\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\PublishRequestPacket $request\n     * @param \\Imi\\Server\\MQTT\\Message\\ReceiveData $receiveData\n     * @return \\BinSoul\\Net\\Mqtt\\Packet\\PublishAckPacket|\\BinSoul\\Net\\Mqtt\\Packet\\PublishReceivedPacket|\\BinSoul\\Net\\Mqtt\\Packet\\PublishReleasePacket|\\BinSoul\\Net\\Mqtt\\Packet\\PublishCompletePacket|null\n     *\/\n    public function publish(PublishRequestPacket $request, ReceiveData $receiveData)\n    {\n        switch($request-&gt;getTopic())\n        {\n            case &#039;a&#039;:\n                $response = new PublishAckPacket;\n                break;\n            case &#039;b&#039;:\n                $response = new PublishReceivedPacket;\n                break;\n            case &#039;c&#039;:\n                $response = new PublishReleasePacket;\n                break;\n            case &#039;d&#039;:\n                $response = new PublishCompletePacket;\n                break;\n        }\n        $response-&gt;setIdentifier($request-&gt;getIdentifier());\n        return $response;\n    }\n\n    \/**\n     * \u8ba2\u9605\n     *\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\SubscribeRequestPacket $request\n     * @param \\Imi\\Server\\MQTT\\Message\\ReceiveData $receiveData\n     * @return \\BinSoul\\Net\\Mqtt\\Packet\\SubscribeResponsePacket|null\n     *\/\n    public function subscribe(SubscribeRequestPacket $request, ReceiveData $receiveData): ?SubscribeResponsePacket\n    {\n        $response = new SubscribeResponsePacket;\n        $response-&gt;setIdentifier($request-&gt;getIdentifier());\n        $response-&gt;setReturnCodes([0]);\n        return $response;\n    }\n\n    \/**\n     * \u53d6\u6d88\u8ba2\u9605\n     *\n     * @param \\BinSoul\\Net\\Mqtt\\Packet\\UnsubscribeRequestPacket $request\n     * @param \\Imi\\Server\\MQTT\\Message\\ReceiveData $receiveData\n     * @return \\BinSoul\\Net\\Mqtt\\Packet\\UnsubscribeResponsePacket|null\n     *\/\n    public function unsubscribe(UnsubscribeRequestPacket $request, ReceiveData $receiveData): ?UnsubscribeResponsePacket\n    {\n        $response = new UnsubscribeResponsePacket;\n        $response-&gt;setIdentifier($request-&gt;getIdentifier());\n        return $response;\n    }\n\n}\n"},{"id":84,"title":"ORM","pageTitle":"ORM","url":"components\/orm\/index.html","content":"ORM\u4ecb\u7ecdimi \u4e2d\u76ee\u524d\u652f\u6301\u4e24\u4e2a\u6a21\u578b\uff1a\u6570\u636e\u5e93\u6a21\u578b\u3001\u5185\u5b58\u8868\u6a21\u578b\u6570\u636e\u5e93\u6a21\u578b\u4e0e\u4f20\u7edf php-fpm \u6846\u67b6\u4e0b\u4f7f\u7528\u5e76\u65e0\u591a\u5927\u5dee\u522b\uff0c\u751a\u81f3\u66f4\u52a0\u597d\u7528\u3002\u5728 imi \u6846\u67b6\u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6a21\u578b\u751f\u6210\u5de5\u5177\u3002\u4f7f\u7528\u8be5\u5de5\u5177\u751f\u6210\u7684\u6a21\u578b\uff0c\u5728\u4f7f\u7528\u65f6\u65e0\u9700\u624b\u52a8\u5b9a\u4e49\u5b57\u6bb5\uff0c\u652f\u6301 IDE \u4ee3\u7801\u63d0\u793a\u3002\u6a21\u578b\u751f\u6210\u547d\u4ee4\u4f7f\u7528\u8bf4\u660e\uff1ahttps:\/\/doc.imiphp.com\/dev\/generate\/model.html\u6a21\u578b\u5b57\u6bb5\u548c\u5e8f\u5217\u5316\u6a21\u578b\u5b9e\u4f8b\u5bf9\u8c61\u53ef\u4ee5\u540c\u65f6\u4f5c\u4e3a\u6570\u7ec4\u548c\u5bf9\u8c61\u4f7f\u7528\u3002\u5982\u6570\u636e\u5e93\u4e2d\u5b57\u6bb5\u4e3auser_age\uff0c\u540c\u65f6\u652f\u6301\u539f\u5b57\u6bb5\u540d\u548c\u9a7c\u5cf0\u547d\u540d\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\/\/ \u4e0b\u9762\u4e09\u53e5\u662f\u7b49\u540c\u7684\n$model[&#039;user_age&#039;] = 1;\n$model[&#039;userAge&#039;] = 1;\n$model-&gt;setUserAge(1);\u8c03\u7528$model-&gt;toArray()\u53ef\u4ee5\u8f6c\u4e3a\u6570\u7ec4\u3002\u53ef\u4ee5\u76f4\u63a5\u5bf9\u6a21\u578b\u8fdb\u884cjson_encode()\u5904\u7406\u3002\u6a21\u578b\u5e8f\u5217\u5316\u540e\u7684\u5b57\u6bb5\u9ed8\u8ba4\u4e3a\u9a7c\u5cf0\u683c\u5f0f\uff0c\u5982\uff1a\u6570\u636e\u5e93\u5b57\u6bb5\u4e3auser_age\uff0c\u5e8f\u5217\u5316\u540e\u4e3auserAge\u3002\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\uff0c\u8bbe\u7f6e\u4e3a\u4f7f\u7528\u539f\u6570\u636e\u5e93\u5b57\u6bb5\u540d\uff1a@Entity(camel=false)"},{"id":101,"title":"\u5185\u5b58\u8868\u6a21\u578b","pageTitle":"\u5185\u5b58\u8868\u6a21\u578b","url":"components\/orm\/MemoryTableModel.html","content":"\u5185\u5b58\u8868\u6a21\u578b\u4ecb\u7ecd\u57fa\u4e8e Swoole Table \u8de8\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u8868\u7684\u6a21\u578b\u3002\u901a\u8fc7\u6ce8\u89e3\u5b9a\u4e49\uff0c\u6846\u67b6\u5e95\u5c42\u81ea\u52a8\u521b\u5efaSwooleTable\uff0c\u76f4\u63a5\u4f7f\u7528\u6a21\u578b\u64cd\u4f5c\uff0c\u65b9\u4fbf\u5feb\u6377\uff01\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1anamespace Test;\n\nuse Imi\\Model\\MemoryTableModel;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\MemoryTable;\n\n\/**\n * @MemoryTable(name=&quot;test&quot;)\n *\/\nclass MTest extends MemoryTableModel\n{\n    \/**\n     * @Column(name=&quot;str&quot;,type=&quot;string&quot;,length=128)\n     * @var string\n     *\/\n    protected $str;\n\n    \/**\n     * @Column(name=&quot;int&quot;,type=&quot;int&quot;)\n     * @var int\n     *\/\n    protected $int;\n\n    \/**\n     * @Column(name=&quot;float&quot;,type=&quot;float&quot;)\n     * @var float\n     *\/\n    protected $float;\n\n    \/**\n     * Get the value of str\n     *\n     * @return  string\n     *\/ \n    public function getStr()\n    {\n        return $this-&gt;str;\n    }\n\n    \/**\n     * Set the value of str\n     *\n     * @param  string  $str\n     *\n     * @return  self\n     *\/ \n    public function setStr(string $str)\n    {\n        $this-&gt;str = $str;\n\n        return $this;\n    }\n\n    \/**\n     * Get the value of int\n     *\n     * @return  int\n     *\/ \n    public function getInt()\n    {\n        return $this-&gt;int;\n    }\n\n    \/**\n     * Set the value of int\n     *\n     * @param  int  $int\n     *\n     * @return  self\n     *\/ \n    public function setInt(int $int)\n    {\n        $this-&gt;int = $int;\n\n        return $this;\n    }\n\n    \/**\n     * Get the value of float\n     *\n     * @return  float\n     *\/ \n    public function getFloat()\n    {\n        return $this-&gt;float;\n    }\n\n    \/**\n     * Set the value of float\n     *\n     * @param  float  $float\n     *\n     * @return  self\n     *\/ \n    public function setFloat(float $float)\n    {\n        $this-&gt;float = $float;\n\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\u3002@MemoryTable(name=&quot;test&quot;) \u662f\u6307\u5b9aSwooleTable\u7684\u540d\u79f0@Column(name=&quot;str&quot;,type=&quot;string&quot;,length=128)\u4e2d\u7684name\u4ee3\u8868\u5b57\u6bb5\u540d\uff0ctype\u652f\u6301string\/int\/float\uff0cstring\u7c7b\u578b\u5fc5\u987b\u8bbe\u7f6elength\u6a21\u578b\u64cd\u4f5c\u67e5\u627e\u4e00\u6761\u8bb0\u5f55$key = &#039;abc&#039;;\n$model = MTest::find($key);\u67e5\u8be2\u591a\u6761\u8bb0\u5f55$list = MTest::select();\n\/\/ $list \u4e3a MTest[] \u7c7b\u578b\u4fdd\u5b58\u8bb0\u5f55$model = MTest::newInstance();\n$model-&gt;__setKey(&#039;abc&#039;);\n$model-&gt;setStr(&#039;aaa&#039;);\n$model-&gt;setInt(123);\n$model-&gt;setFloat(4.56);\n$model-&gt;save();\u5220\u9664\u8bb0\u5f55$model = MTest::find(&#039;abc&#039;);\n$model-&gt;delete();\u6279\u91cf\u5220\u9664\/\/ \u4e24\u79cd\u65b9\u5f0f\nMTest::deleteBatch(&#039;k1&#039;, &#039;k2&#039;);\nMTest::deleteBatch([&#039;k1&#039;, &#039;k2&#039;]);\u7edf\u8ba1\u6570\u91cfMTest::count();\u83b7\u53d6\u952e$model = MTest::find(&#039;abc&#039;);\n$model-&gt;getKey();\u8bbe\u7f6e\u952e$model = MTest::find(&#039;abc&#039;);\n$model-&gt;__setKey(&#039;def&#039;);"},{"id":87,"title":"\u6a21\u578b\u4e8b\u4ef6","pageTitle":"\u6a21\u578b\u4e8b\u4ef6","url":"components\/orm\/RDModel\/event.html","content":"\u6a21\u578b\u4e8b\u4ef6\u4e8b\u4ef6\u76d1\u542c\u5206\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u4ec5\u9650\u4e8e\u5bf9\u8c61\u7684\u4e8b\u4ef6\uff0c\u53e6\u4e00\u79cd\u662f\u9759\u6001\u65b9\u6cd5\u89e6\u53d1\u7684\u4e8b\u4ef6\u3002\u76d1\u542c\u65b9\u5f0f\u5206\u4e24\u79cd\uff1a1\u3001\u5728\u7c7b\u91cc\u5199\u76d1\u542c\u4ee3\u7801\uff1b2\u3001\u5b9a\u4e49\u76d1\u542c\u7c7b\u6279\u91cf\u64cd\u4f5c\u7684\u4e8b\u4ef6\u76d1\u542c\uff0c\u4e00\u822c\u5efa\u8bae\u7528\u76d1\u542c\u7c7b\u65b9\u5f0f\u3002\u5bf9\u8c61\u7684\u4e8b\u4ef6\u76d1\u542c\u6839\u636e\u4e60\u60ef\u9009\u62e9\u5373\u53ef\u3002\u4e8b\u4ef6\u5217\u8868\u6a21\u578b\u5bf9\u8c61\u4e8b\u4ef6\u4e8b\u4ef6\u540d\u5e38\u91cf\u63cf\u8ff0BeforeInsertModelEvents::BEFORE_INSERT\u63d2\u5165\u524d\uff0cinsert()\/save()\u89e6\u53d1AfterInsertModelEvents::AFTER_INSERT\u63d2\u5165\u540e\uff0cinsert()\/save()\u89e6\u53d1BeforeUpdateModelEvents::BEFORE_UPDATE\u66f4\u65b0\u524d\uff0cupdate()\/save()\u89e6\u53d1AfterUpdateModelEvents::AFTER_UPDATE\u66f4\u65b0\u540e\uff0cupdate()\/save()\u89e6\u53d1BeforeDeleteModelEvents::BEFORE_DELETE\u5220\u9664\u524d\uff0cdelete()\u89e6\u53d1AfterDeleteModelEvents::AFTER_DELETE\u5220\u9664\u540e\uff0cdelete()\u89e6\u53d1BeforeSaveModelEvents::BEFORE_SAVE\u4fdd\u5b58\u524d\uff0c\u5148\u4e8e\u63d2\u5165\u524d\u548c\u66f4\u65b0\u524d\u89e6\u53d1AfterSaveModelEvents::AFTER_SAVE\u4fdd\u5b58\u540e\uff0c\u540e\u4e8e\u63d2\u5165\u540e\u548c\u66f4\u65b0\u540e\u89e6\u53d1AfterQueryModelEvents::AFTER_QUERY\u53ea\u8981\u6700\u7ec8\u67e5\u8be2\u51fa\u8be5\u6a21\u578b\u5c31\u4f1a\u89e6\u53d1\u4e8b\u4ef6\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\u7c7b\u578b\u4e3aImi\\Model\\Event\\Param\\\u4e8b\u4ef6\u540dEventParam\u5bf9\u8c61\u4e8b\u4ef6\u76d1\u542c\u65b9\u6cd51-\u76d1\u542c\u4ee3\u7801\/**\n * Test\n * @Entity\n * @Table(name=&quot;tb_test&quot;, id={&quot;id&quot;, &quot;a&quot;})\n *\/\nclass Test extends Model\n{\n    public function __init($data = [])\n    {\n        $this-&gt;on(ModelEvents::AFTER_INIT, [$this, &#039;onAfterInit&#039;]);\n        parent::__init($data);\n    }\n\n    public function onAfterInit(\\Imi\\Model\\Event\\Param\\InitEventParam $data)\n    {\n        var_dump($data-&gt;data);\n    }\n}\u5bf9\u8c61\u4e8b\u4ef6\u76d1\u542c\u65b9\u6cd52-\u5b9a\u4e49\u76d1\u542c\u7c7b&lt;?php\nnamespace XXX\\ModelEvent\\Logs;\n\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Model\\Event\\Param\\BeforeInsertEventParam;\nuse Imi\\Model\\Event\\Listener\\IBeforeInsertEventListener;\n\n\/**\n * \u63d2\u5165\u524d\u5904\u7406\n * @ClassEventListener(className=&quot;\\XXX\\Model\\Test&quot;,eventName=\\Imi\\Model\\Event\\ModelEvents::BEFORE_INSERT)\n *\/\nclass BeforeInsert implements IBeforeInsertEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param BeforeInsertEventParam $e\n     * @return void\n     *\/\n    public function handle(BeforeInsertEventParam $e)\n    {\n        $e-&gt;data-&gt;data = json_encode($e-&gt;data-&gt;data);\n        $e-&gt;data-&gt;ip = inet_pton($e-&gt;data-&gt;ip);\n    }\n}\u6a21\u578b\u7c7b\u9759\u6001\u4e8b\u4ef6\u4e8b\u4ef6\u540d\u5e38\u91cf\u63cf\u8ff0BeforeFindModelEvents::BEFORE_FIND\u67e5\u627e\u524d\uff0cModel::find()\u89e6\u53d1AfterFindModelEvents::AFTER_FIND\u67e5\u627e\u540e\uff0cModel::find()\u89e6\u53d1BeforeSelectModelEvents::BEFORE_SELECT\u67e5\u8be2\u524d\uff0cModel::select()\u89e6\u53d1AfterSelectModelEvents::AFTER_SELECT\u67e5\u8be2\u540e\uff0cModel::select()\u89e6\u53d1BeforeInitModelEvents::BEFORE_INIT\u521d\u59cb\u5316\u503c\u524d\uff0cnewInstance()\u89e6\u53d1AfterInitModelEvents::AFTER_INIT\u521d\u59cb\u5316\u503c\u540e\uff0cnewInstance()\u89e6\u53d1BeforeBatchUpdateModelEvents::BEFORE_BATCH_UPDATE\u6279\u91cf\u66f4\u65b0\u524dAfterBatchUpdateModelEvents::AFTER_BATCH_UPDATE\u6279\u91cf\u66f4\u65b0\u540eBeforeBatchDeleteModelEvents::BEFORE_BATCH_DELETE\u6279\u91cf\u5220\u9664\u524dAfterBatchDeleteModelEvents::AFTER_BATCH_DELETE\u6279\u91cf\u5220\u9664\u540eBeforeParseDataModelEvents::BEFORE_PARSE_DATA\u5904\u7406 save\u3001insert\u3001update \u6570\u636e\u524dAfterParseDataModelEvents::AFTER_PARSE_DATA\u5904\u7406 save\u3001insert\u3001update \u6570\u636e\u540e\u4e8b\u4ef6\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\u7c7b\u578b\u4e3aImi\\Model\\Event\\Param\\\u4e8b\u4ef6\u540dEventParamBeforeInit\u548cAfterInit\u662f\u4f8b\u5916\uff0c\u5171\u7528Imi\\Model\\Event\\Param\\InitEventParam\u7c7b\u6a21\u578b\u7c7b\u9759\u6001\u4e8b\u4ef6\u76d1\u542c\u4e8b\u4ef6\u540d\u79f0\u4e3a\u6a21\u578b\u7c7b\u540d:\u4e8b\u4ef6\u540d\uff0c\u5982\uff1aXXX\\Model\\Test+BeforeBatchUpdate=XXX\\Model\\Test:BeforeBatchUpdate&lt;?php\nnamespace XXX\\Listener;\n\nuse Imi\\Model\\Event\\Param\\BeforeBatchUpdateEventParam;\nuse Imi\\Model\\Event\\Listener\\IBeforeBatchUpdateEventListener;\n\n\/**\n * @Listener(&quot;XXX\\Model\\TestBeforeBatchUpdate&quot;)\n *\/\nclass BeforeBatchUpdate implements IBeforeBatchUpdateEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param BeforeBatchUpdateEventParam $e\n     * @return void\n     *\/\n    public function handle(BeforeBatchUpdateEventParam $e)\n    {\n        \/\/ $e-&gt;data-&gt;name = &#039;123&#039;; \/\/ \u5728\u66f4\u65b0\u524d\u53ef\u4ee5\u5bf9\u6570\u636e\u8d4b\u503c\n    }\n}\n"},{"id":86,"title":"\u6570\u636e\u5e93\u8868\u6a21\u578b","pageTitle":"\u6570\u636e\u5e93\u8868\u6a21\u578b","url":"components\/orm\/RDModel.html","content":"\u6570\u636e\u5e93\u8868\u6a21\u578b\u4ecb\u7ecd\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff08MySQL\uff09\u7684\u6a21\u578b\uff0c\u65e5\u5e38\u589e\u5220\u6539\u67e5\u5b8c\u5168\u591f\u7528\uff0c\u652f\u6301\u590d\u5408\u4e3b\u952e\u3001\u8054\u5408\u4e3b\u952e\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cimi \u7684\u6a21\u578b\u4e0e\u4f20\u7edf TP \u7b49\u6846\u67b6\u4e2d\u7684\u6a21\u578b\u6982\u5ff5\u6709\u4e9b\u5dee\u522b\u3002imi \u7684\u6a21\u578b\u7c7b\u91cc\u4e00\u822c\u4e0d\u5199\u903b\u8f91\u4ee3\u7801\uff0c\u6a21\u578b\u7c7b\u7684\u4e00\u4e2a\u5bf9\u8c61\u5c31\u4ee3\u8868\u4e00\u6761\u8bb0\u5f55\uff0c\u5e76\u4e14\u6240\u6709\u5b57\u6bb5\u90fd\u9700\u8981\u6709\u503c\uff08\u9664\u975e\u4f60\u4e0d\u5b9a\u4e49\u6307\u5b9a\u7684\u5b57\u6bb5\uff09\u3002\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01@Entity \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u5b9e\u4f53\u7c7b@Table \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u6570\u636e\u8868@Column \u6ce8\u89e3\u4e3a\u5b9a\u4e49\u5b57\u6bb5@DDL \u5b9a\u4e49\u8868\u7ed3\u6784\u7684 SQL \u8bed\u53e5\u5efa\u8bae\u4f7f\u7528\u6a21\u578b\u751f\u6210\u5de5\u5177\uff1ahttps:\/\/doc.imiphp.com\/dev\/generate\/model.html\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1anamespace Test;\n\nuse Imi\\Model\\Model;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\n\n\/**\n * \u5b9a\u4e49\u4e3a\u5b9e\u4f53\n * @Entity\n * \u6307\u5b9a\u5b9e\u4f53\u4e3atest\uff0c\u590d\u5408\u4e3b\u952eid\u548ca\n * @Table(name=&quot;test&quot;, id={&quot;id&quot;, &quot;a&quot;})\n *\/\nclass Test extends Model\n{\n    \/**\n     * ID\n     * \u5b57\u6bb5id\uff0c\u7c7b\u578bint\uff0c\u957f\u5ea610\uff0c\u662f\u4e3b\u952e\uff0c\u7b2c0\u4e2a\u4e3b\u952e\uff0c\u662f\u81ea\u589e\u5b57\u6bb5\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * aaa\n     * @Column(name=&quot;a&quot;, type=&quot;string&quot;, length=255, isPrimaryKey=true, primaryKeyIndex=1)\n     * @var string\n     *\/\n    protected $a;\n\n    \/**\n     * bbb\n     * @Column(name=&quot;b&quot;, type=&quot;string&quot;, length=255)\n     * @var string\n     *\/\n    protected $b;\n\n    \/**\n     * ccc\n     * @Column(name=&quot;c&quot;, type=&quot;string&quot;, length=255)\n     * @var string\n     *\/\n    protected $c;\n\n    \/**\n     * Get iD\n     *\n     * @return  int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * Set iD\n     *\n     * @param  int  $id  ID\n     *\n     * @return  self\n     *\/ \n    public function setId(int $id)\n    {\n        $this-&gt;id = $id;\n\n        return $this;\n    }\n\n    \/**\n     * Get aaa\n     *\n     * @return  string\n     *\/ \n    public function getA()\n    {\n        return $this-&gt;a;\n    }\n\n    \/**\n     * Set aaa\n     *\n     * @param  string  $a  aaa\n     *\n     * @return  self\n     *\/ \n    public function setA(string $a)\n    {\n        $this-&gt;a = $a;\n\n        return $this;\n    }\n\n    \/**\n     * Get bbb\n     *\n     * @return  string\n     *\/ \n    public function getB()\n    {\n        return $this-&gt;b;\n    }\n\n    \/**\n     * Set bbb\n     *\n     * @param  string  $b  bbb\n     *\n     * @return  self\n     *\/ \n    public function setB(string $b)\n    {\n        $this-&gt;b = $b;\n\n        return $this;\n    }\n\n    \/**\n     * Get ccc\n     *\n     * @return  string\n     *\/ \n    public function getC()\n    {\n        return $this-&gt;c;\n    }\n\n    \/**\n     * Set ccc\n     *\n     * @param  string  $c  ccc\n     *\n     * @return  self\n     *\/ \n    public function setC(string $c)\n    {\n        $this-&gt;c = $c;\n\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f\u7528\u6a21\u578b\u751f\u6210\u5de5\u5177\u751f\u6210\u3002\u6a21\u578b\u4e2d\u53ef\u4ee5\u52a0\u5165\u865a\u62df\u5b57\u6bb5\uff0c\u901a\u8fc7\u6ce8\u89e3@Column(virtual=true)\uff0c\u865a\u62df\u5b57\u6bb5\u4e0d\u53c2\u4e0e\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u6a21\u578b\u6ce8\u89e3@Entity\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u7c7b\u4e3a\u5b9e\u4f53\u6a21\u578b\u7c7b\u7528\u6cd5\uff1a@Entity\u5e8f\u5217\u5316\u65f6\u4e0d\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d\uff0c\u4f7f\u7528\u539f\u672c\u7684\u5b57\u6bb5\u540d\uff1a@Entity(false)@Table\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u6570\u636e\u8868\u7528\u6cd5\uff1a@Table(&#039;tb_user&#039;)\u6307\u5b9a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff1a@Table(name=&#039;tb_user&#039;, dbPoolName=&#039;\u6307\u5b9a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u540d&#039;)\u6307\u5b9a\u4e3b\u952e\uff1a@Table(name=&#039;tb_user&#039;, id=&#039;id&#039;)\u6307\u5b9a\u591a\u4e2a\u4e3b\u952e@Table(name=&#039;tb_user&#039;, id={&#039;id1&#039;, &#039;id2&#039;})@DDL\u5199\u5728\u7c7b\u4e0a\uff0c\u5b9a\u4e49\u8868\u7ed3\u6784\u7528\u6cd5\uff1a\/**\n * ArticleBase\n * @Entity\n * @Table(name=&quot;tb_article&quot;, id={&quot;id&quot;})\n * @DDL(&quot;CREATE TABLE `tb_article` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `title` varchar(255) NOT NULL,\n  `content` mediumtext NOT NULL,\n  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`) USING BTREE\n) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT&quot;)\n * @property int $id \n * @property string $title \n * @property string $content \n * @property string $time \n *\/\nabstract class ArticleBase extends Model\n{\n}@JsonEncode\u5199\u5728\u7c7b\u4e0a\uff0c\u8bbe\u5b9a JSON \u5e8f\u5217\u5316\u65f6\u7684\u914d\u7f6e\u4e0d\u4f7f\u7528 Unicode \u7f16\u7801\u8f6c\u6362\u4e2d\u6587\uff1a@JsonEncode(JSON_UNESCAPED_UNICODE)\u5b8c\u6574\u53c2\u6570\uff1a@JsonEncode(flags=0, depth=512)@Column\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u5b9a\u4e49\u5b57\u6bb5\u5217@Column(name=&quot;\u5b57\u6bb5\u540d&quot;, type=&quot;\u5b57\u6bb5\u7c7b\u578b&quot;, length=&quot;\u957f\u5ea6&quot;, nullable=&quot;\u662f\u5426\u5141\u8bb8\u4e3a\u7a7atrue\/false&quot;, accuracy=&quot;\u7cbe\u5ea6\uff0c\u5c0f\u6570\u4f4d\u540e\u51e0\u4f4d&quot;, default=&quot;\u9ed8\u8ba4\u503c&quot;, isPrimaryKey=&quot;\u662f\u5426\u4e3a\u4e3b\u952etrue\/false&quot;, primaryKeyIndex=&quot;\u8054\u5408\u4e3b\u952e\u4e2d\u7684\u7b2c\u51e0\u4e2a\uff0c\u4ece0\u5f00\u59cb&quot;, isAutoIncrement=&quot;\u662f\u5426\u4e3a\u81ea\u589e\u5b57\u6bb5true\/false&quot;, virtual=&quot;\u865a\u62df\u5b57\u6bb5\uff0c\u4e0d\u53c2\u4e0e\u6570\u636e\u5e93\u64cd\u4f5ctrue\/false&quot;, updateTime=true)\u5f53\u4f60\u6307\u5b9atype=json\u65f6\uff0c\u5199\u5165\u6570\u636e\u5e93\u65f6\u81ea\u52a8json_encode\uff0c\u4ece\u6570\u636e\u5b9e\u4f8b\u5316\u5230\u5bf9\u8c61\u65f6\u81ea\u52a8json_decode\u5f53\u4f60\u6307\u5b9atype=list\u5e76\u4e14\u8bbe\u7f6e\u4e86listSeparator\u5206\u5272\u7b26\u65f6\uff0c\u5199\u5165\u6570\u636e\u5e93\u65f6\u81ea\u52a8implode\uff0c\u4ece\u6570\u636e\u5b9e\u4f8b\u5316\u5230\u5bf9\u8c61\u65f6\u81ea\u52a8explodeupdateTime\uff1asave\/update \u6a21\u578b\u65f6\u662f\u5426\u5c06\u5f53\u524d\u65f6\u95f4\u5199\u5165\u8be5\u5b57\u6bb5\u3002\u652f\u6301 date\/time\/datetime\/timestamp\/year\/int\/bigint\u3002\u5f53\u5b57\u6bb5\u4e3a int \u7c7b\u578b\uff0c\u5199\u5165\u79d2\u7ea7\u65f6\u95f4\u6233\u3002\u5f53\u5b57\u6bb5\u4e3a bigint \u7c7b\u578b\uff0c\u5199\u5165\u6beb\u79d2\u7ea7\u65f6\u95f4\u6233\u3002@Sql\u4e3a\u865a\u62df\u5b57\u6bb5\u5b9a\u4e49 SQL \u8bed\u53e5\uff0c\u6a21\u578b\u67e5\u8be2\u65f6\u81ea\u52a8\u5e26\u4e0a\u6539\u5b57\u6bb5\u3002@Sql(&quot;SQL \u8bed\u53e5&quot;)\u5982\u679c @Column \u6ce8\u89e3\u5b9a\u4e49\u4e86 name \u5c5e\u6027\uff0c\u5219\u5c06 name \u4f5c\u4e3a\u5b57\u6bb5\u522b\u540d\uff1b\u5982\u679c\u672a\u5b9a\u4e49\uff0c\u5219\u4f7f\u7528\u5c5e\u6027\u540d\u79f0\u4f5c\u4e3a\u522b\u540d\u3002\u793a\u4f8b\uff1a&lt;?php\n\nnamespace Imi\\Test\\Component\\Model;\n\nuse Imi\\Bean\\Annotation\\Inherit;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Serializables;\nuse Imi\\Model\\Annotation\\Sql;\nuse Imi\\Test\\Component\\Model\\Base\\MemberBase;\n\n\/**\n * Member.\n *\n * @Inherit\n * @Serializables(mode=&quot;deny&quot;, fields={&quot;password&quot;})\n *\/\nclass MemberWithSqlField extends MemberBase\n{\n    \/**\n     * @Column(name=&quot;a&quot;, virtual=true)\n     * @Sql(&quot;1+1&quot;)\n     *\n     * @var int\n     *\/\n    public $test1;\n\n    \/**\n     * @Column(virtual=true)\n     * @Sql(&quot;2+2&quot;)\n     *\n     * @var int\n     *\/\n    public $test2;\n\n    \/**\n     * Set the value of test1.\n     *\n     * @param int $test1\n     *\n     * @return self\n     *\/\n    public function setTest1(int $test1)\n    {\n        $this-&gt;test1 = $test1;\n\n        return $this;\n    }\n\n    \/**\n     * Get the value of test1.\n     *\n     * @return int\n     *\/\n    public function getTest1()\n    {\n        return $this-&gt;test1;\n    }\n\n    \/**\n     * Set the value of test2.\n     *\n     * @param int $test2\n     *\n     * @return self\n     *\/\n    public function setTest2(int $test2)\n    {\n        $this-&gt;test2 = $test2;\n\n        return $this;\n    }\n\n    \/**\n     * Get the value of test2.\n     *\n     * @return int\n     *\/\n    public function getTest2()\n    {\n        return $this-&gt;test2;\n    }\n}\u67e5\u8be2\u65f6\u7684 SQL \u8bed\u53e5\uff1aselect `tb_member`.*,(1+1) as `a`,(2+2) as `test2` from `tb_member` where `id`=:id limit 1@JsonNotNull\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u65e0\u53c2\u6570\u3002\u5f53\u5b57\u6bb5\u503c\u4e0d\u4e3a null \u65f6\u624d\u5e8f\u5217\u5316\u5230 json@Serializable\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u5e8f\u5217\u5316\u6ce8\u89e3\u7528\u6cd5\uff1a\u7981\u6b62\u53c2\u4e0e\u5e8f\u5217\u5316\uff08toArray()\u6216json_encode()\u4e0d\u5305\u542b\u8be5\u5b57\u6bb5\uff09\uff1a@Serializable(false)@Serializables\u5199\u5728\u7c7b\u4e0a\uff0c\u6279\u91cf\u8bbe\u7f6e\u5e8f\u5217\u5316\u6ce8\u89e3\uff0c\u4f18\u5148\u7ea7\u4f4e\u4e8e\u9488\u5bf9\u5c5e\u6027\u5355\u72ec\u8bbe\u7f6e\u7684@Serializable\u6ce8\u89e3\u7528\u6cd5\uff1a\u767d\u540d\u5355\uff08\u5e8f\u5217\u5316\u540e\u53ea\u663e\u793aid\u3001name\u5b57\u6bb5\uff09\uff1a@Serializables(mode=&quot;allow&quot;, fields={&quot;id&quot;, &quot;name&quot;})\u9ed1\u540d\u5355\uff08\u5e8f\u5217\u5316\u540e\uff0c\u6392\u9664id\u3001name\u5b57\u6bb5\uff09@Serializables(mode=&quot;deny&quot;, fields={&quot;id&quot;, &quot;name&quot;})@ExtractProperty\u5199\u5728\u5c5e\u6027\u4e0a\uff0c\u63d0\u53d6\u5b57\u6bb5\u4e2d\u7684\u5c5e\u6027\u5230\u5f53\u524d\u6a21\u578b\u7528\u6cd5\uff1a\u63d0\u53d6\u8be5\u5c5e\u6027\u4e2d\u7684userId\u503c\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId\uff1a@ExtractProperty(&quot;userId&quot;)\u63d0\u53d6\u8be5\u5c5e\u6027\u4e2d\u7684userId\u503c\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId2\uff1a@ExtractProperty(fieldName=&quot;userId&quot;, alias=&quot;userId2&quot;)\u652f\u6301\u591a\u7ea7\u63d0\u53d6\u5230\u5f53\u524d\u6a21\u578b\u4e2d\u7684userId2\uff1a\/**\n * @ExtractProperty(fieldName=&quot;ex.userId&quot;, alias=&quot;userId2&quot;)\n *\/\nprotected $xxx = [\n    &#039;ex&#039;    =&gt;    [\n        &#039;userId&#039;    =&gt;    123,\n    ],\n];\u6a21\u578b\u64cd\u4f5c\u521d\u59cb\u5316\u6a21\u578b$testModel = TestModel::newInstance([\n    &#039;a&#039;    =&gt;    &#039;abc&#039;,\n    &#039;b&#039;    =&gt;    &#039;def&#039;,\n]);\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff1a$testModel = TestModel::newInstance();\n$testModel-&gt;set([\n    &#039;a&#039;    =&gt;    &#039;abc&#039;,\n    &#039;b&#039;    =&gt;    &#039;def&#039;,\n]);\u63d2\u5165$testModel = TestModel::newInstance();\n$testModel-&gt;setA(&#039;1&#039;);\n$testModel-&gt;setB(&#039;1&#039;);\n$testModel-&gt;setC(&#039;1&#039;);\n$result = $testModel-&gt;insert();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 insert() \u8fd4\u56de\u503c\u7528\u6cd5\necho &#039;\u63d2\u5165\u7684\u81ea\u589eID\uff1a&#039;, $testModel-&gt;getId();\u672a\u8bbe\u7f6e\u503c\u7684\u5b57\u6bb5\uff08\u4ee5\u6ce8\u89e3\u5b9a\u4e49\u4e3a\u51c6\uff09\uff0c\u9ed8\u8ba4\u4ee5 null \u503c\u63d2\u5165\uff0c\u5982\u6709\u9700\u8981\u5efa\u8bae\u7ed9\u5b57\u6bb5\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u66f4\u65b0$testModel = TestModel::find(1, &#039;abc&#039;);\n$result = $testModel-&gt;update();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 update() \u8fd4\u56de\u503c\u7528\u6cd5\u4fdd\u5b58\/\/ \u81ea\u52a8\u5224\u65ad\u662f\u63d2\u5165\u8fd8\u662f\u66f4\u65b0\n$testModel-&gt;save();\u5220\u9664$testModel = TestModel::find(1, &#039;abc&#039;);\n$result = $testModel-&gt;delete();\n\/\/ $result \u7528\u6cd5\u540c\u6570\u636e\u5e93\u4e2d\u7684 delete() \u8fd4\u56de\u503c\u7528\u6cd5\u67e5\u8be2\u6784\u5efa\u5668imi \u4e2d\u6570\u636e\u5e93\u67e5\u8be2\u8fde\u8d2f\u64cd\u4f5c\u90fd\u6765\u81ea\u4e8e\u67e5\u8be2\u5668\uff0c\u67e5\u8be2\u5668\u7684\u521b\u5efa\u65b9\u5f0f\uff1a\u67e5\u8be2\u7ed3\u679c\u8fd4\u56de\u6a21\u578b\u5bf9\u8c61\uff1a$query = TestModel::query();\u67e5\u8be2\u7ed3\u679c\u8fd4\u56de\u6570\u7ec4\uff1a$query = TestModel::dbQuery();\u67e5\u8be2\u8bb0\u5f55\u67e5\u8be2\u8bb0\u5f55\u5e76\u8fd4\u56de\u4e00\u4e2a\u6a21\u578b\u5b9e\u4f8b\u3002\/\/ where id = 1\n$testModel = TestModel::find(1);\n\/\/ \u590d\u5408\u4e3b\u952e where a = 1 and b = &#039;abc&#039;\n$testModel = TestModel::find(1, &#039;abc&#039;);\necho $testModel-&gt;getId();\n\/\/ \u6307\u5b9a\u591a\u4e2a\u5b57\u6bb5\u6761\u4ef6 where a = 1 and b = &#039;abc&#039;\n$testModel = TestModel::find([\n    &#039;a&#039; =&gt; 1,\n    &#039;b&#039; =&gt; &#039;abc&#039;,\n]);\u6279\u91cf\u67e5\u8be2\u8bb0\u5f55\/\/ \u67e5\u8be2\u6240\u6709\u8bb0\u5f55\n$list = TestModel::select();\n\n\/\/ \u5e26 where \u6761\u4ef6\u7684\u67e5\u8be2\uff0cid = 1\n$list = TestModel::select([\n    &#039;id&#039;    =&gt;    1\n]);\n\n\/\/ where \u56de\u8c03\u6761\u4ef6\n$list = TestModel::select(function(IQuery $query){\n    $query-&gt;where(&#039;id&#039;, &#039;=&#039;, 1);\n});\n\n\/\/ \u67e5\u8be2\u5668\u67e5\u8be2\n$list = TestModel::query()-&gt;where(&#039;id&#039;, &#039;=&#039;, 1)-&gt;select()-&gt;getArray();\n\n\/\/ \u4ee5\u4e0a\u6240\u6709 $list \u90fd\u662f TestModel[] \u7c7b\u578b\u5206\u9875\u67e5\u8be2\u5e26\u6269\u5c55\u5b57\u6bb5\u67e5\u8be2\u603b\u8bb0\u5f55\u6570\u3001\u603b\u9875\u6570\uff1a$page = 1;\n$count = 10;\n$data = TestModel::query()-&gt;paginate($page, $count);\n\n$data-&gt;getList(); \/\/ \u5217\u8868\u6570\u636e\n$data-&gt;getTotal(); \/\/ \u603b\u8bb0\u5f55\u6570\n$data-&gt;getLimit(); \/\/ $count === 10\n$data-&gt;getPageCount(); \/\/ \u603b\u9875\u6570\n\nvar_dump($data-&gt;toArray()); \/\/ \u8f6c\u6570\u7ec4\nvar_dump(json_encode($data)); \/\/ \u652f\u6301\u5e8f\u5217\u5316\n\/\/ \u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a\n[\n    &#039;list&#039;          =&gt; [],\n    &#039;total&#039;         =&gt; 100,\n    &#039;limit&#039;         =&gt; 10,\n    &#039;page_count&#039;    =&gt; 10,\n]\u4e0d\u67e5\u8be2\u603b\u8bb0\u5f55\u6570\u3001\u603b\u9875\u6570\uff1a$page = 1;\n$count = 10;\n$data = TestModel::query()-&gt;paginate($page, $count, [\n    &#039;total&#039; =&gt;  false,\n]);\nvar_dump($data-&gt;toArray()); \/\/ \u8f6c\u6570\u7ec4\nvar_dump(json_encode($data)); \/\/ \u652f\u6301\u5e8f\u5217\u5316\n\/\/ \u6570\u636e\u683c\u5f0f\u5982\u4e0b\uff1a\n[\n    &#039;list&#039;          =&gt; [],\n    &#039;limit&#039;         =&gt; 10,\n]\u805a\u5408\u51fd\u6570TestModel::count();\nTestModel::sum(&#039;id&#039;);\u6279\u91cf\u66f4\u65b0\/\/ update tb_test set a = &#039;abc&#039; where id &gt; 5\nTestModel::updateBatch([\n    &#039;a&#039;    =&gt;    &#039;abc&#039;,\n], &#039;id &gt; 5&#039;);\u6279\u91cf\u5220\u9664\/\/ delete tb_test set a = &#039;abc&#039; where id &gt; 5\nTestModel::deleteBatch([\n    &#039;a&#039;    =&gt;    &#039;abc&#039;,\n], &#039;id &gt; 5&#039;);\u67e5\u8be2\u5668$testModel = TestModel::query()-&gt;where()-&gt;join()-&gt;select()-&gt;get();\n\/\/ $testModel \u4f9d\u7136\u662f TestModel \u7c7b\u578b\u5bf9\u8c61\u8f6c\u6570\u7ec4\u5c06\u5f53\u524d\u5bf9\u8c61\u4f5c\u4e3a\u6570\u7ec4\u8fd4\u56de\uff1a\u5c5e\u6027\u7684\u503c\uff0c\u5982\u679c\u662f\u5bf9\u8c61\uff0c\u90a3\u4f9d\u7136\u4f1a\u4fdd\u6301\u539f\u6837\u3002\u53ea\u4fdd\u8bc1\u7b2c\u4e00\u5c42\u662f\u6570\u7ec4\u3002$testModel = TestModel::find(1, &#039;abc&#039;);\n$array = $testModel-&gt;toArray();\u5c06\u5f53\u524d\u6a21\u578b\u8f6c\u4e3a\u6570\u7ec4\uff1a\u5305\u62ec\u5c5e\u6027\u7684\u503c\u4e5f\u4f1a\u88ab\u8f6c\u4e3a\u6570\u7ec4$testModel = TestModel::find(1, &#039;abc&#039;);\n$array = $testModel-&gt;convertToArray(); \/\/ \u8fc7\u6ee4\u6ce8\u89e3\u5b9a\u4e49\u7684\u9690\u85cf\u5c5e\u6027\n$array = $testModel-&gt;convertToArray(false); \/\/ \u4e0d\u8fc7\u6ee4\u8f6c\u6362\u6a21\u578b\u6570\u7ec4\u4e3a\u6a21\u578b$list = TestModel::select();\n$arrayList = TestModel::convertListToArray($list); \/\/ \u8fc7\u6ee4\u6ce8\u89e3\u5b9a\u4e49\u7684\u9690\u85cf\u5c5e\u6027\n$arrayList = TestModel::convertListToArray($list, false); \/\/ \u4e0d\u8fc7\u6ee4\u624b\u52a8\u83b7\u53d6\/\u8bbe\u7f6e\u6a21\u578b\u5e8f\u5217\u5316\u5b57\u6bb5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6839\u636e @Column \u6ce8\u89e3\u5b9a\u4e49\u5b57\u6bb5\uff0c@Serializable\u3001@Serializables \u5e72\u9884\u5e8f\u5217\u5316\uff08toArray\u3001json_encode\uff09\u540e\u7684\u5b57\u6bb5\u3002\u73b0\u5728\u4f60\u4e5f\u53ef\u4ee5\u624b\u52a8\u5e72\u9884\u4e86\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a$member-&gt;__getSerializedFields(); \/\/ \u83b7\u53d6\uff0c\u9ed8\u8ba4\u4e3a null \u5219\u4f7f\u7528\u9ed8\u8ba4\u89c4\u5219\n\n$member-&gt;__setSerializedFields([&#039;username&#039;, &#039;password&#039;]); \/\/ \u624b\u52a8\u5e72\u9884\uff0c\u5e8f\u5217\u5316\u540e\u53ea\u6709username\u3001password\u5b57\u6bb5\n$member-&gt;__setSerializedFields(null); \/\/ \u8bbe\u4e3a\u9ed8\u8ba4"},{"id":100,"title":"Redis \u6a21\u578b","pageTitle":"Redis \u6a21\u578b","url":"components\/orm\/RedisModel.html","content":"Redis \u6a21\u578b\u4ecb\u7ecdRedis \u6a21\u578b\u9002\u5408\u56fa\u5b9a\u7ed3\u6784\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u8ddf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7684\u6a21\u578b\u4e00\u6837\uff0c\u65e0\u9700\u5173\u5fc3\u76f4\u63a5\u7684\u64cd\u4f5c\uff0c\u589e\u5220\u6539\u67e5\u4e00\u628a\u68ad\u3002\u6a21\u578b\u5b9a\u4e49\u559c\u95fb\u4e50\u89c1\u7684\u5bf9\u547d\u540d\u7a7a\u95f4\u3001\u7c7b\u540d\u65e0\u8981\u6c42\uff0c\u53ea\u8981\u6309\u7167\u89c4\u5b9a\u5199\u6ce8\u89e3\u5373\u53ef\uff01\u5177\u4f53\u5b9a\u4e49\u770b\u4e0b\u9762\u4ee3\u7801\uff1a&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Model;\n\nuse Imi\\Model\\RedisModel;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\nuse Imi\\Model\\Annotation\\RedisEntity;\n\n\/**\n * Test\n * @Entity\n * @RedisEntity(poolName=&quot;redis&quot;, key=&quot;{id}-{name}&quot;)\n *\/\nclass TestRedisModel extends RedisModel\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * name\n     * @Column(name=&quot;name&quot;)\n     * @var string\n     *\/\n    protected $name;\n\n    \/**\n     * \u83b7\u53d6 name\n     *\n     * @return string\n     *\/ \n    public function getName()\n    {\n        return $this-&gt;name;\n    }\n\n    \/**\n     * \u8d4b\u503c name\n     * @param string $name name\n     * @return static\n     *\/ \n    public function setName($name)\n    {\n        $this-&gt;name = $name;\n        return $this;\n    }\n\n    \/**\n     * age\n     * @Column(name=&quot;age&quot;)\n     * @var string\n     *\/\n    protected $age;\n\n    \/**\n     * \u83b7\u53d6 age\n     *\n     * @return string\n     *\/ \n    public function getAge()\n    {\n        return $this-&gt;age;\n    }\n\n    \/**\n     * \u8d4b\u503c age\n     * @param string $age age\n     * @return static\n     *\/ \n    public function setAge($age)\n    {\n        $this-&gt;age = $age;\n        return $this;\n    }\n}\u9700\u8981\u4f7f\u7528\u6ce8\u89e3\u5c06\u8868\u3001\u5b57\u6bb5\u5c5e\u6027\u5168\u90e8\u6807\u6ce8\u3002\u5e76\u4e14\u5199\u4e0aget\u548cset\u65b9\u6cd5\u3002@RedisEntity\u6307\u5b9a\u5f53\u524d\u7c7b\u4e3aRedis\u5b9e\u4f53\u7c7b\u53ef\u9009\u5c5e\u6027\uff1apoolNameredis\u8fde\u63a5\u6c60\u540d\u79f0db\u7b2c\u51e0\u4e2a\u5e93\uff0c\u4e0d\u4f20\u4e3anull\u65f6\u4f7f\u7528\u8fde\u63a5\u6c60\u9ed8\u8ba4\u914d\u7f6ekey\u952e\uff0c\u652f\u6301\u5b9a\u4e49\u591a\u4e2a\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e3a{key}\uff0c\u5728RedisModel\u4e2d\u5df2\u7ecf\u9884\u5148\u5b9a\u4e49\u4e86setKey()\u548cgetKey()\u65b9\u6cd5member\uff0c\u89c4\u5219\u540ckey\uff0c\u4ec5\u5728storage\u4e3ahash\u65f6\u6709\u6548ttl\u6570\u636e\u9ed8\u8ba4\u7684\u8fc7\u671f\u65f6\u95f4\uff0cnull\u4e3a\u6c38\u4e0d\u8fc7\u671f\uff0chash \u5b58\u50a8\u6a21\u5f0f\u4e0d\u652f\u6301\u8fc7\u671fstorageRedis \u5b9e\u4f53\u7c7b\u5b58\u50a8\u6a21\u5f0f\uff0c\u652f\u6301\uff1astring\u3001hash\u3001hash_objectstorage \u5c5e\u6027\u8bf4\u660e\uff1astring\u5b57\u7b26\u4e32\u6a21\u5f0f\uff0c\u4f7f\u7528 set\/get \u5b58\u5e8f\u5217\u5316\u540e\u7684\u5bf9\u8c61hashhash \u6a21\u5f0f\uff0c\u4f7f\u7528 hset\/hget \u5b58\u5e8f\u5217\u5316\u540e\u7684\u5bf9\u8c61hash_objecthash \u5bf9\u8c61\u6a21\u5f0f\uff0c\u4f7f\u7528 hset\/hget\uff0c\u5c06\u5bf9\u8c61\u5b58\u5230\u4e00\u4e2a key \u4e2d\uff0cmember \u4e3a\u5b57\u6bb5\u540d@ColumnRedis\u6a21\u578b\u4e2d\u53ea\u6709name\u751f\u6548\u6a21\u578b\u64cd\u4f5c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u4f9d\u636e\u4e0a\u9762\u5b9a\u4e49\u7684TestRedisModel\u67e5\u627e\u4e00\u6761\u8bb0\u5f55\/\/ \u8bfb\u53d6-\u76f4\u63a5\u4f20key\n$model2 = TestRedisModel::find(&#039;123-imi&#039;);\n\n\/\/ \u8bfb\u53d6-\u4f20\u53c2\u6570\u7ec4\u6210\n$model3 = TestRedisModel::find([\n    &#039;id&#039;    =&gt;    &#039;123&#039;,\n    &#039;name&#039;    =&gt;    &#039;imi&#039;\n]);\u67e5\u8be2\u591a\u6761\u8bb0\u5f55$list = TestRedisModel::select(&#039;kkk&#039;, &#039;123-imi&#039;, [\n    &#039;id&#039;    =&gt;    &#039;123&#039;,\n    &#039;name&#039;    =&gt;    &#039;imi&#039;\n]);\nforeach($list as $item)\n{\n    var_dump($item-&gt;toArray());\n}\u4fdd\u5b58\u8bb0\u5f55$model = TestRedisModel::newInstance();\n$model-&gt;setId(123);\n$model-&gt;setName(&#039;imi&#039;);\n$model-&gt;setAge(100);\n$model-&gt;save();\n\u5220\u9664\u8bb0\u5f55$model2 = TestRedisModel::find(&#039;123-imi&#039;);\n$model2-&gt;delete();\u6279\u91cf\u5220\u9664\/\/ \u5220\u9664\u952e\u4e3akey\u548c123-imi\u7684\u6570\u636e\n\/\/ 123-imi\u662f\u4ee5RedisEntity\u4e2d\u5b9a\u4e49\u4e3a\u51c6\nTestRedisModel::deleteBatch(&#039;kkk&#039;, [\n    &#039;id&#039;    =&gt;    &#039;123&#039;,\n    &#039;name&#039;    =&gt;    &#039;imi&#039;\n]);"},{"id":98,"title":"\u524d\u7f6e\u548c\u540e\u7f6e\u4e8b\u4ef6","pageTitle":"\u524d\u7f6e\u548c\u540e\u7f6e\u4e8b\u4ef6","url":"components\/orm\/relation\/events.html","content":"\u524d\u7f6e\u548c\u540e\u7f6e\u4e8b\u4ef6\u5728 imi \u4e2d\uff0c\u4f7f\u7528\u6a21\u578b\u5173\u8054\u65f6\uff0c\u63d0\u4f9b\u4e86\u76d1\u542c\u524d\u7f6e\u548c\u540e\u7f6e\u4e8b\u4ef6\u7684\u65b9\u6cd5\uff0c\u8ba9\u5f00\u53d1\u8005\u53ef\u4ee5\u66f4\u52a0\u7075\u6d3b\u5730\u505a\u4e00\u4e9b\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u4e8b\u4ef6\u63d2\u5165\u4e8b\u4ef6\u524d\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.INSERT.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.BEFORE\u540e\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.INSERT.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.AFTER\u4e8b\u4ef6\u53c2\u6570\uff1a\u53c2\u6570\u540d\u7c7b\u578b\u63cf\u8ff0modelstring\u6a21\u578b\u7c7b\u540dpropertyNamestring\u6a21\u578b\u5c5e\u6027\u540dannotationOneToOne OneToMany ManyToMany PolymorphicOneToOne PolymorphicOneToMany PolymorphicManyToMany PolymorphicToOne PolymorphicToMany\u6ce8\u89e3\uff0c\u547d\u540d\u7a7a\u95f4\u524d\u7f00\\Imi\\Model\\Annotation\\Relation\\structOneToOne OneToMany ManyToMany PolymorphicOneToOne PolymorphicOneToMany PolymorphicManyToMany\u7528\u4e8e\u83b7\u53d6\u4e00\u4e9b\u4fe1\u606f\u7684\u7ed3\u6784\uff0c\u547d\u540d\u7a7a\u95f4\u524d\u7f00\\Imi\\Model\\Relation\\Struct\\\u66f4\u65b0\u4e8b\u4ef6\u524d\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.UPDATE.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.BEFORE\u540e\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.UPDATE.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.AFTER\u4e8b\u4ef6\u53c2\u6570\uff1a\u540c\u63d2\u5165\u4e8b\u4ef6\u53c2\u6570\u5220\u9664\u4e8b\u4ef6\u524d\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.DELETE.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.BEFORE\u540e\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.DELETE.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.AFTER\u4e8b\u4ef6\u53c2\u6570\uff1a\u540c\u63d2\u5165\u4e8b\u4ef6\u53c2\u6570\u67e5\u8be2\u4e8b\u4ef6\u524d\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.QUERY.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.BEFORE\u540e\u7f6e\u4e8b\u4ef6\u540d\uff1a IMI.MODEL.RELATION.QUERY.\u6a21\u578b\u7c7b\u540d.\u6a21\u578b\u5c5e\u6027\u540d.AFTER\u4e8b\u4ef6\u53c2\u6570\uff1a\u53c2\u6570\u540d\u7c7b\u578b\u63cf\u8ff0modelstring\u6a21\u578b\u7c7b\u540dpropertyNamestring\u6a21\u578b\u5c5e\u6027\u540dannotationOneToOne OneToMany ManyToMany PolymorphicOneToOne PolymorphicOneToMany PolymorphicManyToMany PolymorphicToOne PolymorphicToMany\u6ce8\u89e3\uff0c\u547d\u540d\u7a7a\u95f4\u524d\u7f00\\Imi\\Model\\Annotation\\Relation\\structOneToOne OneToMany ManyToMany PolymorphicOneToOne PolymorphicOneToMany PolymorphicManyToMany\u7528\u4e8e\u83b7\u53d6\u4e00\u4e9b\u4fe1\u606f\u7684\u7ed3\u6784\uff0c\u547d\u540d\u7a7a\u95f4\u524d\u7f00\\Imi\\Model\\Relation\\Struct\\\u3002annotation\u4e3aPolymorphicToOne\u65f6\u4e0d\u4f1a\u6709\u8be5\u53c2\u6570\u3002query\\Imi\\Db\\Query\\Interfaces\\IQuery\u67e5\u8be2\u6784\u5efa\u5668\u5bf9\u8c61\uff0c\u4e3a\u524d\u7f6e\u4e8b\u4ef6\u65f6\u5fc5\u4f20"},{"id":91,"title":"\u4ecb\u7ecd","pageTitle":"\u4ecb\u7ecd","url":"components\/orm\/relation\/index.html","content":"\u4ecb\u7ecd\u901a\u8fc7\u9884\u5148\u786e\u5b9a\u597d\u6a21\u578b\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5728\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0c\u4f7f\u7528\u975e\u5e38\u7b80\u4fbf\u7684\u5199\u6cd5\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u590d\u6742\u7684\u6d89\u53ca\u591a\u8868\u6570\u636e\u589e\u5220\u6539\u67e5\u3002\u8fd9\u4e00\u5207\u90fd\u662f\u6a21\u578b\u5e95\u5c42\u5b9e\u73b0\u5e2e\u4f60\u5728\u5904\u7406\uff0c\u5728 imi \u4e2d\uff0c\u6a21\u578b\u7684\u5173\u8054\u5173\u7cfb\u90fd\u4f7f\u7528\u6ce8\u89e3\u6765\u5b9a\u4e49\u3002\u6ce8\u89e3\u8fd9\u91cc\u5217\u51fa\u5b9a\u4e49\u6a21\u578b\u5173\u8054\u5173\u7cfb\u6240\u9700\u7684\u6ce8\u89e3\uff0c\u6240\u6709\u5173\u8054\u6a21\u578b\u7684\u6ce8\u89e3\uff0c\u547d\u540d\u7a7a\u95f4\u4e3aImi\\Model\\Annotation\\Relation@OneToOne\u4e00\u5bf9\u4e00\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@OneToOne(&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToOne(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@OneToOne(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@OneToMany\u4e00\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@OneToMany(&quot;\u6a21\u578b\u7c7b\u540d&quot;)@OneToMany(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@OneToMany(model=&quot;\u6a21\u578b\u7c7b\u540d&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@ManyToMany\u591a\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@ManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@ManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@PolymorphicOneToOne\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicOneToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@PolymorphicOneToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@PolymorphicOneToMany\u591a\u6001\u4e00\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicOneToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@PolymorphicOneToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@PolymorphicManyToMany\u591a\u6001\u591a\u5bf9\u591a\u5173\u7cfb\u58f0\u660e\u7528\u6cd5\uff1a@PolymorphicManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@PolymorphicManyToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, middle=&quot;\u4e2d\u95f4\u6a21\u578b\u7c7b\u540d&quot;, rightMany=&quot;\u5c5e\u6027\u540d\uff0c\u8d4b\u503c\u4e3a\u5173\u8054\u7684\u6a21\u578b\u5bf9\u8c61\u5217\u8868&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@PolymorphicToOne\u7528\u4e8e\u591a\u6001\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u5173\u8054\u88ab\u5173\u8054\u7684\u6a21\u578b\u4e2d\u4f7f\u7528\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u5de6\u4fa7\u6a21\u578b\u5141\u8bb8\u51fa\u73b0\u591a\u4e2a\uff0c\u4f1a\u6839\u636etype\u548ctypeValue\u5224\u65ad\uff0c\u9009\u62e9\u5408\u9002\u7684\u6ce8\u89e3\u914d\u7f6e\u67e5\u8be2\u6a21\u578b\u3002\u7528\u6cd5\uff1a@PolymorphicToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@PolymorphicToOne(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;})@PolymorphicToMany\u7528\u4e8e\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054\u88ab\u5173\u8054\u7684\u6a21\u578b\u4e2d\u4f7f\u7528\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u5de6\u4fa7\u6a21\u578b\u5217\u8868\u9700\u8981\u548c@JoinToMiddle\u3001@JoinFromMiddle\u914d\u5408\u4f7f\u7528\u4e0d\u5141\u8bb8\u51fa\u73b0\u591a\u4e2a\uff01\u7528\u6cd5\uff1a@PolymorphicToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;)\u4e3a\u67e5\u8be2\u51fa\u6765\u7684\u6a21\u578b\u6307\u5b9a\u5b57\u6bb5\uff1a@PolymorphicToMany(model=&quot;\u5173\u8054\u6a21\u578b&quot;, modelField=&quot;\u5173\u8054\u7684\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, field=&quot;\u5f53\u524d\u6a21\u578b\u7528\u4e8e\u5173\u8054\u7684\u5b57\u6bb5&quot;, type=&quot;\u591a\u6001\u7c7b\u578b\u5b57\u6bb5\u540d&quot;, typeValue=&quot;\u591a\u6001\u7c7b\u578b\u503c&quot;, order=&quot;\u6392\u5e8f\u89c4\u5219\u5b57\u7b26\u4e32\uff0c\u4f8b\uff1aage desc, id desc&quot;, fields={&quot;\u5b57\u6bb51&quot;, &quot;\u5b57\u6bb52&quot;)@JoinFrom\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u5de6\u8868\u4e0e\u53f3\u8868\u5173\u8054\u7528\u7684\u5b57\u6bb5\u540d\u7528\u6cd5\uff1a@JoinFrom(&quot;\u5b57\u6bb5\u540d&quot;)@JoinFrom(field=&quot;\u5b57\u6bb5\u540d&quot;)@JoinTo\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u53f3\u8868\u4e0e\u5de6\u8868\u5173\u8054\u7528\u7684\u5b57\u6bb5\u540d\u7528\u6cd5\uff1a@JoinTo(&quot;\u5b57\u6bb5\u540d&quot;)@JoinTo(field=&quot;\u5b57\u6bb5\u540d&quot;)@JoinToMiddle\u591a\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u5de6\u4fa7\u6a21\u578b\u5173\u8054\u5230\u4e2d\u95f4\u8868\u6a21\u578b\u7528\u6cd5\uff1a@JoinToMiddle(field=&quot;\u5de6\u4fa7\u5173\u8054\u5b57\u6bb5&quot;, middleField=&quot;\u4e2d\u95f4\u8868\u5173\u8054\u5b57\u6bb5&quot;)@JoinFromMiddle\u591a\u5bf9\u591a\u58f0\u660e\u4e2d\uff0c\u6307\u5b9a\u4e2d\u95f4\u8868\u6a21\u578b\u5173\u8054\u5230\u53f3\u4fa7\u6a21\u578b\u7528\u6cd5\uff1a@JoinFromMiddle(field=&quot;\u53f3\u4fa7\u5173\u8054\u5b57\u6bb5&quot;, middleField=&quot;\u4e2d\u95f4\u8868\u5173\u8054\u5b57\u6bb5&quot;)@AutoSelect\u6307\u5b9a\u6a21\u578b\u67e5\u8be2\uff08find\u3001select\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u67e5\u8be2\u51fa\u5173\u8054\u6570\u636e\u3002\u4e0d\u5199\u8be5\u6ce8\u89e3\uff0c\u6216\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoSelect@AutoSelect(true)\u662f\u5426\u603b\u662f\u663e\u793a\u8be5\u5c5e\u6027\uff0c\u5982\u679c\u4e3afalse\uff0c\u5728\u4e3anull\u65f6\u5e8f\u5217\u5316\u4e3a\u6570\u7ec4\u6216json\u4e0d\u663e\u793a\u8be5\u5c5e\u6027\u3002\u9ed8\u8ba4\u4e3atrue@AutoSelect(alwaysShow=false)@AutoInsert\u6307\u5b9a\u6a21\u578b\u63d2\u5165\uff08insert\u3001save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoInsert@AutoInsert(true)@AutoInsert(false)@AutoUpdate\u6307\u5b9a\u6a21\u578b\u66f4\u65b0\uff08update\u3001save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u66f4\u65b0\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u5f53orphanRemoval\u4e3atrue\u65f6\uff0c\u4f1a\u628a\u4e0d\u5305\u542b\u5728\u6a21\u578b\u91cc\u7684\u5173\u8054\u6570\u636e\u5220\u9664\u540e\u518d\u66f4\u65b0\u3001\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u7528\u6cd5\uff1a@AutoUpdate@AutoUpdate(true)@AutoUpdate(false)@AutoUpdate(orphanRemoval=true)@AutoSave\u6307\u5b9a\u6a21\u578b\u4fdd\u5b58\uff08save\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u4fdd\u5b58\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u5f53orphanRemoval\u4e3atrue\u65f6\uff0c\u4f1a\u628a\u4e0d\u5305\u542b\u5728\u6a21\u578b\u91cc\u7684\u5173\u8054\u6570\u636e\u5220\u9664\u540e\u518d\u66f4\u65b0\u3001\u63d2\u5165\u5173\u8054\u6570\u636e\u3002\u7528\u6cd5\uff1a@AutoSave@AutoSave(true)@AutoSave(false)@AutoSave(orphanRemoval=true)@AutoDelete\u6307\u5b9a\u6a21\u578b\u5220\u9664\uff08delete\uff09\u65f6\uff0c\u8be5\u5173\u8054\u5c5e\u6027\u662f\u5426\u81ea\u52a8\u5220\u9664\u5173\u8054\u6570\u636e\u3002\u4e0d\u6307\u5b9a\u503c\u9ed8\u8ba4\u4e3atrue\u7528\u6cd5\uff1a@AutoDelete@AutoDelete(true)@AutoDelete(false)\u65b9\u6cd5\u67e5\u8be2\u6307\u5b9a\u5173\u8054\u4f7f\u7528\u5173\u8054\u6a21\u578b\u65f6\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u6ce8\u89e3@AutoSelect(false)\uff0c\u8ba9\u5b83\u4e0d\u81ea\u52a8\u67e5\u8be2\u3002\u5728\u4e4b\u540e\u60f3\u8981\u7528\u5230\u7684\u65f6\u5019\uff0c\u518d\u624b\u52a8\u67e5\u8be2\u3002$model-&gt;queryRelations(&#039;\u5c5e\u6027\u540d&#039;);\n\n\/\/ \u4e5f\u53ef\u4ee5\u652f\u6301\u591a\u4e2a\n$model-&gt;queryRelations(&#039;\u5c5e\u6027\u540d1&#039;, &#039;\u5c5e\u6027\u540d2&#039;);\n\n\/\/ \u67e5\u8be2\u540e\u53ef\u4ee5\u8fd9\u4e48\u83b7\u53d6\u7ed3\u679c\n$data = $model-&gt;\u5c5e\u6027\u540d;\u4e3a\u4e00\u4e2a\u5217\u8868\u67e5\u8be2\u6307\u5b9a\u5173\u8054\\Imi\\Model\\Model::queryRelationsList($modelList);"},{"id":94,"title":"\u591a\u5bf9\u591a\u5173\u8054","pageTitle":"\u591a\u5bf9\u591a\u5173\u8054","url":"components\/orm\/relation\/manyToMany.html","content":"\u591a\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u8981\u5173\u8054\u7528\u6237\u548c\u89d2\u8272\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u5c31\u8981\u7528\u5230\u591a\u5bf9\u591a\u3002\u591a\u5bf9\u591a\u9700\u8981\u4e00\u5f20\u4e2d\u95f4\u8868\u6765\u505a\u5173\u8054\u3002\u5b9a\u4e49\u591a\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@ManyToMany\u3001@JoinFromMiddle\u3001@JoinToMiddle\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0c\u7c7b\u5b9a\u4e49\u4e86\u4e00\u4e2a$userRole\u5c5e\u6027\u548c$role\u5c5e\u6027\u3002$userRole\u5c5e\u6027\u5b9a\u4e49\u7684\u662f\u4e2d\u95f4\u6a21\u578b\uff0c\u6307\u5b9a\u4e2d\u95f4\u6a21\u578b\u4e3aUserRole\uff0c\u53f3\u4fa7\u8868\u6a21\u578bRole\uff0c\u53f3\u4fa7\u8868\u6a21\u578b\u6570\u636e\u5230\u65f6\u4f1a\u8d4b\u503c\u5230$role\u5c5e\u6027\u4e2d\u3002User\u6a21\u578b\u4f7f\u7528id\u4e0e\u4e2d\u95f4\u6a21\u578b\u7684user_id\u5173\u8054\uff0c\u4e2d\u95f4\u6a21\u578b\u4f7f\u7528role_id\u4e0e\u53f3\u4fa7\u6a21\u578bid\u5173\u8054\u3002\u5141\u8bb8\u81ea\u52a8\u67e5\u8be2\u3001\u63d2\u5165\u3001\u66f4\u65b0\u3001\u4fdd\u5b58\u3001\u5220\u9664\u65f6\uff0c\u81ea\u52a8\u5904\u7406\u5173\u8054\u6a21\u578b\u6570\u636e\u3002\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $userRole\n * @property \\Imi\\Util\\ArrayList $role\n *\/\nclass User extends Model\n{\n    \/**\n     * @ManyToMany(model=&quot;Role&quot;, middle=&quot;UserRole&quot;, rightMany=&quot;role&quot;)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;user_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;role_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoInsert\n     * @AutoUpdate\n     * @AutoSave\n     * @AutoDelete\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $userRole;\n    \n    \/**\n     * Get the value of userRole\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getUserRole()\n    {\n        return $this-&gt;userRole;\n    }\n\n    \/**\n     * Set the value of userRole\n     *\n     * @param  \\Imi\\Util\\ArrayList  $userRole\n     *\n     * @return  self\n     *\/ \n    public function setUserRole($userRole)\n    {\n        $this-&gt;userRole = $userRole;\n\n        return $this;\n    }\n\n    \/**\n     * \n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $role;\n\n    \/**\n     * Get the value of role\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\ArrayList[]\n     *\/ \n    public function getRole()\n    {\n        return $this-&gt;role;\n    }\n\n    \/**\n     * Set the value of role\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\ArrayList[]  $role\n     *\n     * @return  self\n     *\/ \n    public function setRole($role)\n    {\n        $this-&gt;role = $role;\n\n        return $this;\n    }\n\n    \/\/ \u5176\u5b83\u8fd9\u8fb9\u7701\u7565\u2026\u2026\n}\u67e5\u8be2find$model = UserWithFriend::find(1);\n\/\/ \u53ef\u4ee5\u53d6\u5230\u5173\u8054\u5173\u7cfb\u53ca\u53f3\u4fa7\u6a21\u578b\u6570\u636e\nvar_dump($model-&gt;userRole);\nvar_dump($model-&gt;role);select$list = UserWithFriend::select();\nforeach($list as $item)\n{\n    \/\/ \u53ef\u4ee5\u53d6\u5230\u5173\u8054\u5173\u7cfb\u53ca\u53f3\u4fa7\u6a21\u578b\u6570\u636e\n    var_dump($item-&gt;userRole);\n    var_dump($item-&gt;role);\n}\u63d2\u5165$user = UserWithFriend::newInstance();\n$user-&gt;username = Random::letterAndNumber(6, 16);\n$user-&gt;ex-&gt;intro = &#039;\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b&#039;;\n\/\/ \u63d2\u5165\u5173\u8054\u5173\u7cfb\n$user-&gt;userRole-&gt;append(\n    UserRole::newInstance([&#039;role_id&#039;=&gt;1]), \n    UserRole::newInstance([&#039;role_id&#039;=&gt;2])\n);\n$result = $user-&gt;insert();\u66f4\u65b0$user = UserWithFriend::find(1);\n$user-&gt;ex-&gt;intro = &#039;\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b-&#039; . date(&#039;Y-m-d H:i:s&#039;);\n$user-&gt;userRole-&gt;clear();\n\/\/ \u66f4\u65b0\u5173\u8054\u5173\u7cfb\n$user-&gt;userRole-&gt;append(\n    UserRole::newInstance([&#039;role_id&#039;=&gt;998])\n);\n$result = $user-&gt;update();\u4fdd\u5b58\u548cinsert\u3001update\u540c\u7406\uff0c\u5c31\u4e0d\u4f5c\u6f14\u793a\u4e86\u3002\u5220\u9664$user = UserWithFriend::find(1);\n\/\/ \u5220\u9664\u6570\u636e\u548c\u5173\u8054\u5173\u7cfb\n$result = $user-&gt;delete();\nif($result-&gt;isSuccess())\n{\n    echo &#039;success&#039;;\n}"},{"id":93,"title":"\u4e00\u5bf9\u591a\u5173\u8054","pageTitle":"\u4e00\u5bf9\u591a\u5173\u8054","url":"components\/orm\/relation\/oneToMany.html","content":"\u4e00\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\u8868\uff0c\u6bcf\u4e2a\u7528\u6237\u90fd\u53ef\u4ee5\u53d1\u5e03\u6587\u7ae0\uff0c\u7528\u6237\u548c\u6587\u7ae0\u5c31\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002\u5f53\u7136imi-demo\u91cc\u4e00\u5bf9\u591a\u7684\u4f8b\u5b50\u9009\u7684\u4e0d\u597d\uff0c\u4e0d\u8fc7\u4e0d\u91cd\u8981\uff0c\u7406\u89e3\u610f\u601d\u5c31\u884c\u3002\u5b9a\u4e49\u4e00\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@OneToMany\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0cUserWithFriend\u7ee7\u627fUser\u3002\u7c7b\u5b9a\u4e49\u4e86\u4e00\u4e2a$friends\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054UserFriend\u6a21\u578b\u3002User\u4e2did\u4e0eUserFriend\u4e2duser_id\u5173\u8054\uff0c\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u6ca1\u6709@JoinFrom\u6ce8\u89e3\uff0c\u6ca1\u6709\u7684\u8bdd\u9ed8\u8ba4\u53d6\u5de6\u4fa7\u6a21\u578b\u7684\u4e3b\u952e\u3002\u5141\u8bb8\u81ea\u52a8\u67e5\u8be2\u3001\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664\u65f6\uff0c\u81ea\u52a8\u5904\u7406UserFriend\u6a21\u578b\u6570\u636e\uff0c\u5f53\u66f4\u65b0\u65f6\uff0c\u4f1a\u5220\u9664\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $friends\n *\/\nclass UserWithFriend extends User\n{\n    \/**\n     * @OneToMany(&quot;UserFriend&quot;)\n     * @JoinTo(&quot;user_id&quot;)\n     * @AutoInsert(true)\n     * @AutoUpdate(orphanRemoval=true)\n     * @AutoDelete(true)\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $friends;\n\n    \/**\n     * Get the value of friends\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserFriend[]\n     *\/ \n    public function getFriends()\n    {\n        return $this-&gt;friends;\n    }\n\n    \/**\n     * Set the value of friends\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserFriend[]  $friends\n     *\n     * @return  self\n     *\/ \n    public function setFriends($friends)\n    {\n        $this-&gt;friends = $friends;\n\n        return $this;\n    }\n\n}\u67e5\u8be2find$model = UserWithFriend::find(1);\nvar_dump($model-&gt;friends); \/\/ friends\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserFriend\u5b9e\u4f8bselect$list = UserWithFriend::select();\nforeach($list as $item)\n{\n    var_dump($item-&gt;friends); \/\/ friends\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserFriend\u5b9e\u4f8b\n}\u63d2\u5165$user = UserWithFriend::newInstance();\n$user-&gt;username = &#039;Yurun&#039;;\n\/\/ \u7531\u4e8e\u7ee7\u627f\u4e86User\u7c7b\uff0c\u6240\u4ee5\u4e00\u5bf9\u4e00\u5173\u7cfb\u8fd8\u662f\u5b58\u5728\uff0c\u4f9d\u65e7\u53ef\u4ee5\u4f7f\u7528\n$user-&gt;ex-&gt;intro = &#039;\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b&#039;;\n\/\/ \u5728\u670b\u53cb\u5173\u7cfb\u5217\u8868\u4e2d\u589e\u52a02\u9879\n$user-&gt;friends-&gt;append(\n    UserFriend::newInstance([&#039;friend_user_id&#039;=&gt;1]), \n    UserFriend::newInstance([&#039;friend_user_id&#039;=&gt;2])\n);\n$result = $user-&gt;insert();\u66f4\u65b0$user = UserWithFriend::find(1);\n$user-&gt;ex-&gt;intro = &#039;\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b-&#039; . date(&#039;Y-m-d H:i:s&#039;);\n\n\/\/ \u4e0b\u9762\u6ce8\u91ca\u7684\u4ee3\u7801\uff0c\u662f\u628a\u591a\u4f59\u7684\u8bb0\u5f55\u5220\u9664\uff0c\u53ea\u4fdd\u7559id\u4e3a4\u8fd9\u4e2a\n\/\/ $friendIds = [4];\n\/\/ $user-&gt;friends-&gt;clear();\n\/\/ $updateItems = UserFriend::query()-&gt;where(&#039;user_id&#039;, &#039;=&#039;, $user-&gt;id)-&gt;whereIn(&#039;friend_user_id&#039;, $friendIds)-&gt;select()-&gt;getArray();\n\/\/ $user-&gt;friends-&gt;append(...$updateItems);\n\/\/ $ids = ObjectArrayHelper::column($updateItems, &#039;friend_user_id&#039;);\n\/\/ foreach(array_diff($friendIds, $ids) as $id)\n\/\/ {\n\/\/     $user-&gt;friends-&gt;append(UserFriend::newInstance([\n\/\/         &#039;friend_user_id&#039;    =&gt;    $id,\n\/\/     ]));\n\/\/ }\n\n\/\/ \u4e0b\u9762\u7684\u662f\u7b80\u5355\u7684\u589e\u52a0\u4e24\u9879\u5173\u8054\n$user-&gt;friends-&gt;append(\n    UserFriend::newInstance([&#039;friend_user_id&#039;=&gt;1]), \n    UserFriend::newInstance([&#039;friend_user_id&#039;=&gt;2])\n);\n\n$result = $user-&gt;update();\u4fdd\u5b58\u548cinsert\u3001update\u540c\u7406\uff0c\u5c31\u4e0d\u4f5c\u6f14\u793a\u4e86\u3002\u5220\u9664$user = UserWithFriend::find(1);\n\/\/ \u5220\u9664ID\u4e3a1\u7684\u8bb0\u5f55\uff0cUserEx\u5bf9\u5e94\u8868\u4e5f\u4f1a\u5220\u9664\u8fd9\u6761\u5173\u8054\u8bb0\u5f55\n$result = $user-&gt;delete();\nif($result-&gt;isSuccess())\n{\n    echo &#039;success&#039;;\n}"},{"id":92,"title":"\u4e00\u5bf9\u4e00\u5173\u8054","pageTitle":"\u4e00\u5bf9\u4e00\u5173\u8054","url":"components\/orm\/relation\/oneToOne.html","content":"\u4e00\u5bf9\u4e00\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\u8868\uff0c\u53e6\u5916\u6709\u4e00\u4e2a\u4e2a\u4eba\u8d44\u6599\u8868\uff0c\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u8054\u5c31\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\u3002\u5b9a\u4e49\u4e00\u5bf9\u4e00\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@OneToOne\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a$ex\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054UserEx\u6a21\u578b\u3002User\u4e2did\u4e0eUserEx\u4e2duser_id\u5173\u8054\u3002\u5141\u8bb8\u81ea\u52a8\u67e5\u8be2\u3001\u4fdd\u5b58\u3001\u5220\u9664\u65f6\uff0c\u81ea\u52a8\u5904\u7406UserEx\u6a21\u578b\u6570\u636e\u3002\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $userRole\n * @property \\Imi\\Util\\ArrayList $role\n *\/\nclass User extends Model\n{\n    \/**\n     * @OneToOne(&quot;UserEx&quot;)\n     * @JoinFrom(&quot;id&quot;)\n     * @JoinTo(&quot;user_id&quot;)\n     * @AutoSave(true)\n     * @AutoDelete\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx\n     *\/\n    protected $ex;\n\n    \/**\n     * Get the value of ex\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx\n     *\/ \n    public function getEx()\n    {\n        return $this-&gt;ex;\n    }\n\n    \/**\n     * Set the value of ex\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx  $ex\n     *\n     * @return  self\n     *\/ \n    public function setEx(\\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex)\n    {\n        $this-&gt;ex = $ex;\n\n        return $this;\n    }\n\n    \/\/ \u5176\u5b83\u8fd9\u8fb9\u7701\u7565\u2026\u2026\u67e5\u8be2find$model = User::find(1);\nvar_dump($model-&gt;ex); \/\/ ex\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserEx\u5b9e\u4f8bselect$list = User::select();\nforeach($list as $item)\n{\n    var_dump($item-&gt;ex); \/\/ ex\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u53d6\u5230\uff0c\u662fUserEx\u5b9e\u4f8b\n}\u63d2\u5165$user = User::newInstance();\n$user-&gt;username = &#039;User123&#039;;\n\n\/\/ \u5bf9UserEx\u5b9e\u4f8b\u8d4b\u503c\n$user-&gt;ex-&gt;intro = &#039;\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b&#039;;\n\n\/\/ \u4e00\u53e5\u8bdd\uff0c\u6570\u636e\u63d2\u5165\u4e24\u5f20\u8868\n$result = $user-&gt;insert();\n\nvar_dump($result-&gt;getLastInsertId());\u66f4\u65b0$user = User::find(1);\n$user-&gt;ex-&gt;intro = &#039;\u8fd9\u4e2a\u4eba\u5f88\u61d2\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u7559\u4e0b-&#039; . date(&#039;Y-m-d H:i:s&#039;);\n\n\/\/ \u66f4\u65b0ID\u4e3a1\u7684\u8bb0\u5f55\n\/\/ \u5bf9User\u5bf9\u8c61\u6267\u884cupdate\uff0c\u540c\u65f6\u4e5f\u4f1a\u8ba9UserEx\u505aupdate\n$result = $user-&gt;update();\u4fdd\u5b58\u548cinsert\u3001update\u540c\u7406\uff0c\u5c31\u4e0d\u4f5c\u6f14\u793a\u4e86\u3002\u5220\u9664$user = User::find(1);\n\/\/ \u5220\u9664ID\u4e3a1\u7684\u8bb0\u5f55\uff0cUserEx\u5bf9\u5e94\u8868\u4e5f\u4f1a\u5220\u9664\u8fd9\u6761\u5173\u8054\u8bb0\u5f55\n$result = $user-&gt;delete();\nif($result-&gt;isSuccess())\n{\n    echo &#039;success&#039;;\n}"},{"id":97,"title":"\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054","pageTitle":"\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054","url":"components\/orm\/relation\/polymorphicManyToMany.html","content":"\u591a\u6001\u591a\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u5f20\u6587\u7ae0\u8868\uff0c\u4e00\u5f20\u4e66\u7c4d\u8868\uff0c\u4e00\u5f20\u6807\u7b7e\u8868\uff0c\u4e00\u5f20\u6807\u7b7e\u5173\u8054\u8868\u3002\u6587\u7ae0\u548c\u4e66\u7c4d\u5171\u7528\u6807\u7b7e\u5e93\u3002mysql&gt; desc tb_article;\n+---------+------------------+------+-----+---------+----------------+\n| Field   | Type             | Null | Key | Default | Extra          |\n+---------+------------------+------+-----+---------+----------------+\n| id      | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title   | varchar(32)      | NO   |     | NULL    |                |\n| content | text             | NO   |     | NULL    |                |\n+---------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_book;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_tags;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_taggables;\n+---------------+------------------+------+-----+---------+-------+\n| Field         | Type             | Null | Key | Default | Extra |\n+---------------+------------------+------+-----+---------+-------+\n| tag_id        | int(10) unsigned | NO   | PRI | NULL    |       |\n| taggable_id   | int(10) unsigned | NO   | PRI | NULL    |       |\n| taggable_type | tinyint(4)       | NO   | PRI | NULL    |       |\n+---------------+------------------+------+-----+---------+-------+\u5b9a\u4e49\u591a\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@PolymorphicManyToMany\u3001@PolymorphicToMany\u3001@JoinFromMiddle\u3001@JoinToMiddle\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDeleteArticle \u6a21\u578b\/**\n * Article\n * @Entity\n * @Table(name=&quot;tb_article&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $title\n * @property string $content\n * @property \\Imi\\Util\\ArrayList $comments\n * @property \\Imi\\Util\\ArrayList $taggables\n * @property \\Imi\\Util\\ArrayList $tags\n *\/\nclass Article extends Model\n{\n    \/\/ \u7701\u7565\u5176\u5b83\u2026\u2026\n    \n    \/**\n     * \u6807\u7b7e\u5173\u8054\n     * \n     * @PolymorphicManyToMany(model=&quot;Tags&quot;, middle=&quot;Taggables&quot;, rightMany=&quot;tags&quot;, type=&quot;taggable_type&quot;, typeValue=1)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;taggable_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;tag_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoInsert\n     * @AutoUpdate(orphanRemoval=true)\n     * @AutoSave\n     * @AutoDelete\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $taggables;\n\n    \/**\n     * Get \u6807\u7b7e\u5173\u8054\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getTaggables()\n    {\n        return $this-&gt;taggables;\n    }\n\n    \/**\n     * Set \u6807\u7b7e\u5173\u8054\n     *\n     * @param  \\Imi\\Util\\ArrayList  $taggables  \u6807\u7b7e\u5173\u8054\n     *\n     * @return  self\n     *\/ \n    public function setTaggables(\\Imi\\Util\\ArrayList $taggables)\n    {\n        $this-&gt;taggables = $taggables;\n\n        return $this;\n    }\n\n    \/**\n     * \u5173\u8054\u6807\u7b7e\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $tags;\n\n    \/**\n     * Get \u5173\u8054\u6807\u7b7e\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getTags()\n    {\n        return $this-&gt;tags;\n    }\n\n    \/**\n     * Set \u5173\u8054\u6807\u7b7e\n     *\n     * @param  \\Imi\\Util\\ArrayList  $tags  \u5173\u8054\u6807\u7b7e\n     *\n     * @return  self\n     *\/ \n    public function setTags($tags)\n    {\n        $this-&gt;tags = $tags;\n\n        return $this;\n    }\n}Tags \u6a21\u578b\/**\n * Tags\n * @Entity\n * @Table(name=&quot;tb_tags&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $name\n *\/\nclass Tags extends Model\n{\n    \/\/ \u7701\u7565\u5176\u5b83\u2026\u2026\n\n    \/**\n     * \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6587\u7ae0\u5217\u8868\n     * \n     * @PolymorphicToMany(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Article::class, modelField=&quot;id&quot;, type=&quot;taggable_type&quot;, typeValue=1, field=&quot;taggable_id&quot;, middle=&quot;Taggables&quot;)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;taggable_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;tag_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoSelect(false)\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $articles;\n\n    \/**\n     * Get \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6a21\u578b\u5217\u8868\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getArticles()\n    {\n        return $this-&gt;articles;\n    }\n\n    \/**\n     * Set \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6a21\u578b\u5217\u8868\n     *\n     * @param  \\Imi\\Util\\ArrayList  $articles  \u62e5\u6709\u672c\u6807\u7b7e\u7684\u6a21\u578b\u5217\u8868\n     *\n     * @return  self\n     *\/ \n    public function setArticles(\\Imi\\Util\\ArrayList $articles)\n    {\n        $this-&gt;articles = $articles;\n\n        return $this;\n    }\n    \n    \/**\n     * \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     * \n     * @PolymorphicToMany(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Book::class, modelField=&quot;id&quot;, type=&quot;taggable_type&quot;, typeValue=2, field=&quot;taggable_id&quot;, middle=&quot;Taggables&quot;)\n     * @JoinToMiddle(field=&quot;id&quot;, middleField=&quot;taggable_id&quot;)\n     * @JoinFromMiddle(middleField=&quot;tag_id&quot;, field=&quot;id&quot;)\n     * \n     * @AutoSelect(false)\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $books;\n\n    \/**\n     * Get \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     *\n     * @return  \\Imi\\Util\\ArrayList\n     *\/ \n    public function getBooks()\n    {\n        return $this-&gt;books;\n    }\n\n    \/**\n     * Set \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     *\n     * @param  \\Imi\\Util\\ArrayList  $books  \u62e5\u6709\u672c\u6807\u7b7e\u7684\u4e66\u7c4d\u5217\u8868\n     *\n     * @return  self\n     *\/ \n    public function setBooks(\\Imi\\Util\\ArrayList $books)\n    {\n        $this-&gt;books = $books;\n\n        return $this;\n    }\n    \n}Taggables \u6a21\u578b\u6ca1\u6709\u8981\u8bbe\u7f6e\u7684\u6ce8\u89e3\uff0c\u4e0d\u5c55\u793a\u4e86\u67e5\u8be2\u5e38\u89c1\u7684\u589e\u5220\u6539\u67e5\u5c31\u4e0d\u5199\u4e86\uff0c\u548c\u4e00\u5bf9\u591a\u5173\u8054\u4e00\u6837\u7528\u6cd5\u6807\u7b7e\u53cd\u67e5\u6587\u7ae0\u548c\u4e66\u7c4d$tag = Tags::find(1);\n$tag-&gt;queryRelations(&#039;articles&#039;, &#039;books&#039;);\n$articles = $tag-&gt;articles;\n$books = $tag-&gt;books;"},{"id":96,"title":"\u591a\u6001\u4e00\u5bf9\u591a\u5173\u8054","pageTitle":"\u591a\u6001\u4e00\u5bf9\u591a\u5173\u8054","url":"components\/orm\/relation\/polymorphicOneToMany.html","content":"\u591a\u6001\u4e00\u5bf9\u591a\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u5f20\u6587\u7ae0\u8868\uff0c\u4e00\u5f20\u4e66\u7c4d\u8868\uff0c\u4e00\u5f20\u8bc4\u8bba\u8868\u3002\u6587\u7ae0\u548c\u4e66\u7c4d\u7684\u8bc4\u8bba\u8bb0\u5f55\u90fd\u5728\u540c\u4e00\u5f20\u8bc4\u8bba\u8868\u4e2d\u3002mysql&gt; desc tb_article;\n+---------+------------------+------+-----+---------+----------------+\n| Field   | Type             | Null | Key | Default | Extra          |\n+---------+------------------+------+-----+---------+----------------+\n| id      | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title   | varchar(32)      | NO   |     | NULL    |                |\n| content | text             | NO   |     | NULL    |                |\n+---------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_book;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| title | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_comment;\n+-------------+------------------+------+-----+---------+----------------+\n| Field       | Type             | Null | Key | Default | Extra          |\n+-------------+------------------+------+-----+---------+----------------+\n| id          | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| content     | text             | NO   |     | NULL    |                |\n| type        | tinyint(4)       | NO   |     | NULL    |                |\n| relation_id | int(10) unsigned | NO   |     | NULL    |                |\n+-------------+------------------+------+-----+---------+----------------+\u5b9a\u4e49\u4e00\u5bf9\u591a\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@PolymorphicOneToMany\u3001@PolymorphicToOne\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0cArticle\u5b9a\u4e49\u4e86\u4e00\u4e2a$comments\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054Comment\u6a21\u578b\u3002Article\u4e2did\u4e0eComment\u4e2drelation_id\u5173\u8054\uff0c\u5e76\u4e14type\u4e3a1\u7684\u624d\u5173\u8054\u3002Article \u6a21\u578b\/**\n * Article\n * @Entity\n * @Table(name=&quot;tb_article&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $title\n * @property string $content\n * @property \\Imi\\Util\\ArrayList $comments\n * @property \\Imi\\Util\\ArrayList $taggables\n * @property \\Imi\\Util\\ArrayList $tags\n *\/\nclass Article extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * title\n     * @Column(name=&quot;title&quot;, type=&quot;varchar&quot;, length=32, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $title;\n\n    \/**\n     * \u83b7\u53d6 title\n     *\n     * @return string\n     *\/ \n    public function getTitle()\n    {\n        return $this-&gt;title;\n    }\n\n    \/**\n     * \u8d4b\u503c title\n     * @param string $title title\n     * @return static\n     *\/ \n    public function setTitle($title)\n    {\n        $this-&gt;title = $title;\n        return $this;\n    }\n\n    \/**\n     * content\n     * @Column(name=&quot;content&quot;, type=&quot;text&quot;, length=0, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $content;\n\n    \/**\n     * \u83b7\u53d6 content\n     *\n     * @return string\n     *\/ \n    public function getContent()\n    {\n        return $this-&gt;content;\n    }\n\n    \/**\n     * \u8d4b\u503c content\n     * @param string $content content\n     * @return static\n     *\/ \n    public function setContent($content)\n    {\n        $this-&gt;content = $content;\n        return $this;\n    }\n\n    \/**\n     * \u8bc4\u8bba\n     * \n     * @PolymorphicOneToMany(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Comment::class, type=&quot;type&quot;, typeValue=1)\n     * @JoinTo(&quot;relation_id&quot;)\n     * @AutoSave(orphanRemoval=true)\n     * @AutoDelete\n     *\n     * @var \\Imi\\Util\\ArrayList\n     *\/\n    protected $comments;\n\n    \/**\n     * Get \u8bc4\u8bba\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Comment[]\n     *\/ \n    public function getComments()\n    {\n        return $this-&gt;comments;\n    }\n\n    \/**\n     * Set \u8bc4\u8bba\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Comment[]  $comments  \u8bc4\u8bba\n     *\n     * @return  self\n     *\/ \n    public function setComments($comments)\n    {\n        $this-&gt;comments = $comments;\n\n        return $this;\n    }\n    \n}\u4e3b\u8981\u53c2\u8003$comments\u4e0a\u7684\u6ce8\u89e3\uff0c\u4e0e\u591a\u6001\u4e00\u5bf9\u591a\u4e00\u6837\u3002Comment \u6a21\u578b\/**\n * Comment\n * @Entity\n * @Table(name=&quot;tb_comment&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $content\n * @property int $type\n * @property int $relationId\n *\/\nclass Comment extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * content\n     * @Column(name=&quot;content&quot;, type=&quot;text&quot;, length=0, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $content;\n\n    \/**\n     * \u83b7\u53d6 content\n     *\n     * @return string\n     *\/ \n    public function getContent()\n    {\n        return $this-&gt;content;\n    }\n\n    \/**\n     * \u8d4b\u503c content\n     * @param string $content content\n     * @return static\n     *\/ \n    public function setContent($content)\n    {\n        $this-&gt;content = $content;\n        return $this;\n    }\n\n    \/**\n     * type\n     * @Column(name=&quot;type&quot;, type=&quot;tinyint&quot;, length=4, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $type;\n\n    \/**\n     * \u83b7\u53d6 type\n     *\n     * @return int\n     *\/ \n    public function getType()\n    {\n        return $this-&gt;type;\n    }\n\n    \/**\n     * \u8d4b\u503c type\n     * @param int $type type\n     * @return static\n     *\/ \n    public function setType($type)\n    {\n        $this-&gt;type = $type;\n        return $this;\n    }\n\n    \/**\n     * relation_id\n     * @Column(name=&quot;relation_id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $relationId;\n\n    \/**\n     * \u83b7\u53d6 relationId\n     *\n     * @return int\n     *\/ \n    public function getRelationId()\n    {\n        return $this-&gt;relationId;\n    }\n\n    \/**\n     * \u8d4b\u503c relationId\n     * @param int $relationId relation_id\n     * @return static\n     *\/ \n    public function setRelationId($relationId)\n    {\n        $this-&gt;relationId = $relationId;\n        return $this;\n    }\n\n}\u67e5\u8be2\u5e38\u89c1\u7684\u589e\u5220\u6539\u67e5\u5c31\u4e0d\u5199\u4e86\uff0c\u548c\u4e00\u5bf9\u591a\u5173\u8054\u4e00\u6837\u7528\u6cd5\u8bc4\u8bba\u6a21\u578b\u53cd\u67e5\u6587\u7ae0\u6a21\u578b\u6ce8\u89e3\u53ca\u7528\u6cd5\u4e0e\u4e00\u5bf9\u4e00\u76f8\u540c"},{"id":95,"title":"\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054","pageTitle":"\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054","url":"components\/orm\/relation\/polymorphicOneToOne.html","content":"\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054\u6bd4\u5982\u6211\u4eec\u6709\u4e00\u4e2a\u7528\u6237\u8868\uff0c\u4e00\u4e2a\u56e2\u961f\u8868\uff0c\u4ed6\u4eec\u548c\u5934\u50cf\u8868\u76f8\u5173\u8054\u3002mysql&gt; desc tb_user;\n+----------+------------------+------+-----+---------+----------------+\n| Field    | Type             | Null | Key | Default | Extra          |\n+----------+------------------+------+-----+---------+----------------+\n| id       | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| username | varchar(32)      | NO   |     | NULL    |                |\n| age      | tinyint(3)       | NO   |     | NULL    |                |\n+----------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_team;\n+-------+------------------+------+-----+---------+----------------+\n| Field | Type             | Null | Key | Default | Extra          |\n+-------+------------------+------+-----+---------+----------------+\n| id    | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| name  | varchar(32)      | NO   |     | NULL    |                |\n+-------+------------------+------+-----+---------+----------------+\n\nmysql&gt; desc tb_avatar;\n+-------------+------------------+------+-----+---------+----------------+\n| Field       | Type             | Null | Key | Default | Extra          |\n+-------------+------------------+------+-----+---------+----------------+\n| id          | int(10) unsigned | NO   | PRI | NULL    | auto_increment |\n| type        | tinyint(4)       | NO   | MUL | NULL    |                |\n| relation_id | int(10) unsigned | NO   |     | NULL    |                |\n| url         | varchar(255)     | NO   |     | NULL    |                |\n+-------------+------------------+------+-----+---------+----------------+\u5b9a\u4e49\u591a\u6001\u4e00\u5bf9\u4e00\u5173\u8054\u4f1a\u7528\u5230\u7684\u6ce8\u89e3\uff1a@PolymorphicOneToOne\u3001@PolymorphicToOne\u3001@JoinFrom\u3001@JoinTo\u3001@AutoSelect\u3001@AutoInsert\u3001@AutoUpdate\u3001@AutoSave\u3001@AutoDelete\u5982 imi-demo \u4e2d\u4ee3\u7801\u6240\u793a\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a$avatar\u5c5e\u6027\uff0c\u8fd9\u4e2a\u5c5e\u6027\u5173\u8054Avatar\u6a21\u578b\u3002User\u4e2did\u4e0eAvatar\u4e2drelation_id\u5173\u8054\uff0c\u5e76\u4e14type\u4e3a1\u7684\u624d\u5173\u8054\u3002User \u6a21\u578b\/**\n * User\n * @Entity\n * @Table(name=&quot;tb_user&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property string $username\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\UserEx $ex\n * @property \\Imi\\Util\\ArrayList $userRole\n * @property \\Imi\\Util\\ArrayList $role\n * @property \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar $avatar\n *\/\nclass User extends Model\n{\n    \/**\n     * \u5934\u50cf\n     * \n     * @PolymorphicOneToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar::class, type=&quot;type&quot;, typeValue=1)\n     * @JoinTo(&quot;relation_id&quot;)\n     * @AutoSave\n     * @AutoDelete\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar\n     *\/\n    protected $avatar;\n\n    \/**\n     * Get \u5934\u50cf\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar\n     *\/ \n    public function getAvatar()\n    {\n        return $this-&gt;avatar;\n    }\n\n    \/**\n     * Set \u5934\u50cf\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar  $avatar  \u5934\u50cf\n     *\n     * @return  self\n     *\/ \n    public function setAvatar(\\ImiDemo\\HttpDemo\\MainServer\\Model\\Avatar $avatar)\n    {\n        $this-&gt;avatar = $avatar;\n\n        return $this;\n    }\n\n}@PolymorphicOneToOne\u6ce8\u89e3\u4e2d\uff0ctype\u4ee3\u8868\u5728Avatar\u6a21\u578b\u4e2d\u7684\u5b57\u6bb5\u540d\uff0ctypeValue\u4ee3\u8868\u5339\u914d\u7684\u503c\u3002Avatar \u6a21\u578b\/**\n * Avatar\n * @Entity\n * @Table(name=&quot;tb_avatar&quot;, id={&quot;id&quot;})\n * @property int $id\n * @property int $type\n * @property int $relationId\n * @property string $url\n *\/\nclass Avatar extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * type\n     * @Column(name=&quot;type&quot;, type=&quot;tinyint&quot;, length=4, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $type;\n\n    \/**\n     * \u83b7\u53d6 type\n     *\n     * @return int\n     *\/ \n    public function getType()\n    {\n        return $this-&gt;type;\n    }\n\n    \/**\n     * \u8d4b\u503c type\n     * @param int $type type\n     * @return static\n     *\/ \n    public function setType($type)\n    {\n        $this-&gt;type = $type;\n        return $this;\n    }\n\n    \/**\n     * relation_id\n     * @Column(name=&quot;relation_id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var int\n     *\/\n    protected $relationId;\n\n    \/**\n     * \u83b7\u53d6 relationId\n     *\n     * @return int\n     *\/ \n    public function getRelationId()\n    {\n        return $this-&gt;relationId;\n    }\n\n    \/**\n     * \u8d4b\u503c relationId\n     * @param int $relationId relation_id\n     * @return static\n     *\/ \n    public function setRelationId($relationId)\n    {\n        $this-&gt;relationId = $relationId;\n        return $this;\n    }\n\n    \/**\n     * url\n     * @Column(name=&quot;url&quot;, type=&quot;varchar&quot;, length=255, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $url;\n\n    \/**\n     * \u83b7\u53d6 url\n     *\n     * @return string\n     *\/ \n    public function getUrl()\n    {\n        return $this-&gt;url;\n    }\n\n    \/**\n     * \u8d4b\u503c url\n     * @param string $url url\n     * @return static\n     *\/ \n    public function setUrl($url)\n    {\n        $this-&gt;url = $url;\n        return $this;\n    }\n\n    \/**\n     * \u5bf9\u5e94\u7528\u6237\n     * \n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\User::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=1, field=&quot;relation_id&quot;)\n     * @AutoSelect(false)\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\User\n     *\/\n    protected $user;\n\n    \/**\n     * Get \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User\n     *\/ \n    public function getUser()\n    {\n        return $this-&gt;user;\n    }\n\n    \/**\n     * Set \u5bf9\u5e94\u7528\u6237\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User  $user  \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  self\n     *\/ \n    public function setUser(\\ImiDemo\\HttpDemo\\MainServer\\Model\\User $user)\n    {\n        $this-&gt;user = $user;\n\n        return $this;\n    }\n\n    \/**\n     * \u5bf9\u5e94\u7528\u6237\n     * \n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Team::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=2, field=&quot;relation_id&quot;)\n     * @AutoSelect(false)\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/\n    protected $team;\n\n    \/**\n     * Get \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/ \n    public function getTeam()\n    {\n        return $this-&gt;team;\n    }\n\n    \/**\n     * Set \u5bf9\u5e94\u7528\u6237\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\Team  $team  \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  self\n     *\/ \n    public function setTeam(\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team $team)\n    {\n        $this-&gt;team = $team;\n\n        return $this;\n    }\n\n    \/**\n     * \u5bf9\u5e94\u7528\u6237\n     * \n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\User::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=1, field=&quot;relation_id&quot;)\n     * @PolymorphicToOne(model=ImiDemo\\HttpDemo\\MainServer\\Model\\Team::class, modelField=&quot;id&quot;, type=&quot;type&quot;, typeValue=2, field=&quot;relation_id&quot;)\n     * @AutoSelect(false)\n     *\n     * @var \\ImiDemo\\HttpDemo\\MainServer\\Model\\User|\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/\n    protected $relationModel;\n\n    \/**\n     * Get \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User|\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team\n     *\/ \n    public function getRelationModel()\n    {\n        return $this-&gt;relationModel;\n    }\n\n    \/**\n     * Set \u5bf9\u5e94\u7528\u6237\n     *\n     * @param  \\ImiDemo\\HttpDemo\\MainServer\\Model\\User|\\ImiDemo\\HttpDemo\\MainServer\\Model\\Team  $relationModel  \u5bf9\u5e94\u7528\u6237\n     *\n     * @return  self\n     *\/ \n    public function setRelationModel($relationModel)\n    {\n        $this-&gt;relationModel = $relationModel;\n\n        return $this;\n    }\n}Avatar \u6a21\u578b\u4e2d\uff0c$user\u548c$team\u662f\u6307\u5b9a\u7c7b\u578b\u7684\u5173\u8054\uff0c\u53ea\u80fd\u53d6\u5230\u5bf9\u5e94\u6a21\u578b\u7684\u6570\u636e\u3002$relationModel\u4f1a\u6839\u636e\u5f53\u524d\u6a21\u578b\u7684type\u503c\uff0c\u67e5\u8be2\u51fa\u5bf9\u5e94\u6a21\u578b\u7684\u6570\u636e\uff0c\u7c7b\u578b\u4e0d\u56fa\u5b9a\u3002\u67e5\u8be2\u5e38\u89c1\u7684\u589e\u5220\u6539\u67e5\u5c31\u4e0d\u5199\u4e86\uff0c\u548c\u4e00\u5bf9\u4e00\u5173\u8054\u4e00\u6837\u7528\u6cd5\u5934\u50cf\u6a21\u578b\u53cd\u67e5\u7528\u6237\u6a21\u578b\u667a\u80fd\u7c7b\u578b\u67e5\u8be2$avatar = Avatar::find(1);\n$avatar-&gt;queryRelations(&#039;relationModel&#039;);\n$user = $avatar-&gt;relationModel;\u6307\u5b9a\u7c7b\u578b\u67e5\u8be2$avatar = Avatar::find(1);\n$avatar-&gt;queryRelations(&#039;user&#039;);\n$user = $avatar-&gt;user;\u540c\u65f6\u67e5\u8be2\u591a\u4e2a$avatar = Avatar::find(1);\n$avatar-&gt;queryRelations(&#039;user&#039;, &#039;relationModel&#039;);\n$user1 = $avatar-&gt;user;\n$user2 = $avatar-&gt;relationModel;"},{"id":89,"title":"\u6a21\u578b\u8f6f\u5220\u9664","pageTitle":"\u6a21\u578b\u8f6f\u5220\u9664","url":"components\/orm\/softDelete.html","content":"\u6a21\u578b\u8f6f\u5220\u9664\u56e0\u4e3a\u79cd\u79cd\u539f\u56e0\uff0c\u73b0\u5728\u5927\u90e8\u5206\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5f00\u53d1\u5220\u9664\u529f\u80fd\u65f6\uff0c\u90fd\u4e0d\u4f1a\u5c06\u8bb0\u5f55\u7269\u7406\u5220\u9664\u3002\u4f7f\u7528\u6a21\u578b\u8f6f\u5220\u9664\u529f\u80fd\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u6a21\u578b\u7c7b\u4e2d\u5f15\u5165 trait Imi\\Model\\SoftDelete\\Traits\\TSoftDelete\uff0c\u5e76\u4e14\u5728\u7c7b\u4e0a\u52a0\u4e0a\u6ce8\u89e3 @SoftDelete\u793a\u4f8b&lt;?php\n\nnamespace Imi\\Test\\Component\\Model;\n\nuse Imi\\Bean\\Annotation\\Inherit;\nuse Imi\\Model\\SoftDelete\\Annotation\\SoftDelete;\nuse Imi\\Model\\SoftDelete\\Traits\\TSoftDelete;\nuse Imi\\Test\\Component\\Model\\Base\\TestSoftDeleteBase;\n\n\/**\n * tb_test_soft_delete.\n *\n * @Inherit\n * @SoftDelete\n *\/\nclass TestSoftDelete extends TestSoftDeleteBase\n{\n    use TSoftDelete;\n}\u6ce8\u89e3@SoftDelete\u8f6f\u5220\u9664\u7c7b\u540d\uff1aImi\\Model\\SoftDelete\\Annotation\\SoftDelete\u5c5e\u6027\u540d\u79f0\u8bf4\u660efield\u8f6f\u5220\u9664\u5b57\u6bb5\u540d\uff0c\u9ed8\u8ba4\u4e3adelete_timedefault\u8f6f\u5220\u9664\u5b57\u6bb5\u7684\u9ed8\u8ba4\u503c\uff0c\u4ee3\u8868\u975e\u5220\u9664\u72b6\u6001\uff0c\u9ed8\u8ba4\u4e3a0\u4f7f\u7528imi \u6a21\u578b\u8f6f\u5220\u9664\uff0c\u9ed8\u8ba4\u903b\u8f91\u662f\u975e\u5220\u9664\u72b6\u6001\u5b57\u6bb5\u503c\u4e3a 0\uff0c\u5220\u9664\u540e\u503c\u4e3a\u5f53\u524d\u65f6\u95f4\u6233\u3002\u4f60\u4e5f\u53ef\u4ee5\u81ea\u884c\u5b9a\u4e49\u5b57\u6bb5\u540d\u3001\u9ed8\u8ba4\u503c\u3001\u5220\u9664\u540e\u7684\u503c\u3002\u5b57\u6bb5\u540d\u3001\u9ed8\u8ba4\u503c\u53ef\u4ee5\u901a\u8fc7 @SoftDelete \u8fdb\u884c\u8bbe\u7f6e\u3002\u5220\u9664\u540e\u7684\u503c\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6\u6a21\u578b\u7c7b\u4e2d\u7684 __generateSoftDeleteValue() \u65b9\u6cd5\u5b9e\u73b0\uff1a\/**\n * \u751f\u6210\u8f6f\u5220\u9664\u5b57\u6bb5\u7684\u503c\n *\n * @return mixed\n *\/\npublic function __generateSoftDeleteValue()\n{\n    return time();\n}"},{"id":88,"title":"TreeModel","pageTitle":"TreeModel","url":"components\/orm\/TreeModel.html","content":"TreeModel\u4ecb\u7ecd\u6211\u4eec\u5f00\u53d1\u4e2d\u6709\u4e00\u4e9b\u8868\u662f\u6811\u5f62\u7ed3\u6784\u7684\uff0c\u6bd4\u5982\u5730\u533a\u3001\u5206\u9500\u5173\u7cfb\u7b49\u3002imi \u7279\u5730\u4e3a\u6b64\u505a\u4e86\u589e\u5f3a\u652f\u6301\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u64cd\u4f5c\u6811\u5f62\u7ed3\u6784\u7684\u6570\u636e\u8868\u3002\u5b9a\u4e49\u6a21\u578b\u5f15\u5165 trait\uff1aImi\\Model\\Tree\\TTreeModel\u7c7b\u4e0a\u52a0\u4e0a @TreeModel \u6ce8\u89e3\uff0c\u7c7b\uff1aImi\\Model\\Tree\\Annotation\\TreeModel\u5c5e\u6027\u540d\u79f0\u8bf4\u660eidField\u4e3b\u952e\u5b57\u6bb5\u540d\uff0c\u9ed8\u8ba4\u4e3anull\uff0c\u5219\u81ea\u52a8\u83b7\u53d6parentField\u7236\u7ea7ID\u5b57\u6bb5\u540dchildrenField\u5b50\u96c6\u5b57\u6bb5\u540d&lt;?php\nnamespace Imi\\Test\\Component\\Model;\n\nuse Imi\\Model\\Model;\nuse Imi\\Model\\Tree\\TTreeModel;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\nuse Imi\\Model\\Tree\\Annotation\\TreeModel;\nuse Imi\\Test\\Component\\Model\\Base\\TreeBase;\n\n\/**\n * Tree\n * @Entity\n * @TreeModel(parentField=&quot;parent_id&quot;, childrenField=&quot;children&quot;)\n * @Table(name=&quot;tb_tree&quot;, id={&quot;id&quot;})\n *\/\nclass Tree extends TreeBase \/\/ TreeBase \u4e3a\u901a\u8fc7 generate\/model \u5de5\u5177\u751f\u6210\u51fa\u6765\u7684\u57fa\u7c7b\n{\n    use TTreeModel;\n\n    \/**\n     * \u5b50\u8282\u70b9\u96c6\u5408\n     * \n     * @Column(virtual=true)\n     *\n     * @var static[]\n     *\/\n    protected $children = [];\n\n    \/**\n     * Get \u5b50\u8282\u70b9\u96c6\u5408\n     *\n     * @return static[]\n     *\/ \n    public function &amp;getChildren()\n    {\n        return $this-&gt;children;\n    }\n\n    \/**\n     * Set \u5b50\u8282\u70b9\u96c6\u5408\n     *\n     * @param static[] $children\n     *\n     * @return self\n     *\/ \n    public function setChildren($children)\n    {\n        $this-&gt;children = $children;\n\n        return $this;\n    }\n\n}\u4f7f\u7528\u65b9\u6cd5\u5217\u8868getChildIds\u83b7\u53d6\u4e00\u7ea7\u5b50\u8282\u70b9\u7684ID\u4eec$item = Tree::find(1);\n$ids = $item-&gt;getChildIds(); \/\/ \u5f53\u524d\u5bf9\u8c61\u5b50\u8282\u70b9\n$ids = $item-&gt;getChildIds(123); \/\/ \u6307\u5b9a ID \u5b50\u8282\u70b9getChildrenIds\u83b7\u53d6\u4e0b\u5c5e N \u7ea7\u5b50\u8282\u70b9\u7684ID\u975e\u9012\u5f52\u5b9e\u73b0\uff0c\u76f8\u6bd4\u9012\u5f52\u5b9e\u73b0\u6027\u80fd\u66f4\u9ad8\uff0c\u66f4\u7701\u5185\u5b58$item = Tree::find(1);\n$item-&gt;getChildrenIds(null, true); \/\/ \u5305\u542b\u7236\u7ea7ID\uff081\uff09\n$item-&gt;getChildrenIds(); \/\/ \u4e0d\u5305\u542b\u7236\u7ea7ID\uff081\uff09\n$item-&gt;getChildrenIds(123, false, 1); \/\/ \u4e0d\u5305\u542b\u7236\u7ea7ID\uff08123\uff09\uff0c\u9650\u5236\u83b7\u53d6\u5b50\u5c42\u7ea7\u4e3a1\u7ea7getChildrenList\u83b7\u53d6\u5b50\u6210\u5458\u5bf9\u8c61\u5217\u8868\uff0c\u53ef\u4ee5\u6307\u5b9a\u5c42\u7ea7\uff0c\u9ed8\u8ba4\u65e0\u9650\u7ea7$item = Tree::find(1);\n$tree = $item-&gt;getChildrenList(); \/\/ \u83b7\u53d6\u7236\u7ea7ID\uff081\uff09\u4e0b\u6240\u6709\u8bb0\u5f55\n$tree = $item-&gt;getChildrenList(null, 1); \/\/ \u83b7\u53d6\u7236\u7ea7ID\uff081\uff09\u4e0b\u6240\u6709\u8bb0\u5f55\uff0c\u5c42\u7ea71\u7ea7\n$tree = $item-&gt;getChildrenList(123, 1); \/\/ \u83b7\u53d6\u7236\u7ea7ID\uff08123\uff09\u4e0b\u6240\u6709\u8bb0\u5f55\uff0c\u5c42\u7ea71\u7ea7\ngetParent\u83b7\u53d6\u7236\u7ea7\u5bf9\u8c61$item = Tree::find(1);\n$parentItem = $item-&gt;getParent();getParents\u83b7\u53d6\u6240\u6709\u7236\u7ea7\u5bf9\u8c61\u5217\u8868$item = Tree::find(1);\n$parentItemList = $item-&gt;getParents();getAssocList\u83b7\u53d6\u5173\u8054\u5217\u8868\uff0c@TreeModel\u6ce8\u89e3\u4e2d\u914d\u7f6e\u7684childrenField\u5c5e\u6027\u751f\u6548\uff0c\u653e\u5165\u914d\u7f6e\u7684\u5c5e\u6027\u4e2d$list = Tree::getAssocList(); \/\/ \u6240\u6709\u6570\u636e\n\n\/\/ \u6307\u5b9a\u53ea\u663e\u793a ID \u4e3a 1\u30012\u30013 \u7684\u6570\u636e\uff0c\u4ed6\u4eec\u4e4b\u95f4\u5982\u679c\u6709\u4e0a\u4e0b\u7ea7\u5173\u7cfb\uff0c\u4f1a\u5728 children \u5c5e\u6027\u4e2d\u4f53\u73b0\n$query = Tree::query()-&gt;whereIn(&#039;id&#039;, [1, 2, 3]);\n$list = Tree::getAssocList($query);\n$children = $list[0]-&gt;children; \/\/ $children \u4e0e $list \u7ed3\u6784\u76f8\u540c"},{"id":"645b0b4a643c66.51510577","title":"Phar \u652f\u6301","pageTitle":"Phar \u652f\u6301","url":"components\/phar\/index.html","content":"Phar \u652f\u6301\u76ee\u524d imi \u5df2\u7ecf\u5b8c\u5168\u652f\u6301\u4e86 Phar \u6a21\u5f0f\u8fd0\u884c\u3002\uff08\u5176\u5b9e\u53ef\u4ee5\u4e0d\u770b\uff0c\u76f4\u63a5\u7528\uff09Phar \u6a21\u5f0f\u751f\u6210 phar \u6587\u4ef6\u9700\u8981\u4fee\u6539php.ini\uff0c\u52a0\u5165\u4ee5\u4e0b\u914d\u7f6e\uff1aphar.readonly=Offimi \u5185\u7f6e\u6253\u5305\u751f\u6210 phar \u547d\u4ee4\uff1abin\/build-phar\u76ee\u524d\uff0c\u9ed8\u8ba4\uff08\u5f3a\u5236\uff09\u751f\u6210\u4e3aimi\/src\/imi.phar"},{"id":79,"title":"\u8fde\u63a5\u6c60","pageTitle":"\u8fde\u63a5\u6c60","url":"components\/pool\/index.html","content":"\u8fde\u63a5\u6c60\u7531\u4e8e Swoole \u7684\u5e38\u9a7b\u5185\u5b58\u7279\u6027\uff0c\u6240\u4ee5 imi \u4e2d\u5b9e\u73b0\u4e86\u8fde\u63a5\u6c60\u3002\u6240\u6709\u7684\u6570\u636e\u5e93\u3001Redis\u8fde\u63a5\uff0c\u90fd\u901a\u8fc7\u8fde\u63a5\u6c60\u53bb\u83b7\u53d6\u3002\u5b9a\u4e49\u8fde\u63a5\u6c60\u8fde\u63a5\u6c60\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u5199\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5199\u5728\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u3002\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e00\u4e2apools\u8282\u70b9\uff0c\u91cc\u9762\u914d\u7f6e\u7684\u662f\u8fde\u63a5\u6c60\u3002\u540c\u6b65\u6c60\u5b50\u4ec5\u5728task\u8fdb\u7a0b\u4f7f\u7528\uff0c\u5f02\u6b65\u6c60\u5b50\u5728worker\u8fdb\u7a0b\u4f7f\u7528\u3002\u4e00\u822c\u4f7f\u7528\u65f6\u65e0\u9700\u81ea\u884c\u5224\u65ad\u5728\u54ea\u4e2a\u8fdb\u7a0b\uff0c\u6846\u67b6\u4f1a\u81ea\u52a8\u5e2e\u4f60\u83b7\u53d6\u5bf9\u5e94\u7684\u8fde\u63a5\u3002\u83b7\u53d6\u8fde\u63a5\u83b7\u53d6\u6c60\u5b50\u4e2d\u7684\u8d44\u6e90\\Imi\\Pool\\PoolManager::getResource(string $name): IPoolResource$name \u4e3a\u6c60\u5b50\u540d\u79f0\u83b7\u53d6\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u4e00\u4e2a\u8bf7\u6c42\u4e0a\u4e0b\u6587\u901a\u8fc7\u6b64\u65b9\u6cd5\uff0c\u53ea\u80fd\u83b7\u53d6\u540c\u4e00\u4e2a\u8d44\u6e90\\Imi\\Pool\\PoolManager::getRequestContextResource(string $name): IPoolResource\u5c1d\u8bd5\u83b7\u53d6\u8d44\u6e90\\Imi\\Pool\\PoolManager::tryGetResource(string $name): IPoolResource|boolean\u56de\u8c03\u65b9\u5f0f\u4f7f\u7528\u8d44\u6e90\u4f7f\u7528\u56de\u8c03\u6765\u4f7f\u7528\u6c60\u5b50\u4e2d\u7684\u8d44\u6e90\uff0c\u65e0\u9700\u624b\u52a8\u91ca\u653e$result = \\Imi\\Pool\\PoolManager::use($poolName, function($resource, \\Swoole\\Coroutine\\Redis $redis) use($key){\n    return $redis-&gt;get($key);\n});$poolName-\u6c60\u5b50\u540d\u79f0\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u56de\u8c03\uff0c\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u8d44\u6e90\u672c\u8eab\uff0c\u7b2c\u4e8c\u4e2a\u4e3a\u8d44\u6e90\u91cc\u9762\u7684\u5b9e\u4f8b\u3002\u6bd4\u5982\u4e0a\u9762\u7684\u662fRedis\u56de\u8c03\u7684\u8fd4\u56de\u503c\u4e5f\u4f1a\u6210\u4e3ause\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u624b\u52a8\u91ca\u653e\u8fde\u63a5\\Imi\\Pool\\PoolManager::releaseResource(IPoolResource $resource)\u81ea\u52a8\u91ca\u653e\u8fde\u63a5\u8c03\u7528\\Imi\\Pool\\PoolManager::getRequestContextResource()\u65b9\u6cd5\u83b7\u53d6\uff0c\u5f53\u4e0a\u4e0b\u6587\u88ab\u9500\u6bc1\u65f6\uff0c\u4f1a\u81ea\u52a8\u91ca\u653e\u8d44\u6e90\u3002"},{"id":119,"title":"\u8fdb\u7a0b","pageTitle":"\u8fdb\u7a0b","url":"components\/process\/index.html","content":"\u8fdb\u7a0bimi \u4e2d\u5bf9\u8fdb\u7a0b\u7684\u521b\u5efa\u548c\u8fd0\u884c\u505a\u4e86\u7b80\u5355\u5c01\u88c5\u3002\u5b9a\u4e49\u8fdb\u7a0b&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Process;\n\nuse Imi\\Process\\BaseProcess;\nuse Imi\\Process\\Annotation\\Process;\n\n\/**\n * \u5b9a\u4e49\u8fdb\u7a0btp1\n * @Process(&quot;tp1&quot;)\n *\/\nclass TestProcess extends BaseProcess\n{\n    public function run(\\Swoole\\Process $process)\n    {\n        var_dump($this-&gt;data);\n        sleep(3);\n        var_dump(&#039;testProcess&#039;);\n    }\n}\u91ca\u653e\u8fde\u63a5\u6c60\u56e0\u4e3a\u6211\u4eec\u6709\u4e9b\u8fdb\u7a0b\u662f\u7528\u4e0d\u5230\uff0c\u6216\u8005\u4e0d\u9700\u8981\u6240\u6709\u8fdb\u7a0b\u6c60\u7684\u3002\u8fdb\u7a0b\u6c60\u8d44\u6e90\u8fde\u7740\u4e5f\u662f\u6d6a\u8d39\uff0c\u6240\u6709\u63d0\u4f9b\u4e00\u4e2a\u6ce8\u89e3\uff0c\u7528\u4ee5\u91ca\u653e\u3002\u5728 run() \u65b9\u6cd5\u4e0a\u4f7f\u7528 @PoolClean \u6ce8\u89e3\u5373\u53ef\uff0c\u7c7b\uff1aImi\\Pool\\Annotation\\PoolClean@PoolClean \u53c2\u6570\uff1amode \u6a21\u5f0f\uff0callow-\u767d\u540d\u5355\uff0cdeny-\u9ed1\u540d\u5355list=[] \u8fde\u63a5\u6c60\u540d\u79f0\u5217\u8868\u3002mode=allow\u5219\u4e3a\u4fdd\u7559\u7684\u8fde\u63a5\u6c60\uff0cmode=deny\u5219\u4e3a\u5173\u95ed\u7684\u8fde\u63a5\u6c60\u6ce8\u89e3@Process\/**\n * \u8fdb\u7a0b\u540d\u79f0\n * @var string\n *\/\npublic $name;\n\n\/**\n * \u91cd\u5b9a\u5411\u5b50\u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u5165\u548c\u8f93\u51fa\u3002\u542f\u7528\u6b64\u9009\u9879\u540e\uff0c\u5728\u5b50\u8fdb\u7a0b\u5185\u8f93\u51fa\u5185\u5bb9\u5c06\u4e0d\u662f\u6253\u5370\u5c4f\u5e55\uff0c\u800c\u662f\u5199\u5165\u5230\u4e3b\u8fdb\u7a0b\u7ba1\u9053\u3002\u8bfb\u53d6\u952e\u76d8\u8f93\u5165\u5c06\u53d8\u4e3a\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u9ed8\u8ba4\u4e3a\u963b\u585e\u8bfb\u53d6\u3002\n * @var boolean\n *\/\npublic $redirectStdinStdout = false;\n\n\/**\n * \u7ba1\u9053\u7c7b\u578b\uff0c\u542f\u7528$redirectStdinStdout\u540e\uff0c\u6b64\u9009\u9879\u5c06\u5ffd\u7565\u7528\u6237\u53c2\u6570\uff0c\u5f3a\u5236\u4e3a1\u3002\u5982\u679c\u5b50\u8fdb\u7a0b\u5185\u6ca1\u6709\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 0\n * @var int\n *\/\npublic $pipeType = 2;\n\n\/**\n * \u81ea\u52a8\u5f00\u542f\u534f\u7a0b\n *\n * @var boolean\n *\/\npublic $co = true;\u521b\u5efa\u8fdb\u7a0b\u901a\u8fc7\u6ce8\u89e3\u4e2d\u7684\u8fdb\u7a0b\u540d\u79f0\u521b\u5efa\u8fdb\u7a0b\uff0c\u8fd4\u56de\\Swoole\\Process\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u9700\u8981\u624b\u52a8\u8c03\u7528start()\u65b9\u6cd5\u6765\u8fd0\u884c\u8fdb\u7a0b\u3002\/**\n * \u521b\u5efa\u8fdb\u7a0b\n * \u672c\u65b9\u6cd5\u65e0\u6cd5\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\n * \u8fd4\u56de\\Swoole\\Process\u5bf9\u8c61\u5b9e\u4f8b\n * \n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return \\Swoole\\Process\n *\/\nProcessManager::create($name, $args = [], $redirectStdinStdout = null, $pipeType = null): \\Swoole\\Process\u8fd0\u884c\u8fdb\u7a0b\uff0c\u540c\u6b65\u963b\u585e\u7b49\u5f85\u8fdb\u7a0b\u6267\u884c\u8fd4\u56de\/**\n * \u8fd0\u884c\u8fdb\u7a0b\uff0c\u540c\u6b65\u963b\u585e\u7b49\u5f85\u8fdb\u7a0b\u6267\u884c\u8fd4\u56de\n * \u4e0d\u8fd4\u56de\\Swoole\\Process\u5bf9\u8c61\u5b9e\u4f8b\n * \u6267\u884c\u5931\u8d25\u8fd4\u56defalse\uff0c\u6267\u884c\u6210\u529f\u8fd4\u56de\u6570\u7ec4\uff0c\u5305\u542b\u4e86\u8fdb\u7a0b\u9000\u51fa\u7684\u72b6\u6001\u7801\u3001\u4fe1\u53f7\u3001\u8f93\u51fa\u5185\u5bb9\u3002\n * array(\n *     &#039;code&#039; =&gt; 0,\n *     &#039;signal&#039; =&gt; 0,\n *     &#039;output&#039; =&gt; &#039;&#039;,\n * );\n *\n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return array\n *\/\nProcessManager::run($name, $args = [], $redirectStdinStdout = null, $pipeType = null)\u8fd0\u884c\u8fdb\u7a0b\uff0c\u521b\u5efa\u4e00\u4e2a\u534f\u7a0b\u6267\u884c\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fdb\u7a0b\u6267\u884c\u7ed3\u679c\/**\n * \u8fd0\u884c\u8fdb\u7a0b\uff0c\u521b\u5efa\u4e00\u4e2a\u534f\u7a0b\u6267\u884c\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fdb\u7a0b\u6267\u884c\u7ed3\u679c\n * \u6267\u884c\u5931\u8d25\u8fd4\u56defalse\uff0c\u6267\u884c\u6210\u529f\u8fd4\u56de\u6570\u7ec4\uff0c\u5305\u542b\u4e86\u8fdb\u7a0b\u9000\u51fa\u7684\u72b6\u6001\u7801\u3001\u4fe1\u53f7\u3001\u8f93\u51fa\u5185\u5bb9\u3002\n * array(\n *     &#039;code&#039; =&gt; 0,\n *     &#039;signal&#039; =&gt; 0,\n *     &#039;output&#039; =&gt; &#039;&#039;,\n * );\n *\n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return void\n *\/\nProcessManager::coRun($name, $args = [], $redirectStdinStdout = null, $pipeType = null)\u8fd0\u884c\u8fdb\u7a0b\uff0c\u6258\u7ba1\u5230 Manager \u8fdb\u7a0b\u8fd9\u4e2a\u7528\u6cd5\u53ea\u80fd\u5728IMI.SERVERS.CREATE.AFTER\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff01\/**\n * \u6302\u9760Manager\u8fdb\u7a0b\u8fd0\u884c\u8fdb\u7a0b\n *\n * @param string $name\n * @param array $args\n * @param boolean $redirectStdinStdout\n * @param int $pipeType\n * @return void\n *\/\npublic static function runWithManager($name, $args = [], $redirectStdinStdout = null, $pipeType = null)\u8fdb\u7a0b\u968f\u670d\u52a1\u542f\u52a8\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6ebeans\u8282\uff1a[\n    &#039;AutoRunProcessManager&#039; =&gt;  [\n        &#039;processes&#039; =&gt;  [\n            \/\/ \u65b9\u5f0f\u4e00\uff1a\u6700\u7b80\u5355\u7528\u6cd5\uff0c@Process \u6ce8\u89e3\u5b9a\u4e49\u7684\u8fdb\u7a0b\u540d\u79f0\n            &#039;XXXProcess&#039;,\n            \/\/ \u65b9\u5f0f\u4e8c\uff1a\u652f\u6301\u6307\u5b9a\u53c2\u6570\n            &#039;A&#039; =&gt;  [\n                &#039;process&#039;   =&gt;  &#039;XXXProcess&#039;, \/\/ @Process \u6ce8\u89e3\u5b9a\u4e49\u7684\u8fdb\u7a0b\u540d\u79f0\n                &#039;args&#039;      =&gt;  [&#039;id&#039; =&gt; 123],\n            ],\n        ],\n    ],\n]\u83b7\u53d6\u968f\u670d\u52a1\u542f\u52a8\u7684\u8fdb\u7a0b\u5bf9\u8c61use \\Imi\\Process\\ProcessManager;\n\/** @var \\Swoole\\Process $process *\/\n$process = ProcessManager::getProcessWithManager(&#039;processName&#039;);\u8bbe\u7f6e\u5f02\u6b65\u4fe1\u53f7\u76d1\u542c\u76f8\u6bd4 Swoole \u7684\u76d1\u542c\uff0c\u6b64\u65b9\u6cd5\u652f\u6301\u89e6\u53d1\u591a\u6b21\u4e8b\u4ef6\\Imi\\Util\\Process::signal(SIGTERM, function($signo) {\n     echo &quot;shutdown.&quot;;\n});"},{"id":121,"title":"\u8fdb\u7a0b\u6c60-imi","pageTitle":"\u8fdb\u7a0b\u6c60-imi","url":"components\/process-pool\/imi.html","content":"\u8fdb\u7a0b\u6c60-imiimi \u5b9e\u73b0\u4e86\u4e00\u4e2a\u53ef\u4ee5\u66ff\u4ee3 Swoole \u8fdb\u7a0b\u6c60\u7684\u66f4\u5f3a\u5927\u7684\u8fdb\u7a0b\u6c60\u3002\u652f\u6301\u4fe1\u53f7\u76d1\u542c\u3001\u91cd\u542f\u8fdb\u7a0b\uff08\u53ef\u6307\u5b9a\uff09\u3001Pool Master \u4e0e Worker \u6d88\u606f\u901a\u8baf\u7b49\u3002\u57fa\u4e8e Swoole\\Process \u5b9e\u73b0\uff0c\u5185\u90e8\u5df2\u5b9e\u73b0\u4e86\u4fe1\u53f7\u76d1\u542c\u3002\u4f7f\u7528$workerNum = 4;\n$processPool = new \\Imi\\Process\\Pool($workerNum);\n\/\/ \u521d\u59cb\u5316\u4e8b\u4ef6-\u53ef\u9009\n$processPool-&gt;on(&#039;Init&#039;, function(\\Imi\\Process\\Pool\\InitEventParam $e){\n    var_dump(&#039;init&#039;);\n});\n\/\/ \u5de5\u4f5c\u8fdb\u7a0b\u5f00\u59cb\u4e8b\u4ef6-\u5fc5\u9009\n$processPool-&gt;on(&#039;WorkerStart&#039;, function(\\Imi\\Process\\Pool\\WorkerEventParam $e){\n    \/\/ \u4e1a\u52a1\u4ee3\u7801\u5199\u8fd9\n    while(true)\n    {\n        \/\/ \u7ed9 master \u8fdb\u7a0b\u53d1\u6d88\u606f\n        $e-&gt;getWorker()-&gt;sendMessage(&#039;test&#039;, [\n            &#039;time&#039;  =&gt;  time(),\n        ]);\n        sleep(3);\n    }\n});\n\/\/ \u5de5\u4f5c\u8fdb\u7a0b\u9000\u51fa\u4e8b\u4ef6-\u53ef\u9009\n$processPool-&gt;on(&#039;WorkerExit&#039;, function(\\Imi\\Process\\Pool\\WorkerEventParam $e){\n    \/\/ \u505a\u4e00\u4e9b\u91ca\u653e\u64cd\u4f5c\n});\n\/\/ \u5de5\u4f5c\u8fdb\u7a0b\u505c\u6b62\u4e8b\u4ef6-\u53ef\u9009\n$processPool-&gt;on(&#039;WorkerStop&#039;, function(\\Imi\\Process\\Pool\\WorkerEventParam $e){\n\n});\n\/\/ \u5de5\u4f5c\u8fdb\u7a0b\u505c\u6b62\u4e8b\u4ef6-\u53ef\u9009\n$processPool-&gt;on(&#039;Message&#039;, function(\\Imi\\Process\\Pool\\MessageEventParam $e){\n    $data = $e-&gt;getData();\n     \/\/ $data[&#039;a&#039;] \u7ea6\u5b9a\u662f\u64cd\u4f5c\u540d\uff0c\u5176\u5b83\u6210\u5458\u4e3a\u53c2\u6570\n    switch($data[&#039;a&#039;])\n    {\n        case &#039;test&#039;:\n            \/\/ \u505a\u4e00\u4e9b\u4e8b\n            var_dump($e-&gt;getWorkerId() . &#039;:&#039; . $data[&#039;time&#039;]);\n            break;\n    }\n});\n$processPool-&gt;start(); \/\/ \u542f\u52a8\n\/\/ $processPool-&gt;shutdown(); \/\/ \u505c\u6b62\u91cd\u542f\u8fdb\u7a0b\u91cd\u542f\u6240\u6709\u8fdb\u7a0b\uff1a$processPool-&gt;restartAllWorker();\u91cd\u542f\u90e8\u5206\u8fdb\u7a0b\uff1a\/\/ \u91cd\u542f workerId \u4e3a 0\u30013 \u7684\u8fdb\u7a0b\n$processPool-&gt;restartWorker(0, 3);"},{"id":120,"title":"\u8fdb\u7a0b\u6c60-Swoole","pageTitle":"\u8fdb\u7a0b\u6c60-Swoole","url":"components\/process-pool\/swoole.html","content":"\u8fdb\u7a0b\u6c60-Swooleimi \u4e2d\u5bf9\u8fdb\u7a0b\u6c60\u7684\u521b\u5efa\u548c\u8fd0\u884c\u505a\u4e86\u7b80\u5355\u5c01\u88c5\uff0c\u57fa\u4e8eSwoole\\Process\\Pool\u5b9e\u73b0\u3002\u5b9a\u4e49\u8fdb\u7a0b\u6c60&lt;?php\nnamespace XinchengApi\\api\\ProcessPool;\n\nuse Imi\\Process\\Annotation\\ProcessPool;\n\n\/**\n * @ProcessPool(name=&quot;\u8fdb\u7a0b\u540d\u79f0&quot;)\n *\/\nclass Sms extends \\Imi\\Process\\BasePoolProcess\n{\n    public function run(\\Swoole\\Process\\Pool $pool, int $workerId, $name, $workerNum, $args, $ipcType, $msgQueueKey)\n    {\n        \/\/ \u505a\u4e00\u4e9b\u4e8b\u60c5\n    }\n}\u91ca\u653e\u8fde\u63a5\u6c60\u56e0\u4e3a\u6211\u4eec\u6709\u4e9b\u8fdb\u7a0b\u662f\u7528\u4e0d\u5230\uff0c\u6216\u8005\u4e0d\u9700\u8981\u6240\u6709\u8fdb\u7a0b\u6c60\u7684\u3002\u8fdb\u7a0b\u6c60\u8d44\u6e90\u8fde\u7740\u4e5f\u662f\u6d6a\u8d39\uff0c\u6240\u6709\u63d0\u4f9b\u4e00\u4e2a\u6ce8\u89e3\uff0c\u7528\u4ee5\u91ca\u653e\u3002\u5728 run() \u65b9\u6cd5\u4e0a\u4f7f\u7528 @PoolClean \u6ce8\u89e3\u5373\u53ef\uff0c\u7c7b\uff1aImi\\Pool\\Annotation\\PoolClean@PoolClean \u53c2\u6570\uff1amode \u6a21\u5f0f\uff0callow-\u767d\u540d\u5355\uff0cdeny-\u9ed1\u540d\u5355list=[] \u8fde\u63a5\u6c60\u540d\u79f0\u5217\u8868\u3002mode=allow\u5219\u4e3a\u4fdd\u7559\u7684\u8fde\u63a5\u6c60\uff0cmode=deny\u5219\u4e3a\u5173\u95ed\u7684\u8fde\u63a5\u6c60\u6ce8\u89e3@ProcessPool\/**\n * \u8fdb\u7a0b\u6c60\u540d\u79f0\n * @var string\n *\/\npublic $name;\n\n\/**\n * \u8fdb\u7a0b\u6570\u91cf\n *\n * @var int\n *\/\npublic $workerNum = 1;\n\n\/**\n * \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u4e0d\u4f7f\u7528\u4efb\u4f55\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7279\u6027\n *\n * @var integer\n *\/\npublic $ipcType = 0;\n\n\/**\n * \u6d88\u606f\u961f\u5217key\n *\n * @var string\n *\/\npublic $msgQueueKey = null;\u521b\u5efa\u8fdb\u7a0b\u6c60\u901a\u8fc7\u6ce8\u89e3\u4e2d\u7684\u8fdb\u7a0b\u540d\u79f0\u521b\u5efa\u8fdb\u7a0b\uff0c\u8fd4\u56de\\Swoole\\Process\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u9700\u8981\u624b\u52a8\u8c03\u7528start()\u65b9\u6cd5\u6765\u8fd0\u884c\u8fdb\u7a0b\u3002\/**\n * \u521b\u5efa\u8fdb\u7a0b\u6c60\n * \u672c\u65b9\u6cd5\u65e0\u6cd5\u5728\u63a7\u5236\u5668\u4e2d\u4f7f\u7528\n * \u8fd4\u56de\\Swoole\\Process\\Pool\u5bf9\u8c61\u5b9e\u4f8b\n * \n * @param string $name\n * @param int $workerNum \u6307\u5b9a\u5de5\u4f5c\u8fdb\u7a0b\u7684\u6570\u91cf\n * @param array $args\n * @param int $ipcType \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u4e0d\u4f7f\u7528\u4efb\u4f55\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7279\u6027\n * @param string $msgQueueKey\n * @return \\Swoole\\Process\\Pool\n *\/\npublic static function create($name, $workerNum = null, $args = [], $ipcType = 0, $msgQueueKey = null): \\Swoole\\Process\\Pool\u542f\u52a8\u8fde\u63a5\u6c60\u8fdb\u7a0b\u547d\u4ee4\uff1abin\/imi process\/pool -name \u8fdb\u7a0b\u540d\u5176\u5b83\u53c2\u6570\u53ef\u52a0\u4e0a-h\u53c2\u6570\u67e5\u770b"},{"id":134,"title":"\u9650\u6d41","pageTitle":"\u9650\u6d41","url":"components\/rate-limit.html","content":"\u9650\u6d41\u4ecb\u7ecdimi-rate-limit \u662f imi \u6846\u67b6\u7684\u9650\u6d41\u7ec4\u4ef6\uff0c\u57fa\u4e8e bandwidth-throttle\/token-bucket \u5f00\u53d1\u3002\u672c\u7ec4\u4ef6\u4ec5\u652f\u6301\u4f7f\u7528 Redis \u4f5c\u4e3a\u4e2d\u95f4\u4ef6\uff0c\u53ef\u4ee5\u9488\u5bf9\u65b9\u6cd5\u3001\u63a5\u53e3\u8bbe\u7f6e\u9650\u6d41\uff0c\u901a\u8fc7\u8bbe\u7f6e\u603b\u5bb9\u91cf\u3001\u5355\u4f4d\u65f6\u95f4\u5185\u751f\u6210\u586b\u5145\u7684\u6570\u91cf\u3001\u6bcf\u6b21\u6263\u9664\u6570\u91cf\u5b9e\u73b0\u9650\u6d41\u3002Composer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-rate-limit&quot;: &quot;~1.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u963f\u91cc\u4e91\u96c6\u7fa4\u7528\u6237\uff0c\u8bf7\u628a script_check_enable \u8bbe\u7f6e\u6539\u4e3a 0\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;RateLimit&#039;    =&gt;  &#039;Imi\\RateLimit&#039;,\n    ],\n    &#039;pools&#039;    =&gt;    [\n        \/\/ \u4e00\u5b9a\u5f97\u8981\u914d\u7f6e Redis \u8fde\u63a5\u6c60\u624d\u53ef\u4ee5\u7528\n    ],\n    &#039;redis&#039; =&gt;  [\n        &#039;defaultPool&#039;   =&gt;  &#039;redis\u8fde\u63a5\u6c60\u540d\u79f0&#039;,\n    ],\n]\u4f7f\u7528\uff1a\/**\n * \u9650\u5236\u6bcf\u79d2\u540c\u65f6\u8bbf\u95ee 3 \u6b21\n * \n * @Action\n * \n * @RateLimit(name=&quot;test1&quot;, capacity=3)\n *\n * @return void\n *\/\npublic function test1()\n{\n    return [\n        &#039;data&#039;  =&gt;  &#039;test1&#039;,\n    ];\n}\n\n\/**\n * \u9650\u5236\u6bcf\u79d2\u540c\u65f6\u8bbf\u95ee 1 \u6b21\uff0c\u7b49\u5f85\u89e3\u9664\u9650\u5236\u540e\u7ee7\u7eed\u6267\u884c\uff0c\u8d85\u65f6\u65f6\u95f4\u4e3a 1 \u79d2\n * \n * @Action\n * \n * @RateLimit(name=&quot;test2&quot;, capacity=1)\n * @BlockingConsumer(1)\n *\n * @return void\n *\/\npublic function test2()\n{\n    return [\n        &#039;data&#039;  =&gt;  &#039;test2&#039;,\n    ];\n}\n\n\/**\n * \u603b\u5bb9\u91cf\u4e3a 1000\uff0c\u6bcf\u6beb\u79d2\u586b\u5145 1\uff0c\u6bcf\u6b21\u8c03\u7528\u6263\u9664 500\n * \n * \u81ea\u5b9a\u4e49\u5904\u7406\u9650\u5236\n * \n * @Action\n * \n * @RateLimit(name=&quot;test3&quot;, capacity=1000, fill=1, unit=&quot;millisecond&quot;, deduct=500, callback=&quot;\\ImiDemo\\HttpDemo\\Util\\RateLimitParser::parse&quot;)\n *\n * @return void\n *\/\npublic function test3()\n{\n    return [\n        &#039;data&#039;  =&gt;  &#039;test3&#039;,\n    ];\n}\n\n\/**\n * \u624b\u52a8\u8c03\u7528\u9650\u6d41\n * \n * \u603b\u5bb9\u91cf\u4e3a 1000\uff0c\u6bcf\u6beb\u79d2\u586b\u5145 1\uff0c\u6bcf\u6b21\u8c03\u7528\u6263\u9664 500\n *\n * @Action\n * \n * @return void\n *\/\npublic function test4()\n{\n    if(true !== $result = RateLimiter::limit(&#039;test4&#039;, 1000, function(){\n        \/\/ \u81ea\u5b9a\u4e49\u56de\u8c03\u4e2d\u7684\u8fd4\u56de\u503c\uff0c\u4f1a\u4f5c\u4e3a\u539f\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u88ab\u8fd4\u56de\n        return [\n            &#039;message&#039;   =&gt;  &#039;\u81ea\u5b9a\u4e49\u89e6\u53d1\u9650\u6d41\u8fd4\u56de\u5185\u5bb9&#039;,\n        ];\n    }, 1, &#039;millisecond&#039;, 500))\n    {\n        return $result;\n    }\n    return [\n        &#039;data&#039;  =&gt;  &#039;test4&#039;,\n    ];\n}\n\n\/**\n * \u624b\u52a8\u8c03\u7528\u9650\u6d41\n * \n * \u9650\u5236\u6bcf\u79d2\u540c\u65f6\u8bbf\u95ee 1 \u6b21\uff0c\u7b49\u5f85\u89e3\u9664\u9650\u5236\u540e\u7ee7\u7eed\u6267\u884c\uff0c\u8d85\u65f6\u65f6\u95f4\u4e3a 1 \u79d2\n *\n * @Action\n * \n * @return void\n *\/\npublic function test5()\n{\n    if(true !== $result = RateLimiter::limitBlock(&#039;test5&#039;, 1, function(){\n        \/\/ \u81ea\u5b9a\u4e49\u56de\u8c03\u4e2d\u7684\u8fd4\u56de\u503c\uff0c\u4f1a\u4f5c\u4e3a\u539f\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u88ab\u8fd4\u56de\n        return [\n            &#039;message&#039;   =&gt;  &#039;\u81ea\u5b9a\u4e49\u89e6\u53d1\u9650\u6d41\u8fd4\u56de\u5185\u5bb9&#039;,\n        ];\n    }, 1, 1, &#039;second&#039;, 1))\n    {\n        return $result;\n    }\n    return [\n        &#039;data&#039;  =&gt;  &#039;test5&#039;,\n    ];\n}"},{"id":99,"title":"Redis","pageTitle":"Redis","url":"components\/redis\/index.html","content":"RedisRedis \u8fde\u63a5\u6c60\u914d\u7f6e\u65b9\u5f0f\u5df2\u7ecf\u5728\u8fde\u63a5\u6c60\u91cc\u8bb2\u8fc7\uff0c\u8fd9\u91cc\u5c31\u4e0d\u91cd\u590d\u4e86\uff0c\u76f4\u63a5\u8bf4\u4f7f\u7528\u65b9\u6cd5\u3002\u8fde\u63a5\u6c60\u914d\u7f6e\u6807\u51c6\u5199\u6cd5\uff1a\u4ece imi v1.2.1 \u7248\u672c\u5f00\u59cb\u652f\u6301\n&lt;?php\nreturn [\n    &#039;redis&#039;    =&gt;    [\n        &#039;defaultPool&#039;    =&gt;    &#039;alias1&#039;, \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\n        &#039;quickFromRequestContext&#039;    =&gt;    true, \/\/ \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u83b7\u53d6\u516c\u7528\u8fde\u63a5\n    ],\n    &#039;pools&#039; =&gt; [\n        \/\/ \u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;alias1&#039; =&gt; [\n            &#039;pool&#039; =&gt; [\n                \/\/ \u540c\u6b65\u6c60\u7c7b\u540d\n                &#039;syncClass&#039;     =&gt;    \\Imi\\Redis\\SyncRedisPool::class,\n                \/\/ \u534f\u7a0b\u6c60\u7c7b\u540d\n                &#039;asyncClass&#039;    =&gt;    \\Imi\\Redis\\CoroutineRedisPool::class,\n                &#039;config&#039; =&gt; [\n                    \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                    \/\/ &#039;maxResources&#039; =&gt; 10,\n                    \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                    \/\/ &#039;minResources&#039; =&gt; 2,\n                    \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;gcInterval&#039; =&gt; 60,\n                    \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;maxActiveTime&#039; =&gt; 3600,\n                    \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                    \/\/ &#039;waitTimeout&#039; =&gt; 3000,\n                    \/\/ \u5fc3\u8df3\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                    \/\/ &#039;heartbeatInterval&#039; =&gt; null,\n                    \/\/ \u5f53\u83b7\u53d6\u8d44\u6e90\u65f6\uff0c\u662f\u5426\u68c0\u67e5\u72b6\u6001\n                    \/\/ &#039;checkStateWhenGetResource&#039; =&gt; true,\n                    \/\/ \u6bcf\u6b21\u83b7\u53d6\u8d44\u6e90\u6700\u957f\u4f7f\u7528\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                    \/\/ &#039;maxUsedTime&#039; =&gt; null,\n                    \/\/ \u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u68c0\u67e5\u72b6\u6001\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u652f\u6301\u5c0f\u6570\u7684\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                    \/\/ &#039;requestResourceCheckInterval&#039; =&gt; 30,\n                    \/\/ \u8d1f\u8f7d\u5747\u8861-\u8f6e\u6d41\n                    \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::TURN,\n                    \/\/ \u8d1f\u8f7d\u5747\u8861-\u968f\u673a\n                    \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::RANDOM,\n                ],\n            ],\n            \/\/ \u6570\u7ec4\u8d44\u6e90\u914d\u7f6e\n            &#039;resource&#039; =&gt; [\n                \/\/ --- \u5355\u673a\u6a21\u5f0f\u914d\u7f6e ---\n                \/\/ &#039;mode&#039; =&gt; \\Imi\\Redis\\Enum\\RedisMode::STANDALONE,\n                \/\/ &#039;host&#039;    =&gt;    &#039;127.0.0.1&#039;,\n                \/\/ &#039;port&#039;    =&gt;    6379,\n                \/\/ \u662f\u5426\u81ea\u52a8\u5e8f\u5217\u5316\u53d8\u91cf\n                \/\/ &#039;serialize&#039;    =&gt;    true,\n                \/\/ \u5bc6\u7801\n                \/\/ &#039;password&#039;    =&gt;    null,\n                \/\/ \u7b2c\u51e0\u4e2a\u5e93\n                \/\/ &#039;db&#039;    =&gt;    0,\n\n                \/\/ --- \u54e8\u5175\u6a21\u5f0f\u914d\u7f6e ---\n                &#039;mode&#039; =&gt; \\Imi\\Redis\\Enum\\RedisMode::SENTINEL,\n                &#039;master&#039; =&gt; &#039;master \u540d\u79f0&#039;,\n                &#039;nodes&#039; =&gt; [\n                    \/\/ \u652f\u6301\u4e24\u79cd\u683c\u5f0f\n                    \/\/ \u683c\u5f0f\u4e00\n                    &#039;127.0.0.1:6379&#039;,\n                    \/\/ \u683c\u5f0f\u4e8c\n                    [\n                        &#039;host&#039; =&gt; &#039;127.0.0.1&#039;\n                        &#039;port&#039; =&gt; 6379,\n                    ],\n                ],\n                &#039;timeout&#039; =&gt; null,\n                &#039;retryInterval&#039; =&gt; null,\n                &#039;readTimeout&#039; =&gt; null,\n\n                \/\/ --- \u96c6\u7fa4\u6a21\u5f0f\u914d\u7f6e ---\n                &#039;mode&#039; =&gt; \\Imi\\Redis\\Enum\\RedisMode::CLUSTER,\n                &#039;seeds&#039; =&gt; [\n                    &#039;127.0.0.1:6379&#039;,\n                    &#039;127.0.0.1:6380&#039;,\n                ],\n                &#039;name&#039; =&gt; null,\n                &#039;persistent&#039; =&gt; null,\n                &#039;timeout&#039; =&gt; null,\n                &#039;readTimeout&#039; =&gt; null,\n            ],\n            \/\/ uri\u8d44\u6e90\u914d\u7f6e\uff0c\u4ee5\u5206\u53f7;\u5206\u9694\u591a\u4e2a\uff0c\u53c2\u6570\u4f7f\u7528query\u53c2\u6570\u683c\u5f0f\uff0c\u7279\u6b8a\u5b57\u7b26\u9700\u8981\u8f6c\u7801\n            \/\/ &#039;resource&#039;  =&gt;  &#039;tcp:\/\/192.168.0.222&amp;timeout=60;tcp:\/\/192.168.0.222&#039;,\n        ],\n    ],\n];\u65e7\u5199\u6cd5\uff1a\u4f9d\u7136\u652f\u6301\uff0c\u4f46\u4e0d\u518d\u63a8\u8350&lt;?php\nreturn [\n    &#039;redis&#039;    =&gt;    [\n        &#039;defaultPool&#039;    =&gt;    &#039;alias1&#039;, \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\n        &#039;quickFromRequestContext&#039;    =&gt;    true, \/\/ \u4ece\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u83b7\u53d6\u516c\u7528\u8fde\u63a5\n    ],\n    &#039;pools&#039; =&gt; [\n        \/\/ \u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;alias1&#039; =&gt; [\n            \/\/ \u540c\u6b65\u6c60\u5b50\uff0ctask\u8fdb\u7a0b\u4f7f\u7528\n            &#039;sync&#039; =&gt; [\n                &#039;pool&#039; =&gt; [\n                    &#039;class&#039;        =&gt;    \\Imi\\Redis\\SyncRedisPool::class,\n                    &#039;config&#039; =&gt; [\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u591a\u8d44\u6e90\u6570\n                        \/\/ &#039;maxResources&#039; =&gt; 10,\n                        \/\/ \u6c60\u5b50\u4e2d\u6700\u5c11\u8d44\u6e90\u6570\n                        \/\/ &#039;minResources&#039; =&gt; 2,\n                        \/\/ \u8d44\u6e90\u56de\u6536\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;gcInterval&#039; =&gt; 60,\n                        \/\/ \u83b7\u53d6\u8d44\u6e90\u6700\u5927\u5b58\u6d3b\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;maxActiveTime&#039; =&gt; 3600,\n                        \/\/ \u7b49\u5f85\u8d44\u6e90\u6700\u5927\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                        \/\/ &#039;waitTimeout&#039; =&gt; 3000,\n                        \/\/ \u5fc3\u8df3\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n                        \/\/ &#039;heartbeatInterval&#039; =&gt; null,\n                        \/\/ \u5f53\u83b7\u53d6\u8d44\u6e90\u65f6\uff0c\u662f\u5426\u68c0\u67e5\u72b6\u6001\n                        \/\/ &#039;checkStateWhenGetResource&#039; =&gt; true,\n                        \/\/ \u6bcf\u6b21\u83b7\u53d6\u8d44\u6e90\u6700\u957f\u4f7f\u7528\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                        \/\/ &#039;maxUsedTime&#039; =&gt; null,\n                        \/\/ \u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u8d44\u6e90\u68c0\u67e5\u72b6\u6001\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u652f\u6301\u5c0f\u6570\u7684\u79d2\uff1b\u4e3a null \u5219\u4e0d\u9650\u5236\n                        \/\/ &#039;requestResourceCheckInterval&#039; =&gt; 30,\n                        \/\/ \u8d1f\u8f7d\u5747\u8861-\u8f6e\u6d41\n                        \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::TURN,\n                        \/\/ \u8d1f\u8f7d\u5747\u8861-\u968f\u673a\n                        \/\/ &#039;resourceConfigMode&#039; =&gt; ResourceConfigMode::RANDOM,\n                    ],\n                ],\n                &#039;resource&#039; =&gt; [\n                    \/\/ &#039;host&#039;    =&gt;    &#039;127.0.0.1&#039;,\n                    \/\/ &#039;port&#039;    =&gt;    6379,\n                    \/\/ \u662f\u5426\u81ea\u52a8\u5e8f\u5217\u5316\u53d8\u91cf\n                    \/\/ &#039;serialize&#039;    =&gt;    true,\n                    \/\/ \u5bc6\u7801\n                    \/\/ &#039;password&#039;    =&gt;    null,\n                    \/\/ \u7b2c\u51e0\u4e2a\u5e93\n                    \/\/ &#039;db&#039;    =&gt;    0,\n                ],\n            ],\n            \/\/ \u5f02\u6b65\u6c60\u5b50\uff0cworker\u8fdb\u7a0b\u4f7f\u7528\n            &#039;async&#039; =&gt; [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\Redis\\CoroutineRedisPool::class,\n                    &#039;config&#039;    =&gt;    [\n                        \/\/ \u540c\u4e0a\n                    ],\n                ],\n                \/\/ uri\u65b9\u5f0f\uff0c\u4ee5\u5206\u53f7;\u5206\u9694\u591a\u4e2a\uff0c\u53c2\u6570\u4f7f\u7528query\u53c2\u6570\u683c\u5f0f\uff0c\u7279\u6b8a\u5b57\u7b26\u9700\u8981\u8f6c\u7801\n                &#039;resource&#039;  =&gt;  &#039;tcp:\/\/192.168.0.222&amp;timeout=60;tcp:\/\/192.168.0.222&#039;,\n            ],\n        ]\n    ],\n];\u57fa\u672c\u4f7f\u7528\u4e0e\u539f\u751f Redis \u7c7b\u64cd\u4f5c\u65b9\u5f0f\u57fa\u672c\u4e00\u81f4\uff0c\u8fd9\u91cc\u65e0\u9700\u591a\u8bf4\u3002\u83b7\u53d6\u5bf9\u8c61use \\Imi\\Redis\\RedisManager;\n$redis = RedisManager::getInstance();\n$redis-&gt;set(&#039;imi:redis:test&#039;, date(&#039;Y-m-d H:i:s&#039;));\n$datetime = $redis-&gt;get(&#039;imi:redis:test&#039;);\u83b7\u53d6\u65b0\u5bf9\u8c61\u6bcf\u6b21\u8c03\u7528\u90fd\u5c1d\u8bd5\u4ece\u8fde\u63a5\u6c60\u4e2d\u83b7\u53d6\u65b0\u7684\u5bf9\u8c61\uff0c\u8981\u6ce8\u610f\u6bcf\u6b21\u7528\u5b8c\u9700\u8981\u624b\u52a8\u91ca\u653e\uff01use \\Imi\\Redis\\RedisManager;\n$redis = RedisManager::getNewInstance();\n\/\/ $redis = RedisManager::getNewInstance($poolName);\nRedisManager::release($redis);\u83b7\u53d6\u9ed8\u8ba4\u8fde\u63a5\u6c60\u540d\u79f0use \\Imi\\Redis\\RedisManager;\necho RedisManager::getDefaultPoolName();\u4fbf\u6377\u64cd\u4f5cRedis::\u65b9\u6cd5\u540d()use \\Imi\\Redis\\Redis;\nRedis::set(&#039;imi:redis:test&#039;, date(&#039;Y-m-d H:i:s&#039;));\n$datetime = Redis::get(&#039;imi:redis:test&#039;);\u56de\u8c03\u65b9\u5f0f\u4f7f\u7528Redis$result = Redis::use(function(\\Imi\\Redis\\RedisHandler $redis){\n    $redis-&gt;set(&#039;a&#039;, 1);\n    return true;\n}); \/\/ true\u8fdb\u9636\u4f7f\u7528$redis = RedisManager::getInstance();\n$redis-&gt;\u65b9\u6cd5\u540d();\u6216\\Imi\\Redis\\Redis::\u65b9\u6cd5\u540d();evalEximi \u5c01\u88c5\u4e86\u4e00\u4e2a\u57fa\u4e8e evalSha \u548c eval \u7684\u4fbf\u6377\u65b9\u6cd5\uff0c\u4f18\u5148\u4f7f\u7528 evalSha \u5c1d\u8bd5\uff0c\u5931\u8d25\u5219\u4f7f\u7528 eval \u65b9\u6cd5\u3002\u5b9a\u4e49\uff1apublic function evalEx($script, $args = null, $num_keys = null)return false !== $redis-&gt;evalEx(&lt;&lt;&lt;SCRIPT\nredis.call(&#039;set&#039;, &#039;a&#039;, &#039;123&#039;)\nreturn redis.call(&#039;get&#039;, &#039;a&#039;)\nSCRIPT\n    );scanEachscan \u65b9\u6cd5\u7684\u6269\u5c55\u7b80\u6613\u904d\u5386\u65b9\u6cd5\u53c2\u6570\u4e0e scan \u57fa\u672c\u4e00\u81f4\uff0c\u65e0\u9700\u4f20\u9012 it \u53c2\u6570foreach(Redis::scanEach(&#039;imi:scanEach:*&#039;, 10) as $value)\n{\n    var_dump($value);\n}hscanEachhscan \u65b9\u6cd5\u7684\u6269\u5c55\u7b80\u6613\u904d\u5386\u65b9\u6cd5\u53c2\u6570\u4e0e hscan \u57fa\u672c\u4e00\u81f4\uff0c\u65e0\u9700\u4f20\u9012 it \u53c2\u6570foreach(Redis::hscanEach($key, &#039;value:*&#039;, 10) as $k =&gt; $value)\n{\n    var_dump($k, $value);\n}sscanEachsscan \u65b9\u6cd5\u7684\u6269\u5c55\u7b80\u6613\u904d\u5386\u65b9\u6cd5\u53c2\u6570\u4e0e sscan \u57fa\u672c\u4e00\u81f4\uff0c\u65e0\u9700\u4f20\u9012 it \u53c2\u6570foreach(Redis::sscanEach($key, &#039;*&#039;, 10) as $value)\n{\n    var_dump($value);\n}zscanEachzscan \u65b9\u6cd5\u7684\u6269\u5c55\u7b80\u6613\u904d\u5386\u65b9\u6cd5\u53c2\u6570\u4e0e zscan \u57fa\u672c\u4e00\u81f4\uff0c\u65e0\u9700\u4f20\u9012 it \u53c2\u6570foreach(Redis::zscanEach($key, &#039;*&#039;, 10) as $score)\n{\n    var_dump($value);\n}"},{"id":110,"title":"\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4ee3\u7406\uff08RequestContextProxy\uff09","pageTitle":"\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4ee3\u7406\uff08RequestContextProxy\uff09","url":"components\/requestContextProxy\/index.html","content":"\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4ee3\u7406\uff08RequestContextProxy\uff09\u53ef\u4ee5\u4ee3\u7406\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4e2d\u7684\u6570\u636e\uff0c\u652f\u6301\u9759\u6001\u65b9\u6cd5\u8c03\u7528\u548c\u5bf9\u8c61\u65b9\u6cd5\u8c03\u7528\u3002\u793a\u4f8b\u5047\u8bbe\u6709\u8fd9\u4e48\u4e00\u4e2a\u7c7b\uff1a&lt;?php\n\nnamespace Imi\\Test\\Component\\RequestContextProxy;\n\nclass A\n{\n    public function add($a, $b)\n    {\n        return $a + $b;\n    }\n}\n\u5b9a\u4e49\u4ee3\u7406\u7c7b RequestContextProxy\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\RequestContextProxy;\n\nuse Imi\\RequestContextProxy\\BaseRequestContextProxy;\nuse Imi\\RequestContextProxy\\Annotation\\RequestContextProxy;\n\n\/**\n * @RequestContextProxy(class=&quot;Imi\\Test\\Component\\RequestContextProxy\\A&quot;, name=&quot;testRequestContextProxyA&quot;)\n * @method mixed add($a, $b)\n * @method static mixed add($a, $b)\n *\/\nclass RequestContextProxyA extends BaseRequestContextProxy\n{\n\n}\n\u7ee7\u627f Imi\\RequestContextProxy\\BaseRequestContextProxy \u7c7b\uff0c\u7136\u540e\u4f7f\u7528@RequestContextProxy\u6ce8\u89e3\u7c7b\u5b9a\u4e49\u7ed1\u5b9a\u5230\u4e0a\u4e0b\u6587\u7684\u540d\u79f0\u3002\u4f7f\u7528\u65b9\u5f0f\uff1ause Imi\\Test\\Component\\RequestContextProxy\\RequestContextProxyA;\nRequestContextProxyA::add(1, 2); \/\/ 3\n\n\/\/ \u4e5f\u53ef\u4ee5\u5b9e\u4f8b\u5316\u540e\u4f7f\u7528\n$a = new RequestContextProxyA();\n$a-&gt;add(2, 3); \/\/ 5\n\n\/\/ \u83b7\u53d6\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4e2d\u7684\u5b9e\u4f8b\n$a = RequestContextProxyA::__getProxyInstance();\n$a-&gt;add(2, 3); \/\/ 5\n\n\/\/ \u8bbe\u7f6e\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4e2d\u7684\u5b9e\u4f8b\nRequestContextProxyA::__setProxyInstance($a);@RequestContextProxy \u6ce8\u89e3class RequestContextProxy extends Base\n{\n    \/**\n     * \u53ea\u4f20\u4e00\u4e2a\u53c2\u6570\u65f6\u7684\u53c2\u6570\u540d.\n     *\n     * @var string\n     *\/\n    protected $defaultFieldName = &#039;name&#039;;\n\n    \/**\n     * \u4ee3\u7406\u7c7b\u540d.\n     *\n     * @var string\n     *\/\n    public $class;\n\n    \/**\n     * \u8bf7\u6c42\u4e0a\u4e0b\u6587\u4e2d\u7684\u540d\u79f0.\n     *\n     * @var string\n     *\/\n    public $name;\n}RequestContextProxy \u751f\u6210\u5668\u67e5\u770b\u5e2e\u52a9\uff1aimi generate\/requestContextProxy -h"},{"id":126,"title":"gRPC","pageTitle":"gRPC","url":"components\/rpc\/grpc.html","content":"gRPC\u4ecb\u7ecd\u5728 imi \u6846\u67b6\u4e2d\u96c6\u6210 gRPC \u670d\u52a1\u5f00\u53d1\u3001\u5ba2\u6237\u7aef\u8c03\u7528\u53ca\u8fde\u63a5\u6c60\u3002\u901a\u8baf\u534f\u8bae\u4e3a\u4e8c\u8fdb\u5236\u7684 Protobuf\u3002Github: https:\/\/github.com\/imiphp\/imi-grpcComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-grpc&quot;: &quot;^1.0.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u8bf4\u660e\u53ef\u4ee5\u53c2\u8003 https:\/\/github.com\/imiphp\/imi-grpc\/tree\/master\/example \u76ee\u5f55\u793a\u4f8b\uff0c\u5305\u62ec\u5b8c\u6574\u7684\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u8c03\u7528\u3002\u670d\u52a1\u548c\u6d88\u606f\u683c\u5f0f\u5b9a\u4e49gRPC \u548c Protobuf \u662f\u9ec4\u91d1\u642d\u6863\uff0cProtobuf \u662f\u7528\u6765\u505a\u901a\u8baf\u6d88\u606f\u683c\u5f0f\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u5de5\u4f5c\u3002gRPC \u901a\u8baf\u6709\u8bf7\u6c42\uff08Request\uff09\u6d88\u606f\u548c\u54cd\u5e94\uff08Response\uff09\u6d88\u606f\uff0c\u4ece\u8bf7\u6c42\u6d88\u606f\u4e2d\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\uff0c\u901a\u8fc7\u54cd\u5e94\u6d88\u606f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u5b9a\u4e49\u53c2\u8003\uff1aexample\/grpc\/grpc.protosyntax = &quot;proto3&quot;;\n\npackage grpc;\noption php_generic_services = true;\n\nservice AuthService {\n    rpc Login (LoginRequest) returns (LoginResponse);\n}\n\nmessage LoginRequest {\n    string phone = 1;       \/\/ \u624b\u673a\u53f7\n    string password = 2;    \/\/ \u5bc6\u7801\n}\n\nmessage LoginResponse {\n    bool success = 1;       \/\/ \u662f\u5426\u6210\u529f\n    string error = 2;       \/\/ \u9519\u8bef\u4fe1\u606f\n}\u5b9a\u4e49\u597d\u540e\uff0c\u901a\u8fc7\u547d\u4ee4\u751f\u6210 PHP \u6587\u4ef6\uff1aprotoc --php_out=.\/ grpc.protoprotoc \u4e0b\u8f7d\u548c\u5b89\u88c5\uff1ahttps:\/\/github.com\/protocolbuffers\/protobuf\/releases\u670d\u52a1\u7aef\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165RPC\u7ec4\u4ef6\u4ee5\u53ca\u672c\u7ec4\u4ef6\n        &#039;Rpc&#039;   =&gt;  &#039;Imi\\Rpc&#039;,\n        &#039;Grpc&#039;  =&gt;  &#039;Imi\\Grpc&#039;,\n    ],\n]\u5982\u679c\u4f60\u7528\u4e3b\u670d\u52a1\u5668\uff1a[\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n    &#039;mainServer&#039;    =&gt;  [\n        &#039;namespace&#039; =&gt;    &#039;ImiApp\\GrpcServer&#039;,\n        &#039;type&#039;      =&gt;    &#039;Grpc&#039;,\n        &#039;host&#039;      =&gt;    &#039;127.0.0.1&#039;,\n        &#039;port&#039;      =&gt;    8080,\n    ],\n]\u5982\u679c\u4f60\u7528\u5b50\u670d\u52a1\u5668\uff1a[\n    \/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n    &#039;subServers&#039;    =&gt;  [\n        \/\/ \u5b50\u670d\u52a1\u5668\u540d\n        &#039;XXX&#039;   =&gt;  [\n            &#039;namespace&#039; =&gt;    &#039;ImiApp\\GrpcServer&#039;,\n            &#039;type&#039;      =&gt;    &#039;Grpc&#039;,\n            &#039;host&#039;      =&gt;    &#039;127.0.0.1&#039;,\n            &#039;port&#039;      =&gt;    8080,\n        ]\n    ],\n]\u63a7\u5236\u5668\u5199\u6cd5\u4e0e Http Api \u51e0\u4e4e\u4e00\u81f4\u3002\u6807\u51c6 gRPC Url \u683c\u5f0f\u4e3a\uff1ahttp:\/\/host:port\/{package}.{service}\/{method}\/**\n * @Controller(&quot;\/grpc.AuthService\/&quot;)\n *\/\nclass AuthServiceController extends HttpController implements AuthServiceInterface\n{\n    \/**\n     * Method &lt;code&gt;login&lt;\/code&gt;\n     *\n     * @Action\n     * \n     * @param \\Grpc\\LoginRequest $request\n     * @return \\Grpc\\LoginResponse\n     *\/\n    public function login(\\Grpc\\LoginRequest $request)\n    {\n        $response = new LoginResponse;\n        $success = &#039;12345678901&#039; === $request-&gt;getPhone() &amp;&amp; &#039;123456&#039; === $request-&gt;getPassword();\n        $response-&gt;setSuccess($success);\n        $response-&gt;setError($success ? &#039;&#039; : &#039;\u767b\u5f55\u5931\u8d25&#039;);\n        return $response;\n    }\n\n}\u5ba2\u6237\u7aef\u8fde\u63a5\u6c60\u914d\u7f6e[\n    \/\/ \u8fde\u63a5\u6c60\u914d\u7f6e\n    &#039;pools&#039;    =&gt;    [\n        &#039;grpc&#039;  =&gt;  [\n            &#039;async&#039;    =&gt;    [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\Rpc\\Client\\Pool\\RpcClientCoroutinePool::class,\n                    &#039;config&#039;    =&gt;    [\n                        \/\/ \u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8bbe\u7f6e\n                        &#039;maxResources&#039;  =&gt;    100,\n                        &#039;minResources&#039;  =&gt;    1,\n                    ],\n                ],\n                &#039;resource&#039;    =&gt;    [\n                    \/\/ \u8fd9\u91cc\u9700\u8981\u548c\u4f60\u7684\u670d\u52a1\u7aef\u8def\u7531\u4e00\u81f4\n                    &#039;url&#039;           =&gt;  &#039;http:\/\/127.0.0.1:8080\/{package}.{service}\/{name}&#039;,\n                    \/\/ &#039;url&#039;           =&gt;  &#039;http:\/\/127.0.0.1:8080\/{package}.{service}\/{name|ucfirst}&#039;, \/\/ \u53c2\u6570\u652f\u6301\u8bbe\u5b9a\u51fd\u6570\u5904\u7406\uff0c\u6bd4\u5982\u8fd9\u4e2a\u5c06\u65b9\u6cd5\u540d\u9996\u5b57\u6bcd\u5927\u5199\uff0c\u517c\u5bb9\u5176\u5b83\u90e8\u5206\u8bed\u8a00\n                    &#039;clientClass&#039;   =&gt;  \\Imi\\Grpc\\Client\\GrpcClient::class,\n                    &#039;method&#039;        =&gt;  &#039;POST&#039;, \/\/ \u6307\u5b9a\u8bf7\u6c42\u65b9\u5f0f\uff0c\u9ed8\u8ba4 GET\n                ]\n            ],\n        ],\n    ],\n    &#039;rpc&#039;   =&gt;  [\n        &#039;defaultPool&#039;   =&gt;  &#039;grpc&#039;,\n    ],\n]\u5ba2\u6237\u7aef\u8c03\u7528\u4ee3\u7801\u8c03\u7528\uff1a\/\/ $service = \\Imi\\Rpc\\Client\\Pool\\RpcClientPool::getClient(&#039;\u8fde\u63a5\u6c60\u540d&#039;)-&gt;getService(&#039;\u670d\u52a1\u540d&#039;, &#039;\u751f\u6210\u51fa\u6765\u7684\u670d\u52a1\u63a5\u53e3\u7c7b\u540d&#039;);\n$service = \\Imi\\Rpc\\Client\\Pool\\RpcClientPool::getClient()-&gt;getService(&#039;AuthService&#039;, \\Grpc\\AuthServiceInterface::class);\n$request = new \\Grpc\\LoginRequest;\n$request-&gt;setPhone(&#039;&#039;);\n$service-&gt;login($request);\u6ce8\u89e3\u8c03\u7528\uff1ause Imi\\Rpc\\Annotation\\RpcClient;\nuse Imi\\Grpc\\Client\\Annotation\\GrpcService;\n\nclass Test\n{\n    \/**\n     * @RpcClient()\n     *\n     * @var \\Imi\\Rpc\\Client\\IRpcClient\n     *\/\n    protected $rpcClient;\n\n    \/**\n     * @GrpcService(serviceName=&quot;grpc.AuthService&quot;, interface=\\Grpc\\AuthServiceInterface::class)\n     *\n     * @var \\Grpc\\AuthServiceInterface\n     *\/\n    protected $authService;\n\n    public function aaa()\n    {\n        $request = new \\Grpc\\LoginRequest;\n        $request-&gt;setPhone(&#039;&#039;);\n\n        \/\/ \u65b9\u6cd5\u4e00\n        $this-&gt;rpcClient-&gt;getService(&#039;\u670d\u52a1\u540d&#039;, &#039;\u751f\u6210\u51fa\u6765\u7684\u670d\u52a1\u63a5\u53e3\u7c7b\u540d&#039;)-&gt;\u65b9\u6cd5\u540d($request);\n\n        \/\/ \u65b9\u6cd5\u4e8c\n        $this-&gt;xxxRpc-&gt;\u65b9\u6cd5\u540d($request);\n    }\n}@GrpcService \u6ce8\u89e3\u7684 serviceName \u5c5e\u6027\u683c\u5f0f\u4e3a {package}.{service}\uff1binterface \u5c5e\u6027\u662f\u751f\u6210\u51fa\u6765\u7684\u670d\u52a1\u63a5\u53e3\u7c7b\u540d\u2193\u2193\u2193\u6ce8\u610f\u2193\u2193\u2193\uff1a\u4f7f\u7528 @GrpcService \u6ce8\u89e3\u6ce8\u5165\u65f6\uff0c\u5982\u679c\u8c03\u7528\u7684 grpc \u63a5\u53e3\u65b9\u6cd5\u540d\u662f\uff1agetName\u3001send\u3001recv\u3001call\u3001getClient\uff0c\u8bf7\u4f7f\u7528 call \u65b9\u6cd5\u6765\u8c03\u7528\uff0c\u56e0\u4e3a\u8fd9\u548c\u5185\u7f6e\u65b9\u6cd5\u540d\u76f8\u51b2\u7a81\u4e86\u3002"},{"id":127,"title":"Hprose","pageTitle":"Hprose","url":"components\/rpc\/hprose.html","content":"Hprose\u4ecb\u7ecd\u5728 imi \u6846\u67b6\u4e2d\u96c6\u6210 Hprose \u670d\u52a1\u5f00\u53d1\uff0c\u76ee\u524d\u652f\u6301TCP\u3001Unix Socket\u534f\u8bae\u3002Github: https:\/\/github.com\/imiphp\/imi-hproseComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-hprose&quot;: &quot;^1.2&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u670d\u52a1\u7aef\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165RPC\u7ec4\u4ef6\u4ee5\u53ca\u672c\u7ec4\u4ef6\n        &#039;Rpc&#039;        =&gt;  &#039;Imi\\Rpc&#039;,\n        &#039;Hprose&#039;    =&gt;  &#039;Imi\\Hprose&#039;,\n    ],\n]\u5982\u679c\u4f60\u7528\u4e3b\u670d\u52a1\u5668\uff1a[\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n    &#039;mainServer&#039;    =&gt;    [\n        &#039;namespace&#039;    =&gt;    &#039;XXX\\MainServer&#039;, \/\/ \u4f60\u7684\u547d\u540d\u7a7a\u95f4\n        &#039;type&#039;        =&gt;    &#039;Hprose&#039;, \/\/ \u5fc5\u987b\u8bbe\u4e3a Hprose\n        &#039;port&#039;        =&gt;    8080,\n    ],\n]\u5982\u679c\u4f60\u7528\u5b50\u670d\u52a1\u5668\uff1a[\n    \/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n    &#039;subServers&#039;        =&gt;    [\n        \/\/ \u5b50\u670d\u52a1\u5668\u540d\n        &#039;XXX&#039;    =&gt;    [\n            &#039;namespace&#039;    =&gt;    &#039;XXX\\Hprose&#039;, \/\/ \u4f60\u7684\u547d\u540d\u7a7a\u95f4\n            &#039;type&#039;        =&gt;    &#039;Hprose&#039;, \/\/ \u5fc5\u987b\u8bbe\u4e3a Hprose\n            &#039;port&#039;        =&gt;    50001,\n        ]\n    ],\n]\u63a7\u5236\u5668\u57fa\u7c7bImi\\Rpc\\Controller\\RpcController\u63a7\u5236\u5668\u6ce8\u89e3\\Imi\\Rpc\\Route\\Annotation\\RpcController\u7528\u6cd5\uff1a@RpcController\u522b\u540d\u524d\u7f00\uff1a@RpcController(&quot;a_b_&quot;)\u6307\u5b9a\u670d\u52a1\u5668\uff1a@RpcController(prefix=&quot;a_b_&quot;, server=&quot;\u670d\u52a1\u5668\u540d&quot;)\u52a8\u4f5c\u6ce8\u89e3\\Imi\\Rpc\\Route\\Annotation\\RpcAction\u65e0\u53c2\u8def\u7531\u6ce8\u89e3\\Imi\\Hprose\\Route\\Annotation\\HproseRoute\u53c2\u6570\uff1aname \u8def\u7531\u540d\u79f0\u89c4\u5219\u3002\u4e00\u822c\u4e5f\u662f\u65b9\u6cd5\u540d\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u522b\u540d\uff0c\u5219\u6700\u7ec8\u4e3a\u522b\u540d+\u65b9\u6cd5\u540dmode \u8be5\u8bbe\u7f6e\u8868\u793a\u8be5\u670d\u52a1\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u679c\u7c7b\u578b\uff0c\u5177\u4f53\u503c\u8bf7\u53c2\u8003 Hprose \u6587\u6863simple \u8be5\u8bbe\u7f6e\u8868\u793a\u672c\u670d\u52a1\u51fd\u6570\u6240\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u5426\u4e3a\u7b80\u5355\u6570\u636e\u3002\u9ed8\u8ba4\u503c\u4e3a false\u3002oneway \u8be5\u8bbe\u7f6e\u8868\u793a\u672c\u670d\u52a1\u51fd\u6570\u662f\u5426\u4e0d\u9700\u8981\u7b49\u5f85\u8fd4\u56de\u503c\u3002\u5f53\u8be5\u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u8c03\u7528\u4f1a\u5f02\u6b65\u5f00\u59cb\uff0c\u5e76\u4e14\u4e0d\u7b49\u5f85\u7ed3\u679c\uff0c\u7acb\u5373\u8fd4\u56de null \u7ed9\u5ba2\u6237\u7aef\u3002\u9ed8\u8ba4\u503c\u4e3a false\u3002async \u8be5\u8bbe\u7f6e\u8868\u793a\u672c\u670d\u52a1\u51fd\u6570\u662f\u5426\u4e3a\u5f02\u6b65\u51fd\u6570\uff0c\u5f02\u6b65\u51fd\u6570\u7684\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u7528\u6237\u9700\u8981\u5728\u5f02\u6b65\u51fd\u6570\u4e2d\u8c03\u7528\u8be5\u56de\u8c03\u65b9\u6cd5\u6765\u4f20\u56de\u8fd4\u56de\u503cpassContext \u8be5\u5c5e\u6027\u4e3a boolean \u7c7b\u578b\uff0c\u9ed8\u8ba4\u503c\u4e3a false\u3002\u5177\u4f53\u8bf7\u53c2\u8003 Hprose \u6587\u6863Hprose \u6587\u6863\u53c2\u8003\uff1ahttps:\/\/github.com\/hprose\/hprose-php\/wiki\/06-Hprose-\u670d\u52a1\u5668#addfunction-%E6%96%B9%E6%B3%95\u5ba2\u6237\u7aef\u8fde\u63a5\u6c60\u914d\u7f6e[\n    &#039;pools&#039;    =&gt;    [\n        &#039;\u8fde\u63a5\u6c60\u540d&#039;    =&gt;    [\n            &#039;sync&#039;    =&gt;    [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\Rpc\\Client\\Pool\\RpcClientSyncPool::class,\n                    &#039;config&#039;    =&gt;    [\n                        \/\/ \u8fde\u63a5\u6c60\u901a\u7528\uff0c\u67e5\u9605\u6587\u6863\n                    ],\n                ],\n                &#039;resource&#039;    =&gt;    [\n                    &#039;clientClass&#039;    =&gt;    \\Imi\\Hprose\\Client\\HproseSocketClient::class,\n                    &#039;uris&#039;    =&gt;    &#039;tcp:\/\/127.0.0.1:50001&#039;, \/\/ \u8fde\u63a5\u5730\u5740\n                    \/\/ \u5176\u5b83\u914d\u7f6e\n                ]\n            ],\n            &#039;async&#039;    =&gt;    [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\Rpc\\Client\\Pool\\RpcClientCoroutinePool::class,\n                    &#039;config&#039;    =&gt;    [\n                        \/\/ \u8fde\u63a5\u6c60\u901a\u7528\uff0c\u67e5\u9605\u6587\u6863\n                    ],\n                ],\n                &#039;resource&#039;    =&gt;    [\n                    &#039;clientClass&#039;    =&gt;    \\Imi\\Hprose\\Client\\HproseSocketClient::class,\n                    &#039;uris&#039;    =&gt;    &#039;tcp:\/\/127.0.0.1:50001&#039;, \/\/ \u8fde\u63a5\u5730\u5740\n                    \/\/ \u5176\u5b83\u914d\u7f6e\n                ]\n            ],\n        ],\n    ],\n    &#039;rpc&#039;    =&gt;    [\n        &#039;defaultPool&#039;    =&gt;    &#039;\u8fde\u63a5\u6c60\u540d&#039;, \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\u540d\n    ],\n]\u5ba2\u6237\u7aef\u8c03\u7528\u4ee3\u7801\u8c03\u7528\uff1a\\Imi\\Rpc\\Client\\Pool\\RpcClientPool::getService(&#039;\u670d\u52a1\u540d&#039;)-&gt;\u65b9\u6cd5\u540d(\u53c2\u6570);\u6ce8\u89e3\u8c03\u7528\uff1aclass Test\n{\n    \/**\n     * @RpcClient()\n     *\n     * @var \\Imi\\Rpc\\Client\\IRpcClient\n     *\/\n    protected $rpcClient;\n\n    \/**\n     * @RpcService(serviceName=&quot;\u670d\u52a1\u540d&quot;)\n     *\n     * @var \\Imi\\Rpc\\Client\\IService\n     *\/\n    protected $xxxRpc;\n\n    public function aaa()\n    {\n        \/\/ \u65b9\u6cd5\u4e00\n        $this-&gt;rpcClient-&gt;getService(&#039;\u670d\u52a1\u540d&#039;)-&gt;\u65b9\u6cd5\u540d(\u53c2\u6570);\n\n        \/\/ \u65b9\u6cd5\u4e8c\n        $this-&gt;xxxRpc-&gt;\u65b9\u6cd5\u540d(\u53c2\u6570);\n    }\n}"},{"id":66,"title":"\u5185\u7f6e\u7684\u6570\u636e\u5904\u7406\u5668","pageTitle":"\u5185\u7f6e\u7684\u6570\u636e\u5904\u7406\u5668","url":"components\/server\/dataParser.html","content":"\u5185\u7f6e\u7684\u6570\u636e\u5904\u7406\u5668JsonArrayParserJSON \u6570\u7ec4\u7c7b\u540d\uff1a\\Imi\\Server\\DataParser\\JsonArrayParser::class\u652f\u6301\u6ce8\u5165\u7684\u5c5e\u6027\uff1a\u540d\u79f0\u63cf\u8ff0\u9ed8\u8ba4\u503coptionsJSON \u5e8f\u5217\u5316\u65f6\u7684\u53c2\u65700 depth\u8bbe\u7f6e\u6700\u5927\u6df1\u5ea6\u3002 \u5fc5\u987b\u5927\u4e8e0\u3002512 JsonObjectParserJSON \u5bf9\u8c61\u7c7b\u540d\uff1a\\Imi\\Server\\DataParser\\JsonObjectParser::class\u652f\u6301\u6ce8\u5165\u7684\u5c5e\u6027\uff1a\u540d\u79f0\u63cf\u8ff0\u9ed8\u8ba4\u503coptionsJSON \u5e8f\u5217\u5316\u65f6\u7684\u53c2\u65700 depth\u8bbe\u7f6e\u6700\u5927\u6df1\u5ea6\u3002 \u5fc5\u987b\u5927\u4e8e0\u3002512 \u81ea\u5b9a\u4e49\u6570\u636e\u5904\u7406\u5668\u5b9e\u73b0\u63a5\u53e3\uff1aImi\\Server\\DataParser\\IParser&lt;?php\n\nnamespace App\\DataParser;\n\nuse Imi\\Server\\DataParser\\IParser;\n\nclass XXXParser implements IParser\n{\n    \/**\n     * \u7f16\u7801\u4e3a\u5b58\u50a8\u683c\u5f0f.\n     *\n     * @param mixed $data\n     *\n     * @return mixed\n     *\/\n    public function encode($data)\n    {\n    }\n\n    \/**\n     * \u89e3\u7801\u4e3aphp\u53d8\u91cf.\n     *\n     * @param mixed $data\n     *\n     * @return mixed\n     *\/\n    public function decode($data)\n    {\n    }\n}"},{"id":59,"title":"\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u6570\u636e","pageTitle":"\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u6570\u636e","url":"components\/server\/serverPush.html","content":"\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u6570\u636e\u957f\u8fde\u63a5\u670d\u52a1\uff08TCP\u3001WebSocket\uff09\u652f\u6301\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u6570\u636e\uff0c\u5177\u4f53\u7528\u6cd5https:\/\/doc.imiphp.com\/utils\/Server.html"},{"id":48,"title":"SSL","pageTitle":"SSL","url":"components\/server\/ssl.html","content":"SSL\u672c\u9875\u4ecb\u7ecd\u6709\u5173 HTTPS\u3001WSS \u7684\u914d\u7f6e\u65b9\u6cd5\u3002\u6709\u4e24\u4e2a\u65b9\u5f0f\uff0c\u7b2c\u4e00\u79cd\u662f\u76f4\u63a5\u5728 imi \u670d\u52a1\u5668\u914d\u7f6e\u4e2d\u8bbe\u7f6e\uff0c\u7b2c\u4e8c\u79cd\u662f\u5728 Nginx \u5c42\u914d\u7f6e\u3002\u8fd9\u8fb9\u66f4\u52a0\u63a8\u8350\u5728 Nginx \u5c42\u8bbe\u7f6e\u901a\u8fc7 imi \u914d\u7f6e\u9879\u76ee config.php\uff1a[\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\n    &#039;mainServer&#039;    =&gt;    [\n        &#039;namespace&#039; =&gt;  &#039;ImiApp\\WebSocketServer&#039;,\n        &#039;type&#039;      =&gt;  Imi\\Server\\Type::WEBSOCKET,\n        &#039;host&#039;      =&gt;  &#039;127.0.0.1&#039;,\n        &#039;port&#039;      =&gt;  8082,\n        &#039;mode&#039;      =&gt;  SWOOLE_BASE,\n        &#039;sockType&#039;  =&gt;  SWOOLE_SOCK_TCP | SWOOLE_SSL, \/\/ SSL \u9700\u8981\u8bbe\u7f6e\u4e00\u4e0b sockType\n        &#039;configs&#039;   =&gt;  [\n            &#039;worker_num&#039;            =&gt;  1,\n            &#039;task_worker_num&#039;       =&gt;  1,\n            &#039;task_enable_coroutine&#039; =&gt;  true,\n            \/\/ \u914d\u7f6e\u8bc1\u4e66\n            &#039;ssl_cert_file&#039;     =&gt;  &#039;\/server.crt&#039;,\n            &#039;ssl_key_file&#039;      =&gt;  &#039;\/server.key&#039;,\n        ],\n    ],\n\n    \/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n    &#039;subServers&#039;        =&gt;    [\n        &#039;ApiServer&#039;     =&gt;  [\n            &#039;namespace&#039; =&gt;  &#039;ImiApp\\ApiServer&#039;,\n            &#039;type&#039;      =&gt;  Imi\\Server\\Type::HTTP,\n            &#039;host&#039;      =&gt;  &#039;127.0.0.1&#039;,\n            &#039;port&#039;      =&gt;  8080,\n            &#039;sockType&#039;  =&gt;  SWOOLE_SOCK_TCP | SWOOLE_SSL, \/\/ SSL \u9700\u8981\u8bbe\u7f6e\u4e00\u4e0b sockType\n            &#039;configs&#039;   =&gt;  [\n                \/\/ \u914d\u7f6e\u8bc1\u4e66\n                &#039;ssl_cert_file&#039;     =&gt;  &#039;\/server.crt&#039;,\n                &#039;ssl_key_file&#039;      =&gt;  &#039;\/server.key&#039;,\n            ]\n        ],\n    ],\n]\u901a\u8fc7 Nginx \u914d\u7f6eHTTPSserver {\n    listen 443 ssl;\n    server_name {\u57df\u540d};\n    access_log  \/var\/log\/nginx\/{\u57df\u540d}.access.log  main;\n    error_log  \/var\/log\/nginx\/{\u57df\u540d}.error.log  error;\n    ssl_certificate      {\u8bc1\u4e66}.pem;\n    ssl_certificate_key  {\u8bc1\u4e66}.key;\n\n    location \/ {\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_pass http:\/\/127.0.0.1:8080; # imi \u670d\u52a1 HTTP \u5730\u5740\n    }\n}WSSserver {\n    listen 443 ssl;\n    server_name {\u57df\u540d};\n    access_log  \/var\/log\/nginx\/{\u57df\u540d}.access.log  main;\n    error_log  \/var\/log\/nginx\/{\u57df\u540d}.error.log  error;\n    ssl_certificate      {\u8bc1\u4e66}.pem;\n    ssl_certificate_key  {\u8bc1\u4e66}.key;\n\n    # websocket\n    location \/ { # \u5168\u90e8\n    # location ~* ^\/ws\/(.+) { # \u6307\u5b9a\u8def\u5f84\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection &quot;upgrade&quot;;\n        proxy_pass http:\/\/127.0.0.1:8082\/$1?$args; # imi \u670d\u52a1 WebSocket \u5730\u5740\n    }\n}"},{"id":135,"title":"\u8de8\u8fdb\u7a0b\u53d8\u91cf\u5171\u4eab","pageTitle":"\u8de8\u8fdb\u7a0b\u53d8\u91cf\u5171\u4eab","url":"components\/shared-memory.html","content":"\u8de8\u8fdb\u7a0b\u53d8\u91cf\u5171\u4eab\u4ecb\u7ecd\u57fa\u4e8e Swoole Shared Memory \u5f00\u53d1\u7684 imi \u6846\u67b6\u8de8\u8fdb\u7a0b\u53d8\u91cf\u5171\u4eab\u7ec4\u4ef6\u3002Composer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-shared-memory&quot;: &quot;~1.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;SharedMemory&#039;    =&gt;  &#039;Imi\\SharedMemory&#039;,\n    ],\n    &#039;pools&#039;    =&gt;    [\n        \/\/ \u5ba2\u6237\u7aef\u8fde\u63a5\u6c60\n        &#039;sharedMemory&#039;  =&gt;  [\n            &#039;async&#039; =&gt;  [\n                &#039;pool&#039;    =&gt;    [\n                    &#039;class&#039;        =&gt;    \\Imi\\SharedMemory\\Pool\\ClientPool::class,\n                    &#039;config&#039;    =&gt;    [\n                        &#039;maxResources&#039;    =&gt;    100,\n                        &#039;minResources&#039;    =&gt;    0,\n                    ],\n                ],\n                &#039;resource&#039;  =&gt;  [\n                    \/\/ \u4ee5\u4e0b\u4e3a\u53ef\u9009\u914d\u7f6e\n\n                    \/\/ \u5b58\u50a8\u5668\u7c7b\u578b\uff0c\u6ce8\u610f\u548c\u4e0b\u9762\u7684\u7c7b\u540d\u4e0d\u540c\n                    \/\/ &#039;storeTypes&#039;    =&gt;  [\n                    \/\/     \\Yurun\\Swoole\\SharedMemory\\Client\\Store\\KV::class,\n                    \/\/     \\Yurun\\Swoole\\SharedMemory\\Client\\Store\\Stack::class,\n                    \/\/     \\Yurun\\Swoole\\SharedMemory\\Client\\Store\\Queue::class,\n                    \/\/     \\Yurun\\Swoole\\SharedMemory\\Client\\Store\\PriorityQueue::class,\n                    \/\/      &#039;name&#039;  =&gt;  &#039;XXXClass&#039;,\n                    \/\/ ],\n\n                    \/\/ unix socket \u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u4f1a\u81ea\u52a8\u653e runtime \u76ee\u5f55\u4e2d\n                    \/\/ &#039;socketFile&#039;    =&gt;  &#039;&#039;,\n                ],\n            ],\n        ]\n    ],\n    \/\/ \u4ee5\u4e0b\u4e3a\u53ef\u9009\u914d\u7f6e\n    \/\/ &#039;swooleSharedMemory&#039;    =&gt;  [\n        \/\/ unix socket \u6587\u4ef6\u540d\uff0c\u9ed8\u8ba4\u4f1a\u81ea\u52a8\u653e runtime \u76ee\u5f55\u4e2d\n        \/\/ &#039;socketFile&#039;    =&gt;  &#039;&#039;,\n\n        \/\/ \u5b58\u50a8\u5668\u7c7b\u578b\uff0c\u6ce8\u610f\u548c\u4e0a\u9762\u7684\u7c7b\u540d\u4e0d\u540c\n        \/\/ &#039;storeTypes&#039;    =&gt;  [\n        \/\/     \\Yurun\\Swoole\\SharedMemory\\Store\\KV::class,\n        \/\/     \\Yurun\\Swoole\\SharedMemory\\Store\\Stack::class,\n        \/\/     \\Yurun\\Swoole\\SharedMemory\\Store\\Queue::class,\n        \/\/     \\Yurun\\Swoole\\SharedMemory\\Store\\PriorityQueue::class,\n        \/\/      &#039;name&#039;  =&gt;  &#039;XXXClass&#039;,\n        \/\/ ],\n\n        \/\/ \u9ed8\u8ba4\u8fde\u63a5\u6c60\u540d\n        \/\/ &#039;defaultPool&#039;   =&gt;  &#039;sharedMemory&#039;\n    \/\/ ],\n]\u5728\u4ee3\u7801\u4e2d\u64cd\u4f5c\uff1a\/\/ \u65b9\u6cd5\u4e00\nSharedMemory::use(&#039;KV&#039;, function(\\Yurun\\Swoole\\SharedMemory\\Client\\Store\\KV $kv){\n    $kv-&gt;set(&#039;a&#039;, 1);\n});\n\n\/\/ \u65b9\u6cd5\u4e8c\n$kv = SharedMemory::getInstance()-&gt;getObject(&#039;KV&#039;);\n$kv-&gt;set(&#039;a&#039;, 1);"},{"id":133,"title":"Smarty \u6a21\u7248\u5f15\u64ce","pageTitle":"Smarty \u6a21\u7248\u5f15\u64ce","url":"components\/smarty.html","content":"Smarty \u6a21\u7248\u5f15\u64ce\u4ecb\u7ecd\u652f\u6301\u5728 imi \u6846\u67b6\u4e2d\u4f7f\u7528 Smarty \u6a21\u7248\u5f15\u64ceComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-smarty&quot;: &quot;~1.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u57fa\u672c\u4f7f\u7528\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;Smarty&#039;       =&gt;  &#039;Imi\\Smarty&#039;,\n    ],\n]\u5728\u670d\u52a1\u5668\u7684 config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;beans&#039;    =&gt;    [\n        &#039;HtmlView&#039;    =&gt;    [\n            &#039;templatePath&#039;      =&gt;  dirname(__DIR__) . &#039;\/template\/&#039;,\n            &#039;templateEngine&#039;    =&gt;  &#039;SmartyEngine&#039;,\n            \/\/ \u652f\u6301\u7684\u6a21\u7248\u6587\u4ef6\u6269\u5c55\u540d\uff0c\u4f18\u5148\u7ea7\u6309\u5148\u540e\u987a\u5e8f\n            &#039;fileSuffixs&#039;        =&gt;    [\n                &#039;tpl&#039;,\n                &#039;html&#039;,\n                &#039;php&#039;\n            ],\n        ],\n        \/\/ \u53ef\u9009\u9879\n        &#039;SmartyEngine&#039; =&gt; [\n            \/\/ \u7f13\u5b58\u76ee\u5f55\n            &#039;cacheDir&#039;      =&gt;  null,\n            \/\/ \u7f16\u8bd1\u76ee\u5f55\n            &#039;compileDir&#039;    =&gt;  null,\n            \/\/ \u662f\u5426\u5f00\u542f\u7f13\u5b58\uff0c\u9ed8\u8ba4\u4e0d\u5f00\u542f\n            &#039;caching&#039;       =&gt;  null,\n            \/\/ \u7f13\u5b58\u6709\u6548\u65f6\u95f4\n            &#039;cacheLifetime&#039; =&gt;  null,\n        ],\n    ],\n];\u8fdb\u9636\u4f7f\u7528\u672c\u7ec4\u4ef6\u6ca1\u6709\u5c01\u88c5\u5927\u91cf\u7684\u914d\u7f6e\u9879\uff0c\u6240\u4ee5\u5f53\u4f60\u9700\u8981\u505a\u4e00\u4e9b\u5176\u5b83\u8bbe\u7f6e\u65f6\uff0c\u53ef\u4ee5\u76d1\u542c IMI.SMARTY.NEW \u4e8b\u4ef6\uff0c\u5f53\u9996\u6b21\u5b9e\u4f8b\u5316\u5bf9\u8c61\u65f6\uff0c\u89e6\u53d1\u8be5\u4e8b\u4ef6\u3002\u4e8b\u4ef6\u53c2\u6570\u6570\u636e\u5982\u4e0b\uff1a[\n    &#039;smarty&#039;        =&gt;  $smarty,        \/\/ Smarty \u5bf9\u8c61\n    &#039;serverName&#039;    =&gt;  $serverName,    \/\/ \u5f53\u524d\u670d\u52a1\u5668\u540d\n]"},{"id":136,"title":"\u96ea\u82b1\u7b97\u6cd5\u53d1\u53f7\u5668","pageTitle":"\u96ea\u82b1\u7b97\u6cd5\u53d1\u53f7\u5668","url":"components\/snowflake.html","content":"\u96ea\u82b1\u7b97\u6cd5\u53d1\u53f7\u5668\u4ecb\u7ecdimi \u6846\u67b6\u7684\u96ea\u82b1\u7b97\u6cd5\u751f\u6210\u7ec4\u4ef6Github: https:\/\/github.com\/imiphp\/imi-snowflakeComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-snowflake&quot;: &quot;~1.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;snowflake&#039;    =&gt;  &#039;Imi\\Snowflake&#039;,\n    ],\n]\u914d\u7f6e\u914d\u7f6e @app.beans\uff1a[\n    &#039;Snowflake&#039;   =&gt;  [\n        &#039;list&#039;  =&gt;  [\n            \/\/ \u53ef\u5b9a\u4e49\u591a\u4e2a\u914d\u7f6e\u540d\u79f0\n            &#039;testBasic&#039; =&gt;  [\n                \/\/ &#039;datacenterId&#039;   =&gt; null, \/\/ \u6570\u636e\u4e2d\u5fc3ID\uff0c\u672a\u7a7a\u65f6\u4e3a0\n                \/\/ &#039;workerId&#039;       =&gt; null, \/\/ \u5de5\u4f5c\u8fdb\u7a0bID\uff0c\u4e3a\u7a7a\u65f6\u53d6\u5f53\u524d\u8fdb\u7a0bID\n                \/\/ &#039;startTimeStamp&#039; =&gt; null, \/\/ \u5f00\u59cb\u65f6\u95f4\u6233\uff0c\u5355\u4f4d\uff1a\u6beb\u79d2\n                \/\/ &#039;redisPool&#039;      =&gt; null, \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u4e3a\u7a7a\u53d6\u9ed8\u8ba4\u8fde\u63a5\u6c60\n            ],\n        ],\n    ],\n]\u751f\u6210ID$id = \\Imi\\Snowflake\\SnowflakeUtil::id(&#039;testBasic&#039;);\u89e3\u6790ID$array = \\Imi\\Snowflake\\SnowflakeUtil::parseId(&#039;testBasic&#039;, $id);\nvar_dump($array);\u5904\u7406\u7ed3\u679c\u683c\u5f0f\uff1aarray(4) {\n  [&quot;timestamp&quot;]=&gt;\n  string(35) &quot;10100100111111101010001000001110010&quot;\n  [&quot;sequence&quot;]=&gt;\n  string(12) &quot;000000000000&quot;\n  [&quot;workerid&quot;]=&gt;\n  string(5) &quot;00000&quot;\n  [&quot;datacenter&quot;]=&gt;\n  string(5) &quot;00000&quot;\n}"},{"id":144,"title":"ArrayData","pageTitle":"ArrayData","url":"components\/struct\/ArrayData.html","content":"ArrayData\u6570\u7ec4\u6570\u636e\u57fa\u7c7b\uff0c\u652f\u6301\u4f7f\u7528 a.b.c \u65b9\u5f0f\u64cd\u4f5c\u6570\u636e$data = [\n    &#039;a&#039; =&gt;  [\n        &#039;b&#039; =&gt;  [\n            &#039;c&#039; =&gt;  [\n                &#039;name&#039;  =&gt;  &#039;imi&#039;,\n            ]\n        ]\n    ]\n];\n$data = new \\Imi\\Util\\ArrayData($data);\n\/\/ 3 \u79cd\u4e0d\u540c\u64cd\u4f5c\u65b9\u6cd5\uff0c\u8f93\u51fa\u90fd\u662f imi\nvar_dump($data-&gt;get(&#039;a.b.c.name&#039;));\nvar_dump($data[&#039;a.b.c.name&#039;]);\nvar_dump($data-&gt;{&#039;a.b.c.name&#039;});\n\n$data-&gt;set(&#039;a.id&#039;, 123); \/\/ a.id \u76f4\u63a5\u4f5c\u4e3akey\uff0c\u800c\u4e0d\u662f\u591a\u7ea7\u6570\u7ec4\nvar_dump($data[&#039;a.id&#039;]); \/\/ false\nvar_dump($data-&gt;get()[&#039;a.id&#039;]); \/\/ 123\n\n$data-&gt;setVal(&#039;a.id&#039;, 456);\nvar_dump($data[&#039;a.id&#039;]); \/\/ 456\n\n$data-&gt;clear(); \/\/ \u5168\u90e8\u6e05\u9664"},{"id":146,"title":"ArrayList","pageTitle":"ArrayList","url":"components\/struct\/ArrayList.html","content":"ArrayList\u9650\u5b9a\u6210\u5458\u7c7b\u578b\u7684\u6570\u7ec4\u5217\u8868\u5982\u679c\u6210\u5458\u7c7b\u578b\u4e0d\u6b63\u786e\uff0c\u4f1a\u629b\u51fa\\InvalidArgumentException\u5f02\u5e38class TestModel\n{\n    public $id;\n\n    public $name;\n\n    public function __construct($id, $name)\n    {\n        $this-&gt;id = $id;\n        $this-&gt;name = $name;\n    }\n}\n\n\/\/ $list = new \\Imi\\Util\\ArrayList(TestModel::class);\n$list = new \\Imi\\Util\\ArrayList(TestModel::class, [\n    new TestModel(1, &#039;a&#039;),\n    new TestModel(2, &#039;b&#039;),\n]);\n\nforeach($list as $index =&gt; $item)\n{\n    var_dump($index, $item);\n}\n\n\/\/ \u53d6\u5176\u4e2d\u67d0\u4e2a\u6210\u5458\n$item0 = $list[0];\n\n\/\/ \u8f6c\u4e3a\u6570\u7ec4\n$arrayList = $list-&gt;toArray();\nvar_dump($arrayList);\n\n\/\/ \u79fb\u9664\u591a\u4e2a\u6210\u5458\n$arrayList-&gt;remove($list[1], $list[2]);\n\n\/\/ \u6e05\u7a7a\n$arrayList-&gt;clear();\n\n\/\/ \u7edf\u8ba1\u6570\u91cf\necho $arrayList-&gt;count();"},{"id":140,"title":"Atomic","pageTitle":"Atomic","url":"components\/struct\/atomic.html","content":"Atomic\u57fa\u4e8e Swoole \u63d0\u4f9b\u7684 Swoole\\Atomic\uff0c\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5728worker\u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff0c\u6570\u636e\u4e92\u901a\u3002\u4f7f\u7528\u65f6\u65e0\u9700\u52a0\u9501\uff01\u914d\u7f6e\u65b9\u5f0f\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4ee5\u4e0b\u8282&#039;atomics&#039;    =&gt;    [\n    \/\/ \u5b9a\u4e49\u540d\u4e3aname1\u7684\uff0c\u521d\u59cb\u503c\u4e3a0\n    &#039;name1&#039;,\n    \/\/ \u5b9a\u4e49\u540d\u4e3aname2\u7684\uff0c\u521d\u59cb\u503c\u4e3a10\n    &#039;name2&#039;    =&gt;    10,\n],\u4f7f\u7528\u65b9\u5f0fuse \\Imi\\Util\\AtomicManager;\n\n\/\/ \u83b7\u53d6 Swoole\\Atomic \u5bf9\u8c61\n$atomic = AtomicManager::getInstance(&#039;name1&#039;);\n\n\/\/ \u52a01\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::add(&#039;name1&#039;);\n\n\/\/ \u52a010\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::add(&#039;name1&#039;, 10);\n\n\/\/ \u51cf1\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::sub(&#039;name1&#039;);\n\n\/\/ \u51cf10\uff0c\u8fd4\u56de\u7ed3\u679c\n$number = AtomicManager::::sub(&#039;name1&#039;, 10);\n\n\/\/ \u83b7\u53d6\u5f53\u524d\u503c\n$number = AtomicManager::get(&#039;name1&#039;);\n\n\/\/ \u8bbe\u7f6e\u5f53\u524d\u503c\u4e3a100\nAtomicManager::get(&#039;name1&#039;, 100);\n\n\/\/ -----------------------------------------------\n\n\/\/ \u5982\u679c\u5f53\u524d\u6570\u503c\u7b49\u4e8e100\u8fd4\u56detrue\uff0c\u5e76\u5c06\u5f53\u524d\u6570\u503c\u8bbe\u7f6e\u4e3a1\n\/\/ \u5982\u679c\u5f53\u524d\u6570\u503c\u4e0d\u7b49\u4e8e100\u8fd4\u56defalse\n$number = AtomicManager::cmpset(&#039;name1&#039;, 100, 1);\n\n\/**\n * \u5f53\u539f\u5b50\u8ba1\u6570\u7684\u503c\u4e3a0\u65f6\u7a0b\u5e8f\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u8c03\u7528wakeup\u53ef\u4ee5\u518d\u6b21\u5524\u9192\u7a0b\u5e8f\u3002\u5e95\u5c42\u57fa\u4e8eLinux Futex\u5b9e\u73b0\uff0c\u4f7f\u7528\u6b64\u7279\u6027\uff0c\u53ef\u4ee5\u4ec5\u75284\u5b57\u8282\u5185\u5b58\u5b9e\u73b0\u4e00\u4e2a\u7b49\u5f85\u3001\u901a\u77e5\u3001\u9501\u7684\u529f\u80fd\u3002\n * \u8d85\u65f6\u8fd4\u56defalse\uff0c\u9519\u8bef\u7801\u4e3aEAGAIN\uff0c\u53ef\u4f7f\u7528swoole_errno\u51fd\u6570\u83b7\u53d6\n * \u6210\u529f\u8fd4\u56detrue\uff0c\u8868\u793a\u6709\u5176\u4ed6\u8fdb\u7a0b\u901a\u8fc7wakeup\u6210\u529f\u5524\u9192\u4e86\u5f53\u524d\u7684\u9501\n * \u4f7f\u7528wait\/wakeup\u7279\u6027\u65f6\uff0c\u539f\u5b50\u8ba1\u6570\u7684\u503c\u53ea\u80fd\u4e3a0\u62161\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\n * \u5f53\u7136\u539f\u5b50\u8ba1\u6570\u7684\u503c\u4e3a1\u65f6\uff0c\u8868\u793a\u4e0d\u9700\u8981\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u8d44\u6e90\u5f53\u524d\u5c31\u662f\u53ef\u7528\u3002wait\u51fd\u6570\u4f1a\u7acb\u5373\u8fd4\u56detrue\n * @param string $name \u539f\u5b50\u8ba1\u6570\u5bf9\u8c61\u540d\u79f0\n * @param float $timeout \u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a-1\uff0c\u8868\u793a\u6c38\u4e0d\u8d85\u65f6\uff0c\u4f1a\u6301\u7eed\u7b49\u5f85\u76f4\u5230\u6709\u5176\u4ed6\u8fdb\u7a0b\u5524\u9192\n * @return bool\n *\/\n$result = AtomicManager::wait(&#039;name1&#039;);\n\/\/ \u8d85\u65f6\u65f6\u95f4100\u6beb\u79d2\n$result = AtomicManager::wait(&#039;name1&#039;, 0.1);\n\n\/**\n * \u5524\u9192\u5904\u4e8ewait\u72b6\u6001\u7684\u5176\u4ed6\u8fdb\u7a0b\u3002\n * \u5f53\u524d\u539f\u5b50\u8ba1\u6570\u5982\u679c\u4e3a0\u65f6\uff0c\u8868\u793a\u6ca1\u6709\u8fdb\u7a0b\u6b63\u5728wait\uff0cwakeup\u4f1a\u7acb\u5373\u8fd4\u56detrue\n * \u5f53\u524d\u539f\u5b50\u8ba1\u6570\u5982\u679c\u4e3a1\u65f6\uff0c\u8868\u793a\u5f53\u524d\u6709\u8fdb\u7a0b\u6b63\u5728wait\uff0cwakeup\u4f1a\u5524\u9192\u7b49\u5f85\u7684\u8fdb\u7a0b\uff0c\u5e76\u8fd4\u56detrue\n * \u5982\u679c\u540c\u65f6\u6709\u591a\u4e2a\u8fdb\u7a0b\u5904\u4e8ewait\u72b6\u6001\uff0c$n\u53c2\u6570\u53ef\u4ee5\u63a7\u5236\u5524\u9192\u7684\u8fdb\u7a0b\u6570\u91cf\n * \u88ab\u5524\u9192\u7684\u8fdb\u7a0b\u8fd4\u56de\u540e\uff0c\u4f1a\u5c06\u539f\u5b50\u8ba1\u6570\u8bbe\u7f6e\u4e3a0\uff0c\u8fd9\u65f6\u53ef\u4ee5\u518d\u6b21\u8c03\u7528wakeup\u5524\u9192\u5176\u4ed6\u6b63\u5728wait\u7684\u8fdb\u7a0b\n * @param string $name \u539f\u5b50\u8ba1\u6570\u5bf9\u8c61\u540d\u79f0\n * @param integer $n\n * @return void\n *\/\nAtomicManager::wakeup(&#039;name1&#039;); \/\/ \u7b2c\u4e8c\u4e2a\u53c2\u6570\u6211\u4e5f\u4e0d\u77e5\u9053\u5e72\u561b\u7684\uff0cswoole\u6587\u6863\u6ca1\u5199"},{"id":141,"title":"\u534f\u7a0b Channel","pageTitle":"\u534f\u7a0b Channel","url":"components\/struct\/co-channel.html","content":"\u534f\u7a0b Channel\u57fa\u4e8e Swoole \u63d0\u4f9b\u7684 Swoole\\Coroutine\\Channel\uff0c\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u5728worker\u8fdb\u7a0b\u4e2d\u4f7f\u7528\uff0c\u6570\u636e\u4e92\u901a\u3002Swoole\\Coroutine\\Channel\u53ef\u4ee5\u4f5c\u4e3a\u961f\u5217\u4f7f\u7528\uff0c\u652f\u6301\u591a\u751f\u4ea7\u8005\u534f\u7a0b\u548c\u591a\u6d88\u8d39\u8005\u534f\u7a0b\u3002\u5e95\u5c42\u81ea\u52a8\u5b9e\u73b0\u4e86\u534f\u7a0b\u7684\u5207\u6362\u548c\u8c03\u5ea6\u3002\u914d\u7f6e\u65b9\u5f0f\u5728\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4ee5\u4e0b\u8282&#039;coroutineChannels&#039;    =&gt;    [\n    \/\/ \u5b9a\u4e49\u540d\u4e3aname1\u7684\uff0c\u901a\u9053\u5360\u7528\u7684\u5185\u5b58\u7684\u5c3a\u5bf8\u4e3a64kb\n    \/\/ \u5f53\u8bbe\u7f6e\u4e3a0\u65f6\uff0c\u5e95\u5c42\u5c06\u4e0d\u518d\u8bbe\u7f6e\u7f13\u51b2\u533a\uff0cpush\u548cpop\u64cd\u4f5c\u4f1a\u7acb\u5373\u6302\u8d77\u5f53\u524d\u534f\u7a0b\u3002\n    &#039;name1&#039;    =&gt;    [64 * 1024],\n],\u4f7f\u7528\u65b9\u5f0fuse \\Imi\\Util\\CoroutineChannelManager;\n\n\/\/ \u83b7\u53d6 Swoole\\Coroutine\\Channel \u5bf9\u8c61\n$channel = CoroutineChannelManager::getInstance(&#039;name1&#039;);\n\n\/\/ \u5411\u961f\u5217\u4e2d\u52a0\u5165\u4e00\u4e2a\u6210\u5458\nCoroutineChannelManager::push(&#039;name1&#039;, &#039;test&#039;);\n\/\/ \u8fd8\u652f\u6301\u6570\u7ec4\uff0c\u7b49\u4e00\u5207\u53ef\u4ee5\u88ab\u5e8f\u5217\u5316\u7684\u503c\nCoroutineChannelManager::push(&#039;name1&#039;, [1, 2, 3]);\n\n\/\/ \u5f39\u51fa\u4e00\u4e2a\u6210\u5458\uff0c\u5982\u679c\u6ca1\u6709\u503c\u5219\u4e3afalse\n$result = CoroutineChannelManager::pop(&#039;name1&#039;);\n\n\/\/ \u83b7\u53d6\u901a\u9053\u7684\u72b6\u6001\n$result = CoroutineChannelManager::stats(&#039;name&#039;);\n\/*\n$result \u683c\u5f0f\u5982\u4e0b\uff1a\n[\n    \/\/ \u6d88\u8d39\u8005\u6570\u91cf\uff0c\u8868\u793a\u5f53\u524d\u901a\u9053\u4e3a\u7a7a\uff0c\u6709N\u4e2a\u534f\u7a0b\u6b63\u5728\u7b49\u5f85\u5176\u4ed6\u534f\u7a0b\u8c03\u7528push\u65b9\u6cd5\u751f\u4ea7\u6570\u636e\n    &#039;consumer_num&#039;    =&gt;    1,\n    \/\/ \u751f\u4ea7\u8005\u6570\u91cf\uff0c\u8868\u793a\u5f53\u524d\u901a\u9053\u5df2\u6ee1\uff0c\u6709N\u4e2a\u534f\u7a0b\u6b63\u5728\u7b49\u5f85\u5176\u4ed6\u534f\u7a0b\u8c03\u7528pop\u65b9\u6cd5\u6d88\u8d39\u6570\u636e\n    &#039;producer_num&#039;  =&gt;    1,\n    \/\/ \u901a\u9053\u4e2d\u7684\u5143\u7d20\u6570\u91cf\n    &#039;queue_num&#039;    =&gt;    10,\n    \/\/ \u901a\u9053\u5f53\u524d\u5360\u7528\u7684\u5185\u5b58\u5b57\u8282\u6570\n    &#039;queue_bytes&#039;    =&gt;    1024,\n]\n*\/\n\n\/\/ \u5173\u95ed\u901a\u9053\u3002\u5e76\u5524\u9192\u6240\u6709\u7b49\u5f85\u8bfb\u5199\u7684\u534f\u7a0b\u3002\nCoroutineChannelManager::close(&#039;name1&#039;);\n"},{"id":143,"title":"\u679a\u4e3e","pageTitle":"\u679a\u4e3e","url":"components\/struct\/enum.html","content":"\u679a\u4e3e\u7531\u4e8e PHP \u672c\u8eab\u4e0d\u652f\u6301\u679a\u4e3e\u7c7b\u578b\uff0cimi \u7279\u522b\u57fa\u4e8e\u6ce8\u89e3\u5b9e\u73b0\u4e86\u679a\u4e3e\u7c7b\u3002\u679a\u4e3e\u7c7b\u5b9a\u4e49\u7ee7\u627fImi\\Enum\\BaseEnum\u7c7b\uff0c\u7136\u540e\u5728\u7c7b\u5e38\u91cf\u4e0a\u9762\u5199\u4e0a\u6ce8\u89e3@EnumItem\uff0c\u53c2\u6570\u662f\u5f53\u524d\u5e38\u91cf\u7684\u6587\u5b57\u8bf4\u660e\u3002&lt;?php\nnamespace ImiDemo\\HttpDemo\\MainServer\\Enum;\n\nuse Imi\\Enum\\BaseEnum;\nuse Imi\\Enum\\Annotation\\EnumItem;\n\nclass Status extends BaseEnum\n{\n    \/**\n     * @EnumItem(&quot;\u6b63\u786e&quot;)\n     *\/\n    const YES = 1;\n\n    \/**\n     * @EnumItem(&quot;\u9519\u8bef&quot;)\n     *\/\n    const NO = 0;\n}\u4f7f\u7528\/\/ \u6839\u636e\u540d\u79f0\u83b7\u5f97\u5e38\u91cf\u503c\nStatus::getValue(&#039;YES&#039;);\n\n\/\/ \u6839\u636e\u503c\u83b7\u5f97\u6587\u5b57\u8bf4\u660e\nStatus::getText(Status::YES);\n\n\/\/ \u6839\u636e\u503c\u83b7\u5f97 @EnumItem \u6ce8\u89e3\u5bf9\u8c61\nStatus::getData(Status::YES);\n\n\/\/ \u83b7\u53d6\u679a\u4e3e\u7c7b\u4e2d\u6240\u6709\u540d\u79f0\nStatus::getNames();\n\n\/\/ \u83b7\u53d6\u679a\u4e3e\u7c7b\u4e2d\u6240\u6709\u503c\nStatus::getValues();"},{"id":147,"title":"FilterableList","pageTitle":"FilterableList","url":"components\/struct\/FilterableList.html","content":"FilterableList\u8fc7\u6ee4\u5b57\u6bb5\u7684\u5217\u8868\uff0c\u6bcf\u4e00\u4e2a\u6210\u5458\u5e94\u8be5\u662f\u6570\u7ec4\u6216\u5bf9\u8c61$data = [\n    [&#039;id&#039;=&gt;1, &#039;name&#039;=&gt;&#039;a&#039;],\n    [&#039;id&#039;=&gt;2, &#039;name&#039;=&gt;&#039;b&#039;],\n];\n\n\/\/ \u4e24\u4e2a\u6beb\u65e0\u610f\u4e49\u7684\u5b9e\u4f8b\u5316\u5199\u6cd5\n$list = new FilterableList;\n$list = new FilterableList($data);\n\/\/ \u53ea\u4fdd\u7559 name \u5b57\u6bb5\n$list = new FilterableList($data, [&#039;name&#039;]);\n$list = new FilterableList($data, [&#039;name&#039;], &#039;allow&#039;);\n\/\/ \u5254\u9664 name \u5b57\u6bb5\n$list = new FilterableList($data, [&#039;name&#039;], &#039;deny&#039;);\n\nforeach($list as $index =&gt; $item)\n{\n    var_dump($index, $item);\n}\n\n\/\/ \u53d6\u5176\u4e2d\u67d0\u4e2a\u6210\u5458\n$item0 = $list[0];\n\n\/\/ \u8f6c\u4e3a\u6570\u7ec4\n$arrayList = $list-&gt;toArray();\nvar_dump($arrayList);\n\n\/\/ \u79fb\u9664\u591a\u4e2a\u6210\u5458\n$arrayList-&gt;remove($list[1], $list[2]);\n\n\/\/ \u6e05\u7a7a\n$arrayList-&gt;clear();\n\n\/\/ \u7edf\u8ba1\u6570\u91cf\necho $arrayList-&gt;count();"},{"id":145,"title":"LazyArrayObject","pageTitle":"LazyArrayObject","url":"components\/struct\/LazyArrayObject.html","content":"LazyArrayObject\u540c\u65f6\u53ef\u4ee5\u4f5c\u4e3a\u6570\u7ec4\u548c\u5bf9\u8c61\u8bbf\u95ee\u7684\u7c7b\/\/ $object = new \\Imi\\Util\\LazyArrayObject;\n$object = new \\Imi\\Util\\LazyArrayObject([\n    &#039;id&#039;    =&gt;  123,\n    &#039;name&#039;  =&gt;  &#039;imi&#039;,\n]);\n\n$object[&#039;id&#039;] = 111;\necho &#039;id:&#039;, $object-&gt;id, PHP_EOL;\n\n$object-&gt;id = 222;\necho &#039;id:&#039;, $object[&#039;id&#039;], PHP_EOL;\n\n$arrayData = $object-&gt;toArray();\nvar_dump($arrayData);"},{"id":142,"title":"MemoryTable","pageTitle":"MemoryTable","url":"components\/struct\/memory-table.html","content":"MemoryTableimi \u652f\u6301 MemoryTableModel\uff0c\u4e5f\u652f\u6301\u76f4\u63a5\u5b9a\u4e49\u548c\u64cd\u4f5cMemoryTable\u3002\u914d\u7f6e\u65b9\u6cd5\/\/ \u5185\u5b58\u8868\u914d\u7f6e\n&#039;memoryTable&#039;   =&gt;  [\n    \/\/ name =&gt; \u914d\u7f6e\n    &#039;t1&#039;    =&gt;  [\n        \/\/ \u5b9a\u4e49\u5b57\u6bb5\n        &#039;columns&#039;   =&gt;  [\n            [&#039;name&#039; =&gt; &#039;name&#039;, &#039;type&#039; =&gt; \\Swoole\\Table::TYPE_STRING, &#039;size&#039; =&gt; 16],\n            [&#039;name&#039; =&gt; &#039;quantity&#039;, &#039;type&#039; =&gt; \\Swoole\\Table::TYPE_INT],\n        ],\n        &#039;lockId&#039;    =&gt;  &#039;atomic&#039;, \/\/ \u9501 ID\uff0c\u975e\u5fc5\u8bbe\u3002\u4e0d\u914d\u7f6e\u5c31\u4e0d\u5141\u8bb8\u4f7f\u7528\u9501\uff0c\u5176\u5b83\u7684\u53ef\u4ee5\u6b63\u5e38\u7528\n    ],\n    &#039;connectContext&#039;    =&gt;  [\n        \/\/ \u6307\u5b9a\u5b9e\u73b0\u4e86 Imi\\Util\\MemoryTable\\IMemoryTableOption \u63a5\u53e3\u7684\u6765\uff0c\u6765\u5b9a\u4e49\u8868\u7ed3\u6784\n        &#039;class&#039; =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\MemoryTable\\ConnectContextOption::class,\n        &#039;lockId&#039;=&gt;  &#039;atomic&#039;, \/\/ \u540c\u4e0a\n    ],\n],\u4f7f\u7528\u65b9\u6cd5\u5199\u5165use Imi\\Util\\MemoryTableManager;\n$key = &#039;a&#039;; \/\/ \u4e3b\u952e\n$value = [\n    &#039;name&#039;      =&gt;  &#039;abc&#039;,\n    &#039;quantity&#039;  =&gt;  123,\n];\nMemoryTableManager::set($tableName, $key, $value);\u8bfb\u53d6\/\/ \u83b7\u53d6\u4e00\u884c\n$row = MemoryTableManager::get($tableName, $key);\n\n\/\/ \u83b7\u53d6\u5355\u4e2a\u5b57\u6bb5\n$field = &#039;quantity&#039;;\n$value = MemoryTableManager::get($tableName, $key, $field);\u5220\u9664MemoryTableManager::del($tableName, $key);\u6570\u636e\u884c\u662f\u5426\u5b58\u5728MemoryTableManager::exist($tableName, $key);\u539f\u5b50\u81ea\u589eMemoryTableManager::incr($tableName, $key, $field); \/\/ +1\nMemoryTableManager::incr($tableName, $key, $field, 123); \/\/ +123\u539f\u5b50\u81ea\u51cfMemoryTableManager::decr($tableName, $key, $field); \/\/ -1\nMemoryTableManager::decr($tableName, $key, $field, 123); \/\/ -123\u83b7\u53d6\u884c\u6570MemoryTableManager::count($tableName);\u52a0\u9501\u6267\u884c\u9700\u8981\u914d\u7f6e lockIdMemoryTableManager::lock($tableName, function(){\n    \/\/ \u65b9\u6cd5\u4f53\u5185\u90e8\u90fd\u5728\u9501\u4e2d\u6267\u884c\uff0c\u6267\u884c\u5b8c\u81ea\u52a8\u91ca\u653e\u9501\n    $row = MemoryTableManager::get($tableName, $key);\n    $row[&#039;quantity&#039;] = 456;\n    MemoryTableManager::set($tableName, $key, $row);\n});\u5b9e\u73b0 IMemoryTableOption \u63a5\u53e3\u793a\u4f8b\u4ee3\u7801\uff1a&lt;?php\nnamespace Imi\\Server\\ConnectContext\\StoreHandler\\MemoryTable;\n\nuse Imi\\Util\\MemoryTable\\IMemoryTableOption;\n\n\/**\n * Swoole \u5185\u5b58\u8868\n *\/\nclass ConnectContextOption implements IMemoryTableOption\n{\n    \/**\n     * \u83b7\u53d6\u914d\u7f6e\n     *\n     * @return array\n     *\/\n    public function getOption($option = null): array\n    {\n        if(!$option)\n        {\n            $option = [];\n        }\n        if(!isset($option[&#039;size&#039;]))\n        {\n            $option[&#039;size&#039;] = 65536;\n        }\n        $option[&#039;columns&#039;] = [\n            [&#039;name&#039; =&gt; &#039;data&#039;, &#039;type&#039; =&gt; \\Swoole\\Table::TYPE_STRING, &#039;size&#039; =&gt; $option[&#039;dataLength&#039;] ?? 1024],\n        ];\n        return $option;\n    }\n\n}"},{"id":138,"title":"swoole-tracker","pageTitle":"swoole-tracker","url":"components\/swoole-tracker.html","content":"swoole-tracker\u4ecb\u7ecd\u5728 imi \u6846\u67b6\u4e2d\u63a5\u5165 Swoole Tracker \u76d1\u63a7Swoole Tracker: https:\/\/www.swoole-cloud.com\/tracker.html\u4f01\u4e1a\u7248\u96c6\u6210\u4e86Facebook\u7684Xhprof\u5de5\u5177\uff0c\u53ef\u4ee5\u751f\u6210\u8c03\u7528\u5806\u6808\u56fe\u548c\u706b\u7130\u56fe\uff0c\u4ea6\u53ef\u751f\u6210\u5206\u5c42\u5206\u6790\u8868\u683c\uff0c\u65b9\u4fbf\u627e\u5230\u7a0b\u5e8f\u74f6\u9888\u70b9\u8fdb\u884c\u4f18\u5316\u3002\u4e3a\u89e3\u51b3PHP\u5e38\u9a7b\u8fdb\u7a0b\u7684\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff0c\u4f01\u4e1a\u7248\u4e13\u95e8\u9488\u5bf9PHP\u7684\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u5de5\u5177\uff0c\u65b9\u4fbf\u5feb\u901f\u7684\u89e3\u51b3\u548c\u5b9a\u4f4d\u5185\u5b58\u6301\u7eed\u589e\u957f\u95ee\u9898\u3002Swoole\u5f02\u6b65\/\u534f\u7a0b\u6a21\u5f0f\u4ee5\u53caReactPHP\u7b49\u4f17\u591a\u6846\u67b6\u6700\u81f4\u547d\u7684\u5c31\u662f\u963b\u585e\u8c03\u7528\uff0c\u4f1a\u8ba9\u5e76\u53d1\u5927\u5927\u964d\u4f4e\uff0c\u4e3a\u6b64\u6211\u4eec\u5f00\u53d1\u4e86\u6beb\u79d2\u7ea7\u963b\u585e\u68c0\u6d4b\u5de5\u5177\uff0c\u8fc5\u901f\u5b9a\u4f4d\u5bfc\u81f4\u963b\u585e\u7684\u4ee3\u7801\u3002\u81ea\u52a8\u6293\u53d6FPM\u3001CLI\u8fdb\u7a0b\u6570\u91cf\uff0c\u7edf\u8ba1CPU\u3001\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3002\u6240\u6709\u5de5\u5177\u96f6\u90e8\u7f72\u6210\u672c\uff0c\u540e\u53f0\u4e00\u952e\u5f00\u542f\u5173\u95ed\u5404\u79cd\u68c0\u6d4b\uff0c\u5b8c\u7f8e\u652f\u6301PHP7\u3002Swoole Tracker\u76ee\u524dSwoole Tracker\u7684v2.5.0\u7248\u672c\u652f\u6301\u81ea\u52a8\u751f\u6210\u5e94\u7528\u540d\u79f0\u5e76\u521b\u5efa\u5e94\u7528\uff0c\u65e0\u9700\u4fee\u6539\u4efb\u4f55\u4ee3\u7801\uff0c\u751f\u6210\u7684\u5e94\u7528\u540d\u79f0\u683c\u5f0f\u4e3a\uff1aSwoole\u7684HttpServer\uff1aip:prot\u5176\u4ed6\u7684Server\uff1aip(hostname):prot\u5373\u5b89\u88c5\u597dswoole_tracker\u6269\u5c55\u4e4b\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528Swoole Tracker\u7684\u529f\u80fd\u7ec4\u4ef6\u57fa\u672c\u4f7f\u7528\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-swoole-tracker&quot;: &quot;~1.0&quot;\n    }\n}\u6267\u884c composer update \u5b89\u88c5\u3002\u5728\u9879\u76ee config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;components&#039;    =&gt;  [\n        \/\/ \u5f15\u5165\u672c\u7ec4\u4ef6\n        &#039;SwooleTracker&#039;       =&gt;  &#039;Imi\\SwooleTracker&#039;,\n    ],\n]Http \u670d\u52a1\u5728\u670d\u52a1\u5668\u7684 config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;beans&#039;    =&gt;    [\n        &#039;HttpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \u2026\u2026 \/\/ \u4f60\u7684\u5176\u4ed6\u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Http\\Middleware\\RouteMiddleware::class,\n                &quot;SwooleTrackerHttpMiddleware&quot;, \/\/ \u653e\u5728 RouteMiddlware \u540e\n            ],\n        ],\n        &#039;SwooleTrackerHttpMiddleware&#039;   =&gt;  [\n            &#039;serviceName&#039;   =&gt; &#039;imi-http-example&#039;, \/\/ \u670d\u52a1\u540d\n            \/\/ &#039;serverIp&#039;      =&gt; null, \/\/ \u670d\u52a1\u5668 IP\uff0c\u9ed8\u8ba4\u83b7\u53d6\u5f53\u524d\u7f51\u5361 IP\n            \/\/ &#039;interface&#039;     =&gt; null, \/\/ \u7f51\u5361 interface \u540d\uff0c\u81ea\u52a8\u83b7\u53d6\u5f53\u524d\u7f51\u5361IP\u65f6\u6709\u6548\n            \/\/ &#039;successStatusCode&#039; =&gt; 200, \/\/ \u6210\u529f\u7684 Http \u72b6\u6001\u7801\n        ],\n    ],\n];WebSocket \u670d\u52a1\u5728\u670d\u52a1\u5668\u7684 config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;beans&#039;    =&gt;    [\n        &#039;WebSocketDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \u2026\u2026 \/\/ \u4f60\u7684\u5176\u4ed6\u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\WebSocket\\Middleware\\RouteMiddleware::class,\n                &quot;SwooleTrackerWebSocketMiddleware&quot;, \/\/ \u653e\u5728 RouteMiddlware \u540e\n            ],\n        ],\n        &#039;SwooleTrackerWebSocketMiddleware&#039;  =&gt;  [\n            &#039;serviceName&#039;       =&gt; &#039;imi-websocket-example&#039;, \/\/ \u670d\u52a1\u540d\n            \/\/ &#039;serverIp&#039;          =&gt; null, \/\/ \u670d\u52a1\u5668 IP\uff0c\u9ed8\u8ba4\u83b7\u53d6\u5f53\u524d\u7f51\u5361 IP\n            \/\/ &#039;interface&#039;         =&gt; null, \/\/ \u7f51\u5361 interface \u540d\uff0c\u81ea\u52a8\u83b7\u53d6\u5f53\u524d\u7f51\u5361IP\u65f6\u6709\u6548\n            \/\/ &#039;successCode&#039;       =&gt;  500, \/\/ \u5f53\u6210\u529f\u65f6\u4e0a\u62a5\u7684\u9ed8\u8ba4code\n            \/\/ &#039;exceptionCode&#039;     =&gt;  500, \/\/ \u5f53\u53d1\u751f\u5f02\u5e38\u65f6\u4e0a\u62a5\u7684\u9ed8\u8ba4code\n            \/\/ \u6307\u5b9a\u83b7\u53d6\u8bf7\u6c42\u65b9\u6cd5\u540d\u7684\u53c2\u6570\uff0c\u5fc5\u987b\u6709\n            &#039;nameHandler&#039;       =&gt;  function(\\Imi\\Server\\WebSocket\\Message\\IFrame $frame){\n                return $frame-&gt;getFormatData()-&gt;action ?? &#039;unknown&#039;; \/\/ \u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\n            },\n        ],\n    ],\n];TCP \u670d\u52a1\u5728\u670d\u52a1\u5668\u7684 config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;beans&#039;    =&gt;    [\n        &#039;TcpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \u2026\u2026 \/\/ \u4f60\u7684\u5176\u4ed6\u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\TcpServer\\Middleware\\RouteMiddleware::class,\n                &quot;SwooleTrackerTCPMiddleware&quot;, \/\/ \u653e\u5728 RouteMiddlware \u540e\n            ],\n        ],\n        &#039;SwooleTrackerTCPMiddleware&#039;  =&gt;  [\n            &#039;serviceName&#039;       =&gt; &#039;imi-tcp-example&#039;, \/\/ \u670d\u52a1\u540d\n            \/\/ &#039;serverIp&#039;          =&gt; null, \/\/ \u670d\u52a1\u5668 IP\uff0c\u9ed8\u8ba4\u83b7\u53d6\u5f53\u524d\u7f51\u5361 IP\n            \/\/ &#039;interface&#039;         =&gt; null, \/\/ \u7f51\u5361 interface \u540d\uff0c\u81ea\u52a8\u83b7\u53d6\u5f53\u524d\u7f51\u5361IP\u65f6\u6709\u6548\n            \/\/ &#039;successCode&#039;       =&gt;  500, \/\/ \u5f53\u6210\u529f\u65f6\u4e0a\u62a5\u7684\u9ed8\u8ba4code\n            \/\/ &#039;exceptionCode&#039;     =&gt;  500, \/\/ \u5f53\u53d1\u751f\u5f02\u5e38\u65f6\u4e0a\u62a5\u7684\u9ed8\u8ba4code\n            \/\/ \u6307\u5b9a\u83b7\u53d6\u8bf7\u6c42\u65b9\u6cd5\u540d\u7684\u53c2\u6570\uff0c\u5fc5\u987b\u6709\n            &#039;nameHandler&#039;       =&gt;  function(\\Imi\\Server\\TcpServer\\Message\\IReceiveData $data){\n                return $data-&gt;getFormatData()-&gt;action ?? &#039;unknown&#039;; \/\/ \u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\n            },\n        ],\n    ],\n];UDP \u670d\u52a1\u5728\u670d\u52a1\u5668\u7684 config\/config.php \u4e2d\u914d\u7f6e\uff1a[\n    &#039;beans&#039;    =&gt;    [\n        &#039;UdpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \u2026\u2026 \/\/ \u4f60\u7684\u5176\u4ed6\u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\UdpServer\\Middleware\\RouteMiddleware::class,\n                &quot;SwooleTrackerUDPMiddleware&quot;, \/\/ \u653e\u5728 RouteMiddlware \u540e\n            ],\n        ],\n        &#039;SwooleTrackerUDPMiddleware&#039;  =&gt;  [\n            &#039;serviceName&#039;       =&gt; &#039;imi-udp-example&#039;, \/\/ \u670d\u52a1\u540d\n            \/\/ &#039;serverIp&#039;          =&gt; null, \/\/ \u670d\u52a1\u5668 IP\uff0c\u9ed8\u8ba4\u83b7\u53d6\u5f53\u524d\u7f51\u5361 IP\n            \/\/ &#039;interface&#039;         =&gt; null, \/\/ \u7f51\u5361 interface \u540d\uff0c\u81ea\u52a8\u83b7\u53d6\u5f53\u524d\u7f51\u5361IP\u65f6\u6709\u6548\n            \/\/ &#039;successCode&#039;       =&gt;  500, \/\/ \u5f53\u6210\u529f\u65f6\u4e0a\u62a5\u7684\u9ed8\u8ba4code\n            \/\/ &#039;exceptionCode&#039;     =&gt;  500, \/\/ \u5f53\u53d1\u751f\u5f02\u5e38\u65f6\u4e0a\u62a5\u7684\u9ed8\u8ba4code\n            &#039;nameHandler&#039;       =&gt;  function(\\Imi\\Server\\UdpServer\\Message\\IPacketData $data){\n                return $data-&gt;getFormatData()-&gt;action ?? &#039;unknown&#039;; \/\/ \u4ee3\u7801\u4ec5\u4f9b\u53c2\u8003\n            },\n        ],\n    ],\n];\u8fdb\u9636\u4f7f\u7528\u5982\u679c\u8bf7\u6c42\u4ea7\u751f\u5f02\u5e38\uff0c\u81ea\u52a8\u4e0a\u62a5\u5931\u8d25\uff0c\u9519\u8bef\u7801\u4e3a\u5f02\u5e38 code\u3002\u4f60\u4e5f\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u6307\u5b9a\u662f\u5426\u6210\u529f\u548c\u9519\u8bef\u7801\uff0c\u4f8b\u5b50\uff1aRequestContext::set(&#039;imi.tracker.success&#039;, false);\nRequestContext::set(&#039;imi.tracker.code&#039;, 19260817);"},{"id":117,"title":"\u5b9a\u65f6\u4efb\u52a1","pageTitle":"\u5b9a\u65f6\u4efb\u52a1","url":"components\/task\/cron.html","content":"\u5b9a\u65f6\u4efb\u52a1\u8bf4\u660e\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u6709\u4e00\u4e9b\u4efb\u52a1\u662f\u9700\u8981\u5b9a\u65f6\u6267\u884c\u7684\u3002\u867d\u7136\u6709 cron\u3001crontab\u3001systemd \u7b49\u7cfb\u7edf\u7ea7\u5185\u7f6e\u7684\uff0c\u5b9a\u65f6\u4efb\u52a1\u5de5\u5177\u5b58\u5728\u3002\u4f46\u662f\u4ed6\u4eec\u7684\u4e00\u4e9b\u8ba9\u4eba\u6389\u5934\u53d1\u7684\u914d\u7f6e\u5199\u6cd5\uff0c\u4ee5\u53ca\u589e\u52a0\u8fd0\u7ef4\u5fc3\u667a\u8d1f\u62c5\uff0c\u65e0\u6cd5\u9002\u5e94\u591a\u5b9e\u4f8b\u90e8\u7f72\u573a\u666f\u7b49\u7b49\u539f\u56e0\uff0c\u52bf\u5fc5\u9700\u8981\u5728 imi \u6846\u67b6\u4e2d\u63d0\u4f9b\u8fd9\u4e2a\u529f\u80fd\u3002\u8bbe\u8ba1imi \u901a\u8fc7\u589e\u52a0\u4e00\u4e2a CronProcess \u8fdb\u7a0b\u7528\u4e8e\u5b9a\u65f6\u4efb\u52a1\u7684\u8c03\u5ea6\u548c\u6267\u884c\uff0c\u4f7f\u7528 Redis \u4f5c\u4e3a\u6570\u636e\u5b58\u50a8\u3002\u5b9a\u65f6\u4efb\u52a1\u652f\u6301\u5728\u4ee5\u4e0b\u8fdb\u7a0b\u4e2d\u6267\u884c\uff1a Task \u8fdb\u7a0b\u3001Worker \u8fdb\u7a0b\uff0c\u4e5f\u652f\u6301\u65b0\u8fd0\u884c\u4e00\u4e2a Process \u8fdb\u7a0b\u3002\u652f\u6301\u8bbe\u7f6e\u67d0\u8fdb\u7a0b\u5728\u5f53\u524d\u5b9e\u4f8b\/\u591a\u5b9e\u4f8b\u4e2d\u53ea\u8fd0\u884c\u4e00\u4e2a\u3002\u4f7f\u7528\u542f\u7528\u5b9a\u65f6\u4efb\u52a1\u8fdb\u7a0b\u5fc5\u987b\u5728\u9879\u76ee config.php \u7684 beans \u4e2d\u52a0\u5165\u914d\u7f6e\u542f\u7528\u5b9a\u65f6\u4efb\u52a1\u8fdb\u7a0b\uff0c\u5426\u5219\u6240\u6709\u5b9a\u65f6\u4efb\u52a1\u90fd\u65e0\u6cd5\u751f\u6548\u3002\u914d\u7f6e\u4ee3\u7801\uff1a&#039;AutoRunProcessManager&#039;   =&gt;  [\n    &#039;processes&#039; =&gt;  [\n        &#039;CronProcess&#039;,\n    ],\n],\u5b9a\u4e49\u4efb\u52a1Task \u4efb\u52a1\u4e0e\u5f02\u6b65\u4efb\u52a1\u5199\u6cd5\u57fa\u672c\u4e00\u81f4\uff0c\u591a\u4e86@Cron\u6ce8\u89e3\uff0c\u5e76\u4e14\u9700\u8981\u4e0a\u62a5\u4efb\u52a1\u5b8c\u6210\uff01&lt;?php\nnamespace Imi\\Test\\HttpServer\\Cron;\n\nuse Imi\\Task\\TaskParam;\nuse Imi\\Cron\\Annotation\\Cron;\nuse Imi\\Task\\Annotation\\Task;\nuse Imi\\Cron\\Util\\CronUtil;\nuse Imi\\Task\\Interfaces\\ITaskHandler;\n\n\/**\n * @Cron(id=&quot;TaskCron&quot;, second=&quot;3n&quot;, data={&quot;id&quot;:&quot;TaskCron&quot;})\n * @Task(&quot;CronTask1&quot;)\n *\/\nclass TaskCron implements ITaskHandler\n{\n    \/**\n     * \u4efb\u52a1\u5904\u7406\u65b9\u6cd5\n     * @param TaskParam $param\n     * @param \\Swoole\\Server $server\n     * @param integer $taskID\n     * @param integer $WorkerID\n     * @return void\n     *\/\n    public function handle(TaskParam $param, \\Swoole\\Server $server, int $taskID, int $workerID)\n    {\n        \/\/ \u4e0a\u62a5\u4efb\u52a1\u5b8c\u6210\n        CronUtil::reportCronResult($param-&gt;getData()[&#039;id&#039;], true, &#039;&#039;);\n        return date(&#039;Y-m-d H:i:s&#039;);\n    }\n \n    \/**\n     * \u4efb\u52a1\u7ed3\u675f\u65f6\u89e6\u53d1\n     * @param \\swoole_server $server\n     * @param int $taskId\n     * @param mixed $data\n     * @return void\n     *\/\n    public function finish(\\Swoole\\Server $server, int $taskID, $data)\n    {\n    }\n\n}Process \u4efb\u52a1\u4e0e\u8fdb\u7a0b\u5199\u6cd5\u57fa\u672c\u4e00\u81f4\uff0c\u591a\u4e86@Cron\u6ce8\u89e3\uff0c\u5e76\u4e14\u9700\u8981\u4e0a\u62a5\u4efb\u52a1\u5b8c\u6210\uff01&lt;?php\nnamespace Imi\\Test\\HttpServer\\Cron;\n\nuse Imi\\Util\\Args;\nuse Imi\\Process\\IProcess;\nuse Imi\\Cron\\Annotation\\Cron;\nuse Imi\\Cron\\Util\\CronUtil;\nuse Imi\\Process\\Annotation\\Process;\nuse Swoole\\Event;\n\n\/**\n * @Cron(id=&quot;CronProcess1&quot;, second=&quot;3n&quot;)\n * @Process(&quot;CronProcess1&quot;)\n *\/\nclass TaskProcess implements IProcess\n{\n    public function run(\\Swoole\\Process $process)\n    {\n        $success = false;\n        $message = &#039;&#039;;\n        try {\n            $id = Args::get(&#039;id&#039;);\n            if(null === $id)\n            {\n                return;\n            }\n            $data = json_decode(Args::get(&#039;data&#039;), true);\n            $success = true;\n        } catch(\\Throwable $th) {\n            $message = $th-&gt;getMessage();\n            throw $th;\n        } finally {\n            \/\/ \u4e0a\u62a5\u4efb\u52a1\u5b8c\u6210\n            CronUtil::reportCronResult($id, $success, $message);\n        }\n    }\n\n}\u534f\u7a0b\u4efb\u52a1\u5b9e\u73b0 Imi\\Cron\\Contract\\ICronTask \u63a5\u53e3\u3001run() \u65b9\u6cd5\uff0c\u65e0\u9700\u624b\u52a8\u4e0a\u62a5\u4efb\u52a1\u5b8c\u6210\u3002&lt;?php\nnamespace Imi\\Test\\HttpServer\\Cron;\n\nuse Imi\\Cron\\Annotation\\Cron;\nuse Imi\\Cron\\Contract\\ICronTask;\n\n\/**\n * @Cron(id=&quot;CronRandomWorker&quot;, second=&quot;3n&quot;, type=&quot;random_worker&quot;)\n *\/\nclass CronRandomWorker implements ICronTask\n{\n    \/**\n     * \u6267\u884c\u4efb\u52a1\n     *\n     * @param string $id\n     * @param mixed $data\n     * @return void\n     *\/\n    public function run(string $id, $data)\n    {\n        var_dump(&#039;random&#039;);\n    }\n\n}\u5b9a\u65f6\u89c4\u5219\u652f\u6301\u6ce8\u89e3\u8bbe\u5b9a\u548c\u914d\u7f6e\u6587\u4ef6\u8bbe\u5b9a\u4e24\u79cd\u6a21\u5f0f\uff0c\u5176\u4e2d\u914d\u7f6e\u6587\u4ef6\u8bbe\u5b9a\uff0c\u662f\u53ef\u4ee5\u8986\u76d6\u6ce8\u89e3\u8bbe\u5b9a\u7684\u3002\u6ce8\u89e3\u8bbe\u5b9a\u6ce8\u89e3 @Cron\uff0c\u7c7b Imi\\Cron\\Annotation\\Cron@Cron(id=&quot;\u4efb\u52a1\u552f\u4e00ID&quot;, type=&quot;&quot;, year=&quot;&quot;, month=&quot;&quot;, day=&quot;&quot;, hour=&quot;&quot;, minute=&quot;&quot;, second=&quot;&quot;, unique=null, redisPool=&quot;&quot;, lockWaitTimeout=&quot;&quot;, maxExecutionTime=&quot;&quot;, force=false)\u5c5e\u6027id\u4f7f\u7528@Cron\u6ce8\u89e3\u65f6\u7684\u4efb\u52a1\u552f\u4e00ID\u3002\u5982\u679c\u662f Task\u3001Process\uff0c\u9ed8\u8ba4\u4f7f\u7528 Task \u6216 Process + \u540d\u79f0\u3002type\u4efb\u52a1\u7c7b\u578b\u53ef\u9009\uff1arandom_worker-\u968f\u673a\u5de5\u4f5c\u8fdb\u7a0b\u4efb\u52a1all_worker-\u6240\u6709\u5de5\u4f5c\u8fdb\u7a0b\u6267\u884c\u7684\u4efb\u52a1task-\u540e\u53f0\u4efb\u52a1process-\u8fdb\u7a0bcron_process-\u5b9a\u65f6\u4efb\u52a1\u8fdb\u7a0bforce\u6bcf\u6b21\u542f\u52a8\u670d\u52a1\u5f3a\u5236\u6267\u884c\uff0c\u9ed8\u8ba4\u4e3afalseyear\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u5e74\u4efd\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52362019 - \u6307\u5b9a\u5e742019-2022 - \u6307\u5b9a\u5e74\u4efd\u533a\u95f42019,2021,2022 - \u6307\u5b9a\u591a\u4e2a\u5e74\u4efd2n - \u6bcf 2 \u5e74\uff0c\u5176\u5b83\u4ee5\u6b64\u7c7b\u63a8month\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u6708\u4efd\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52361 (1 \u6708), -1 (12 \u6708) - \u6307\u5b9a\u6708\u4efd\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u67081-6 (1-6 \u6708), -3--1 (10-12 \u6708) - \u6307\u5b9a\u6708\u4efd\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u67081,3,5,-1 (1\u30013\u30015\u300112 \u6708) - \u6307\u5b9a\u591a\u4e2a\u6708\u4efd\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u67082n - \u6bcf 2 \u4e2a\u6708\uff0c\u5176\u5b83\u4ee5\u6b64\u7c7b\u63a8day\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u65e5\u671f\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52361 (1 \u65e5), -1 (\u6bcf\u6708\u6700\u540e\u4e00\u5929) - \u6307\u5b9a\u65e5\u671f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671f1-6 (1-6 \u65e5), -3--1 (\u6bcf\u6708\u5012\u6570 3 \u5929) - \u6307\u5b9a\u65e5\u671f\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671f1,3,5,-1 (\u6bcf\u6708 1\u30013\u30015\u3001\u6700\u540e\u4e00\u5929) - \u6307\u5b9a\u591a\u4e2a\u65e5\u671f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671f2n - \u6bcf 2 \u5929\uff0c\u5176\u5b83\u4ee5\u6b64\u7c7b\u63a8year 1 (\u4e00\u5e74\u4e2d\u7684\u7b2c 1 \u65e5), year -1 (\u6bcf\u5e74\u6700\u540e\u4e00\u5929) - \u6307\u5b9a\u4e00\u5e74\u4e2d\u7684\u65e5\u671f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671f1-6 (\u4e00\u5e74\u4e2d\u7684\u7b2c 1-6 \u65e5), -3--1 (\u6bcf\u5e74\u5012\u6570 3 \u5929) - \u6307\u5b9a\u4e00\u5e74\u4e2d\u7684\u65e5\u671f\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671fyear 1-6 (\u4e00\u5e74\u4e2d\u7684\u7b2c 1-6 \u65e5), year -3--1 (\u6bcf\u5e74\u5012\u6570 3 \u5929) - \u6307\u5b9a\u4e00\u5e74\u4e2d\u7684\u65e5\u671f\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671f1,3,5,-1 (\u6bcf\u5e74 1\u30013\u30015\u3001\u6700\u540e\u4e00\u5929) - \u6307\u5b9a\u4e00\u5e74\u4e2d\u7684\u591a\u4e2a\u65e5\u671f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671fyear 1,3,5,-1 (\u6bcf\u5e74 1\u30013\u30015\u3001\u6700\u540e\u4e00\u5929) - \u6307\u5b9a\u4e00\u5e74\u4e2d\u7684\u591a\u4e2a\u65e5\u671f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u65e5\u671fweek\u6307\u5b9a\u5468\u51e0\u6267\u884c\u4efb\u52a1\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52361 (\u5468\u4e00), -1 (\u5468\u65e5) - \u6307\u5b9a\u5468\u51e0\uff081-7\uff09\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u54681-6 (\u5468\u4e00\u5230\u5468\u516d), -3--1 (\u5468\u4e94\u5230\u5468\u65e5) - \u6307\u5b9a\u5468\u51e0\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u54681,3,5,-1 (\u5468\u4e00\u3001\u4e09\u3001\u4e94\u3001\u65e5) - \u6307\u5b9a\u591a\u4e2a\u65e5\u671f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5468hour\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u5c0f\u65f6\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52360 (0 \u70b9), -1 (23 \u70b9) - \u6307\u5b9a\u5c0f\u65f6\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5c0f\u65f61-6 (1-6 \u5e97), -3--1 (21-23 \u70b9) - \u6307\u5b9a\u5c0f\u65f6\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5c0f\u65f61,3,5,-1 (1\u30013\u30015\u300123 \u70b9) - \u6307\u5b9a\u591a\u4e2a\u5c0f\u65f6\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5c0f\u65f62n - \u6bcf 2 \u5c0f\u65f6\uff0c\u5176\u5b83\u4ee5\u6b64\u7c7b\u63a8minute\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u5206\u949f\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52360 (0 \u5206), -1 (59 \u5206) - \u6307\u5b9a\u5206\u949f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5206\u949f1-6 (1-6 \u5206), -3--1 (57-59 \u5206) - \u6307\u5b9a\u5206\u949f\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5206\u949f1,3,5,-1 (1\u30013\u30015\u300159 \u5206) - \u6307\u5b9a\u591a\u4e2a\u5206\u949f\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u5206\u949f2n - \u6bcf 2 \u5206\u949f\uff0c\u5176\u5b83\u4ee5\u6b64\u7c7b\u63a8second\u6307\u5b9a\u4efb\u52a1\u6267\u884c\u79d2\uff0c\u9ed8\u8ba4\u4e3a *\u3002* - \u4e0d\u9650\u52360 (0 \u79d2), -1 (59 \u79d2) - \u6307\u5b9a\u79d2\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u79d21-6 (1-6 \u79d2), -3--1 (57-59 \u79d2) - \u6307\u5b9a\u79d2\u533a\u95f4\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u79d21,3,5,-1 (1\u30013\u30015\u300159 \u79d2) - \u6307\u5b9a\u591a\u4e2a\u79d2\uff0c\u652f\u6301\u8d1f\u6570\u4e3a\u5012\u6570\u7684\u79d22n - \u6bcf 2 \u79d2\uff0c\u5176\u5b83\u4ee5\u6b64\u7c7b\u63a8unique\u5b9a\u65f6\u4efb\u52a1\u552f\u4e00\u6027\u8bbe\u7f6e\u5f53\u524d\u5b9e\u4f8b\u552f\u4e00: current\u6240\u6709\u5b9e\u4f8b\u552f\u4e00: all\u4e0d\u552f\u4e00: nullredisPool\u7528\u4e8e\u9501\u7684 Redis \u8fde\u63a5\u6c60\u540dlockWaitTimeout\u83b7\u53d6\u9501\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2maxExecutionTime\u6700\u5927\u8fd0\u884c\u6267\u884c\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\u3002\u8be5\u503c\u4e0e\u5206\u5e03\u5f0f\u9501\u8d85\u65f6\u65f6\u95f4\u5171\u4eab\uff0c\u9ed8\u8ba4\u4e3a 60 \u79d2\u914d\u7f6e\u6587\u4ef6\u8bbe\u5b9a\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff0cbeans \u8282\u4e2d\u914d\u7f6e[\n    &#039;CronManager&#039;   =&gt;  [\n        &#039;tasks&#039; =&gt;  [\n            \/\/ \u4efb\u52a1\u552f\u4e00ID\n            &#039;taskName&#039;  =&gt;  [\n                \/\/ \u4efb\u52a1\u7c7b\u578b\uff0c\u53ef\u9009\uff1aworker-\u5de5\u4f5c\u8fdb\u7a0b\u4efb\u52a1; task-\u4efb\u52a1; process-\u8fdb\u7a0b\n                &#039;type&#039;      =&gt;  &#039;worker&#039;,\n                \/\/ \u4efb\u52a1\u6267\u884c\u56de\u8c03\uff0c\u53ef\u4ee5\u662fcallable\u7c7b\u578b\uff0c\u4e5f\u53ef\u4ee5\u662f task\u3001process \u540d\n                &#039;task&#039;      =&gt;  mixed,\n                \/\/ \u5b9a\u65f6\u914d\u7f6e\n                &#039;cron&#039;     =&gt;  [\n                    \/\/ \u652f\u6301\u591a\u4e2a\u6761\u4ef6\u53bb\u89e6\u53d1\n                    \/\/ \u89c4\u5219\u540c @Cron \u6ce8\u89e3\n                    [\n                        &#039;year&#039;  =&gt;  &#039;&#039;,\n                        &#039;month&#039; =&gt;  &#039;&#039;,\n                        &#039;day&#039;   =&gt;  &#039;&#039;,\n                        &#039;week&#039;  =&gt;  &#039;&#039;,\n                        &#039;hour&#039;  =&gt;  &#039;&#039;,\n                        &#039;minute&#039;=&gt;  &#039;&#039;,\n                        &#039;second&#039;=&gt;  &#039;&#039;,\n                    ],\n                ],\n                \/\/ \u53ef\u9009\u914d\u7f6e\n                &#039;data&#039;              =&gt;  null,\n                &#039;unique&#039;            =&gt;  null,\n                &#039;redisPool&#039;         =&gt;  &#039;redis&#039;,\n                &#039;lockWaitTimeout&#039;   =&gt;  10,\n                &#039;maxExecutionTime&#039;  =&gt;  120,\n                &#039;force&#039;             =&gt;  false,\n            ],\n        ],\n    ],\n]\u52a8\u6001\u7ef4\u62a4\u589e\u52a0\u5b9a\u65f6\u4efb\u52a1use Imi\\Cron\\Util\\CronUtil;\nuse Imi\\Cron\\Annotation\\Cron;\nuse Imi\\Test\\HttpServer\\Cron\\CronDWorker;\n\n$cron = new Cron;\n$cron-&gt;id = &#039;CronRandomWorkerTest&#039;;\n$cron-&gt;second = &#039;3n&#039;;\n$cron-&gt;type = &#039;random_worker&#039;;\nCronUtil::addCron($cron, CronDWorker::class);\u79fb\u9664\u5b9a\u65f6\u4efb\u52a1use Imi\\Cron\\Util\\CronUtil;\n\nCronUtil::removeCron(&#039;\u4efb\u52a1ID&#039;);"},{"id":116,"title":"\u540e\u53f0\u4efb\u52a1","pageTitle":"\u540e\u53f0\u4efb\u52a1","url":"components\/task\/index.html","content":"\u540e\u53f0\u4efb\u52a1\u8bf4\u660e\u5728\u540e\u53f0\u4efb\u52a1\u4e2d\uff0c\u56e0\u4e3a\u662f\u8fd0\u884c\u5728task\u8fdb\u7a0b\uff0c\u6240\u4ee5\u65e0\u6cd5\u4f7f\u7528\u534f\u7a0b\u548c\u534f\u7a0b\u5ba2\u6237\u7aef\u3002\u5982\u679c\u4f60\u8981\u64cd\u4f5c\u6570\u636e\u5e93\u6216Redis\uff0c\u4e00\u5b9a\u8981\u914d\u7f6e\u540c\u6b65\u7684\u8fde\u63a5\u6c60\u3002\u914d\u7f6e\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\u4e2dmainServer.configs.task_worker_num\u4e00\u5b9a\u8981\u914d\u7f6e\u4e3a\u5927\u4e8e0\uff0c\u5426\u5219\u65e0\u6cd5\u4f7f\u7528\u540e\u53f0\u4efb\u52a1\u3002\u5b9a\u4e49\u4efb\u52a1\u6267\u884c\u7c7b&lt;?php\nnamespace Test;\n\nuse Imi\\Task\\TaskParam;\nuse Imi\\Task\\Interfaces\\ITaskHandler;\n\nclass Test implements ITaskHandler\n{\n    \/**\n     * \u4efb\u52a1\u5904\u7406\u65b9\u6cd5\n     * @param TaskParam $param\n     * @param \\Swoole\\Server $server\n     * @param integer $taskID\n     * @param integer $WorkerID\n     * @return void\n     *\/\n    public function handle(TaskParam $param, \\Swoole\\Server $server, int $taskID, int $workerID)\n    {\n        \/\/ \u6295\u9012\u4efb\u52a1\u65f6\u7684\u6570\u636e\n        $data = $param-&gt;getData();\n    }\n\n    \/**\n     * \u4efb\u52a1\u7ed3\u675f\u65f6\u89e6\u53d1\n     * @param \\swoole_server $server\n     * @param int $taskId\n     * @param mixed $data\n     * @return void\n     *\/\n    public function finish(\\Swoole\\Server $server, int $taskID, $data)\n    {\n        \n    }\n}\u7c7b\u540d\u65e0\u6240\u8c13\uff0c\u5b9e\u73b0ITaskHandler\u63a5\u53e3\u548c\u4e24\u4e2a\u65b9\u6cd5\u5373\u53ef\u3002\u6295\u9012\u4efb\u52a1\u6295\u9012\u5f02\u6b65\u4efb\u52a1TaskManager::post(new TaskInfo(\n    \/\/ \u4e0a\u9762\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\n    new TestTask,\n    \/\/ \u6267\u884c\u4efb\u52a1\u7684\u53c2\u6570\uff0c\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u6570\u7ec4\n    new TaskParam([\n        &#039;time&#039;    =&gt;    time(),\n    ])\n));\u8c03\u7528\u540e\u7acb\u5373\u8fd4\u56de\uff0c\u4e0d\u5f71\u54cd\u4e0b\u9762\u4ee3\u7801\u7684\u6267\u884c\u540c\u6b65\u6295\u9012\u4efb\u52a1TaskManager::postWait(new TaskInfo(\n    \/\/ \u4e0a\u9762\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\n    new TestTask,\n    \/\/ \u6267\u884c\u4efb\u52a1\u7684\u53c2\u6570\uff0c\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u6570\u7ec4\n    new TaskParam([\n        &#039;time&#039;    =&gt;    time(),\n    ])),\n    \/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n    0.5\n);\u6295\u9012\u4efb\u52a1\u540e\u963b\u585e\u7b49\u5f85\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\uff0c\u8fd4\u56de\u503c\u4e3a\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u6216false\u534f\u7a0b\u6279\u91cf\u6295\u9012\u4efb\u52a1TaskManager::postCo([new TaskInfo(\n    \/\/ \u4e0a\u9762\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\n    new TestTask,\n    \/\/ \u6267\u884c\u4efb\u52a1\u7684\u53c2\u6570\uff0c\u6784\u9020\u65b9\u6cd5\u53ef\u4ee5\u63a5\u6536\u4e00\u4e2a\u6570\u7ec4\n    new TaskParam([\n        &#039;time&#039;    =&gt;    time(),\n    ])\n)],\n\/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n0.5);\u4f20\u5165\u6570\u7ec4\u548c\u8d85\u65f6\u65f6\u95f4\uff0c\u6295\u9012\u540e\u6302\u8d77\u534f\u7a0b\uff0c\u5f53\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\u540e\u8fd4\u56de\u7ed3\u679c\u3002\u8fd4\u56de\u503c\u4e3a\u6570\u7ec4\uff0c\u5bf9\u5e94\u6bcf\u4e2a\u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\u3002\u6ce8\u89e3\u5b9a\u4e49\u4efb\u52a1\u6267\u884c\u7c7b&lt;?php\nnamespace Test;\n\nuse Imi\\Task\\TaskParam;\nuse Imi\\Task\\Annotation\\Task;\nuse Imi\\Task\\Interfaces\\ITaskHandler;\n\n\/**\n * @Task(&quot;testTask&quot;)\n *\/\nclass Test implements ITaskHandler\n{\n    \/**\n     * \u4efb\u52a1\u5904\u7406\u65b9\u6cd5\n     * @param TaskParam $param\n     * @param \\Swoole\\Server $server\n     * @param integer $taskID\n     * @param integer $WorkerID\n     * @return void\n     *\/\n    public function handle(TaskParam $param, \\Swoole\\Server $server, int $taskID, int $workerID)\n    {\n        \/\/ \u6295\u9012\u4efb\u52a1\u65f6\u7684\u6570\u636e\n        $data = $param-&gt;getData();\n    }\n\n    \/**\n     * \u4efb\u52a1\u7ed3\u675f\u65f6\u89e6\u53d1\n     * @param \\swoole_server $server\n     * @param int $taskId\n     * @param mixed $data\n     * @return void\n     *\/\n    public function finish(\\Swoole\\Server $server, int $taskID, $data)\n    {\n        \n    }\n}\u7c7b\u540d\u65e0\u6240\u8c13\uff0c\u5b9e\u73b0ITaskHandler\u63a5\u53e3\u548c\u4e24\u4e2a\u65b9\u6cd5\u5373\u53ef\u3002\u6295\u9012\u4efb\u52a1\u6295\u9012\u5f02\u6b65\u4efb\u52a1TaskManager::nPost(\n\/\/ \u4efb\u52a1\u540d\u79f0\n&#039;testTask&#039;\n\/\/ \u4efb\u52a1\u53c2\u6570\n, [\n    &#039;time&#039;    =&gt;    time(),\n]\n);\u8c03\u7528\u540e\u7acb\u5373\u8fd4\u56de\uff0c\u4e0d\u5f71\u54cd\u4e0b\u9762\u4ee3\u7801\u7684\u6267\u884c\u540c\u6b65\u6295\u9012\u4efb\u52a1TaskManager::nPostWait(\n    \/\/ \u4efb\u52a1\u540d\u79f0\n    &#039;testTask&#039;\n    \/\/ \u4efb\u52a1\u53c2\u6570\n    , [\n        &#039;time&#039;    =&gt;    time(),\n    ]\n    \/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n    0.5\n);\u6295\u9012\u4efb\u52a1\u540e\u963b\u585e\u7b49\u5f85\u6267\u884c\u5b8c\u6bd5\u6216\u8d85\u65f6\uff0c\u8fd4\u56de\u503c\u4e3a\u4efb\u52a1\u6267\u884c\u7ed3\u679c\u6216false\u534f\u7a0b\u6279\u91cf\u6295\u9012\u4efb\u52a1TaskManager::postCo([\n    [&#039;testTask&#039;, [&#039;time&#039;=&gt;time()]],\n    [&#039;testTask&#039;, [&#039;time&#039;=&gt;time()]],\n],\n\/\/ \u6700\u957f\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n0.5);"},{"id":53,"title":"TCP \u63a7\u5236\u5668","pageTitle":"TCP \u63a7\u5236\u5668","url":"components\/tcpServer\/controller.html","content":"TCP \u63a7\u5236\u5668\u5b9a\u4e49&lt;?php\nnamespace ImiDemo\\TcpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpRoute;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpAction;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @TcpController\n *\/\nclass Test extends \\Imi\\Controller\\TcpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @TcpAction\n     * @TcpRoute({&quot;action&quot;=&quot;login&quot;})\n     * @return void\n     *\/\n    public function login($data)\n    {\n        ConnectContext::set(&#039;username&#039;, $data-&gt;username);\n        $this-&gt;server-&gt;joinGroup(&#039;g1&#039;, $this-&gt;data-&gt;getFd());\n        return [&#039;action&#039;=&gt;&#039;login&#039;, &#039;success&#039;=&gt;true];\n    }\n}\u9996\u5148\u63a7\u5236\u5668\u7c7b\u5fc5\u987b\u6709@TcpController\u6ce8\u89e3\uff0c\u5bf9\u5e94\u52a8\u4f5c\u5fc5\u987b\u6709@TcpAction\u548c@TcpRoute\u6ce8\u89e3\u3002\u6ce8\u89e3@TcpController\u6ce8\u91ca\u76ee\u6807\uff1a\u7c7b\u8868\u660e\u4e00\u4e2a\u7c7b\u662f\u63a7\u5236\u5668\u7c7b\u5c5e\u6027\u540d\u79f0\u8bf4\u660esingleton\u662f\u5426\u4e3a\u5355\u4f8b\u63a7\u5236\u5668\uff0c\u9ed8\u8ba4\u4e3a null \u65f6\u53d6 '@server.\u670d\u52a1\u5668\u540d.controller.singleton'server\u6307\u5b9a\u5f53\u524d\u63a7\u5236\u5668\u5141\u8bb8\u54ea\u4e9b\u670d\u52a1\u5668\u4f7f\u7528\u3002\u652f\u6301\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\uff0c\u9ed8\u8ba4\u4e3a null \u5219\u4e0d\u9650\u5236@TcpRoute\u6307\u5b9a Tcp \u8def\u7531\u89e3\u6790\u89c4\u5219\u3002\/\/ \u89e3\u6790 $data[&#039;action&#039;] === &#039;login&#039;\n@TcpRoute({&quot;action&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data[&#039;a&#039;][&#039;b&#039;][&#039;c&#039;] === &#039;login&#039;\n@TcpRoute({&quot;a.b.c&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data[&#039;a&#039;] == &#039;1&#039; &amp;&amp; $data[&#039;b&#039;] == &#039;2&#039;\n@TcpRoute({&quot;a&quot;=&quot;1&quot;, &quot;b&quot;=&quot;2&quot;})\u5f53\u7136\u5bf9\u8c61\u4e5f\u662f\u652f\u6301\u7684\uff1a\/\/ \u89e3\u6790 $data-&gt;a-&gt;b-&gt;c === &#039;login&#039;\n@TcpRoute({&quot;a.b.c&quot;=&quot;login&quot;})\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c31\u4f1a\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c\u3002\u52a8\u4f5c\u54cd\u5e94\u6570\u636e\u54cd\u5e94\u5f53\u524d\u8fd9\u4e2a\u8bf7\u6c42\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5728\u670d\u52a1\u5668\u914d\u7f6e\u8bbe\u5b9a\u7684\u5904\u7406\u5668\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u4e3a\u5bf9\u5e94\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002\u914d\u7f6e\u6587\u4ef6return [\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u63d0\u4f9bwebsocket\u670d\u52a1\n    &#039;mainServer&#039;    =&gt;    [\n        &#039;namespace&#039;    =&gt;    &#039;ImiDemo\\TcpDemo\\MainServer&#039;,\n        &#039;type&#039;        =&gt;    Type::TCP_SERVER,\n        \/\/ &#039;host&#039;        =&gt;    &#039;0.0.0.0&#039;,\n        &#039;port&#039;        =&gt;    8085,\n        \/\/ &#039;mode&#039;        =&gt;    SWOOLE_BASE,\n        \/\/ &#039;sockType&#039;    =&gt;    SWOOLE_SOCK_TCP,\n        &#039;configs&#039;    =&gt;    [\n            &#039;reactor_num&#039;        =&gt;    2,\n            &#039;worker_num&#039;        =&gt;    2,\n            &#039;task_worker_num&#039;    =&gt;    8,\n            \/\/ EOF\u81ea\u52a8\u5206\u5305\n            &#039;open_eof_split&#039;    =&gt;    true, \/\/\u6253\u5f00EOF_SPLIT\u68c0\u6d4b\n            &#039;package_eof&#039;        =&gt;    &quot;\\r\\n&quot;, \/\/\u8bbe\u7f6eEOF\n        ],\n        \/\/ \u6570\u636e\u5904\u7406\u5668\n        &#039;dataParser&#039;    =&gt;    \\ImiDemo\\TcpDemo\\MainServer\\Parser\\JsonObjectParser::class,\n    ],\n}\u54cd\u5e94\u6570\u636ereturn [&#039;success&#039;=&gt;true];\u5206\u7ec4\u53d1\u9001$this-&gt;server-&gt;groupCall(&#039;\u7ec4\u540d&#039;, &#039;push&#039;, [&#039;success&#039;=&gt;true]);\u5f53\u7136\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u9700\u8981\u6709\u54cd\u5e94\u6570\u636e\uff0c\u4ec0\u4e48\u90fd\u4e0dreturn\u6216\u8005return null\u5c31\u662f\u4e0d\u54cd\u5e94\u6570\u636e\u3002\u6307\u5b9a\u8fde\u63a5\u53d1\u9001\u6570\u636e\u4ee5\u4e0b\u4ee3\u7801\u5199\u5728\u63a7\u5236\u5668\u7684\u4ee3\u7801\u4e2d\uff0c\u603b\u800c\u8a00\u4e4b\uff0c\u5982\u679c\u4f60\u8981\u63a8\u9001\u6d88\u606f\uff0c\u4f60\u5f97\u62ff\u5230SwooleServer\u5bf9\u8c61\u3002\/\/ $server \u5bf9\u8c61\u662f \\Swoole\\Server\u7c7b\u578b\n$server = $this-&gt;server-&gt;getSwooleServer();\n\/\/ \u6307\u5b9a\u8fde\u63a5\n$fd = 19260817;\n$data = &#039;hello imi&#039;;\n\n\/\/ \u539f\u6837\u53d1\u9001\u6570\u636e\n$server-&gt;send($fd, $data);\n\n\/\/ \u4f7f\u7528\u9884\u5b9a\u4e49\u7684\u7f16\u7801\u5668\uff0c\u7f16\u7801\u540e\u53d1\u9001\u6570\u636e\n$server-&gt;send($fd, $this-&gt;encodeMessage($data));\u7c7b\u5c5e\u6027$server\u65b9\u6cd5getSwooleServer\u83b7\u53d6Swoole\u7684Server\u5bf9\u8c61\/**\n * \u7ec4\u662f\u5426\u5b58\u5728\n *\n * @param string $groupName\n * @return boolean\n *\/\npublic function hasGroup(string $groupName);\/**\n * \u521b\u5efa\u7ec4\uff0c\u8fd4\u56de\u7ec4\u5bf9\u8c61\n *\n * @param string $groupName\n * @param integer $maxClients\n * @return \\Imi\\Server\\Group\\Group\n *\/\npublic function createGroup(string $groupName, int $maxClients = -1);\/**\n * \u83b7\u53d6\u7ec4\u5bf9\u8c61\uff0c\u4e0d\u5b58\u5728\u8fd4\u56denull\n *\n * @param string $groupName\n * @return \\Imi\\Server\\Group\\Group|null\n *\/\npublic function getGroup(string $groupName);\/**\n * \u52a0\u5165\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function joinGroup(string $groupName, int $fd);\/**\n * \u79bb\u5f00\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function leaveGroup(string $groupName, int $fd);\/**\n * \u8c03\u7528\u7ec4\u65b9\u6cd5\n *\n * @param string $groupName\n * @param string $methodName\n * @param mixed ...$args\n * @return array\n *\/\npublic function groupCall(string $groupName, string $methodName, ...$args);\/**\n * \u83b7\u53d6\u6240\u6709\u7ec4\u5217\u8868\n *\n * @return \\Imi\\Server\\Group\\Group[]\n *\/\npublic function getGroups(): array;$data\u65b9\u6cd5\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u7684socket id\n * @return int\n *\/\npublic function getFd(): int;\/**\n * \u6570\u636e\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u5185\u5bb9\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7opcode\u7684\u503c\u6765\u5224\u65ad\n * @return string\n *\/\npublic function getData();\/**\n * \u83b7\u53d6\u683c\u5f0f\u5316\u540e\u7684\u6570\u636e\uff0c\u4e00\u822c\u662f\u6570\u7ec4\u6216\u5bf9\u8c61\n * @return mixed\n *\/\npublic function getFormatData();\/**\n * \u83b7\u53d6Reactor\u7ebf\u7a0bID\n *\n * @return int\n *\/\npublic function getReactorID(): int;\u63a7\u5236\u5668\u7c7b\u65b9\u6cd5encodeMessage\/**\n * \u7f16\u7801\u6d88\u606f\uff0c\u628a\u6570\u636e\u7f16\u7801\u4e3a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u683c\u5f0f\n *\n * @param mixed $data\n * @return mixed\n *\/\nprotected function encodeMessage($data)"},{"id":56,"title":"\u8fde\u63a5\u5206\u7ec4","pageTitle":"\u8fde\u63a5\u5206\u7ec4","url":"components\/tcpServer\/group.html","content":"\u8fde\u63a5\u5206\u7ec4\u7528\u6cd5\u540cWebSocket \u670d\u52a1 - \u8fde\u63a5\u5206\u7ec4"},{"id":54,"title":"\u4e2d\u95f4\u4ef6","pageTitle":"\u4e2d\u95f4\u4ef6","url":"components\/tcpServer\/middleware.html","content":"\u4e2d\u95f4\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2aTCP\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6&lt;?php\nnamespace Imi\\Server\\TcpServer\\Middleware;\n\nuse Imi\\Bean\\Annotation\\Bean;\n\n\/**\n * @Bean\n *\/\nclass RouteMiddleware implements IMiddleware\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     *\n     * @param IReceiveData $data\n     * @param IReceiveHandler $handle\n     * @return void\n     *\/\n    public function process(IReceiveData $data, IReceiveHandler $handler)\n    {\n        \/\/ \u524d\u7f6e\u5904\u7406\n        \n        \/\/ \u5148\u6267\u884c\u5176\u5b83\u4e2d\u95f4\u4ef6\n        $result = $handler-&gt;handle($data);\n        \n        \/\/ \u540e\u7f6e\u5904\u7406\n        \n        return $result;\n    }\n\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    &#039;beans&#039;    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        &#039;TcpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Tcp\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528&lt;?php\nnamespace ImiDemo\\TcpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpRoute;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpAction;\nuse Imi\\Server\\Route\\Annotation\\Tcp\\TcpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @TcpController\n *\/\nclass Test extends \\Imi\\Controller\\TcpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @TcpAction\n     * @TcpRoute({&quot;action&quot;=&quot;login&quot;})\n     * @TcpMiddleware(XXX::class)\n     * @TcpMiddleware({XXX::class,XXX2::class})\n     * @return void\n     *\/\n    public function login($data)\n    {\n    }\n}\u5982\u4e0a\u4ee3\u7801\uff0c\u540c\u65f6\u652f\u6301\u8bbe\u7f6e\u5355\u4e2a\u548c\u591a\u4e2a\u4e2d\u95f4\u4ef6\u4e2d\u95f4\u4ef6\u5206\u7ec4\u670d\u52a1\u5668 config.php\uff1areturn [\n    &#039;middleware&#039;    =&gt;  [\n        &#039;groups&#039;    =&gt;  [\n            \/\/ \u7ec4\u540d\n            &#039;test&#039;  =&gt;  [\n                \/\/ \u4e2d\u95f4\u4ef6\u5217\u8868\n                \\Imi\\Test\\HttpServer\\ApiServer\\Middleware\\Middleware4::class,\n            ],\n        ],\n    ],\n];"},{"id":58,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","pageTitle":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","url":"components\/tcpServer\/noMiddleware.html","content":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6imi\u4e2d\u5185\u7f6e\u5b9e\u73b0\u4e86\u4e2d\u95f4\u4ef6+\u63a7\u5236\u5668\u65b9\u5f0f\u5f00\u53d1tcp\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528\uff0c\u76f4\u63a5\u76d1\u542c\u670d\u52a1\u5668\u7684receive\u4e8b\u4ef6\uff0c\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u76d1\u542c\u5199\u6cd5&lt;?php\nnamespace Imi\\Server\\TcpServer\\Listener;\n\nuse Imi\\App;\nuse Imi\\ConnectContext;\nuse Imi\\RequestContext;\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\ReceiveEventParam;\nuse Imi\\Server\\Event\\Listener\\IReceiveEventListener;\nuse Imi\\Server\\TcpServer\\Message\\ReceiveData;\n\n\/**\n * Receive\u4e8b\u4ef6\u524d\u7f6e\u5904\u7406\n * @ClassEventListener(className=&quot;Imi\\Server\\TcpServer\\Server&quot;,eventName=&quot;receive&quot;,priority=PHP_INT_MAX)\n *\/\nclass BeforeReceive implements IReceiveEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param ReceiveEventParam $e\n     * @return void\n     *\/\n    public function handle(ReceiveEventParam $e)\n    {\n        \/\/ \u5982\u679c\u670d\u52a1\u5668\u540d\u4e0d\u662f\u4e3b\u670d\u52a1\u5668\u5c31\u8fd4\u56de\n        if(&#039;main&#039; === $e-&gt;server-&gt;getName())\n        {\n            return;\n        }\n        var_dump($e-&gt;data);\n    }\n}"},{"id":57,"title":"\u65ad\u7ebf\u91cd\u8fde","pageTitle":"\u65ad\u7ebf\u91cd\u8fde","url":"components\/tcpServer\/reconnect.html","content":"\u65ad\u7ebf\u91cd\u8fde\u7528\u6cd5\u540cWebSocket \u670d\u52a1 - \u65ad\u7ebf\u91cd\u8fde"},{"id":52,"title":"\u8def\u7531","pageTitle":"\u8def\u7531","url":"components\/tcpServer\/route.html","content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    &#039;beans&#039;    =&gt;    [\n        &#039;TcpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \\Imi\\Server\\TcpServer\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get(&#039;routeResult&#039;);$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\TcpServer\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\Tcp\\TcpRoute\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":55,"title":"\u4f1a\u8bdd\u6570\u636e","pageTitle":"\u4f1a\u8bdd\u6570\u636e","url":"components\/tcpServer\/session.html","content":"\u4f1a\u8bdd\u6570\u636e\u7528\u6cd5\u540cWebSocket \u670d\u52a1\u5668 - \u4f1a\u8bdd\u6570\u636e"},{"id":63,"title":"UDP \u63a7\u5236\u5668","pageTitle":"UDP \u63a7\u5236\u5668","url":"components\/udpServer\/controller.html","content":"UDP \u63a7\u5236\u5668\u5b9a\u4e49&lt;?php\nnamespace ImiDemo\\UdpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpRoute;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpAction;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @UdpController\n *\/\nclass Test extends \\Imi\\Controller\\UdpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @UdpAction\n     * @UdpRoute({&quot;action&quot;=&quot;hello&quot;})\n     * @return void\n     *\/\n    public function hello()\n    {\n        return [\n            &#039;time&#039;    =&gt;    date($this-&gt;data-&gt;getFormatData()-&gt;format),\n        ];\n    }\n\n}\u9996\u5148\u63a7\u5236\u5668\u7c7b\u5fc5\u987b\u6709@UdpController\u6ce8\u89e3\uff0c\u5bf9\u5e94\u52a8\u4f5c\u5fc5\u987b\u6709@UdpAction\u548c@UdpRoute\u6ce8\u89e3\u3002\u6ce8\u89e3@UdpController\u6ce8\u91ca\u76ee\u6807\uff1a\u7c7b\u8868\u660e\u4e00\u4e2a\u7c7b\u662f\u63a7\u5236\u5668\u7c7b\u5c5e\u6027\u540d\u79f0\u8bf4\u660esingleton\u662f\u5426\u4e3a\u5355\u4f8b\u63a7\u5236\u5668\uff0c\u9ed8\u8ba4\u4e3a null \u65f6\u53d6 '@server.\u670d\u52a1\u5668\u540d.controller.singleton'server\u6307\u5b9a\u5f53\u524d\u63a7\u5236\u5668\u5141\u8bb8\u54ea\u4e9b\u670d\u52a1\u5668\u4f7f\u7528\u3002\u652f\u6301\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\uff0c\u9ed8\u8ba4\u4e3a null \u5219\u4e0d\u9650\u5236@UdpRoute\u6307\u5b9a Udp \u8def\u7531\u89e3\u6790\u89c4\u5219\u3002\/\/ \u89e3\u6790 $data[&#039;action&#039;] === &#039;login&#039;\n@TcpRoute({&quot;action&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data[&#039;a&#039;][&#039;b&#039;][&#039;c&#039;] === &#039;login&#039;\n@TcpRoute({&quot;a.b.c&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data[&#039;a&#039;] == &#039;1&#039; &amp;&amp; $data[&#039;b&#039;] == &#039;2&#039;\n@TcpRoute({&quot;a&quot;=&quot;1&quot;, &quot;b&quot;=&quot;2&quot;})\u5f53\u7136\u5bf9\u8c61\u4e5f\u662f\u652f\u6301\u7684\uff1a\/\/ \u89e3\u6790 $data-&gt;a-&gt;b-&gt;c === &#039;login&#039;\n@TcpRoute({&quot;a.b.c&quot;=&quot;login&quot;})\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c31\u4f1a\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c\u3002\u52a8\u4f5c\u54cd\u5e94\u6570\u636e\u54cd\u5e94\u5f53\u524d\u8fd9\u4e2a\u8bf7\u6c42\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5728\u670d\u52a1\u5668\u914d\u7f6e\u8bbe\u5b9a\u7684\u5904\u7406\u5668\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u4e3a\u5bf9\u5e94\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002\u914d\u7f6e\u6587\u4ef6return [\n    \/\/ \u9879\u76ee\u6839\u547d\u540d\u7a7a\u95f4\n    &#039;namespace&#039;    =&gt;    &#039;ImiDemo\\UdpDemo&#039;,\n    \/\/ \u626b\u63cf\u76ee\u5f55\n    &#039;beanScan&#039;    =&gt;    [\n    ],\n    \/\/ \u4e3b\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u63d0\u4f9bwebsocket\u670d\u52a1\n    &#039;mainServer&#039;    =&gt;    [\n        &#039;namespace&#039;    =&gt;    &#039;ImiDemo\\UdpDemo\\MainServer&#039;,\n        &#039;type&#039;        =&gt;    Type::UDP_SERVER,\n        &#039;host&#039;        =&gt;    &#039;0.0.0.0&#039;,\n        &#039;port&#039;        =&gt;    8087,\n        &#039;configs&#039;    =&gt;    [\n            &#039;reactor_num&#039;        =&gt;    2,\n            &#039;worker_num&#039;        =&gt;    2,\n            &#039;task_worker_num&#039;    =&gt;    8,\n        ],\n        \/\/ \u6570\u636e\u5904\u7406\u5668\n        &#039;dataParser&#039;    =&gt;    Imi\\Server\\DataParser\\JsonObjectParser::class,\n    ],\n}\u54cd\u5e94\u6570\u636ereturn [&#039;success&#039;=&gt;true];\u5206\u7ec4\u53d1\u9001\u7531\u4e8eUDP\u7684\u7279\u6027\uff0c\u6240\u4ee5\u4e0d\u652f\u6301\u5206\u7ec4\u53d1\u9001\u3002\u5982\u6709\u9700\u8981\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u573a\u666f\u81ea\u884c\u5b9e\u73b0\u5206\u7ec4\u3002$data\u65b9\u6cd5\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u7684socket id\n * @return int\n *\/\npublic function getFd(): int;\/**\n * \u6570\u636e\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u5185\u5bb9\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7opcode\u7684\u503c\u6765\u5224\u65ad\n * @return string\n *\/\npublic function getData();\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u4fe1\u606f\n * @return array\n *\/\npublic function getClientInfo();\n\n\/\/ \u683c\u5f0f\u540c\uff1ahttps:\/\/wiki.swoole.com\/#\/server\/methods?id=getclientinfo"},{"id":64,"title":"\u4e2d\u95f4\u4ef6","pageTitle":"\u4e2d\u95f4\u4ef6","url":"components\/udpServer\/middleware.html","content":"\u4e2d\u95f4\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2aUDP\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6&lt;?php\nnamespace Imi\\Server\\UdpServer\\Middleware;\n\nuse Imi\\Bean\\Annotation\\Bean;\n\n\/**\n * @Bean\n *\/\nclass RouteMiddleware implements IMiddleware\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     *\n     * @param IReceiveData $data\n     * @param IReceiveHandler $handle\n     * @return void\n     *\/\n    public function process(IPacketData $data, IPacketHandler $handler)\n    {\n        \/\/ \u524d\u7f6e\u5904\u7406\n        \n        \/\/ \u5148\u6267\u884c\u5176\u5b83\u4e2d\u95f4\u4ef6\n        $result = $handler-&gt;handle($data);\n        \n        \/\/ \u540e\u7f6e\u5904\u7406\n        \n        return $result;\n    }\n\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    &#039;beans&#039;    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        &#039;UdpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\Udp\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528&lt;?php\nnamespace ImiDemo\\UdpDemo\\MainServer\\Controller;\n\nuse Imi\\ConnectContext;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpRoute;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpAction;\nuse Imi\\Server\\Route\\Annotation\\Udp\\UdpController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @UdpController\n *\/\nclass Test extends \\Imi\\Controller\\UdpController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @UdpAction\n     * @UdpRoute({&quot;action&quot;=&quot;hello&quot;})\n     * @UdpMiddleware(XXX::class)\n     * @UdpMiddleware({XXX::class,XXX2::class})\n     * @return void\n     *\/\n    public function hello()\n    {\n        return [\n            &#039;time&#039;    =&gt;    date($this-&gt;data-&gt;getFormatData()-&gt;format),\n        ];\n    }\n\n}\n\u5982\u4e0a\u4ee3\u7801\uff0c\u540c\u65f6\u652f\u6301\u8bbe\u7f6e\u5355\u4e2a\u548c\u591a\u4e2a\u4e2d\u95f4\u4ef6\u4e2d\u95f4\u4ef6\u5206\u7ec4\u670d\u52a1\u5668 config.php\uff1areturn [\n    &#039;middleware&#039;    =&gt;  [\n        &#039;groups&#039;    =&gt;  [\n            \/\/ \u7ec4\u540d\n            &#039;test&#039;  =&gt;  [\n                \/\/ \u4e2d\u95f4\u4ef6\u5217\u8868\n                \\Imi\\Test\\HttpServer\\ApiServer\\Middleware\\Middleware4::class,\n            ],\n        ],\n    ],\n];"},{"id":65,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","pageTitle":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","url":"components\/udpServer\/noMiddleware.html","content":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6imi\u4e2d\u5185\u7f6e\u5b9e\u73b0\u4e86\u4e2d\u95f4\u4ef6+\u63a7\u5236\u5668\u65b9\u5f0f\u5f00\u53d1tcp\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528\uff0c\u76f4\u63a5\u76d1\u542c\u670d\u52a1\u5668\u7684packet\u4e8b\u4ef6\uff0c\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u76d1\u542c\u5199\u6cd5&lt;?php\nnamespace Imi\\Server\\UdpServer\\Listener;\n\nuse Imi\\ServerManage;\nuse Imi\\ConnectContext;\nuse Imi\\RequestContext;\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\PacketEventParam;\nuse Imi\\Server\\UdpServer\\Message\\PacketData;\nuse Imi\\Server\\Event\\Listener\\IPacketEventListener;\n\n\/**\n * Packet\u4e8b\u4ef6\u524d\u7f6e\u5904\u7406\n * @ClassEventListener(className=&quot;Imi\\Server\\UdpServer\\Server&quot;,eventName=&quot;packet&quot;,priority=PHP_INT_MAX)\n *\/\nclass BeforePacket implements IPacketEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param PacketEventParam $e\n     * @return void\n     *\/\n    public function handle(PacketEventParam $e)\n    {\n        \/\/ \u5982\u679c\u670d\u52a1\u5668\u540d\u4e0d\u662f\u4e3b\u670d\u52a1\u5668\u5c31\u8fd4\u56de\n        if(&#039;main&#039; !== $e-&gt;getTarget()-&gt;getName())\n        {\n            return;\n        }\n        var_dump($e-&gt;data);\n\n    }\n}"},{"id":62,"title":"\u8def\u7531","pageTitle":"\u8def\u7531","url":"components\/udpServer\/route.html","content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    &#039;beans&#039;    =&gt;    [\n        &#039;UdpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \\Imi\\Server\\UdpServer\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get(&#039;routeResult&#039;);$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\UdpServer\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\Udp\\UdpRoute\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":108,"title":"\u9a8c\u8bc1\u5668","pageTitle":"\u9a8c\u8bc1\u5668","url":"components\/validation\/index.html","content":"\u9a8c\u8bc1\u5668imi \u63d0\u4f9b\u4e86\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u9a8c\u8bc1\uff0c\u4ee5\u53ca\u53ef\u6269\u5c55\u7684\u9a8c\u8bc1\u65b9\u6cd5\uff0c\u8fd9\u4e00\u5207\u90fd\u53ef\u4ee5\u901a\u8fc7\u6ce8\u89e3\u6765\u4f7f\u7528\u3002\u6ce8\u89e3@Condition\u901a\u7528\u9a8c\u8bc1\u6761\u4ef6\uff0c\u4f20\u5165\u56de\u8c03\u8fdb\u884c\u9a8c\u8bc1\u8be5\u6ce8\u89e3\u53ef\u4ee5\u5199\u5728\u7c7b\u3001\u5c5e\u6027\u3001\u65b9\u6cd5\u4e0a\u3002\u53c2\u6570\uff1a\/**\n * \u53c2\u6570\u540d\u79f0\n * \u5c5e\u6027\u6ce8\u89e3\u53ef\u7701\u7565\n *\n * @var string\n *\/\npublic $name;\n\n\/**\n * \u975e\u5fc5\u9a8c\u8bc1\uff0c\u53ea\u6709\u5f53\u503c\u5b58\u5728\u624d\u9a8c\u8bc1\n *\n * @var boolean\n *\/\npublic $optional = false;\n\n\/**\n * \u5f53\u503c\u4e0d\u7b26\u5408\u6761\u4ef6\u65f6\u7684\u9ed8\u8ba4\u503c\n *\n * @var mixed\n *\/\npublic $default;\n\n\/**\n * \u5bf9\u7ed3\u679c\u53d6\u53cd\n *\n * @var boolean\n *\/\npublic $inverseResult = false;\n\n\/**\n * \u5f53\u9a8c\u8bc1\u6761\u4ef6\u4e0d\u7b26\u5408\u65f6\u7684\u4fe1\u606f\n * \n * \u652f\u6301\u4ee3\u5165{:value}\u539f\u59cb\u503c\n * \u652f\u6301\u4ee3\u5165{:data.xxx}\u6240\u6709\u6570\u636e\u4e2d\u7684\u67d0\u9879\n * \u652f\u6301\u4ee5{name}\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u4ee3\u5165\u6ce8\u89e3\u53c2\u6570\u503c\n *\n * @var string\n *\/\npublic $message = &#039;{name} validate failed&#039;;\n\n\/**\n * \u9a8c\u8bc1\u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;\n\n\/**\n * \u53c2\u6570\u540d\u6570\u7ec4\n * \n * \u652f\u6301\u4ee3\u5165{:value}\u539f\u59cb\u503c\n * \u652f\u6301\u4ee3\u5165{:data}\u6240\u6709\u6570\u636e\n * \u652f\u6301\u4ee3\u5165{:data.xxx}\u6240\u6709\u6570\u636e\u4e2d\u7684\u67d0\u9879\n * \u652f\u6301\u4ee5{name}\u8fd9\u6837\u7684\u5f62\u5f0f\uff0c\u4ee3\u5165\u6ce8\u89e3\u53c2\u6570\u503c\n * \u5982\u679c\u6ca1\u6709{}\uff0c\u5219\u539f\u6837\u4f20\u503c\n *\n * @var array\n *\/\npublic $args = [&#039;{:value}&#039;];\n\n\/**\n * \u5f02\u5e38\u7c7b\n *\n * @var string\n *\/\npublic $exception = null;\n\n\/**\n * \u5f02\u5e38\u7f16\u7801\n *\n * @var integer\n *\/\npublic $exCode = null;callable \u662f\u9a8c\u8bc1\u56de\u8c03\uff0c\u652f\u6301\uff1a&quot;is_int&quot;\u3001&quot;XXX::check&quot;\u3001{@Inject(&quot;BeanName&quot;), &quot;methodName&quot;}{&quot;$this&quot;, &quot;methodName&quot;}\u6307\u5b9a\u5f53\u524d\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5\uff0c\u4f46Http\u9a8c\u8bc1\u5668\u4e2d\u65e0\u6cd5\u4f7f\u7528\u3002\u65b9\u6cd5\u5fc5\u987b\u662fpublic\u6216protected\u3002args \u662f\u56de\u8c03\u65b9\u6cd5\u53c2\u6570\uff0c\u4f8b\u5b50\uff1aclass TestValidate\n{\n    public $abc = &#039;imi niubi!&#039;;\n\n    \/**\n     * @AutoValidation\n     * @Condition(name=&quot;argName&quot;, callable={&quot;$this&quot;, &quot;validate&quot;}, args={&quot;{:value}&quot;, &quot;{:data}&quot;, &quot;{name}&quot;, &quot;{:data.a}&quot;, {&quot;:data.$this.abc&quot;}})\n     *\/\n    public function test($a, $b)\n    {\n\n    }\n\n    \/**\n     * \u672c\u65b9\u6cd5\u53c2\u6570\uff0c\u7531 @Condition \u7684 args \u51b3\u5b9a\n     * $value \u662f\u5f53\u524d\u9a8c\u8bc1\u53c2\u6570\u5bf9\u5e94\u7684\u503c\uff0c\u4e5f\u5c31\u662f test() \u65b9\u6cd5\u4e2d\uff0c$a \u53c2\u6570\u503c\n     * $data \u662f\u96c6\u5408\u4e86 test() \u65b9\u6cd5\u4e2d\u6240\u6709\u53c2\u6570\u7684\u6570\u7ec4\n     * \u4f60\u53ef\u4ee5\u7528 $data[&#039;b&#039;] \u83b7\u53d6 $b \u53c2\u6570\u503c\n     * $name \u4ee3\u8868\u662f @Condition \u4e2d\u7684 name \u53c2\u6570\uff0c\u540c\u7406\u53ef\u4ee5\u53d6\u5230\u6ce8\u89e3\u4e2d\u7684\u5176\u5b83\u53c2\u6570\u503c\n     * $a \u5c31\u662f\u6307\u5b9a\u4f20\u5165 test() \u65b9\u6cd5\u4e2d $a \u53c2\u6570\u503c\n     * $vvv \u5c31\u662f\u6307\u5b9a test() \u65b9\u6cd5\u6240\u5728\u7c7b\u5bf9\u8c61\u4e2d\u7684 $abc \u5c5e\u6027\u503c\n     *\/\n    public function validate($value, $data, $name, $a, $vvv)\n    {\n        var_dump($value, $data, $name, $a, $vvv);\n        return true;\n    }\n}inverseResult \u53c2\u6570\u4e3atrue\u65f6\uff0c\u4f1a\u5bf9\u9a8c\u8bc1\u56de\u8c03\u65b9\u6cd5\u7ed3\u679c\u53d6\u53cd\u540e\uff0c\u5224\u65ad\u662f\u5426\u4e3atruemessage \u662f\u9a8c\u8bc1\u5931\u8d25\u7684\u6d88\u606f\uff0c\u53ef\u4ee5\u5c06{name}\u5f62\u5f0f\u7684\u6ce8\u89e3\u53c2\u6570\u503c\u4ee3\u5165\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528{:value}\u4ee3\u5165\u9a8c\u8bc1\u503c\u3002exception\u548cexCode\u53ef\u4ee5\u8bbe\u5b9a\u9a8c\u8bc1\u5931\u8d25\u65f6\u629b\u51fa\u7684\u5f02\u5e38\u7c7b\u53ca\u5f02\u5e38\u7f16\u7801\uff0c\u9ed8\u8ba4\u4e3a\\InvalidArgumentException\u7c7b\u3002\u9664\u4e86callable\u548cargs\u4ee5\u5916\uff0c\u5176\u5b83\u53c2\u6570\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u5176\u5b83\u9a8c\u8bc1\u6761\u4ef6\u6ce8\u89e3\uff08\u5982\uff1a@Required \u7b49\uff09\u7684\u53c2\u6570@Required\u5224\u65ad\u503c\u662f\u5426\u5b58\u5728@Text\u6587\u672c\u9a8c\u8bc1\u5b57\u8282\u9a8c\u8bc1\u5fc5\u987b&gt;=6\u4f4d\u957f\u5ea6\u5b57\u8282\uff0c\u6700\u957f\u4e0d\u9650\u5236\uff1a@Text(min=6)\u5b57\u8282\u957f\u5ea6\u5fc5\u987b&gt;=6 && &lt;=12\uff1a@Text(min=6, max=12)PHP \u4e2d\uff0cUTF-8 \u7f16\u7801\u7684\u4e2d\u6587\u5b57\uff0c\u6bcf\u4e2a\u5b57\u8282\u957f\u5ea6\u4e3a 3\u5b57\u7b26\u9a8c\u8bc1\u5fc5\u987b&gt;=6\u4f4d\u957f\u5ea6\u5b57\u7b26\uff0c\u6700\u957f\u4e0d\u9650\u5236\uff1a@Text(char=true, min=6)\u5b57\u7b26\u957f\u5ea6\u5fc5\u987b&gt;=6 && &lt;=12\uff1a@Text(char=true, min=6, max=12)\u4e00\u4e2a\u5b57\u6bcd\u662f\u4e00\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u4e2d\u6587\u4e5f\u662f\u4e00\u4e2a\u5b57\u7b26@Integer\u6574\u6570\u9a8c\u8bc1\u9a8c\u8bc1\u5fc5\u987b\u4e3a\u6574\u6570\uff1a@Integer\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1024\u7684\u6574\u6570\uff1a@Integer(min=1024)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&lt;=1024\u7684\u6574\u6570\uff1a@Integer(max=1024)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1 && &lt;=10\u7684\u6574\u6570\uff1a@Integer(min=1, max=10)@Decimal\u5c0f\u6570\u9a8c\u8bc1\u9a8c\u8bc1\u5fc5\u987b\u4e3a\u5c0f\u6570\uff1a@Decimal\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=10.24\u7684\u5c0f\u6570\uff1a@Decimal(min=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&lt;=10.24\u7684\u5c0f\u6570\uff1a@Decimal(max=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1 && &lt;=10.24\u7684\u5c0f\u6570\uff1a@Decimal(min=1, max=10.24)\u4f20\u51651\uff0c\u7ed3\u679c\u4e3afalse\u4f20\u51651.0\uff0c\u7ed3\u679c\u4e3atrue@Number\u6570\u503c\u9a8c\u8bc1\uff0c\u5141\u8bb8\u662f\u6574\u6570\u6216\u8005\u5c0f\u6570\u9a8c\u8bc1\u5fc5\u987b\u4e3a\u6570\u503c\uff1a@Decimal\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=10.24\u7684\u6570\u503c\uff1a@Decimal(min=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&lt;=10.24\u7684\u6570\u503c\uff1a@Decimal(max=10.24)\u9a8c\u8bc1\u5fc5\u987b\u4e3a&gt;=1 && &lt;=10.24\u7684\u6570\u503c\uff1a@Decimal(min=1, max=10.24)\u4f20\u51651\uff0c\u7ed3\u679c\u4e3atrue\u4f20\u51651.0\uff0c\u7ed3\u679c\u4e3atrue@InList\u5217\u8868\u9a8c\u8bc1\uff0c\u5224\u65ad\u503c\u662f\u5426\u5b58\u5728\u4e8e\u5217\u8868\u4e2d@InList(list={1, 2, 3})\u76f8\u5f53\u4e8e\uff1a$result = in_array($value, [1, 2, 3]);@Compare\u6bd4\u8f83\u9a8c\u8bc1\u6ce8\u89e3@Compare(name=&quot;\u53c2\u6570\u540d&quot;, value=&quot;\u88ab\u6bd4\u8f83\u503c&quot;, operation=&quot;\u6bd4\u8f83\u7b26\uff0c\u5982\uff1a==&quot;)value \u53ef\u4ee5\u76f4\u63a5\u4f20\u503c\uff0c\u4e5f\u53ef\u4ee5\u914d\u5408 @ValidateValue \u6ce8\u89e3\u4f7f\u7528\u3002operation \u5141\u8bb8\u4f7f\u7528\uff1a==\u3001!=\u3001===\u3001!==\u3001&lt;\u3001&lt;=\u3001&gt;\u3001&gt;=@ValidateValue\u6307\u5b9a\u9a8c\u8bc1\u65f6\u7684\u503c\u6ce8\u89e3@Compare(name=&quot;id&quot;, value=@ValidateValue(&quot;{:data.id}&quot;), operation=&quot;==&quot;)@InEnum\u7528\u4e8e\u9a8c\u8bc1\u503c\u662f\u5426\u5b58\u5728\u4e8e\u679a\u4e3e\u5217\u8868\u4e2d@InEnum(name=&quot;type&quot;, enum=&quot;EnumClass&quot;)@Regex\u6b63\u5219\u9a8c\u8bc1@Regex(name=&quot;regex&quot;, pattern=&quot;\/\\d+\/&quot;)\u53ef\u9009\u9a8c\u8bc1\u53ef\u9009\u9a8c\u8bc1\uff0c\u53ea\u6709\u5f53\u503c\u5b58\u5728\u65f6\uff0c\u624d\u5bf9\u503c\u8fdb\u884c\u9a8c\u8bc1\u3002\u6ca1\u6709\u8be5\u503c\u65f6\u4e0d\u9a8c\u8bc1\uff0c\u53ef\u4ee5\u7528\u4e8e\u4e00\u4e9b\u53ef\u9009\u53c2\u6570\u7684\u9a8c\u8bc1\u573a\u666f\u3002\u7528\u6cd5\u662f\u9700\u8981\u4f5c\u4e3a\u53ef\u9009\u9a8c\u8bc1\u7684\u6ce8\u89e3\uff0coptional\u5c5e\u6027\u8bbe\u4e3atrue\u5373\u53ef\u3002@Text(name=&quot;a&quot;, &quot;min&quot;=1, optional=true)\u81ea\u52a8\u9a8c\u8bc1\u6ce8\u89e3\uff1a@AutoValidation\u9a8c\u8bc1\u7c7b\u5c5e\u6027imi \u652f\u6301\u5728\u7c7b\u3001\u5c5e\u6027\u4e0a\u4f7f\u7528 @AutoValidation \u6ce8\u89e3\uff0c\u5f53\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u89e6\u53d1\u9a8c\u8bc1\u3002\u9a8c\u8bc1\u5931\u8d25\u629b\u51fa\u5f02\u5e38\u3002\u5982\u4e0b\u4ee3\u7801\uff0c\u5199\u5728\u7c7b\u4e0a\u7684\u6ce8\u89e3\u4ee5\u53ca\u5c5e\u6027\u4e0a\u7684\u6ce8\u89e3\uff0c\u90fd\u56e0\u4e3a\u52a0\u4e86@AutoValidation \u6ce8\u89e3\uff0c\u6240\u4ee5\u5728\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u4f1a\u81ea\u52a8\u8fdb\u884c\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u5931\u8d25\u5219\u629b\u51fa\u5f02\u5e38\u3002\/**\n * @Bean(&quot;ValidatorTest&quot;)\n * \n * @AutoValidation\n * \n * \n * @InList(name=&quot;in&quot;, list={1, 2, 3}, message=&quot;{:value} \u4e0d\u5728\u5217\u8868\u5185&quot;)\n * @Integer(name=&quot;int&quot;, min=0, max=100, message=&quot;{:value} \u4e0d\u7b26\u5408\u5927\u4e8e\u7b49\u4e8e{min}\u4e14\u5c0f\u4e8e\u7b49\u4e8e{max}&quot;)\n * @Required(name=&quot;required&quot;, message=&quot;{name}\u4e3a\u5fc5\u987b\u53c2\u6570&quot;)\n * @Number(name=&quot;number&quot;, min=0.01, max=999.99, accuracy=2, message=&quot;\u6570\u503c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n * @Text(name=&quot;text&quot;, min=6, max=12, message=&quot;{name}\u53c2\u6570\u957f\u5ea6\u5fc5\u987b&gt;={min} &amp;&amp; &lt;={max}&quot;)\n * @Condition(name=&quot;my&quot;, callable=&quot;\\ImiDemo\\HttpDemo\\MainServer\\Validator\\Test::myValidate&quot;, args={&quot;{:value}&quot;}, message=&quot;{name}\u503c\u5fc5\u987b\u4e3a1&quot;)\n *\/\nclass Test\n{\n    \/**\n     * @Decimal(min=-0.01, max=999.99, accuracy=2, message=&quot;\u5c0f\u6570\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n     *\n     * @var float\n     *\/\n    public $decimal;\n\n    public function __construct($data = [], $rules = null)\n    {\n        foreach($data as $name =&gt; $value)\n        {\n            $this-&gt;$name = $value;\n        }\n    }\n\n    public static function myValidate($value)\n    {\n        return 1 == $value;\n    }\n}\n\u9a8c\u8bc1\u65b9\u6cd5\u53c2\u6570\u5728 imi \u4e2d\uff0c\u5982\u679c\u4f60\u5728\u65b9\u6cd5\u4e0a\u4f7f\u7528 @AutoValidation \u6ce8\u89e3\uff0c\u5f53\u65b9\u6cd5\u88ab\u8c03\u7528\u524d\uff0c\u4f1a\u89e6\u53d1\u9a8c\u8bc1\u64cd\u4f5c\uff0c\u9a8c\u8bc1\u5931\u8d25\u5219\u629b\u51fa\u5f02\u5e38\u3002\u9a8c\u8bc1\u7684\u53c2\u6570\u662f\u4f20\u5165\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u5982\u4e0b\u4ee3\u7801\uff0c\u9a8c\u8bc1\u901a\u8fc7\u5219\u8fdb\u5165\u65b9\u6cd5\u4f53\u4e2d\uff0c\u9a8c\u8bc1\u5931\u8d25\u4f1a\u629b\u51fa\u5f02\u5e38\u3002\/**\n * @AutoValidation\n * \n * @Required(name=&quot;id&quot;, message=&quot;\u7528\u6237ID\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Integer(name=&quot;id&quot;, min=&quot;1&quot;, message=&quot;\u7528\u6237ID\u4e0d\u7b26\u5408\u89c4\u5219&quot;)\n * @Required(name=&quot;name&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u4e3a\u5fc5\u4f20\u53c2\u6570&quot;)\n * @Text(name=&quot;name&quot;, min=&quot;2&quot;, message=&quot;\u7528\u6237\u59d3\u540d\u957f\u5ea6\u4e0d\u5f97\u5c11\u4e8e2\u4f4d&quot;)\n *\n * @param int $id\n * @param string $name\n * @return void\n *\/\npublic function test222($id, $name)\n{\n    var_dump($id, $name);\n}\u624b\u52a8\u9a8c\u8bc1\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8e\u9a8c\u8bc1\u7684\u7c7b\uff0c\u5c06\u6570\u636e\u4f20\u5165\u8be5\u7c7b\uff0c\u624b\u52a8\u8c03\u7528\u9a8c\u8bc1\u65b9\u6cd5\u3002\/**\n * @Bean(&quot;ValidatorTest&quot;)\n * \n * @InList(name=&quot;in&quot;, list={1, 2, 3}, message=&quot;{:value} \u4e0d\u5728\u5217\u8868\u5185&quot;)\n * @Integer(name=&quot;int&quot;, min=0, max=100, message=&quot;{:value} \u4e0d\u7b26\u5408\u5927\u4e8e\u7b49\u4e8e{min}\u4e14\u5c0f\u4e8e\u7b49\u4e8e{max}&quot;)\n * @Required(name=&quot;required&quot;, message=&quot;{name}\u4e3a\u5fc5\u987b\u53c2\u6570&quot;)\n * @Number(name=&quot;number&quot;, min=0.01, max=999.99, accuracy=2, message=&quot;\u6570\u503c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n * @Text(name=&quot;text&quot;, min=6, max=12, message=&quot;{name}\u53c2\u6570\u957f\u5ea6\u5fc5\u987b&gt;={min} &amp;&amp; &lt;={max}&quot;)\n * @Condition(name=&quot;my&quot;, callable=&quot;\\ImiDemo\\HttpDemo\\MainServer\\Validator\\Test::myValidate&quot;, args={&quot;{:value}&quot;}, message=&quot;{name}\u503c\u5fc5\u987b\u4e3a1&quot;)\n *\/\nclass Test extends Validator\n{\n    \/**\n     * @Decimal(min=-0.01, max=999.99, accuracy=2, message=&quot;\u5c0f\u6570\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e{min}\uff0c\u5c0f\u4e8e\u7b49\u4e8e{max}\uff0c\u5c0f\u6570\u70b9\u6700\u591a\u4fdd\u7559{accuracy}\u4f4d\u5c0f\u6570\uff0c\u5f53\u524d\u503c\u4e3a{:value}&quot;)\n     *\n     * @var float\n     *\/\n    public $decimal;\n\n    public function __construct($data = [], $rules = null)\n    {\n        parent::__construct($data, $rules);\n        foreach($data as $name =&gt; $value)\n        {\n            $this-&gt;$name = $value;\n        }\n    }\n\n    public static function myValidate($value)\n    {\n        return 1 == $value;\n    }\n}\n\u5f53\u4f60\u4f7f\u7528\u624b\u52a8\u9a8c\u8bc1\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5new\u51fa\u6765\u4f7f\u7528\uff0c\u4e0d\u662f\u5f88\u6709\u5fc5\u8981\u4f7f\u7528\u5bb9\u5668\u3002\u4f7f\u7528\u4ee3\u7801\u793a\u4f8b\uff1a$v = new Test([\n    \/\/ &#039;decimal&#039;   =&gt;  1.1,\n    \/\/ &#039;in&#039;        =&gt;  1,\n    &#039;int&#039;       =&gt;  1,\n    &#039;required&#039;  =&gt;  1,\n    &#039;number&#039;    =&gt;  1,\n    &#039;my&#039;        =&gt;  1,\n]);\n\n\/\/ \u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u6570\u636e\n\/\/ $v-&gt;setData([]);\n\n\/\/ \u9a8c\u8bc1\uff0c\u5f53\u9047\u5230\u4e0d\u901a\u8fc7\u65f6\u7ed3\u675f\u9a8c\u8bc1\u6d41\u7a0b\n$result = $v-&gt;validate();\nif(!$result)\n{\n    echo &#039;error: &#039;, $v-&gt;getMessage(), PHP_EOL;\n    \/\/ \u5f53\u524d\u9519\u8bef\u7684\u6ce8\u89e3\u89c4\u5219\n    var_dump($v-&gt;getFailRule());\n}\n\n\/\/ \u9a8c\u8bc1\u6240\u6709\n$result = $v-&gt;validateAll();\nif(!$result)\n{\n    var_dump(\n        \/\/ \u6240\u6709\u9519\u8bef\u6570\u7ec4\uff0c\u6ce8\u610f\u6bcf\u4e2a\u6210\u5458\u4e5f\u662f\u4e2a\u6570\u7ec4\uff0c\u91cc\u9762\u53ef\u80fd\u6709\u591a\u4e2a\n        $v-&gt;getResults()\n        \/\/ \u6240\u6709\u9519\u8bef\u7684\u6ce8\u89e3\u89c4\u5219\n        , $v-&gt;getFailRules()\n    );\n}\n\n\/\/ \u83b7\u5f97\u6570\u636e\uff0c\u5982\u679c\u4f60\u914d\u7f6e\u6709default\u5c5e\u6027\uff0c\u5e76\u4e14\u9a8c\u8bc1\u5931\u8d25\uff0c\u53ef\u4ee5\u83b7\u5f97\u9ed8\u8ba4\u503c\n$data = $v-&gt;getData();\u573a\u666f\u9a8c\u8bc1\u5b9a\u4e49\u573a\u666f\uff0c\u6307\u5b9a\u67d0\u4e2a\u573a\u666f\uff0c\u53ea\u9a8c\u8bc1\u6307\u5b9a\u7684\u51e0\u4e2a\u5b57\u6bb5\u3002\u65b9\u6cd5\u4e00\uff0c\u6ce8\u89e3\u5b9a\u4e49\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Validate\\Classes;\n\nuse Imi\\Validate\\Validator;\nuse Imi\\Validate\\Annotation\\Scene;\nuse Imi\\Validate\\Annotation\\Decimal;\nuse Imi\\Validate\\Annotation\\Integer;\n\n\/**\n * @Decimal(name=&quot;decimal&quot;, min=1, max=10, accuracy=2)\n * @Integer(name=&quot;int&quot;, min=0, max=100, message=&quot;{:value} \u4e0d\u7b26\u5408\u5927\u4e8e\u7b49\u4e8e{min}\u4e14\u5c0f\u4e8e\u7b49\u4e8e{max}&quot;)\n * @Scene(name=&quot;a&quot;, fields={&quot;decimal&quot;})\n * @Scene(name=&quot;b&quot;, fields={&quot;int&quot;})\n * @Scene(name=&quot;c&quot;, fields={&quot;decimal&quot;, &quot;int&quot;})\n *\/\nclass TestSceneAnnotationValidator extends Validator\n{\n\n}\u65b9\u6cd5\u4e8c\uff0c\u4ee3\u7801\u5b9a\u4e49\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Validate\\Classes;\n\nuse Imi\\Validate\\Validator;\nuse Imi\\Validate\\Annotation\\Decimal;\nuse Imi\\Validate\\Annotation\\Integer;\n\n\/**\n * @Decimal(name=&quot;decimal&quot;, min=1, max=10, accuracy=2)\n * @Integer(name=&quot;int&quot;, min=0, max=100, message=&quot;{:value} \u4e0d\u7b26\u5408\u5927\u4e8e\u7b49\u4e8e{min}\u4e14\u5c0f\u4e8e\u7b49\u4e8e{max}&quot;)\n *\/\nclass TestSceneValidator extends Validator\n{\n    \/**\n     * \u573a\u666f\u5b9a\u4e49\n     *\n     * @var array|null\n     *\/\n    protected $scene = [\n        &#039;a&#039; =&gt;  [&#039;decimal&#039;],\n        &#039;b&#039; =&gt;  [&#039;int&#039;],\n        &#039;c&#039; =&gt;  [&#039;decimal&#039;, &#039;int&#039;],\n    ];\n\n}\u9009\u62e9\u573a\u666f\u9a8c\u8bc1\uff1a$data = [\n    &#039;decimal&#039;   =&gt;  &#039;a&#039;,\n    &#039;int&#039;       =&gt;  &#039;b&#039;,\n];\n$validator = new TestSceneValidator($data);\n$result = $validator-&gt;setCurrentScene(&#039;a&#039;)-&gt;validate();"},{"id":45,"title":"\u8fde\u63a5\u5206\u7ec4","pageTitle":"\u8fde\u63a5\u5206\u7ec4","url":"components\/websocketServer\/group.html","content":"\u8fde\u63a5\u5206\u7ec4imi \u652f\u6301\u5bf9 WebSocket \u7684\u8fde\u63a5\uff08fd\uff09\u8fdb\u884c\u903b\u8f91\u5206\u7ec4\uff0c\u4f60\u53ef\u4ee5\u65b9\u4fbf\u5730\u5bf9\u7528\u6237\u8fdb\u884c\u5206\u7ec4\u6d88\u606f\u63a8\u9001\u3002\u6240\u6709\u7684\u5206\u7ec4\u9488\u5bf9\u670d\u52a1\u5668\uff0c\u6240\u4ee5\u9700\u8981 imi \u7684\u670d\u52a1\u5668\u5bf9\u8c61\u624d\u53ef\u4ee5\u8c03\u7528\u4e0b\u9762\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u6bd4\u5982\u5728WebSocketController\u4e2d\u53ef\u4ee5\u4f7f\u7528$this-&gt;server\u3002\u5206\u7ec4\u7684\u4f7f\u7528\u914d\u7f6e\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;beans&#039; =&gt; [\n        \/\/ \u5206\u7ec4\n        &#039;ServerGroup&#039; =&gt; [\n            &#039;status&#039;       =&gt; true , \/\/ \u542f\u7528\n            &#039;groupHandler&#039; =&gt; &#039;GroupRedis&#039;, \/\/ \u5206\u7ec4\u5904\u7406\u5668\uff0c\u76ee\u524d\u4ec5\u652f\u6301 Redis\n        ],\n        \/\/ \u5206\u7ec4 Redis \u9a71\u52a8\n        &#039;GroupRedis&#039; =&gt; [\n            &#039;redisPool&#039; =&gt; &#039;\u8fde\u63a5\u6c60\u540d&#039;,\n            &#039;redisDb&#039; =&gt; 0, \/\/ redis\u4e2d\u7b2c\u51e0\u4e2a\u5e93\n            &#039;heartbeatTimespan&#039; =&gt; 5, \/\/ \u5fc3\u8df3\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2.\n            &#039;heartbeatTtl&#039; =&gt; 8, \/\/ \u5fc3\u8df3\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2.\n            &#039;key&#039; =&gt; null, \/\/ \u8be5\u670d\u52a1\u7684\u5206\u7ec4\u952e\uff0c\u9ed8\u8ba4\u4e3a imi:\u547d\u540d\u7a7a\u95f4:connect_group\n        ],\n        \/\/ \u5206\u7ec4\u672c\u5730\u9a71\u52a8\uff0c\u4ec5\u652f\u6301\u5f53\u524d Worker \u8fdb\u7a0b\n        &#039;GroupLocal&#039; =&gt; [\n            \/\/ \u65e0\u914d\u7f6e\u9879\n        ],\n    ],\n]\u5206\u7ec4\u521b\u5efa\/\/ \u521b\u5efa\u4e00\u4e2a\u5206\u7ec4\n$this-&gt;server-&gt;createGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;);\n\n\/\/ \u521b\u5efa\u4e00\u4e2a\u5206\u7ec4\uff0c\u6700\u591a\u5141\u8bb8\u52a0\u516510\u4e2a\u8fde\u63a5\uff0c-1\u4e3a\u4e0d\u9650\u5236\n$this-&gt;server-&gt;createGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;, 10);\u52a0\u5165\u5206\u7ec4$this-&gt;server-&gt;joinGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;, $this-&gt;frame-&gt;getFd());\u79bb\u5f00\u5206\u7ec4$this-&gt;server-&gt;leaveGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;, $this-&gt;frame-&gt;getFd());\u8fde\u63a5\u662f\u5426\u5b58\u5728\u4e8e\u7ec4\u91cc$this-&gt;server-&gt;getGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;)-&gt;isInGroup($this-&gt;frame-&gt;getFd());\u83b7\u53d6\u6240\u6709\u8fde\u63a5$this-&gt;server-&gt;getGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;)-&gt;getFds();\u83b7\u53d6\u5728\u7ec4\u4e2d\u7684\u8fde\u63a5\u603b\u6570$this-&gt;server-&gt;getGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;)-&gt;count();\u83b7\u53d6\u5206\u7ec4\u5bf9\u8c61\/\/ \u4e0d\u5b58\u5728\u5219\u4e3anull\uff0c\u5426\u5219\u4e3a\\Imi\\Server\\Group\\Group\u5bf9\u8c61\n$this-&gt;server-&gt;getGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;);\u7ec4\u662f\u5426\u5b58\u5728$this-&gt;server-&gt;hasGroup(&#039;\u5206\u7ec4\u540d\u79f0&#039;);\u8c03\u7528\u7ec4\u65b9\u6cd5\/\/ \u904d\u5386g1\u5206\u7ec4\u4e2d\u6240\u6709fd\uff0c\u8c03\u7528\u670d\u52a1\u5668\u7684push\u65b9\u6cd5\uff0c\u53d1\u9001message\n$this-&gt;server-&gt;groupCall(&#039;g1&#039;, &#039;push&#039;, &#039;message&#039;);\u83b7\u53d6\u6240\u6709\u5206\u7ec4$this-&gt;server-&gt;getGroups();\u5206\u7ec4\u5bf9\u8c61\u8be6\u89e3\u7c7b\\Imi\\Server\\Group\\Group\u52a0\u5165\u7ec4$group-&gt;join($fd);\u79bb\u5f00\u7ec4$group-&gt;leave($fd);\u83b7\u53d6\u670d\u52a1\u5668\u5bf9\u8c61\u5f53\u524d\u5206\u7ec4\u5c5e\u4e8e\u54ea\u4e2a\u670d\u52a1\u5668\uff0c\u8fd9\u4e2a\u662fSwoole\u7684\u670d\u52a1\u5668\u5bf9\u8c61\u3002$group-&gt;getServer();\u83b7\u53d6\u6700\u5927\u5ba2\u6237\u7aef\u6570\u91cf$group-&gt;getMaxClients();\u8c03\u7528\u7ec4\u65b9\u6cd5\/\/ \u53d1\u9001\u7ed9\u7ec4\u91cc\u6240\u6709\u7684\u8fde\u63a5\uff0c\u5176\u5b83\u670d\u52a1\u5668\u65b9\u6cd5\u4e00\u6837\u8c03\u7528\uff0c\u7701\u53bbfd\u53c2\u6570\u5373\u53ef\n$group-&gt;push(&#039;message&#039;);"},{"id":40,"title":"HTTP \u63a7\u5236\u5668","pageTitle":"HTTP \u63a7\u5236\u5668","url":"components\/websocketServer\/httpController.html","content":"HTTP \u63a7\u5236\u5668\u5728 WebSocket \u670d\u52a1\u5668\u4e2d\uff0c\u5982\u679c\u6709\u9700\u8981\u53ef\u4ee5\u5728 HTTP \u63a7\u5236\u5668\u4e2d\u81ea\u884c\u505a\u63e1\u624b\u5904\u7406\u3002\u6307\u5b9a WebSocket \u6570\u636e\u5904\u7406\u5668\u5728\u63a7\u5236\u5668\u4e2d\u7684\u65b9\u6cd5\u4e0a\u52a0\u4e0a\u6ce8\u89e3\uff1a@WSConfig(parserClass=\\Imi\\Server\\DataParser\\JsonArrayParser::class)parserClass \u6307\u5b9a\u7684\u5c31\u662f\u5904\u7406\u5668\u7c7b\uff0c\u4f5c\u7528\u5c31\u662f\u63a5\u6536\u5230\u6570\u636e\u540e\u81ea\u52a8\u89e3\u7801\u4e3a\u5bf9\u8c61\u6216\u6570\u7ec4\uff0c\u53d1\u9001\u65f6\u81ea\u52a8\u5c06\u6570\u7ec4\u6216\u5bf9\u8c61\u7f16\u7801\u4e3a\u76f8\u5e94\u6570\u636e\u3002\u5185\u7f6e\u652f\u6301\u7684\u7c7b\u8be6\u89c1\uff1ahttps:\/\/doc.imiphp.com\/components\/server\/dataParser.html"},{"id":39,"title":"HTTP \u8def\u7531","pageTitle":"HTTP \u8def\u7531","url":"components\/websocketServer\/httpRoute.html","content":"HTTP \u8def\u7531\u5728 WebSocket \u670d\u52a1\u5668\u4e2d\uff0cHTTP \u8def\u7531\u7684\u4f5c\u7528\u662f\u8ba9\u6307\u5b9aURI\u624d\u652f\u6301\u63e1\u624b\uff0c\u5e76\u4e14\u5982\u679c\u6709\u9700\u8981\u53ef\u4ee5\u81ea\u884c\u505a\u63e1\u624b\u5904\u7406\u3002\u7528\u6cd5\u540c HTTP \u670d\u52a1\u5668\uff0c\u4e0d\u518d\u7ec6\u8bf4\u3002"},{"id":43,"title":"\u4e2d\u95f4\u4ef6","pageTitle":"\u4e2d\u95f4\u4ef6","url":"components\/websocketServer\/middleware.html","content":"\u4e2d\u95f4\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u5f00\u53d1\u4e2d\u95f4\u4ef6\u7c7b\uff0c\u5bf9\u6574\u4e2aWebSocket\u8bf7\u6c42\u548c\u54cd\u5e94\u8fc7\u7a0b\u8fdb\u884c\u81ea\u5b9a\u4e49\u5904\u7406\u3002\u6ce8\u610f\uff01\u6700\u597d\u4e0d\u8981\u5728\u4e2d\u95f4\u4ef6\u4e2d\u4f7f\u7528\u7c7b\u5c5e\u6027\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u51b2\u7a81\uff01\u5b9a\u4e49\u4e2d\u95f4\u4ef6&lt;?php\nnamespace Imi\\Server\\WebSocket\\Middleware;\n\nuse Imi\\RequestContext;\nuse Imi\\Bean\\Annotation\\Bean;\nuse Imi\\Server\\WebSocket\\Message\\IFrame;\nuse Imi\\Server\\WebSocket\\MessageHandler;\nuse Imi\\Server\\WebSocket\\IMessageHandler;\n\n\/**\n * @Bean\n *\/\nclass RouteMiddleware implements IMiddleware\n{\n    \/**\n     * \u5904\u7406\u65b9\u6cd5\n     *\n     * @param IFrame $frame\n     * @param IMessageHandler $handler\n     * @return void\n     *\/\n    public function process(IFrame $frame, IMessageHandler $handler)\n    {\n        \/\/ \u524d\u7f6e\u5904\u7406\n        \n        \/\/ \u5148\u6267\u884c\u5176\u5b83\u4e2d\u95f4\u4ef6\n        $result = $handler-&gt;handle($frame);\n        \n        \/\/ \u540e\u7f6e\u5904\u7406\n        \n        return $result;\n    }\n\n}\u5168\u5c40\u4e2d\u95f4\u4ef6return [\n    &#039;beans&#039;    =&gt;    [\n        \/\/ \u4e2d\u95f4\u4ef6\n        &#039;WebSocketDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \/\/ \u4e2d\u95f4\u4ef6\n                \\Imi\\Server\\WebSocket\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u5c40\u90e8\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u4f7f\u7528&lt;?php\nnamespace ImiDemo\\WebSocketDemo\\MainServer\\WSController\\Index;\n\nuse Imi\\ConnectContext;\nuse Imi\\Controller\\WebSocketController;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSRoute;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSAction;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSController;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSMiddleware;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @WSController\n *\/\nclass Test extends WebSocketController\n{\n    \/**\n     * test\n     * \n     * @WSAction\n     * @WSRoute({&quot;action&quot;=&quot;login&quot;})\n     * @WSMiddleware(XXX::class)\n     * @WSMiddleware({XXX::class,XXX2::class})\n     * @return void\n     *\/\n    public function test($data)\n    {\n    }\n}\u5982\u4e0a\u4ee3\u7801\uff0c\u540c\u65f6\u652f\u6301\u8bbe\u7f6e\u5355\u4e2a\u548c\u591a\u4e2a\u4e2d\u95f4\u4ef6\u4e2d\u95f4\u4ef6\u5206\u7ec4\u670d\u52a1\u5668 config.php\uff1areturn [\n    &#039;middleware&#039;    =&gt;  [\n        &#039;groups&#039;    =&gt;  [\n            \/\/ \u7ec4\u540d\n            &#039;test&#039;  =&gt;  [\n                \/\/ \u4e2d\u95f4\u4ef6\u5217\u8868\n                \\Imi\\Test\\HttpServer\\ApiServer\\Middleware\\Middleware4::class,\n            ],\n        ],\n    ],\n];"},{"id":47,"title":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","pageTitle":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6","url":"components\/websocketServer\/noMiddleware.html","content":"\u4e0d\u4f7f\u7528\u4e2d\u95f4\u4ef6imi\u4e2d\u5185\u7f6e\u5b9e\u73b0\u4e86\u4e2d\u95f4\u4ef6+\u63a7\u5236\u5668\u65b9\u5f0f\u5f00\u53d1websocket\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e5f\u53ef\u4ee5\u9009\u62e9\u4e0d\u4f7f\u7528\uff0c\u76f4\u63a5\u76d1\u542c\u670d\u52a1\u5668\u7684message\u4e8b\u4ef6\uff0c\u8fdb\u884c\u624b\u52a8\u5904\u7406\u3002\u76d1\u542c\u5199\u6cd5&lt;?php\nnamespace ImiDemo\\WebSocketDemo\\MainServer\\Listener;\n\nuse Imi\\Bean\\Annotation\\ClassEventListener;\nuse Imi\\Server\\Event\\Param\\MessageEventParam;\nuse Imi\\Server\\Event\\Listener\\IMessageEventListener;\n\n\/**\n * \u76d1\u542cmessage\u4e8b\u4ef6\uff0c\u53ef\u4ee5\u81ea\u5df1\u505a\u5904\u7406\n * \u5982\u679c\u4e0d\u9700\u8981\u9ed8\u8ba4\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u628aWebSocketDispatcher-middlewares\u4e0b\u7684\u4e2d\u95f4\u4ef6\u53bb\u9664\n * \n * @ClassEventListener(className=&quot;Imi\\Server\\WebSocket\\Server&quot;,eventName=&quot;message&quot;)\n *\/\nclass OnMessage implements IMessageEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param MessageEventParam $e\n     * @return void\n     *\/\n    public function handle(MessageEventParam $e)\n    {\n        \/\/ \u5982\u679c\u670d\u52a1\u5668\u540d\u4e0d\u662f\u4e3b\u670d\u52a1\u5668\u5c31\u8fd4\u56de\n        if(&#039;main&#039; !== $e-&gt;getTarget()-&gt;getName())\n        {\n            return;\n        }\n        var_dump($e-&gt;frame-&gt;data);\n        \/\/ $e-&gt;server-&gt;getSwooleServer()-&gt;push($e-&gt;frame-&gt;fd, &#039;\u8fd4\u56de\u4fe1\u606f&#039;);\n    }\n}"},{"id":46,"title":"\u65ad\u7ebf\u91cd\u8fde","pageTitle":"\u65ad\u7ebf\u91cd\u8fde","url":"components\/websocketServer\/reconnect.html","content":"\u65ad\u7ebf\u91cd\u8fde\u4f7f\u7528 WebSocket\u3001Http2\u3001TCP \u7b49\u957f\u8fde\u63a5\u534f\u8bae\u65f6\uff0c\u5f88\u591a\u573a\u666f\u4f1a\u9700\u8981\u65ad\u7ebf\u91cd\u8fde\u529f\u80fd\u3002\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u6807\u8bb0\uff08UID\uff09\uff0c\u6765\u7ed1\u5b9a\u8fde\u63a5\u3002\u65ad\u7ebf\u91cd\u8fde\u5c31\u662f\u8fde\u63a5\u65ad\u5f00\u540e\uff0c\u8be5\u8fde\u63a5\u7684\u4e0a\u4e0b\u6587\u6570\u636e\u4f1a\u7ee7\u7eed\u4fdd\u7559\uff0c\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u91cd\u8fde\uff0c\u5c31\u53ef\u4ee5\u6062\u590d\u4e0a\u4e0b\u6587\u6570\u636e\u3002\u4e00\u822c\u7528\u4e8e\u6e38\u620f\u91cd\u8fde\u3001\u51cf\u5c11\u91cd\u8fde\u540e\u7684\u7f51\u7edc\u901a\u4fe1\u3001\u51cf\u8f7b\u524d\u7aef\u5f00\u53d1\u538b\u529b\u7b49\u573a\u666f\u3002\u65ad\u7ebf\u91cd\u8fde\u89c6\u9891\u4ecb\u7ecd\uff1ahttps:\/\/www.bilibili.com\/video\/BV1GC4y1s7yf\u4f7f\u7528\u6587\u6863\u8be6\u89c1\uff1ahttps:\/\/doc.imiphp.com\/components\/websocketServer\/session.html"},{"id":41,"title":"\u8def\u7531","pageTitle":"\u8def\u7531","url":"components\/websocketServer\/route.html","content":"\u8def\u7531\u542f\u7528\u8def\u7531\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u4e2d\u52a0\u5165\u4e2d\u95f4\u4ef6\uff1areturn [\n    &#039;beans&#039;    =&gt;    [\n        \/\/ \u914d\u7f6e http \u4e3a\u4e86\u63e1\u624b\n        &#039;HttpDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \\Imi\\Server\\WebSocket\\Middleware\\HandShakeMiddleware::class,\n                \\Imi\\Server\\Http\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n        \/\/ WebSocket \u914d\u7f6e\n        &#039;WebSocketDispatcher&#039;    =&gt;    [\n            &#039;middlewares&#039;    =&gt;    [\n                \\Imi\\Server\\WebSocket\\Middleware\\RouteMiddleware::class,\n            ],\n        ],\n    ],\n];\u901a\u8fc7\u914d\u7f6e\u6ce8\u5165\u5f62\u5f0f\uff0c\u5b9e\u73b0\u975e\u5e38\u7075\u6d3b\u7684\u914d\u7f6e\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u81ea\u5df1\u53e6\u5916\u5b9e\u73b0\u8def\u7531\u4e2d\u95f4\u4ef6\uff0c\u800c\u4e0d\u7528\u88ab\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6\u6240\u5f71\u54cd\uff0c\u7528\u54ea\u4e9b\u4e2d\u95f4\u4ef6\u90fd\u5728\u4f60\u7684\u638c\u63a7\u4e4b\u4e2d\uff01\u83b7\u53d6\u63e1\u624b\u8bf7\u6c42\u8def\u7531\u89e3\u6790\u7ed3\u679c$httpRouteResult = ConnectContext::get(&#039;routeResult&#039;);\u83b7\u53d6\u63e1\u624b\u65f6\u7684 uri \u5bf9\u8c61\/** @var \\Imi\\Util\\Uri $uri *\/\n$uri = ConnectContext::get(&#039;uri&#039;);\u83b7\u53d6\u5f53\u524d\u8def\u7531\u89e3\u6790\u7ed3\u679c (routeResult)$routeResult = RequestContext::get(&#039;routeResult&#039;);$routeResult \u5b9a\u4e49\uff1a\/**\n * \u8def\u7531\u914d\u7f6e\u9879\n *\n * @var \\Imi\\Server\\WebSocket\\Route\\RouteItem\n *\/\npublic $routeItem;\n\n\/**\n * \u53c2\u6570\n *\n * @var array\n *\/\npublic $params;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable\n *\/\npublic $callable;$routeResult-&gt;routeItem \u5b9a\u4e49\uff1a\/**\n * \u6ce8\u89e3\n *\n * @var \\Imi\\Server\\Route\\Annotation\\WebSocket\\WSRoute\n *\/\npublic $annotation;\n\n\/**\n * \u56de\u8c03\n *\n * @var callable|\\Imi\\Server\\Route\\RouteCallable\n *\/\npublic $callable;\n\n\/**\n * \u4e2d\u95f4\u4ef6\u5217\u8868\n *\n * @var array\n *\/\npublic $middlewares = [];\n\n\/**\n * \u5176\u5b83\u914d\u7f6e\u9879\n *\n * @var array\n *\/\npublic $options;"},{"id":44,"title":"\u4f1a\u8bdd\u6570\u636e","pageTitle":"\u4f1a\u8bdd\u6570\u636e","url":"components\/websocketServer\/session.html","content":"\u4f1a\u8bdd\u6570\u636eimi \u4e2d WebSocket \u670d\u52a1\u4e2d\u4f7f\u7528 Imi\\ConnectContext \u7c7b\u5bf9\u8fde\u63a5\u7684\u4f1a\u8bdd\u6570\u636e\u8fdb\u884c\u7ba1\u7406\u3002\u5728\u6574\u4e2a\u8fde\u63a5\u7684\u751f\u547d\u5468\u671f\u4e2d\u90fd\u6709\u6548\u3002\u4f7f\u7528use Imi\\ConnectContext;\n\n\/\/ \u53d6\u503c\necho ConnectContext::get(&#039;name&#039;);\necho ConnectContext::get(&#039;name&#039;, &#039;default value&#039;);\n\n\/\/ \u8d4b\u503c\nConnectContext::set(&#039;name&#039;, &#039;value&#039;);\n\n\/\/ \u83b7\u53d6\u6240\u6709\u6570\u636e\n$array = ConnectContext::getContext();\n\n\/\/ \u4f7f\u7528\u56de\u8c03\u5e76\u4e14\u81ea\u52a8\u52a0\u9501\u8fdb\u884c\u64cd\u4f5c\uff0c\u56de\u8c03\u7528\u8fd4\u56de\u6570\u636e\u4f1a\u4fdd\u5b58\u8fdb\u8fde\u63a5\u4e0a\u4e0b\u6587\nConnectContext::use(function($data){\n    \/\/ \u672c\u65b9\u6cd5\u4f53\u4f1a\u5728\u9501\u4e2d\u6267\u884c\n    var_dump($data); \/\/ \u8bfb\u53d6\u6570\u636e\n    $data[&#039;aaa&#039;] = 222;\n    return $data; \/\/ \u5199\u5165\u6570\u636e\uff0c\u4e0dreturn\u4e5f\u53ef\u4ee5\uff0c\u5c31\u662f\u4e0d\u4fee\u6539\n});\u914d\u7f6eConnectContext \u5b58\u50a8\u5668Redis:&#039;beans&#039; =&gt;  [\n    &#039;ConnectContextStore&#039;   =&gt;  [\n        &#039;handlerClass&#039;  =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\Redis::class,\n    ],\n    &#039;ConnectContextRedis&#039;    =&gt;    [\n        &#039;redisPool&#039;    =&gt; &#039;redis&#039;, \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;redisDb&#039;      =&gt; 0, \/\/ redis\u4e2d\u7b2c\u51e0\u4e2a\u5e93\n        &#039;key&#039;          =&gt; &#039;imi:connect_context&#039;, \/\/ \u952e\n        &#039;heartbeatTimespan&#039; =&gt; 5, \/\/ \u5fc3\u8df3\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n        &#039;heartbeatTtl&#039; =&gt; 8, \/\/ \u5fc3\u8df3\u6570\u636e\u8fc7\u671f\u65f6\u95f4\uff0c\u5355\u4f4d\uff1a\u79d2\n        &#039;dataEncode&#039;=&gt;  &#039;serialize&#039;, \/\/ \u6570\u636e\u5199\u5165\u524d\u7f16\u7801\u56de\u8c03\n        &#039;dataDecode&#039;=&gt;  &#039;unserialize&#039;, \/\/ \u6570\u636e\u8bfb\u51fa\u540e\u5904\u7406\u56de\u8c03\n        &#039;lockId&#039;    =&gt;  null, \/\/ \u975e\u5fc5\u8bbe\uff0c\u53ef\u4ee5\u7528\u9501\u6765\u9632\u6b62\u6570\u636e\u9519\u4e71\u95ee\u9898\n    ],\n],Local:\u672c\u5730\u53d8\u91cf\u5b58\u50a8\uff0c\u6027\u80fd\u6700\u9ad8\u53ea\u5efa\u8bae\u5728 SWOOLE_BASE \u6a21\u5f0f\u4e0b\u4f7f\u7528&#039;beans&#039; =&gt;  [\n    &#039;ConnectContextStore&#039;   =&gt;  [\n        &#039;handlerClass&#039;  =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\Local::class,\n    ],\n    &#039;ConnectContextLocal&#039;    =&gt;    [\n        &#039;lockId&#039;    =&gt;  null, \/\/ \u975e\u5fc5\u8bbe\uff0c\u53ef\u4ee5\u7528\u9501\u6765\u9632\u6b62\u6570\u636e\u9519\u4e71\u95ee\u9898\n    ],\n],MemoryTable:&#039;beans&#039; =&gt;  [\n    &#039;ConnectContextStore&#039;   =&gt;  [\n        &#039;handlerClass&#039;  =&gt;  \\Imi\\Server\\ConnectContext\\StoreHandler\\MemoryTable::class,\n    ],\n    &#039;ConnectContextMemoryTable&#039; =&gt;  [\n        &#039;tableName&#039; =&gt;  &#039;connectContext&#039;, \/\/ tableName \u4f60\u9700\u8981\u5b9e\u73b0\u5b9a\u4e49 MemoryTable\uff0c\u8bf7\u67e5\u770b\u76f8\u5173\u7ae0\u8282\n        &#039;dataEncode&#039;=&gt;  &#039;serialize&#039;, \/\/ \u6570\u636e\u5199\u5165\u524d\u7f16\u7801\u56de\u8c03\n        &#039;dataDecode&#039;=&gt;  &#039;unserialize&#039;, \/\/ \u6570\u636e\u8bfb\u51fa\u540e\u5904\u7406\u56de\u8c03\n        &#039;lockId&#039;    =&gt;  null, \/\/ \u975e\u5fc5\u8bbe\uff0c\u56e0\u4e3a\u5982\u679c\u7528 MemoryTable\uff0c\u9ed8\u8ba4\u662f\u7528 MemoryTable \u7684 Lock\n    ],\n],\u8fde\u63a5\u7ed1\u5b9a\u5668&#039;beans&#039; =&gt;  [\n    \/\/ \u8fde\u63a5\u7ed1\u5b9a\u5668\n    &#039;ConnectionBinder&#039;  =&gt;  [\n        \/\/ \u5904\u7406\u5668\u7c7b\uff0c\u9ed8\u8ba4 ConnectionBinderRedis\n        \/\/ \u652f\u6301\uff1aConnectionBinderRedis\u3001ConnectionBinderLocal\n        \/\/ &#039;handlerClass&#039; =&gt; &#039;ConnectionBinderRedis&#039;,\n    ],\n    \/\/ Redis \u8fde\u63a5\u7ed1\u5b9a\u5668\u914d\u7f6e\n    &#039;ConnectionBinderRedis&#039; =&gt; [\n        \/\/ Redis \u8fde\u63a5\u6c60\u540d\u79f0\n        &#039;redisPool&#039; =&gt;  &#039;redis&#039;,\n        \/\/ redis\u4e2d\u7b2c\u51e0\u4e2a\u5e93\n        &#039;redisDb&#039;   =&gt;  0,\n        \/\/ \u952e\uff0c\u591a\u4e2a\u670d\u52a1\u5171\u7528 redis \u8bf7\u8bbe\u4e3a\u4e0d\u540c\u7684\uff0c\u4e0d\u7136\u4f1a\u51b2\u7a81\n        &#039;key&#039;       =&gt;  &#039;imi:wsTest:connectionBinder:map&#039;,\n    ],\n    \/\/ \u8fde\u63a5\u7ed1\u5b9a\u5668\u672c\u5730\u9a71\u52a8\n    &#039;ConnectionBinderLocal&#039; =&gt; [\n        \/\/ &#039;gcInteval&#039; =&gt; 60, \/\/ \u6e05\u9664\u65e7\u7684\u8fc7\u671f\u6570\u636e\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\uff1a\u79d2\n    ],\n],\u65b9\u6cd5\u83b7\u53d6\u5f53\u524d\u8fde\u63a5\u53f7use Imi\\ConnectContext;\n\n$fd = ConnectContext::getFd();\u7ed1\u5b9a\u8fde\u63a5use Imi\\ConnectContext;\n$memberId = 1; \/\/ \u7528\u6237\u6807\u8bc6\u7b26\n\nConnectContext::bind($memberId);\u7ed1\u5b9a\u8fde\u63a5\uff0c\u5982\u679c\u5df2\u7ed1\u5b9a\u8fd4\u56defalseuse Imi\\ConnectContext;\n$memberId = 1; \/\/ \u7528\u6237\u6807\u8bc6\u7b26\n\nConnectContext::bindNx($memberId);\u6062\u590d\u8fde\u63a5\u6570\u636euse Imi\\ConnectContext;\n$memberId = 1; \/\/ \u7528\u6237\u6807\u8bc6\u7b26\n\nConnectContext::restore($memberId);\u53d6\u6d88\u7ed1\u5b9ause Imi\\ConnectContext;\n$memberId = 1; \/\/ \u7528\u6237\u6807\u8bc6\u7b26\n\nConnectContext::unbind($memberId);\u4f7f\u7528\u6807\u8bb0\uff08UID\uff09\u83b7\u53d6\u8fde\u63a5\u7f16\u53f7use Imi\\ConnectContext;\n$memberId = 1; \/\/ \u7528\u6237\u6807\u8bc6\u7b26\n\n$fd = ConnectContext::getFdByFlag($memberId);\u3010\u6279\u91cf\u3011\u4f7f\u7528\u6807\u8bb0\uff08UID\uff09\u83b7\u53d6\u8fde\u63a5\u7f16\u53f7use Imi\\ConnectContext;\n$memberId = 1; \/\/ \u7528\u6237\u6807\u8bc6\u7b26\n\n$fds = ConnectContext::getFdsByFlags([$memberId]); \/\/ [1]\u4f7f\u7528\u8fde\u63a5\u7f16\u53f7\u83b7\u53d6\u6807\u8bb0\uff08UID\uff09use Imi\\ConnectContext;\n$fd = 1; \/\/ \u8fde\u63a5\u7f16\u53f7\n\n$memberIds = ConnectContext::getFlagByFd($fd);\u3010\u6279\u91cf\u3011\u4f7f\u7528\u8fde\u63a5\u7f16\u53f7\u83b7\u53d6\u6807\u8bb0\uff08UID\uff09use Imi\\ConnectContext;\n$fd = 1; \/\/ \u8fde\u63a5\u7f16\u53f7\n\n$memberIds = ConnectContext::getFlagsByFds([$fd]); \/\/ [1]"},{"id":42,"title":"WebSocket \u63a7\u5236\u5668","pageTitle":"WebSocket \u63a7\u5236\u5668","url":"components\/websocketServer\/websocketController.html","content":"WebSocket \u63a7\u5236\u5668\u5b9a\u4e49&lt;?php\nnamespace ImiDemo\\WebSocketDemo\\MainServer\\WSController\\Index;\n\nuse Imi\\ConnectContext;\nuse Imi\\Controller\\WebSocketController;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSRoute;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSAction;\nuse Imi\\Server\\Route\\Annotation\\WebSocket\\WSController;\n\n\/**\n * \u6570\u636e\u6536\u53d1\u6d4b\u8bd5\n * @WSController\n *\/\nclass Test extends WebSocketController\n{\n    \/**\n     * \u767b\u5f55\n     * \n     * @WSAction\n     * @WSRoute({&quot;action&quot;=&quot;login&quot;})\n     * @return void\n     *\/\n    public function login($data)\n    {\n        ConnectContext::set(&#039;username&#039;, $data-&gt;username);\n        $this-&gt;server-&gt;joinGroup(&#039;g1&#039;, $this-&gt;frame-&gt;getFd());\n        return [&#039;success&#039;=&gt;true];\n    }\n}\u9996\u5148\u63a7\u5236\u5668\u7c7b\u5fc5\u987b\u6709@WSController\u6ce8\u89e3\uff0c\u5bf9\u5e94\u52a8\u4f5c\u5fc5\u987b\u6709@WSAction\u548c@WSRoute\u6ce8\u89e3\u3002\u6ce8\u89e3@WSController\u6ce8\u91ca\u76ee\u6807\uff1a\u7c7b\u8868\u660e\u4e00\u4e2a\u7c7b\u662f\u63a7\u5236\u5668\u7c7b\u5c5e\u6027\u540d\u79f0\u8bf4\u660esingleton\u662f\u5426\u4e3a\u5355\u4f8b\u63a7\u5236\u5668\uff0c\u9ed8\u8ba4\u4e3a null \u65f6\u53d6 '@server.\u670d\u52a1\u5668\u540d.controller.singleton'routehttp \u8def\u7531\u3002\u5982\u679c\u8bbe\u7f6e\uff0c\u5219\u53ea\u6709\u63e1\u624b\u6307\u5b9a http \u8def\u7531\uff0c\u624d\u53ef\u4ee5\u89e6\u53d1\u8be5 WebSocket \u8def\u7531server\u6307\u5b9a\u5f53\u524d\u63a7\u5236\u5668\u5141\u8bb8\u54ea\u4e9b\u670d\u52a1\u5668\u4f7f\u7528\u3002\u652f\u6301\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\uff0c\u9ed8\u8ba4\u4e3a null \u5219\u4e0d\u9650\u5236\u901a\u5e38\uff1a@WSController\u6307\u5b9a\u5339\u914d http \u8def\u7531\uff1a\/\/ \u53ea\u6709\u63e1\u624b \/test \u8fd9\u4e2a\u8def\u5f84\u624d\u53ef\u4ee5\u89e6\u53d1\u8be5 WebSocket \u52a8\u4f5c\n@WSController(route=&quot;\/test&quot;)@WSRoute\u6307\u5b9a WebSocket \u8def\u7531\u89e3\u6790\u89c4\u5219\u3002\/\/ \u89e3\u6790 $data[&#039;action&#039;] === &#039;login&#039;\n@WSRoute({&quot;action&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data[&#039;a&#039;][&#039;b&#039;][&#039;c&#039;] === &#039;login&#039;\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\n\/\/ \u89e3\u6790 $data[&#039;a&#039;] == &#039;1&#039; &amp;&amp; $data[&#039;b&#039;] == &#039;2&#039;\n@WSRoute({&quot;a&quot;=&quot;1&quot;, &quot;b&quot;=&quot;2&quot;})\u5f53\u7136\u5bf9\u8c61\u4e5f\u662f\u652f\u6301\u7684\uff1a\/\/ \u89e3\u6790 $data-&gt;a-&gt;b-&gt;c === &#039;login&#039;\n@WSRoute({&quot;a.b.c&quot;=&quot;login&quot;})\u6307\u5b9a\u5339\u914d http \u8def\u7531\uff1a\/\/ \u53ea\u6709\u63e1\u624b \/test \u8fd9\u4e2a\u8def\u5f84\u624d\u53ef\u4ee5\u89e6\u53d1\u8be5 WebSocket \u52a8\u4f5c\n@WSRoute(condition={&quot;action&quot;=&quot;login&quot;}, route=&quot;\/test&quot;)\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c31\u4f1a\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c\u3002\u52a8\u4f5c\u54cd\u5e94\u6570\u636e\u54cd\u5e94\u5f53\u524d\u8fd9\u4e2a\u8bf7\u6c42\u76f4\u63a5\u5728\u65b9\u6cd5\u4e2d\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5728Http \u63a7\u5236\u5668\u4e2d@WSConfig\u4e2d\u8bbe\u5b9a\u7684\u5904\u7406\u5668\uff0c\u5c31\u4f1a\u628a\u8fd9\u4e2a\u8f6c\u4e3a\u5bf9\u5e94\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002return [&#039;success&#039;=&gt;true];\u5206\u7ec4\u53d1\u9001$this-&gt;server-&gt;groupCall(&#039;\u7ec4\u540d&#039;, &#039;push&#039;, [&#039;success&#039;=&gt;true]);\u5f53\u7136\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u9700\u8981\u6709\u54cd\u5e94\u6570\u636e\uff0c\u4ec0\u4e48\u90fd\u4e0dreturn\u6216\u8005return null\u5c31\u662f\u4e0d\u54cd\u5e94\u6570\u636e\u3002\u7c7b\u5c5e\u6027$server\u65b9\u6cd5getSwooleServer\u83b7\u53d6Swoole\u7684Server\u5bf9\u8c61\/**\n * \u7ec4\u662f\u5426\u5b58\u5728\n *\n * @param string $groupName\n * @return boolean\n *\/\npublic function hasGroup(string $groupName);\/**\n * \u521b\u5efa\u7ec4\uff0c\u8fd4\u56de\u7ec4\u5bf9\u8c61\n *\n * @param string $groupName\n * @param integer $maxClients\n * @return \\Imi\\Server\\Group\\Group\n *\/\npublic function createGroup(string $groupName, int $maxClients = -1);\/**\n * \u83b7\u53d6\u7ec4\u5bf9\u8c61\uff0c\u4e0d\u5b58\u5728\u8fd4\u56denull\n *\n * @param string $groupName\n * @return \\Imi\\Server\\Group\\Group|null\n *\/\npublic function getGroup(string $groupName);\/**\n * \u52a0\u5165\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function joinGroup(string $groupName, int $fd);\/**\n * \u79bb\u5f00\u7ec4\uff0c\u7ec4\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\n *\n * @param string $groupName\n * @param integer $fd\n * @return void\n *\/\npublic function leaveGroup(string $groupName, int $fd);\/**\n * \u8c03\u7528\u7ec4\u65b9\u6cd5\n *\n * @param string $groupName\n * @param string $methodName\n * @param mixed ...$args\n * @return array\n *\/\npublic function groupCall(string $groupName, string $methodName, ...$args);\/**\n * \u83b7\u53d6\u6240\u6709\u7ec4\u5217\u8868\n *\n * @return \\Imi\\Server\\Group\\Group[]\n *\/\npublic function getGroups(): array;$frame\u65b9\u6cd5\/**\n * \u83b7\u53d6\u5ba2\u6237\u7aef\u7684socket id\n * @return int\n *\/\npublic function getFd(): int;\/**\n * \u6570\u636e\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u6587\u672c\u5185\u5bb9\u4e5f\u53ef\u4ee5\u662f\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7opcode\u7684\u503c\u6765\u5224\u65ad\n * @return string\n *\/\npublic function getData();\/**\n * \u83b7\u53d6\u683c\u5f0f\u5316\u540e\u7684\u6570\u636e\uff0c\u4e00\u822c\u662f\u6570\u7ec4\u6216\u5bf9\u8c61\n * @return mixed\n *\/\npublic function getFormatData();\/**\n * WebSocket\u7684OpCode\u7c7b\u578b\uff0c\u53ef\u4ee5\u53c2\u8003WebSocket\u534f\u8bae\u6807\u51c6\u6587\u6863\n * WEBSOCKET_OPCODE_TEXT = 0x1 \uff0c\u6587\u672c\u6570\u636e\n * WEBSOCKET_OPCODE_BINARY = 0x2 \uff0c\u4e8c\u8fdb\u5236\u6570\u636e\n * @return int\n *\/\npublic function getOpcode();\/**\n * \u8868\u793a\u6570\u636e\u5e27\u662f\u5426\u5b8c\u6574\n * @return boolean\n *\/\npublic function isFinish();\/**\n * \u83b7\u53d6 \\Swoole\\Websocket\\Frame \u5bf9\u8c61\n * @return \\Swoole\\Websocket\\Frame\n *\/\npublic function getSwooleWebSocketFrame(): \\Swoole\\Websocket\\Frame;"},{"id":"645b0b4a740024.22170170","title":"WebSocket \u8def\u7531","pageTitle":"WebSocket \u8def\u7531","url":"components\/websocketServer\/websocketRoute.html","content":"WebSocket \u8def\u7531\u901a\u8fc7@WSConfig\u4e2d\u8bbe\u7f6e\u7684\u6570\u636e\u5904\u7406\u5668\uff0c\u628a\u63a5\u6536\u5230\u7684\u6570\u636e\u8f6c\u4e3a\u6570\u7ec4\u6216\u5bf9\u8c61\u540e\uff0c\u6839\u636e\u8def\u7531\u6ce8\u89e3\u6216\u914d\u7f6e\uff0c\u89e3\u6790\u5e76\u5339\u914d\u4e3a\u5bf9\u5e94\u65b9\u6cd5\u3002@WSRoute \u7528\u6cd5\u53c2\u8003"},{"id":10,"title":"\u5bb9\u5668","pageTitle":"\u5bb9\u5668","url":"core\/container.html","content":"\u5bb9\u5668\u5bb9\u5668\u7528\u4e8e\u5b58\u653e\u7c7b\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u5bb9\u5668\u4e2d\u7684\u5bf9\u8c61\u7c7b\u6211\u4eec\u79f0\u4e4b\u4e3a Bean\u3002\u901a\u8fc7\u5bb9\u5668\u5b9e\u4f8b\u5316\u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5b83\u4eec\u8fdb\u884c\u6ce8\u5165\u64cd\u4f5c\u3002\u914d\u7f6e\u626b\u63cf\u547d\u540d\u7a7a\u95f4\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u4f1a\u626b\u63cf\u914d\u7f6e\u4e2d\u8bbe\u5b9a\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u626b\u63cf\u5230\u7684\u7c7b\u624d\u53ef\u4ee5\u901a\u8fc7\u5bb9\u5668\u4f7f\u7528 Bean \u540d\u79f0\u83b7\u53d6\u5bf9\u8c61\u3002\u652f\u6301\u5728\u9879\u76ee\u3001\u5b50\u670d\u52a1\u5668\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\uff1areturn [\n    &#039;beanScan&#039;  =&gt;  [\n        &#039;ImiApp\\Model&#039;,\n        &#039;ImiApp\\Service&#039;,\n    ],\n];\u5bb9\u5668\u5206\u7c7b\u5168\u5c40\u5bb9\u5668\u670d\u52a1\u5668\u5bb9\u5668\u8bf7\u6c42\u4e0a\u4e0b\u6587\u5bb9\u5668\u5168\u5c40\u5bb9\u5668\u5b58\u6d3b\u4e8e\u6846\u67b6\u6574\u4e2a\u751f\u547d\u5468\u671f\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5168\u5c40\u5bb9\u5668\u3002$object = \\Imi\\App::getBean(&#039;XXX&#039;);\u670d\u52a1\u5668\u5bb9\u5668\u53ea\u9488\u5bf9\u76ee\u6807\u670d\u52a1\u5668\u7684\u5bb9\u5668\uff0c\u8be5\u5bb9\u5668\u4e2d\u76ee\u524d\u5b58\u50a8\u4e86\u8be5\u670d\u52a1\u5668\u7684\u8def\u7531\u5bf9\u8c61\u53ca\u914d\u7f6e\u7b49\u7b49\u3002$object = \\Imi\\ServerManage::getServer(&#039;main&#039;)-&gt;getBean(&#039;XXX&#039;);\u8bf7\u6c42\u4e0a\u4e0b\u6587\u5bb9\u5668\u5f53\u524d\u8bf7\u6c42\u6709\u6548\u7684\u5bb9\u5668\uff0c\u8bf7\u6c42\u7ed3\u675f\u65f6\u5373\u9500\u6bc1\u3002$object = \\Imi\\RequestContext::getBean(&#039;XXX&#039;);\u5bb9\u5668\u5bf9\u8c61\u7c7b (Bean)getBean()\u65f6\u53ef\u4ee5\u4f20\u5e26\u6709\u5b8c\u6574\u547d\u540d\u7a7a\u95f4\u7684\u7c7b\u540d\uff0c\u6216\u8005\u522b\u540d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7@Bean\u6ce8\u89e3\u6765\u5b9a\u4e49\u522b\u540d\u3002\u4f60\u4e5f\u53ef\u4ee5\u5728\u7c7b\u91cc\u5b9a\u4e49\u4e00\u4e2a__init()\u65b9\u6cd5\uff0cimi \u5c06\u5b83\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u6784\u9020\u65b9\u6cd5\u3002\u6267\u884c\u987a\u5e8f\uff1a__construct -&gt; injectProps -&gt; __initinjectProps \u5373\u4e3a\u5c5e\u6027\u6ce8\u5165\uff0c\u5177\u4f53\u8bf7\u770b\u7ae0\u8282\uff1aAOP\u5b9a\u4e49\uff1anamespace Test;\n\n\/**\n * @Bean(&quot;MyTest&quot;)\n *\/\nclass ABCDEFG\n{\n    public function __construct($id)\n    {\n        echo &#039;first&#039;, PHP_EOL;\n    }\n\n    public function __init($id)\n    {\n        echo &#039;second first&#039;, PHP_EOL;\n    }\n}\u83b7\u5f97\u5b9e\u4f8b\uff1aApp::getBean(&#039;MyTest&#039;);\nApp::getBean(\\Test\\ABCDEFG::class);\u6ce8\u89e3\u7ee7\u627f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7ee7\u627f\u7236\u7c7b\uff0c\u7236\u7c7b\u7684\u6ce8\u89e3\u662f\u4e0d\u751f\u6548\u7684\u3002\u6709\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u8ba9\u4ed6\u751f\u6548\u3002imi \u63d0\u4f9b\u4e86\u4e00\u4e2a @Inherit \u6ce8\u89e3\uff0c\u652f\u6301\u5199\u5728\uff1a\u7c7b\u3001\u65b9\u6cd5\u3001\u5c5e\u6027\u3001\u5e38\u91cf\u4e0a\u3002\u7c7b\u540d\uff1aImi\\Bean\\Annotation\\Inherit\u53c2\u6570\uff1a\/**\n * \u5141\u8bb8\u7684\u6ce8\u89e3\u7c7b\uff0c\u4e3a null \u5219\u4e0d\u9650\u5236\uff0c\u652f\u6301\u5b57\u7b26\u4e32\u6216\u6570\u7ec4\n *\n * @var string|string[]\n *\/\npublic $annotation;\u4f8b\u5b50\uff1a\u4e0b\u9762\u662f\u6a21\u578b\u7684\u4f8b\u5b50\uff0c\u7236\u7c7b\u5b9a\u4e49\u7ed3\u6784\uff0c\u5b50\u7c7b\u4e2d\u53ef\u4ee5\u5199\u81ea\u5b9a\u4e49\u4ee3\u7801\u3002\u91cd\u65b0\u751f\u6210\u6a21\u578b\u7236\u7c7b\u4ee3\u7801\uff0c\u4e0d\u4f1a\u628a\u81ea\u5b9a\u4e49\u4ee3\u7801\u7ed9\u8986\u76d6\u6389\u3002\u7236\u7c7b\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Model\\Base;\n\nuse Imi\\Model\\Model;\nuse Imi\\Model\\Annotation\\Table;\nuse Imi\\Model\\Annotation\\Column;\nuse Imi\\Model\\Annotation\\Entity;\n\n\/**\n * ArticleBase\n * @Entity\n * @Table(name=&quot;tb_article&quot;, id={&quot;id&quot;})\n * @property int $id \n * @property string $title \n * @property string $content \n * @property string $time \n *\/\nabstract class ArticleBase extends Model\n{\n    \/**\n     * id\n     * @Column(name=&quot;id&quot;, type=&quot;int&quot;, length=10, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=true, primaryKeyIndex=0, isAutoIncrement=true)\n     * @var int\n     *\/\n    protected $id;\n\n    \/**\n     * \u83b7\u53d6 id\n     *\n     * @return int\n     *\/ \n    public function getId()\n    {\n        return $this-&gt;id;\n    }\n\n    \/**\n     * \u8d4b\u503c id\n     * @param int $id id\n     * @return static\n     *\/ \n    public function setId($id)\n    {\n        $this-&gt;id = $id;\n        return $this;\n    }\n\n    \/**\n     * title\n     * @Column(name=&quot;title&quot;, type=&quot;varchar&quot;, length=255, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $title;\n\n    \/**\n     * \u83b7\u53d6 title\n     *\n     * @return string\n     *\/ \n    public function getTitle()\n    {\n        return $this-&gt;title;\n    }\n\n    \/**\n     * \u8d4b\u503c title\n     * @param string $title title\n     * @return static\n     *\/ \n    public function setTitle($title)\n    {\n        $this-&gt;title = $title;\n        return $this;\n    }\n\n    \/**\n     * content\n     * @Column(name=&quot;content&quot;, type=&quot;mediumtext&quot;, length=0, accuracy=0, nullable=false, default=&quot;&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $content;\n\n    \/**\n     * \u83b7\u53d6 content\n     *\n     * @return string\n     *\/ \n    public function getContent()\n    {\n        return $this-&gt;content;\n    }\n\n    \/**\n     * \u8d4b\u503c content\n     * @param string $content content\n     * @return static\n     *\/ \n    public function setContent($content)\n    {\n        $this-&gt;content = $content;\n        return $this;\n    }\n\n    \/**\n     * time\n     * @Column(name=&quot;time&quot;, type=&quot;timestamp&quot;, length=0, accuracy=0, nullable=false, default=&quot;CURRENT_TIMESTAMP&quot;, isPrimaryKey=false, primaryKeyIndex=-1, isAutoIncrement=false)\n     * @var string\n     *\/\n    protected $time;\n\n    \/**\n     * \u83b7\u53d6 time\n     *\n     * @return string\n     *\/ \n    public function getTime()\n    {\n        return $this-&gt;time;\n    }\n\n    \/**\n     * \u8d4b\u503c time\n     * @param string $time time\n     * @return static\n     *\/ \n    public function setTime($time)\n    {\n        $this-&gt;time = $time;\n        return $this;\n    }\n\n}\u5b50\u7c7b\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Model;\n\nuse Imi\\Bean\\Annotation\\Inherit;\nuse Imi\\Test\\Component\\Model\\Base\\ArticleBase;\n\n\/**\n * Article\n * @Inherit\n *\/\nclass Article extends ArticleBase\n{\n\n}"},{"id":12,"title":"\u4e8b\u4ef6","pageTitle":"\u4e8b\u4ef6","url":"core\/events.html","content":"\u4e8b\u4ef6imi \u6846\u67b6\u4e8b\u4ef6IMI.INITED\u6846\u67b6\u521d\u59cb\u5316\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.APP.INIT\u9879\u76ee\u521d\u59cb\u5316\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.LOAD_RUNTIME_INFO\u52a0\u8f7d runtime \u4e8b\u4ef6\uff0c\u5728\u6b64\u4e8b\u4ef6\u4e2d\uff0c\u7edd\u5bf9\u53ef\u4ee5\u4f7f\u7528 App::getRuntimeInfo() \u83b7\u53d6\u5230\u6570\u636e\u3002IMI.MAIN_SERVER.WORKER.START.APP\u5728\u9879\u76ee\u4e2d\u76d1\u542c WorkerStart \u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerStartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n}IMI.SERVER.CREATE.BEFORE\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u64cd\u4f5c\uff0c\u4e3b\u670d\u52a1\u5668+\u5b50\u670d\u52a1\u5668\uff0c\u6bcf\u4e2a\u521b\u5efa\u524d\u90fd\u4f1a\u89e6\u53d1\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.SERVER.CREATE.AFTER\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u540e\u4f5c\uff0c\u4e3b\u670d\u52a1\u5668+\u5b50\u670d\u52a1\u5668\uff0c\u6bcf\u4e2a\u521b\u5efa\u540e\u90fd\u4f1a\u89e6\u53d1\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.SERVERS.CREATE.BEFORE\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u540e\u4f5c\uff0c\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.SERVERS.CREATE.AFTER\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u524d\u7f6e\u540e\u4f5c\uff0c\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff01\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.INIT.WORKER.BEFOREWorker \u8fdb\u7a0b\u521d\u59cb\u5316\u540e\u7f6e\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.INIT.WORKER.AFTERWorker \u8fdb\u7a0b\u521d\u59cb\u5316\u540e\u7f6e\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.PROCESS.BEGIN\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u5f00\u59cb\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process $processIMI.PROCESS.END\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u7ed3\u675f\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process $processIMI.PROCESS_POOL.PROCESS.BEGIN\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u6c60\u4e2d\u7684\u8fdb\u7a0b\u5f00\u59cb\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process\\Pool $pool, int $workerId, int $workerNum, array $args, int $ipcType, string $msgQueueKeyIMI.PROCESS_POOL.PROCESS.END\u81ea\u5b9a\u4e49\u8fdb\u7a0b\u6c60\u4e2d\u7684\u8fdb\u7a0b\u7ed3\u675f\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1astring $name, \\Swoole\\Process\\Pool $pool, int $workerId, int $workerNum, array $args, int $ipcType, string $msgQueueKeyIMI.SERVER.GROUP.JOIN\u670d\u52a1\u5668\u903b\u8f91\u5206\u7ec4\u52a0\u5165\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\\Imi\\Server\\Base $server, string $groupName, int $fdIMI.SERVER.GROUP.LEAVE\u670d\u52a1\u5668\u903b\u8f91\u5206\u7ec4\u79bb\u5f00\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\\Imi\\Server\\Base $server, string $groupName, int $fdIMI.REQUEST_CONTENT.CREATE\u8bf7\u6c42\u4e0a\u4e0b\u6587\u521b\u5efa\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0IMI.REQUEST_CONTENT.DESTROY\u8bf7\u6c42\u4e0a\u4e0b\u6587\u9500\u6bc1\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1a\u65e0Swoole Server \u5168\u5c40\u4e8b\u4ef6IMI.MAIN_SERVER.STARTOnStart\u4e8b\u4ef6\u53c2\u6570\uff1aclass StartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.SHUTDOWNOnShutdown\u4e8b\u4ef6\u53c2\u6570\uff1aclass ShutdownEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.WORKER.STARTOnWorkerStart\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerStartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n}IMI.MAIN_SERVER.WORKER.STOPOnWorkerStop\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerStopEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n}IMI.MAIN_SERVER.MANAGER.STARTOnManagerStart\u4e8b\u4ef6\u53c2\u6570\uff1aclass ManagerStartEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.MANAGER.STOPOnManagerStop\u4e8b\u4ef6\u53c2\u6570\uff1aclass ManagerStopEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n}IMI.MAIN_SERVER.TASKOnTask\u4e8b\u4ef6\u53c2\u6570\uff1aclass TaskEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u4efb\u52a1ID\n     * @var int\n     *\/\n    public $taskID;\n\n    \/**\n     * worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n\n    \/**\n     * \u4efb\u52a1\u6570\u636e\n     * @var mixed\n     *\/\n    public $data;\n}IMI.MAIN_SERVER.FINISHOnFinish\u4e8b\u4ef6\u53c2\u6570\uff1aclass FinishEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u4efb\u52a1ID\n     * @var int\n     *\/\n    public $taskID;\n\n    \/**\n     * \u4efb\u52a1\u6570\u636e\n     * @var mixed\n     *\/\n    public $data;\n}IMI.MAIN_SERVER.PIPE_MESSAGEOnPipeMessage\u4e8b\u4ef6\u53c2\u6570\uff1aclass PipeMessageEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n\n    \/**\n     * \u6d88\u606f\u5185\u5bb9\uff0c\u53ef\u4ee5\u662f\u4efb\u610fPHP\u7c7b\u578b\n     * @var mixed\n     *\/\n    public $message;\n}IMI.MAIN_SERVER.WORKER_ERROROnWorkerError\u4e8b\u4ef6\u53c2\u6570\uff1aclass WorkerErrorEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * Worker\u8fdb\u7a0bID\n     * @var int\n     *\/\n    public $workerID;\n\n    \/**\n     * Worker\u8fdb\u7a0bPID\n     *\n     * @var int\n     *\/\n    public $workerPid;\n    \n    \/**\n     * \u9000\u51fa\u7684\u72b6\u6001\u7801\uff0c\u8303\u56f4\u662f 1 \uff5e255\n     *\n     * @var int\n     *\/\n    public $exitCode;\n\n    \/**\n     * \u8fdb\u7a0b\u9000\u51fa\u7684\u4fe1\u53f7\n     *\n     * @var int\n     *\/\n    public $signal;\n}Swoole Server \u5bf9\u8c61\u4e8b\u4ef6\u5bf9\u8c61\u4e8b\u4ef6\u662f\u7531\u591a\u4e2a\u670d\u52a1\u5668\u5bf9\u8c61\u53d1\u51fa\u7684\uff0c\u76d1\u542c\u591a\u4e2a\u7aef\u53e3\u5373\u8ba4\u5b9a\u4e3a\u591a\u4e2a\u670d\u52a1\u5668\u3002Http Serverrequest\u4e8b\u4ef6\u53c2\u6570\uff1aclass RequestEventParam extends EventParam\n{\n    \/**\n     * swoole \u8bf7\u6c42\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Request\n     *\/\n    public $request;\n\n    \/**\n     * swoole \u54cd\u5e94\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Response\n     *\/\n    public $response;\n}close\u4e8b\u4ef6\u53c2\u6570\uff1aclass CloseEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * \u6765\u81ea\u90a3\u4e2areactor\u7ebf\u7a0b\n     *\n     * @var int\n     *\/\n    public $reactorID;\n}WebSocket ServerhandShake\u63e1\u624b\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1aclass HandShakeEventParam extends EventParam\n{\n    \/**\n     * swoole \u8bf7\u6c42\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Request\n     *\/\n    public $request;\n\n    \/**\n     * swoole \u54cd\u5e94\u5bf9\u8c61\n     * @var \\Imi\\Server\\Http\\Message\\Response\n     *\/\n    public $response;\n}open\u63e1\u624b\u5b8c\u6210\u540e\u6253\u5f00\u8fde\u63a5\u4e8b\u4ef6\u4e8b\u4ef6\u53c2\u6570\uff1aclass OpenEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     *\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26.\n     *\n     * @var \\Imi\\Server\\Http\\Message\\Request\n     *\/\n    public $request;\n}message\u4e8b\u4ef6\u53c2\u6570\uff1aclass MessageEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * swoole \u6570\u636e\u5e27\u5bf9\u8c61\n     * @var \\swoole_websocket_frame\n     *\/\n    public $frame;\n}close\u4e8b\u4ef6\u53c2\u6570\uff1aclass CloseEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * \u6765\u81ea\u90a3\u4e2areactor\u7ebf\u7a0b\n     *\n     * @var int\n     *\/\n    public $reactorID;\n}TCP Serverconnect\u4e8b\u4ef6\u53c2\u6570\uff1aclass ConnectEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * Reactor\u7ebf\u7a0bID\n     * @var int\n     *\/\n    public $reactorID;\n}receive\u4e8b\u4ef6\u53c2\u6570\uff1aclass ReceiveEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * Reactor\u7ebf\u7a0bID\n     * @var int\n     *\/\n    public $reactorID;\n\n    \/**\n     * \u63a5\u6536\u5230\u7684\u6570\u636e\n     *\n     * @var string\n     *\/\n    public $data;\n}close\u4e8b\u4ef6\u53c2\u6570\uff1aclass CloseEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n\n    \/**\n     * \u6765\u81ea\u90a3\u4e2areactor\u7ebf\u7a0b\n     *\n     * @var int\n     *\/\n    public $reactorID;\n}BufferFull\u4e8b\u4ef6\u53c2\u6570\uff1aclass BufferEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n}BufferEmpty\u4e8b\u4ef6\u53c2\u6570\uff1aclass BufferEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u6807\u8bc6\u7b26\n     * @var int\n     *\/\n    public $fd;\n}UDP Serverpacketclass PacketEventParam extends EventParam\n{\n    \/**\n     * \u670d\u52a1\u5668\u5bf9\u8c61\n     * @var \\Imi\\Server\\Base\n     *\/\n    public $server;\n\n    \/**\n     * \u6570\u636e\n     * @var string\n     *\/\n    public $data;\n\n    \/**\n     * \u5ba2\u6237\u7aef\u4fe1\u606f\n     *\n     * @var array\n     *\/\n    public $clientInfo;\n}"},{"id":15,"title":"\u9519\u8bef\u8f6c\u4e3a\u5f02\u5e38\u6355\u83b7","pageTitle":"\u9519\u8bef\u8f6c\u4e3a\u5f02\u5e38\u6355\u83b7","url":"core\/handleError.html","content":"\u9519\u8bef\u8f6c\u4e3a\u5f02\u5e38\u6355\u83b7imi \u6846\u67b6\u5e95\u5c42\u652f\u6301\u5c06\u9519\u8bef\u8f6c\u4e3a\u5f02\u5e38\uff0c\u53ef\u4ee5\u901a\u8fc7 try...catch \u6765\u6355\u83b7\u3002\u5728 config.php \u4e2d\u7684 beans \u914d\u7f6e[\n    &#039;ErrorLog&#039;  =&gt;  [\n        \/\/ PHP \u62a5\u544a\u7684\u9519\u8bef\u7ea7\u522b\uff0c\u9ed8\u8ba4 0\uff0c\u4e0d\u62a5\u544a\u4efb\u4f55\u4fe1\u606f\n        &#039;level&#039; =&gt;  0,\n        \/\/ &#039;level&#039; =&gt;  E_ALL, \/\/ \u62a5\u544a\u6240\u6709\u9519\u8bef\n        \/\/ &#039;level&#039; =&gt;  E_ALL &amp; ~E_NOTICE, \/\/ \u62a5\u544a E_NOTICE \u4e4b\u5916\u7684\u6240\u6709\u9519\u8bef\n\n        \/\/ \u9519\u8bef\u6355\u83b7\u7ea7\u522b\uff0c\u6355\u83b7\u5230\u7684\u9519\u8bef\u90fd\u4f1a\u505a\u5904\u7406\uff0c\u6b64\u4e3a\u9ed8\u8ba4\u503c\n        &#039;catchLevel&#039; =&gt; E_ALL | E_STRICT,\n        \/\/ \u629b\u51fa\u5f02\u5e38\u7684\u9519\u8bef\u7ea7\u522b\uff0c\u9664\u6b64\u4e4b\u5916\u5168\u90e8\u8bb0\u5f55\u65e5\u5fd7\uff0c\u6b64\u4e3a\u9ed8\u8ba4\u503c\n        &#039;exceptionLevel&#039; =&gt; E_ERROR | E_PARSE | E_CORE_ERROR | E_COMPILE_ERROR | E_USER_ERROR | E_RECOVERABLE_ERROR | E_WARNING | E_CORE_WARNING | E_COMPILE_WARNING | E_USER_WARNING,\n        \/\/ Log \u7ec4\u4ef6\u5806\u6808\u5e27\u56de\u6eaf\u6570\u91cf\u9650\u5236\uff0c\u9ed8\u8ba4\u4e3a 0 \u4e0d\u9650\u5236\u56de\u6eaf\u6570\u91cf\u3002\n        &#039;backtraceLimit&#039; =&gt; 0\n    ],\n]\u9519\u8bef\u7ea7\u522b\u53c2\u8003\uff1ahttps:\/\/www.php.net\/manual\/zh\/errorfunc.constants.phpbacktraceLimit \u4e0e PHP debug_backtrace \u7684 limit \u53c2\u6570\u4e00\u81f4\uff0c\u4f46\u7531\u4e8e\u6846\u67b6\u9700\u8981\uff0c\u5f53\u503c&gt;0\u4e14&lt;6 \u4f1a\u91cd\u7f6e\u4e3a6\u3002\u629b\u51fa\u7684\u5f02\u5e38\u7c7b\u4e3a \\ErrorException"},{"id":9,"title":"\u751f\u547d\u5468\u671f","pageTitle":"\u751f\u547d\u5468\u671f","url":"core\/lifeCycle.html","content":"\u751f\u547d\u5468\u671fimi \u662f\u57fa\u4e8e Swoole \u5f00\u53d1\u7684\u6846\u67b6\uff0c\u6240\u4ee5\u6700\u597d\u5148\u4e86\u89e3 Swoole\uff0c\u4ee5\u4fbf\u4e86\u89e3\u5404\u79cd\u540d\u8bcd\u6982\u5ff5\u3002\u6846\u67b6\u751f\u547d\u5468\u671f\u6846\u67b6\u7684\u751f\u547d\u5468\u671f\u5927\u81f4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u9636\u6bb5\uff1amaster \u8fdb\u7a0b\u521d\u59cb\u5316\u6846\u67b6\u626b\u63cf\u6ce8\u89e3\uff0c\u6784\u5efa\u8fd0\u884c\u65f6\u7f13\u5b58\u521d\u59cb\u5316 Swoole \u4e2d\u7684 Memory \u6a21\u5757\u52a0\u8f7d\u9879\u76ee\u914d\u7f6e\u521b\u5efa\u670d\u52a1\u5668\u5bf9\u8c61\u542f\u52a8\u670d\u52a1\u5668worker \u8fdb\u7a0bSwoole WorkerStart \u4e8b\u4ef6\u52a0\u8f7d\u8fd0\u884c\u65f6\u7f13\u5b58\u521d\u59cb\u5316\u65e5\u5fd7\u76f8\u5173\u521d\u59cb\u5316\u8fde\u63a5\u6c60\u521d\u59cb\u5316\u7f13\u5b58\u521d\u59cb\u5316\u8def\u7531\u89e6\u53d1\u9879\u76ee\u521d\u59cb\u5316\u4e8b\u4ef6\uff08worker 0 \u7b2c\u4e00\u6b21\u542f\u52a8\uff09\u8bf7\u6c42\u751f\u547d\u5468\u671fimi \u652f\u6301 http\u3001websocket\u3001tcp\u3001udp\uff0c\u4f46\u5176\u5b9e\u90fd\u5927\u540c\u5c0f\u5f02\uff0c\u90fd\u4f7f\u7528\u4e86\u76d1\u542c\u4e8b\u4ef6+\u4e2d\u95f4\u4ef6\u7684\u5957\u8def\uff0c\u8fd9\u91cc\u4ee5 http \u4e3a\u4f8b\u8bf4\u660e\u3002Swoole Request \u4e8b\u4ef6\u521b\u5efa\u8bf7\u6c42\u4e0a\u4e0b\u6587 RequestContext\u8c03\u5ea6\u5668\uff08HttpDispatcher\uff09\u6267\u884c\u4e2d\u95f4\u4ef6\u5339\u914d\u8def\u7531\u63a7\u5236\u5668\u5bf9\u8c61-&gt;\u52a8\u4f5c\u65b9\u6cd5()Response \u54cd\u5e94"},{"id":13,"title":"\u4e2d\u95f4\u4ef6","pageTitle":"\u4e2d\u95f4\u4ef6","url":"core\/middleware.html","content":"\u4e2d\u95f4\u4ef6\u5728 imi \u4e2d\uff0chttp\u3001WebSocket\u3001TCP\u3001UDP \u670d\u52a1\u90fd\u4f7f\u7528\u4e86\u4e2d\u95f4\u4ef6\uff0c\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u4e2d\u95f4\u4ef6\u7684\u6267\u884c\u987a\u5e8f\u3002\u4e2d\u95f4\u4ef6\u662f\u6309\u987a\u5e8f\u5f00\u59cb\u6267\u884c\u7684\uff0c\u4f46\u662f\u540e\u6267\u884c\u7684\u4e2d\u95f4\u4ef6\u5148\u6267\u884c\u5b8c\u6bd5\u3002\u5148\u6267\u884c\u5b8c\u6bd5\u7684\u4e2d\u95f4\u4ef6\uff0c\u8fd4\u56de\u7ed3\u679c\u7ed9\u524d\u9762\u7684\u4e2d\u95f4\u4ef6\u3002\u524d\u9762\u7684\u4e2d\u95f4\u4ef6\u4e0d\u4e00\u5b9a\u4f1a\u91c7\u7528\u83b7\u5f97\u7684\u7ed3\u679c\uff0c\u5b83\u6709\u53ef\u80fd\u5bf9\u8fd9\u4e2a\u7ed3\u679c\u505a\u4fee\u6539\u3002\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1aA\u3001B\u3001C\u4e09\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6267\u884c\u987a\u5e8f\u4e3a\uff1a\u5148\u8fdbA\uff0c\u518d\u8fdbB\uff0c\u518d\u8fdbC\uff0cC\u6267\u884c\u5b8c\uff0cB\u6267\u884c\u5b8c\uff0cA\u6267\u884c\u5b8c"},{"id":11,"title":"Partial","pageTitle":"Partial","url":"core\/partial.html","content":"Partialimi \u7684 Partial \u601d\u60f3\u662f\u4ece C# \u4e2d\u501f\u9274\u800c\u6765\u3002Partial \u53ef\u4ee5\u5c06\u4e00\u4e2a\u7c7b\u7684\u90e8\u5206\uff0c\u5206\u6210\u51e0\u4e2a\u6587\u4ef6\uff0c\u5206\u522b\u4e66\u5199\u3002\u622a\u6b62\u76ee\u524d\u6700\u65b0\u7684 PHP 7.4 \u7248\u672c\uff0c\u8fd8\u672a\u5728\u8bed\u8a00\u5c42\u9762\u4e0a\u652f\u6301 Partial \u7279\u6027\u3002\u4f46\u4f9d\u8d56\u4e8e imi \u5f3a\u5927\u7684\u5bb9\u5668\u5bf9\u8c61\uff0c\u7ec8\u4e8e\u5728 PHP \u4e2d\u5b9e\u73b0\u4e86 Partial \u7279\u6027\u3002\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u4f7f\u7528 trait \u7f16\u5199\uff0c\u52a0\u4e0a @Partial \u6ce8\u89e3\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5730\u6ce8\u5165\u3002Partial \u4f7f\u7528\u573a\u666f\u591a\u4eba\u534f\u4f5c\u5f00\u53d1\uff0c\u4fee\u6539\u540c\u4e00\u4e2a\u7c7b\u6587\u4ef6\u96be\u514d\u6709\u51b2\u7a81\u3002\u5982\u679c\u4e8b\u5148\u5b9a\u4e49\u597d\u63a5\u53e3\uff0c\u5c06\u4e0d\u540c\u65b9\u6cd5\u5206\u914d\u7ed9\u51e0\u4e2a\u4eba\u5f00\u53d1\uff0c\u6bcf\u4e2a\u4eba\u53ea\u9700\u8981\u5728\u81ea\u5df1\u7684\u6587\u4ef6\u4e2d\u7f16\u5199\uff0c\u4e0d\u7528\u62c5\u5fc3\u51b2\u7a81\u95ee\u9898\u3002\u7c7b\u7684\u65b9\u6cd5\u7279\u522b\u591a\uff0c\u5e76\u4e14\u65e0\u6cd5\u5f88\u597d\u5730\u62c6\u5206\u3002\u8fd9\u65f6\u5019\u5206\u5230\u51e0\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4f1a\u76f8\u5bf9\u6bd4\u8f83\u597d\u7ef4\u62a4\u4e00\u4e9b\u3002\u6709\u4e00\u4e9b\u7c7b\u662f\u901a\u8fc7\u5de5\u5177\u751f\u6210\u7684\uff0c\u5982\u679c\u6211\u4eec\u5728\u7c7b\u91cc\u7f16\u5199\u4e86\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u53c8\u9700\u8981\u91cd\u65b0\u5de5\u5177\u751f\u6210\u4e00\u4e9b\u5185\u5bb9\uff0c\u8fd9\u65f6\u5019\u4f1a\u8986\u76d6\u6211\u4eec\u7f16\u5199\u7684\u4ee3\u7801\u3002\u4f7f\u7528 Partial \u5728\u53e6\u4e00\u4e2a\u6587\u4ef6\u5f00\u53d1\uff0c\u4e0d\u4f1a\u88ab\u8986\u76d6\u6389\u3002\u5728 Partial \u6982\u5ff5\u5f15\u5165 imi \u6846\u67b6\u524d\uff0cimi \u7684\u6a21\u578b\u751f\u6210\u5de5\u5177\u5c06\u751f\u6210\u4ee3\u7801\u653e\u5728\u7236\u7c7b\uff0c\u7528\u6237\u5728\u5b50\u7c7b\u4e2d\u7f16\u5199\u4ee3\u7801\u3002\u4f7f\u7528\u65b9\u6cd5\u9700\u8981\u88ab\u6ce8\u5165\u7684\u7c7b\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Partial\\Classes;\n\nuse Imi\\Bean\\Annotation\\Bean;\n\n\/**\n * @Bean(&quot;PartialClassA&quot;)\n *\/\nclass PartialClassA\n{\n    public function test1()\n    {\n        return 1;\n    }\n\n}\n\u5b9a\u4e49 Partial\uff1a&lt;?php\nnamespace Imi\\Test\\Component\\Partial\\Partial\n{\n    use Imi\\Bean\\Annotation\\Partial;\n\n    \/**\n     * @Partial(Imi\\Test\\Component\\Partial\\Classes\\PartialClassA::class)\n     *\/\n    trait TPartialClassA1\n    {\n        public $test2Value = 2;\n\n        public function test2()\n        {\n            return $this-&gt;test2Value;\n        }\n\n    }\n\n}\n\n\/\/ \u4ee5\u4e0b\u4e3a\u65b9\u4fbf IDE \u63d0\u793a\u800c\u5199\uff0c\u975e\u5fc5\u987b\nnamespace Imi\\Test\\Component\\Partial\\Classes\n{\n    \/\/ \u5fc5\u987b\u7528\u8fd9\u4e2a\u62ec\u8d77\u6765\uff0c\u4ee3\u7801\u4e0d\u4f1a\u6267\u884c\uff0c\u4f46\u662f IDE \u63d0\u793a\u6709\u6548\n    if(false)\n    {\n        class PartialClassA\n        {\n            public $test2Value;\n\n            public function test2()\n            {\n\n            }\n        }\n    }\n\n}\u8c03\u7528\uff1a\/** @var \\Imi\\Test\\Component\\Partial\\Classes\\PartialClassA $test *\/\n$test = App::getBean(&#039;PartialClassA&#039;);\nvar_dump($test-&gt;test1());\n\/\/ \u539f\u7c7b\u4e2d\u6ca1\u5b9a\u4e49\uff0c\u4f46\u901a\u8fc7 partial \u53ef\u4ee5\u6b63\u5e38\u8c03\u7528\n\/\/ \u901a\u8fc7\u53cd\u5c04\u4e5f\u53ef\u4ee5\u83b7\u53d6\u5230\uff0c\u662f\u5b9e\u5b9e\u5728\u5728\u5b58\u5728\u7684\u65b9\u6cd5\u548c\u5c5e\u6027\nvar_dump($test-&gt;test2());\nvar_dump($test-&gt;test2Value);\u6ce8\u610f\u4e8b\u9879\uff1a\u547d\u540d\u7a7a\u95f4 namespace \u5fc5\u987b\u7528 {} \u62ec\u8d77\u6765\u3002\u4e0b\u9762\u4e00\u90e8\u5206\u4ee3\u7801\u662f\u4e3a\u65b9\u4fbf IDE \u63d0\u793a\u800c\u5199\uff0c\u975e\u5fc5\u987b\u3002\u5982\u679c\u5199\uff0c\u5219\u5fc5\u987b\u5728\u91cc\u9762\u5199 if(false){}\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u91cd\u590d\u5b9a\u4e49\u7c7b\u9519\u8bef\uff01\u88ab\u6ce8\u5165\u7684\u7c7b\u3001Partial \u5b9a\u4e49\u7c7b\uff0c\u5fc5\u987b\u80fd\u88ab\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u7684 beanScan \u626b\u63cf\u5230\u3002\u4f7f\u7528\u88ab\u6ce8\u5165\u7c7b\u5bf9\u8c61\u65f6\uff0c\u5fc5\u987b\u901a\u8fc7\u5bb9\u5668\uff0c\u5426\u5219\u4e0d\u751f\u6548\u3002"},{"id":17,"title":"\u5185\u90e8\u8fdb\u7a0b\u95f4\u901a\u8baf","pageTitle":"\u5185\u90e8\u8fdb\u7a0b\u95f4\u901a\u8baf","url":"core\/processCommunication.html","content":"\u5185\u90e8\u8fdb\u7a0b\u95f4\u901a\u8baf\u4e3a\u4e86\u65b9\u4fbf\u8fdb\u7a0b\u5185\u90e8\u901a\u8baf\uff0c\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002imi v1.2.0 \u7248\u672c\u65b0\u589e\u4e86\u5185\u90e8\u8fdb\u7a0b\u95f4\u901a\u8baf\u5c01\u88c5\u3002\u4f7f\u7528 Swoole \u63d0\u4f9b\u7684 sendMessage() \u548c onPipeMessage \u4e8b\u4ef6 \u5b9e\u73b0\u3002\u5728 onPipeMessage \u4e8b\u4ef6\u4e2d\uff0c\u6536\u5230\u6307\u5b9a\u7ed3\u6784\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u89e6\u53d1\u76f8\u5e94\u4e8b\u4ef6\u3002\u6211\u4eec\u53ea\u9700\u8981\u76d1\u542c\u4e8b\u4ef6\u5c31\u884c\u4e86\u3002\u4ecb\u7ecd\u6570\u636e\u7ed3\u6784[\n    &#039;action&#039;    =&gt;  &#039;\u52a8\u4f5c\u540d&#039;, \/\/ \u6b64\u5b57\u6bb5\u56fa\u5b9a\n    \/\/ \u5176\u5b83\u53c2\u6570\u4efb\u610f\u589e\u52a0\u5373\u53ef\n]\u4e8b\u4ef6\u540d\u79f0IMI.PIPE_MESSAGE.\u52a8\u4f5c\u540d\u4ee3\u7801\u793a\u4f8b\u53d1\u9001\u5e76\u76d1\u542c\u53d1\u9001\uff1ause Imi\\Server\\Server;\n\n\/\/ \u53d1\u9001\u7ed9\u6240\u6709 Worker \u8fdb\u7a0b\nServer::sendMessage(&#039;test&#039;, [\n    &#039;time&#039;  =&gt;  time(),\n]);\n\n\/\/ \u53d1\u9001\u7ed9 WorkerId \u4e3a 1 \u7684\u8fdb\u7a0b\nServer::sendMessage(&#039;test&#039;, [\n    &#039;time&#039;  =&gt;  time(),\n], 1);\u76d1\u542c\uff1a\u4e8b\u4ef6\u540d\u79f0\u4e3a\uff1aIMI.PIPE_MESSAGE.test&lt;?php\nnamespace App\\Listener;\n\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Bean\\Annotation\\Listener;\n\n\/**\n * @Listener(&quot;IMI.PIPE_MESSAGE.test&quot;)\n *\/\nclass TestMessage implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param EventParam $e\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        $data = $e-&gt;getData()[&#039;data&#039;];\n        var_dump($data[&#039;time&#039;]); \/\/ \u63a5\u6536\u5230\u4e86\u4e0a\u9762\u53d1\u9001\u6765\u7684 time\n    }\n\n}\u53d1\u9001\u5e76\u83b7\u53d6\u8fd4\u56de\u6570\u636e\u601d\u8def\uff1a\u4e00\u822c\u6765\u8bb2\uff0c\u53d1\u9001\u6d88\u606f\u4e0d\u50cf http \u8bf7\u6c42\uff0c\u4e00\u5b9a\u4f1a\u6709\u54cd\u5e94\u7ed3\u679c\u3002\u4f46\u6709\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u83b7\u53d6\u8fd4\u56de\u6570\u636e\u3002\u529e\u6cd5\u5f88\u7b80\u5355\uff0c\u6bd4\u5982\uff1a\u53d1\u9001\u6570\u636e\u52a8\u4f5c\u540d\u4e3a testRequest\uff0c\u518d\u5b9a\u4e49\u4e00\u4e2a testResponse \u52a8\u4f5c\u76d1\u542c\u7528\u4e8e\u63a5\u6536\u6570\u636e\u5373\u53ef\u3002\u518d\u4f7f\u7528 Channel \u6302\u8d77\u534f\u7a0b\u7b49\u5f85\u54cd\u5e94\u7ed3\u679c\uff0c\u5b8c\u7f8e\uff01\u53d1\u9001\u8bf7\u6c42\u5e76\u7b49\u5f85\u54cd\u5e94\uff1ause Imi\\Server\\Server;\nuse Imi\\Util\\Co\\ChannelContainer;\n\n\/\/ \u751f\u6210\u4e00\u4e2a\u968f\u673aID\n$id = uniqid(&#039;&#039;, true);\n\ntry {\n    $channel = ChannelContainer::getChannel($id);\n    \/\/ \u53d1\u9001\u7ed9 WorkerId \u4e3a 1 \u7684\u8fdb\u7a0b\n    Server::sendMessage(&#039;testRequest&#039;, [\n        &#039;time&#039;  =&gt;  time(),\n    ], 1);\n    \/\/ \u901a\u8fc7 Channel \u83b7\u53d6\u7ed3\u679c\uff0c\u8d85\u65f6\u65f6\u95f4\u53ef\u4ee5\u81ea\u884c\u8bbe\u7f6e\uff0c\u8fd9\u91cc\u662f 30 \u79d2\n    $result = $channel-&gt;pop(30);\n    if(false === $result)\n    {\n        throw new \\RuntimeException(&#039;Receive error&#039;);\n    }\n    var_dump($result[&#039;datetime&#039;]); \/\/ \u8fd4\u56de\u7ed3\u679c\n} finally {\n    ChannelContainer::removeChannel($id);\n}\u76d1\u542c\u8bf7\u6c42\uff1a\u4e8b\u4ef6\u540d\u79f0\u4e3a\uff1aIMI.PIPE_MESSAGE.testRequest&lt;?php\nnamespace App\\Listener;\n\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Bean\\Annotation\\Listener;\nuse Imi\\Server\\Server;\n\n\/**\n * @Listener(&quot;IMI.PIPE_MESSAGE.testRequest&quot;)\n *\/\nclass TestRequestMessage implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param EventParam $e\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        $data = $e-&gt;getData()[&#039;data&#039;];\n        $datetime = date(&#039;Y-m-d H:i:s&#039;, $data[&#039;time&#039;]);\n\n        \/\/ \u53d1\u9001\u54cd\u5e94\u7ed3\u679c\n        Server::sendMessage(&#039;testResponse&#039;, [\n            &#039;messageId&#039; =&gt;  $data[&#039;messageId&#039;];\n            &#039;datetime&#039;  =&gt;  $datetime,\n        ], $e-&gt;getData()[&#039;workerId&#039;]);\n    }\n\n}\u76d1\u542c\u54cd\u5e94\uff1a\u4e8b\u4ef6\u540d\u79f0\u4e3a\uff1aIMI.PIPE_MESSAGE.testResponse&lt;?php\nnamespace App\\Listener;\n\nuse Imi\\Event\\EventParam;\nuse Imi\\Event\\IEventListener;\nuse Imi\\Bean\\Annotation\\Listener;\nuse Imi\\Server\\Server;\nuse Imi\\Util\\Co\\ChannelContainer;\n\n\/**\n * @Listener(&quot;IMI.PIPE_MESSAGE.testResponse&quot;)\n *\/\nclass TestResponseMessage implements IEventListener\n{\n    \/**\n     * \u4e8b\u4ef6\u5904\u7406\u65b9\u6cd5\n     * @param EventParam $e\n     * @return void\n     *\/\n    public function handle(EventParam $e)\n    {\n        $data = $e-&gt;getData()[&#039;data&#039;];\n        if(ChannelContainer::hasChannel($data[&#039;messageId&#039;]))\n        {\n            \/\/ \u63a8\u7ed3\u679c\u8fdb Channel\n            ChannelContainer::push($data[&#039;messageId&#039;], $data);\n        }\n    }\n\n}"},{"id":14,"title":"\u8fdb\u7a0b\u540d\u79f0\u7ba1\u7406","pageTitle":"\u8fdb\u7a0b\u540d\u79f0\u7ba1\u7406","url":"core\/processNameManager.html","content":"\u8fdb\u7a0b\u540d\u79f0\u7ba1\u7406imi \u4e3a\u542f\u52a8\u51fa\u6765\u7684\u8fdb\u7a0b\u7edf\u4e00\u7ba1\u7406\u4e86\u8fdb\u7a0b\u540d\uff0c\u4f60\u53ef\u4ee5\u5728 @app.process \u4e2d\u81ea\u5b9a\u4e49\uff0c\u5176\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a\uff1a&#039;process&#039;   =&gt;  [\n    &#039;master&#039;        =&gt;  &#039;imi:master:{namespace}&#039;,\n    &#039;manager&#039;       =&gt;  &#039;imi:manager:{namespace}&#039;,\n    &#039;worker&#039;        =&gt;  &#039;imi:worker-{workerId}:{namespace}&#039;,\n    &#039;taskWorker&#039;    =&gt;  &#039;imi:taskWorker-{workerId}:{namespace}&#039;,\n    &#039;process&#039;       =&gt;  &#039;imi:process-{processName}:{namespace}&#039;,\n    &#039;processPool&#039;   =&gt;  &#039;imi:process-pool-{processPoolName}-{workerId}:{namespace}&#039;,\n    &#039;tool&#039;          =&gt;  &#039;imi:{toolName}\/{toolOperation}:{namespace}&#039;,\n]"},{"id":16,"title":"\u5b50\u670d\u52a1\u5668\uff08\u5355\u9879\u76ee\u591a\u7aef\u53e3\u591a\u534f\u8bae\uff09","pageTitle":"\u5b50\u670d\u52a1\u5668\uff08\u5355\u9879\u76ee\u591a\u7aef\u53e3\u591a\u534f\u8bae\uff09","url":"core\/subServer.html","content":"\u5b50\u670d\u52a1\u5668\uff08\u5355\u9879\u76ee\u591a\u7aef\u53e3\u591a\u534f\u8bae\uff09imi \u539f\u751f\u652f\u6301\u4e00\u4e2a\u9879\u76ee\uff0c\u5355\u6b21\u542f\u52a8\uff0c\u76d1\u542c\u591a\u4e2a\u7aef\u53e3\u591a\u4e2a\u534f\u8bae\u3002\u6bd4\u5982\u4f60\u8981\u505a\u4e00\u4e2a\u804a\u5929\u7cfb\u7edf\uff0chttp \u7528\u4e8e\u6ce8\u518c\u3001\u767b\u5f55\u3001\u4e0a\u4f20\u6587\u4ef6\u7b49\u7b49\uff0cWebSocket \u7528\u4e8e\u5373\u65f6\u901a\u8baf\u3002http \u548c WebSocket \u540c\u65f6\u505a\u5728\u4e00\u4e2a\u9879\u76ee\u4e2d\uff0c\u4ee3\u7801\u4e4b\u95f4\u6ca1\u6709\u9694\u9602\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5730\u4e92\u76f8\u8c03\u7528\u548c\u590d\u7528\u3002\u5b50\u670d\u52a1\u5668\u914d\u7f6e\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    \/\/ \u5b50\u670d\u52a1\u5668\uff08\u7aef\u53e3\u76d1\u542c\uff09\u914d\u7f6e\n    &#039;subServers&#039;    =&gt;    [\n        \/\/ \u6307\u5b9a\u670d\u52a1\u5668\u547d\u540d\u7a7a\u95f4\n        &#039;namespace&#039;    =&gt;    &#039;ImiDemo\\HttpDemo\\MainServer&#039;,\n        \/\/ \u670d\u52a1\u5668\u7c7b\u578b(http\/WebSocket\/TcpServer\/UdpServer)\n        &#039;type&#039;        =&gt;    \\Imi\\Server\\Type::HTTP,\n        \/\/ \u76d1\u542c\u7684IP\u5730\u5740\uff0c\u53ef\u9009\n        &#039;host&#039;        =&gt;    &#039;0.0.0.0&#039;,\n        \/\/ \u76d1\u542c\u7684\u7aef\u53e3\n        &#039;port&#039;        =&gt;    8080,\n        \/\/ \u53c2\u8003 swoole sockType\uff0c\u53ef\u9009\n        &#039;sockType&#039;    =&gt;    SWOOLE_SOCK_TCP,\n        \/\/ \u670d\u52a1\u5668\u914d\u7f6e\uff0c\u53c2\u6570\u7528\u6cd5\u540c\\Swoole\\Server-&gt;set($configs)\n        &#039;configs&#039;    =&gt;    [\n        ],\n    ],\n]\u5b50\u670d\u52a1\u5668\u547d\u540d\u7a7a\u95f4\u914d\u7f6e\u5728\u5b50\u670d\u52a1\u5668\u547d\u540d\u7a7a\u95f4\u6240\u5728\u76ee\u5f55\uff0c\u9700\u8981\u521b\u5efa\u4e00\u4e2a Main.php \u5165\u53e3\u6587\u4ef6\u3002&lt;?php\nnamespace ImiApp\\ApiServer;\n\nuse Imi\\Main\\BaseMain;\n\nclass Main extends BaseMain\n{\n    public function __init()\n    {\n        \/\/ \u53ef\u4ee5\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u64cd\u4f5c\n    }\n\n}\u5b50\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6\u6587\u4ef6\uff1aconfig\/config.php&lt;?php\nreturn [\n    \/\/ \u52a0\u8f7d\u5b50\u914d\u7f6e\u6587\u4ef6\uff0c\u907f\u514d`config.php`\u8fc7\u4e8e\u81c3\u80bf\u4e0d\u4fbf\u7ef4\u62a4\n    \/\/ \u8981\u6ce8\u610f\u8fd9\u91cc\u7684\u522b\u540d\u4e0d\u53ef\u4e0econfigs\u540c\u7ea7\u7684\u540d\u5b57\u91cd\u590d\uff0c\u5426\u5219\u4f1a\u88ab\u8986\u76d6\n    &#039;configs&#039;    =&gt;    [\n        &quot;\u522b\u540d1&quot;    =&gt;    &#039;\u914d\u7f6e\u6587\u4ef6\u8def\u5f841&#039;,\n        &quot;\u522b\u540d2&quot;    =&gt;    &#039;\u914d\u7f6e\u6587\u4ef6\u8def\u5f842&#039;,\n        \u2026\u2026\n    ],\n    \/\/ bean\u626b\u63cf\u76ee\u5f55\uff0c\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\n    &#039;beanScan&#039;    =&gt;    [\n        &#039;ImiDemo\\HttpDemo\\MainServer\\Controller&#039;,\n    ],\n];\u53ea\u6709\u5728 beanScan \u4e2d\u914d\u7f6e\uff0c\u624d\u53ef\u4ee5\u88ab\u626b\u63cf\u5230\uff0c\u6ce8\u89e3\u624d\u53ef\u4ee5\u751f\u6548"},{"id":180,"title":"\u63a7\u5236\u5668\u751f\u6210","pageTitle":"\u63a7\u5236\u5668\u751f\u6210","url":"dev\/generate\/controller.html","content":"\u63a7\u5236\u5668\u751f\u6210\u751f\u6210\u4e00\u4e2a Http Controller\u5fc5\u9009\u53c2\u6570\uff1a-name \u751f\u6210\u7684 Controller \u7c7b\u540d-namespace \u751f\u6210\u7684 Controller \u6240\u5728\u547d\u540d\u7a7a\u95f4\u53ef\u9009\u53c2\u6570\uff1a-prefix \u8def\u7531\u524d\u7f00\uff0c\u4e0d\u4f20\u5219\u4e3a\u7c7b\u540d-render \u6e32\u67d3\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u4e3ajson\uff0c\u53ef\u9009\uff1ahtml\/json\/xml-rest \u662f\u5426\u751f\u6210 RESTful \u98ce\u683c\uff0c\u9ed8\u8ba4 false-override \u662f\u5426\u8986\u76d6\u5df2\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u8bf7\u614e\u91cd\uff01(true\/false)\u793a\u4f8b\uff1aHttpDemo\/bin\/imi generate\/httpController -name \u63a7\u5236\u5668\u540d -namespace &quot;\u547d\u540d\u7a7a\u95f4&quot;\n\nHttpDemo\/bin\/imi generate\/httpController -name \u63a7\u5236\u5668\u540d -namespace &quot;\u547d\u540d\u7a7a\u95f4&quot; -rest"},{"id":178,"title":"\u6a21\u578b\u751f\u6210","pageTitle":"\u6a21\u578b\u751f\u6210","url":"dev\/generate\/model.html","content":"\u6a21\u578b\u751f\u6210\u751f\u6210\u6570\u636e\u5e93\u4e2d\u6240\u6709\u8868\u7684\u6a21\u578b\u6587\u4ef6\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86include\u6216exclude\uff0c\u5219\u6309\u7167\u76f8\u5e94\u89c4\u5219\u8fc7\u6ee4\u8868\u3002\u5fc5\u9009\u53c2\u6570\uff1a-namespace \u751f\u6210\u7684Model\u6240\u5728\u547d\u540d\u7a7a\u95f4\u53ef\u9009\u53c2\u6570\uff1a-database \u6570\u636e\u5e93\u540d\uff0c\u4e0d\u4f20\u5219\u53d6\u8fde\u63a5\u6c60\u9ed8\u8ba4\u914d\u7f6e\u7684\u5e93\u540d-baseClass \u751f\u6210\u65f6\u6240\u7ee7\u627f\u7684\u57fa\u7c7b\uff08\u81ea\u884c\u5b9e\u73b0\u52a1\u5fc5\u7ee7\u627f\u6846\u67b6\u7684\u6a21\u578b\u7c7b\uff09\uff0c\u9ed8\u8ba4Imi\\Model\\Model\uff0c\u53ef\u9009-poolName \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u4e0d\u4f20\u5219\u53d6\u9ed8\u8ba4\u8fde\u63a5\u6c60-prefix \u4f20\u503c\u5219\u53bb\u9664\u8be5\u8868\u524d\u7f00-include \u8981\u5305\u542b\u7684\u8868\u540d\uff0c\u4ee5\u534a\u89d2\u9017\u53f7\u5206\u9694-exclude \u8981\u6392\u9664\u7684\u8868\u540d\uff0c\u4ee5\u534a\u89d2\u9017\u53f7\u5206\u9694-override \u662f\u5426\u8986\u76d6\u5df2\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u8bf7\u614e\u91cd\uff01true-\u5168\u8986\u76d6;false-\u4e0d\u8986\u76d6;base-\u8986\u76d6\u57fa\u7c7b;model-\u8986\u76d6\u6a21\u578b\u7c7b;\u9ed8\u8ba4\u7f3a\u7701\u72b6\u6001\u4e3afalse-config \u914d\u7f6e\u6587\u4ef6\u3002true-\u9879\u76ee\u914d\u7f6e\uff1bfalse-\u5ffd\u7565\u914d\u7f6e\uff1bphp\u914d\u7f6e\u6587\u4ef6\u540d-\u4f7f\u7528\u8be5\u914d\u7f6e\u6587\u4ef6\u3002\u9ed8\u8ba4\u4e3atrue-basePath \u6307\u5b9a\u547d\u540d\u7a7a\u95f4\u5bf9\u5e94\u7684\u57fa\u51c6\u8def\u5f84\uff0c\u53ef\u9009-entity \u5e8f\u5217\u5316\u65f6\u662f\u5426\u4f7f\u7528\u9a7c\u5cf0\u547d\u540d(true or false),\u9ed8\u8ba4true,\u53ef\u9009-sqlSingleLine \u751f\u6210\u7684SQL\u4e3a\u5355\u884c,\u9ed8\u8ba4false,\u53ef\u9009-lengthCheck \u662f\u5426\u68c0\u67e5\u5b57\u7b26\u4e32\u5b57\u6bb5\u957f\u5ea6,\u53ef\u9009\u793a\u4f8b\uff1aHttpDemo\/bin\/imi generate\/model -namespace &quot;\u547d\u540d\u7a7a\u95f4&quot;\u76f8\u5173\u914d\u7f6e\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u751f\u6210\u6a21\u578b\u5de5\u5177\u662f\u65e0\u9700\u4efb\u4f55\u914d\u7f6e\u7684\u3002\u4e00\u822c\u5728\u5927\u578b\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u4f1a\u5bf9\u9879\u76ee\u8fdb\u884c\u6a21\u5757\u5212\u5206\u3002\u6bcf\u4e2a\u6a21\u5757\u6709\u81ea\u5df1\u7684\u6a21\u578b\u3001\u63a7\u5236\u5668\u7b49\u7b49\u3002\u8fd9\u65f6\u5019\uff0c\u6a21\u578b\u6587\u4ef6\u5fc5\u7136\u4e0d\u80fd\u751f\u6210\u5728\u540c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u3002imi \u652f\u6301\u4e24\u79cd\u81ea\u5b9a\u4e49\u6a21\u578b\u751f\u6210\u76ee\u6807\u7684\u914d\u7f6e\u65b9\u5f0f\u3002\u6309\u8868\u6307\u5b9a\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;tools&#039;  =&gt;  [\n        &#039;generate\/model&#039;    =&gt;  [\n            &#039;relation&#039;  =&gt;  [\n                &#039;\u8868\u540d1&#039;   =&gt;  [\n                    &#039;namespace&#039; =&gt;  &#039;\u751f\u6210\u5230\u7684\u547d\u540d\u7a7a\u95f4&#039;,\n                    \/\/ \u662f\u5426\u5907\u4efd\u8bb0\u5f55\uff0c\u4e0d\u5efa\u8bae\u6240\u6709\u8868\u90fd\u5907\u4efd\u6570\u636e\uff0c\u4e00\u822c\u7528\u4e8e\u5b57\u5178\u8868\u3001\u9ed8\u8ba4\u6570\u636e\u7b49\u60c5\u51b5\n                    &#039;withRecords&#039; =&gt; true,\n                ],\n                &#039;\u8868\u540d2&#039;   =&gt;  [\n                    &#039;namespace&#039; =&gt;  &#039;\u751f\u6210\u5230\u7684\u547d\u540d\u7a7a\u95f4&#039;,\n                ],\n            ],\n        ],\n    ],\n]\u6309\u547d\u540d\u7a7a\u95f4\u6307\u5b9a\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;tools&#039;  =&gt;  [\n        &#039;generate\/model&#039;    =&gt;  [\n            &#039;namespace&#039; =&gt;  [\n                &#039;\u547d\u540d\u7a7a\u95f41&#039; =&gt;  [\n                    \/\/ \u5728\u8be5\u547d\u540d\u7a7a\u95f4\u4e0b\uff0c\u5141\u8bb8\u751f\u6210\u7684\u8868\n                    &#039;tables&#039;    =&gt;  [\n                        &#039;\u88681&#039;,\n                        &#039;\u88682&#039;,\n                    ],\n                    \/\/ \u5907\u4efd\u54ea\u4e9b\u8868\u7684\u8bb0\u5f55\uff0c\u4e0d\u5efa\u8bae\u6240\u6709\u8868\u90fd\u5907\u4efd\u6570\u636e\uff0c\u4e00\u822c\u7528\u4e8e\u5b57\u5178\u8868\u3001\u9ed8\u8ba4\u6570\u636e\u7b49\u60c5\u51b5\n                    &#039;withRecords&#039;   =&gt;  [\n                        &#039;\u88681&#039;,\n                    ],\n                ],\n                &#039;\u547d\u540d\u7a7a\u95f42&#039; =&gt;  [\n                    &#039;tables&#039;    =&gt;  [\n                        &#039;\u88683&#039;,\n                        &#039;\u88684&#039;,\n                    ],\n                ],\n            ]\n        ],\n    ],\n]"},{"id":137,"title":"Swagger API \u6587\u6863\u751f\u6210","pageTitle":"Swagger API \u6587\u6863\u751f\u6210","url":"dev\/generate\/swagger.html","content":"Swagger API \u6587\u6863\u751f\u6210\u652f\u6301\u5728\u9879\u76ee\u4e2d\u4f7f\u7528 Swagger \u6ce8\u89e3\u8bed\u6cd5\uff0c\u8fd0\u884c\u547d\u4ee4\uff0c\u751f\u6210 Swagger \u6587\u4ef6\u3002Swagger \u662f\u6700\u6d41\u884c\u7684 API \u5f00\u53d1\u5de5\u5177\uff0c\u5b83\u9075\u5faa OpenAPI Specification\uff08OpenAPI \u89c4\u8303\uff0c\u4e5f\u7b80\u79f0 OAS\uff09\u3002Swagger \u53ef\u4ee5\u8d2f\u7a7f\u4e8e\u6574\u4e2a API \u751f\u6001\uff0c\u5982 API \u7684\u8bbe\u8ba1\u3001\u7f16\u5199 API \u6587\u6863\u3001\u6d4b\u8bd5\u548c\u90e8\u7f72\u3002Swagger \u662f\u4e00\u79cd\u901a\u7528\u7684\uff0c\u548c\u7f16\u7a0b\u8bed\u8a00\u65e0\u5173\u7684 API \u63cf\u8ff0\u89c4\u8303\u3002imi-apidoc \u57fa\u4e8e zircote\/swagger-php \u5f00\u53d1\uff0c100% \u652f\u6301\u5199\u6cd5\u3002Github: https:\/\/github.com\/imiphp\/imi-apidocComposer\u672c\u9879\u76ee\u53ef\u4ee5\u4f7f\u7528composer\u5b89\u88c5\uff0c\u9075\u5faapsr-4\u81ea\u52a8\u52a0\u8f7d\u89c4\u5219\uff0c\u5728\u4f60\u7684 composer.json \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u5185\u5bb9:{\n    &quot;require&quot;: {\n        &quot;imiphp\/imi-apidoc&quot;: &quot;^1.0.0&quot;\n    }\n}\u7136\u540e\u6267\u884c composer update \u5b89\u88c5\u3002\u4f7f\u7528\u8bf4\u660e\u53ef\u4ee5\u53c2\u8003 example\u3001tests \u76ee\u5f55\u793a\u4f8b\u3002\u9879\u76ee\u914d\u7f6e\u6587\u4ef6\uff1a[\n    &#039;components&#039;    =&gt;  [\n        &#039;ApiDoc&#039;  =&gt;  &#039;Imi\\ApiDoc&#039;,\n    ],\n]Swagger \u4e66\u5199\u6587\u6863\u8bf4\u660e\uff1ahttps:\/\/zircote.github.io\/swagger-php\/Getting-started.html#annotation-placementDemo:&lt;?php\nnamespace ImiApp\\ApiServer\\Controller;\n\nuse Imi\\Server\\Route\\Annotation\\Route;\nuse Imi\\Server\\Route\\Annotation\\Action;\nuse Imi\\Controller\\SingletonHttpController;\nuse Imi\\Server\\Route\\Annotation\\Controller;\n\n\/**\n * @OA\\Info(title=&quot;My First API&quot;, version=&quot;0.1&quot;)\n * @Controller(&quot;\/&quot;)\n *\/\nclass IndexController extends SingletonHttpController\n{\n    \/**\n     * @Action\n     * @Route(&quot;\/&quot;)\n     * \n     *\n     * @return void\n     *\/\n    public function index()\n    {\n\n    }\n\n    \/**\n     * @Action\n     * @Route(url=&quot;login&quot;, method=&quot;POST&quot;)\n     *\n     * @param string $username \u7528\u6237\u540d\n     * @param integer $password \u5bc6\u7801\n     * \n     * @return void\n     *\/\n    public function login(string $username, int $password)\n    {\n\n    }\n\n    \/**\n     * @Action\n     * @Route(&quot;register&quot;)\n     * @OA\\Get(\n     *     path=&quot;\/register&quot;,\n     *     @OA\\Response(response=&quot;200&quot;, description=&quot;An example resource&quot;)\n     * )\n     *\n     * @param string $username \u7528\u6237\u540d\n     * @param integer $password \u5bc6\u7801\n     * @param string $birthday \u751f\u65e5\n     * \n     * @return void\n     *\/\n    public function register(string $username, int $password\n    , string $birthday)\n    {\n\n    }\n\n    \/**\n     * @Action\n     *\n     * @param int $id\n     * @return void\n     *\/\n    public function get(int $id)\n    {\n\n    }\n\n}imi-apidoc \u4f1a\u6839\u636e @Route \u6ce8\u89e3\u3001@param \u6ce8\u91ca\uff0c\u81ea\u52a8\u8865\u8db3\u76f8\u5173\u4fe1\u606f\u3002\u8ba9\u4f60\u4e0d\u5fc5\u4e3a\u6bcf\u4e2a\u63a5\u53e3\u90fd\u4e66\u5199 Swagger \u6ce8\u89e3\uff0c\u63d0\u5347\u5f00\u53d1\u6548\u7387\u3002\u5f53\u7136\uff0c\u5982\u679c\u5e0c\u671b\u66f4\u52a0\u4e2a\u6027\u5316\u7684\u4fe1\u606f\u8bbe\u7f6e\uff0c\u8fd8\u662f\u8981\u81ea\u5df1\u53bb\u4e66\u5199\u7684\uff01\u751f\u6210\u547d\u4ee4\uff1aYaml \u683c\u5f0f: imi doc\/api -to api.ymlJson \u683c\u5f0f: imi doc\/api -to api.json\u6307\u5b9a\u626b\u63cf\u7684\u547d\u540d\u7a7a\u95f4\uff1aimi doc\/api -to api.json -namespace &quot;ImiApp\\Controller1,ImiApp\\Controller2&quot;\u6548\u679c\uff1a"},{"id":179,"title":"\u8868\u751f\u6210","pageTitle":"\u8868\u751f\u6210","url":"dev\/generate\/table.html","content":"\u8868\u751f\u6210\u6839\u636e\u6a21\u578b\u4e2d DDL \u6ce8\u89e3\u5b9a\u4e49\uff0c\u751f\u6210\u8868\u6ce8\u610f\uff0c\u672c\u5de5\u5177\u662f\u5220\u9664\u91cd\u5efa\u8868\uff0c\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u751f\u4ea7\u73af\u5883\u614e\u91cd\u4f7f\u7528\uff01imi v1.2.3 \u7248\u672c\u652f\u6301\u53ef\u9009\u53c2\u6570\uff1a-namespace \u6a21\u578b\u6240\u5728\u547d\u540d\u7a7a\u95f4\uff0c\u652f\u6301\u534a\u89d2\u9017\u53f7\u5206\u9694\u4f20\u591a\u4e2a\uff0c\u9ed8\u8ba4\u4e0d\u4f20\u5219\u4e3a\u5168\u90e8-database \u6570\u636e\u5e93\u540d\uff0c\u4e0d\u4f20\u5219\u53d6\u8fde\u63a5\u6c60\u9ed8\u8ba4\u914d\u7f6e\u7684\u5e93\u540d-poolName \u8fde\u63a5\u6c60\u540d\u79f0\uff0c\u4e0d\u4f20\u5219\u53d6\u9ed8\u8ba4\u8fde\u63a5\u6c60-include \u8981\u5305\u542b\u7684\u8868\u540d\uff0c\u4ee5\u534a\u89d2\u9017\u53f7\u5206\u9694-exclude \u8981\u6392\u9664\u7684\u8868\u540d\uff0c\u4ee5\u534a\u89d2\u9017\u53f7\u5206\u9694-override \u662f\u5426\u8986\u76d6\u5df2\u5b58\u5728\u7684\u8868\uff0c\u8bf7\u614e\u91cd\uff01true-\u5168\u8986\u76d6;false-\u4e0d\u8986\u76d6;\u9ed8\u8ba4\u7f3a\u7701\u72b6\u6001\u4e3afalse\u793a\u4f8b\uff1aHttpDemo\/bin\/imi generate\/table\u4e8b\u4ef6\u76d1\u542cIMI.GENERATE_MODEL.BEFORE\u751f\u6210\u8868\u5de5\u5177\u7684\u524d\u7f6e\u64cd\u4f5cIMI.GENERATE_MODEL.AFTER\u751f\u6210\u8868\u5de5\u5177\u7684\u540e\u7f6e\u64cd\u4f5c"},{"id":177,"title":"","pageTitle":"","url":"dev\/generate.html","content":""},{"id":175,"title":"\u4ecb\u7ecd","pageTitle":"\u4ecb\u7ecd","url":"dev\/intro.html","content":"\u4ecb\u7ecdimi \u76ee\u524d\u63d0\u4f9b\u4e86\u547d\u4ee4\u884c\u751f\u6210\u5de5\u5177\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\uff0c\u51cf\u5c11\u91cd\u590d\u65e0\u8c13\u7684\u4f53\u529b\u52b3\u52a8\u3002\u8fd0\u884c\u547d\u4ee4\u884c\u5de5\u5177\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u65b9\u5f0f\u4e00\u6846\u67b6\u81ea\u5e26\u6587\u4ef6\uff1avendor\/yurunsoft\/imi\/bin\/imi\u7528\u6846\u67b6\u81ea\u5e26\u6267\u884c\u547d\u4ee4\u884c\uff0c\u9700\u8981\u624b\u52a8\u4f20\u5165-appNamespace &quot;\u9879\u76ee\u547d\u540d\u7a7a\u95f4&quot;\u53c2\u6570\u65b9\u5f0f\u4e8c\u9879\u76ee\u81ea\u5efa\u6587\u4ef6\uff0c\u4ee5imi-demo\u4e3a\u4f8b\uff1aHttpDemo\/bin\/imi\u4f7f\u7528\u9879\u76ee\u81ea\u5efa\u6587\u4ef6\u53ef\u4ee5\u4f20\u5165-appNamespace &quot;\u9879\u76ee\u547d\u540d\u7a7a\u95f4&quot;\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u3002\u9879\u76ee\u8def\u5f84\/config\/config.php\u4e2dnamespace\u8bbe\u7f6e\u4e3a\u9879\u76ee\u547d\u540d\u7a7a\u95f4\u5373\u53ef\u3002"},{"id":181,"title":"\u8fdb\u7a0b\u5de5\u5177","pageTitle":"\u8fdb\u7a0b\u5de5\u5177","url":"dev\/process.html","content":"\u8fdb\u7a0b\u5de5\u5177\u542f\u52a8\u8fdb\u7a0b\u5f00\u542f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u4efb\u610f\u6dfb\u52a0\u53c2\u6570\u5fc5\u9009\u53c2\u6570\uff1a-name \u8fdb\u7a0b\u540d\u79f0\uff0c\u901a\u8fc7@Process\u6ce8\u89e3\u5b9a\u4e49\u53ef\u9009\u53c2\u6570\uff1a-redirectStdinStdout \u91cd\u5b9a\u5411\u5b50\u8fdb\u7a0b\u7684\u6807\u51c6\u8f93\u5165\u548c\u8f93\u51fa\u3002\u542f\u7528\u6b64\u9009\u9879\u540e\uff0c\u5728\u5b50\u8fdb\u7a0b\u5185\u8f93\u51fa\u5185\u5bb9\u5c06\u4e0d\u662f\u6253\u5370\u5c4f\u5e55\uff0c\u800c\u662f\u5199\u5165\u5230\u4e3b\u8fdb\u7a0b\u7ba1\u9053\u3002\u8bfb\u53d6\u952e\u76d8\u8f93\u5165\u5c06\u53d8\u4e3a\u4ece\u7ba1\u9053\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u9ed8\u8ba4\u4e3a\u963b\u585e\u8bfb\u53d6\u3002-pipeType \u7ba1\u9053\u7c7b\u578b\uff0c\u542f\u7528$redirectStdinStdout\u540e\uff0c\u6b64\u9009\u9879\u5c06\u5ffd\u7565\u7528\u6237\u53c2\u6570\uff0c\u5f3a\u5236\u4e3a1\u3002\u5982\u679c\u5b50\u8fdb\u7a0b\u5185\u6ca1\u6709\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 0\u793a\u4f8b\uff1aHttpDemo\/bin\/imi process\/start -name \u8fdb\u7a0b\u540d\u79f0\n\n# \u8ddf\u4e0a\u8fdb\u7a0b\u9700\u8981\u83b7\u53d6\u7684\u53c2\u6570\nHttpDemo\/bin\/imi process\/start -name \u8fdb\u7a0b\u540d\u79f0 -a 1 -b 2\u8fd0\u884c\u8fdb\u7a0b\u8fd0\u884c\u4e00\u4e2a\u8fdb\u7a0b\u4e0e\u542f\u52a8\u8fdb\u7a0b\u4e0d\u540c\uff0c\u76f4\u63a5\u5728\u542f\u52a8\u7684\u8fdb\u7a0b\u4e2d\u6267\u884c\u8fdb\u7a0b\u903b\u8f91\uff0c\u4e00\u822c\u63a8\u8350\u4f7f\u7528\u672c\u65b9\u6cd5\u5fc5\u9009\u53c2\u6570\uff1a-name \u8fdb\u7a0b\u540d\u79f0\uff0c\u901a\u8fc7@Process\u6ce8\u89e3\u5b9a\u4e49\u793a\u4f8b\uff1aHttpDemo\/bin\/imi process\/run -name \u8fdb\u7a0b\u540d\u79f0\u542f\u52a8\u8fdb\u7a0b\u6c60\u57fa\u4e8eSwoole\\Process\\Pool\u5b9e\u73b0\uff0c\u53ef\u4ee5\u8bbe\u5b9a\u8fdb\u7a0b\u6570\u91cf\u3002\u9700\u8981\u5728\u8fdb\u7a0b\u4e2d\u4eba\u4e3a\u5199\u4e0a\u5faa\u73af\uff0c\u5426\u5219\u8fdb\u7a0b\u4e00\u65e6\u7ed3\u675f\uff0c\u4f1a\u7acb\u5373\u62c9\u8d77\u4e00\u4e2a\u65b0\u8fdb\u7a0b\u3002\u5fc5\u9009\u53c2\u6570\uff1a-name \u8fdb\u7a0b\u6c60\u540d\u79f0\uff0c\u901a\u8fc7@ProcessPool\u6ce8\u89e3\u5b9a\u4e49\u53ef\u9009\u53c2\u6570\uff1a-worker \u8fdb\u7a0b\u6570\u91cf\uff0c\u4e0d\u4f20\u5219\u6839\u636e\u6ce8\u89e3\u914d\u7f6e\u8bbe\u5b9a\uff08\u6ce8\u89e3\u4e0d\u8bbe\u7f6e\u5219\u4e3a1\uff09-ipcType \u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u4e0d\u4f7f\u7528\u4efb\u4f55\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7279\u6027\uff0c\u4e0d\u4f20\u5219\u6839\u636e\u6ce8\u89e3\u914d\u7f6e\u8bbe\u5b9a-msgQueueKey \u6d88\u606f\u961f\u5217\u952e\uff0c\u4e0d\u4f20\u5219\u6839\u636e\u6ce8\u89e3\u914d\u7f6e\u8bbe\u5b9a"},{"id":176,"title":"\u670d\u52a1\u5668\u5de5\u5177","pageTitle":"\u670d\u52a1\u5668\u5de5\u5177","url":"dev\/server.html","content":"\u670d\u52a1\u5668\u5de5\u5177\u5f00\u542f\u670d\u52a1\u65e0\u53c2\u6570\u793a\u4f8b\uff1aHttpDemo\/bin\/imi server\/start\u505c\u6b62\u670d\u52a1\u65e0\u53c2\u6570\u793a\u4f8b\uff1aHttpDemo\/bin\/imi server\/stop\u91cd\u65b0\u52a0\u8f7d\u670d\u52a1\u91cd\u542f Worker \u8fdb\u7a0b\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u8fde\u63a5\u65ad\u5f00\uff0c\u53ef\u4ee5\u8ba9\u9879\u76ee\u6587\u4ef6\u66f4\u6539\u751f\u6548\u65e0\u53c2\u6570\u793a\u4f8b\uff1aHttpDemo\/bin\/imi server\/reload\u66f4\u65b0\u8fd0\u884c\u65f6\u7f13\u5b58\u540e\uff0c\u518d\u91cd\u65b0\u52a0\u8f7d\u670d\u52a1HttpDemo\/bin\/imi server\/reload -runtime"},{"id":182,"title":"\u81ea\u5df1\u52a8\u624b\u5f00\u53d1\u547d\u4ee4\u884c\u5de5\u5177","pageTitle":"\u81ea\u5df1\u52a8\u624b\u5f00\u53d1\u547d\u4ee4\u884c\u5de5\u5177","url":"dev\/tool.html","content":"\u81ea\u5df1\u52a8\u624b\u5f00\u53d1\u547d\u4ee4\u884c\u5de5\u5177imi \u7684\u547d\u4ee4\u884c\u5de5\u5177\u4f7f\u7528\u6ce8\u89e3\u6765\u5b9a\u4e49\u6ce8\u89e3@ToolImi\\Tool\\Annotation\\Tool\uff0c\u5199\u5728\u7c7b\u4e0a\uff0c\u7528\u4e8e\u5b9a\u4e49\u5de5\u5177\u540d\u79f0\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u5de5\u5177\u540d\u79f0@OperationImi\\Tool\\Annotation\\Operation\uff0c\u5199\u5728\u65b9\u6cd5\u4e0a\uff0c\u7528\u4e8e\u5b9a\u4e49\u5de5\u5177\u52a8\u4f5c\u540d\u79f0\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u5de5\u5177\u52a8\u4f5c\u540d\u79f0co\u662f\u5426\u81ea\u52a8\u5f00\u542f\u534f\u7a0b\uff0c\u9ed8\u8ba4\u4e3atrue@ArgImi\\Tool\\Annotation\\Arg\uff0c\u5199\u5728\u65b9\u6cd5\u4e0a\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u7528\u4e8e\u5b9a\u4e49\u5de5\u5177\u53c2\u6570\u5c5e\u6027\u540d\u79f0\u8bf4\u660ename\u53c2\u6570\u540d\u79f0type\u53c2\u6570\u7c7b\u578b\uff0c\u652f\u6301\uff1astring\/int\/float\/boolean\/array\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\\Imi\\Tool\\ArgType::XXXdefault\u9ed8\u8ba4\u503crequired\u662f\u5426\u662f\u5fc5\u9009\u53c2\u6570\uff0c\u9ed8\u8ba4falsecomments\u6ce8\u91ca\u5de5\u5177\u5b9a\u4e49namespace ImiApp\\Tool;\n\nuse Imi\\Tool\\Annotation\\Tool;\nuse Imi\\Tool\\Annotation\\Operation;\nuse Imi\\Tool\\Annotation\\Arg;\n\n\/**\n * @Tool(&quot;test&quot;)\n *\/\nclass Test\n{\n    \/**\n     * @Operation(&quot;hello&quot;)\n     * @Arg(name=&quot;username&quot;, type=&quot;string&quot;, default=&quot;\u9ed8\u8ba4\u503c&quot;)\n     *\/\n    public function hello($username)\n    {\n        echo &quot;hello {$username}&quot;, PHP_EOL;\n    }\n\n}beanScan\u5de5\u5177\u6240\u5728\u547d\u540d\u7a7a\u95f4\u5fc5\u987b\u5728\u9879\u76ee\u914d\u7f6e@app.beanScan\u4e2d\u5b9a\u4e49\u5982\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684ImiApp\\Tool\u5fc5\u987b\u5b9a\u4e49\u5728@app.beanScan\u52a0\u8f7d\u6ce8\u89e3\u9ed8\u8ba4\u547d\u4ee4\u884c\u5de5\u5177\u662f\u4e0d\u52a0\u8f7d\u9879\u76ee\u5b50\u6a21\u5757\uff08\u5b50\u670d\u52a1\u5668\uff09\u4e2d\u7684\u6ce8\u89e3\u7684\uff0c\u5982\u9700\u4f7f\u7528\u8bf7\u8c03\u7528\uff1a\\Imi\\Bean\\Annotation::getInstance()-&gt;init(\\Imi\\Main\\Helper::getAppMains());\u5de5\u5177\u8c03\u7528imi \u5de5\u5177\u540d\u79f0\/\u52a8\u4f5c\u540d\u79f0 -\u53c2\u6570\u540d \u53c2\u6570\u503c\u4e0a\u9762\u7684\u4f8b\u5b50\u8c03\u7528\u793a\u4f8b\uff1aimi test\/hello -username yurun"},{"id":192,"title":"ElasticSearch","pageTitle":"ElasticSearch","url":"other\/elasticsearch.html","content":"ElasticSearchElasticSearch\u662f\u4e00\u4e2a\u57fa\u4e8eLucene\u7684\u641c\u7d22\u670d\u52a1\u5668\u3002\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u591a\u7528\u6237\u80fd\u529b\u7684\u5168\u6587\u641c\u7d22\u5f15\u64ce\uff0c\u57fa\u4e8eRESTful web\u63a5\u53e3\u3002Elasticsearch\u662f\u7528Java\u8bed\u8a00\u5f00\u53d1\u7684\uff0c\u5e76\u4f5c\u4e3aApache\u8bb8\u53ef\u6761\u6b3e\u4e0b\u7684\u5f00\u653e\u6e90\u7801\u53d1\u5e03\uff0c\u662f\u4e00\u79cd\u6d41\u884c\u7684\u4f01\u4e1a\u7ea7\u641c\u7d22\u5f15\u64ce\u3002\u4f7f\u7528\u9996\u5148\u9700\u8981\u5f15\u5165 Guzzle-Swoole\uff1acomposer require yurunsoft\/guzzle-swoole\u5b9e\u4f8b\u5316\u65f6\u5019\u8fd9\u4e48\u5199\u5373\u53ef\uff1a$client = \\Elasticsearch\\ClientBuilder::create()-&gt;setHosts([&#039;192.168.0.233:9200&#039;])\n                                                -&gt;setHandler(new \\Yurun\\Util\\Swoole\\Guzzle\\Ring\\SwooleHandler()) \/\/ \u5173\u952e\u662f\u8fd9\u53e5\n                                                -&gt;build();"},{"id":191,"title":"Guzzle","pageTitle":"Guzzle","url":"other\/guzzle.html","content":"GuzzleGuzzle \u662f\u4e00\u4e2a PHP \u7684 HTTP \u5ba2\u6237\u7aef\uff0c\u7528\u6765\u8f7b\u800c\u6613\u4e3e\u5730\u53d1\u9001\u8bf7\u6c42\uff0c\u5e76\u96c6\u6210\u5230\u6211\u4eec\u7684WEB\u670d\u52a1\u4e0a\u3002Guzzle \u88ab\u56fd\u5185\u5916\u5e7f\u6cdb\u7528\u4e8e\u5404\u79cd\u7b2c\u4e09\u65b9 SDK \u4e2d\uff0c\u5982\u679c\u4f60\u6b63\u5728\u5bfb\u627e\u67d0\u67d0 SDK \u7684\u534f\u7a0b\u5316\u652f\u6301\uff0c\u90a3\u4e48\u4f60\u6765\u5bf9\u5566\uff01\u5b87\u6da6\u66fe\u7ecf\u7533\u8bf7\u5c06 SwooleHttpClientHandler \u96c6\u6210\u5230 Guzzle \u6838\u5fc3\uff0c\u5e76\u4e14\u5f15\u5165\u4e00\u4e2a\u5168\u5c40\u9ed8\u8ba4\u8bf7\u6c42\u5668\u7684\u8bbe\u7f6e\u529f\u80fd\uff0c\u7531\u4e8e\u4e00\u4e9b\u539f\u56e0\u5e76\u6ca1\u6709\u901a\u8fc7\u3002\u4f20\u9001\u95e8\uff1ahttps:\/\/github.com\/guzzle\/guzzle\/pull\/2128\u4e0a\u6709\u653f\u7b56\uff0c\u4e0b\u6709\u5bf9\u7b56\uff0c\u4e8e\u662f\u5c31\u6709\u4e86 Guzzle-Swoole\u5f53\u7136\uff0c\u5982\u679c\u4f60\u662f\u5e0c\u671b\u81ea\u5df1\u7f16\u5199 http \u8bf7\u6c42\u4ee3\u7801\uff0c\u8fd9\u91cc\u66f4\u63a8\u8350\u4f7f\u7528\uff1aYurunHttp\u4ecb\u7ecd\u8ba9 Guzzle \u652f\u6301 Swoole \u534f\u7a0b\uff0c\u8fd9\u4e2a\u9879\u76ee\u76ee\u7684\u5c31\u662f\u8fd9\u4e48\u7b80\u5355\u660e\u4e86\uff01Guzzle-Swoole \u662f Guzzle \u7684\u5904\u7406\u5668\uff08Handler\uff09\uff0c\u5e76\u6ca1\u6709\u5bf9 Guzzle \u672c\u8eab\u4ee3\u7801\u8fdb\u884c\u4fee\u6539\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u517c\u5bb9\u540e\u7eed\u7248\u672c\u3002\u652f\u6301 Ring Handler\uff0c\u53ef\u4ee5\u7528\u4e8e elasticsearch\/elasticsearch \u7b49\u5305\u4e2d\u3002\u4f7f\u7528Composer:&quot;yurunsoft\/guzzle-swoole&quot;:&quot;~2.0&quot;\u5168\u5c40\u8bbe\u5b9a\u5904\u7406\u5668&lt;?php\nrequire dirname(__DIR__) . &#039;\/vendor\/autoload.php&#039;;\n\nuse GuzzleHttp\\Client;\nuse Yurun\\Util\\Swoole\\Guzzle\\SwooleHandler;\nuse GuzzleHttp\\DefaultHandler;\n\nDefaultHandler::setDefaultHandler(SwooleHandler::class);\n\ngo(function(){\n    $client = new Client();\n    $response = $client-&gt;request(&#039;GET&#039;, &#039;http:\/\/www.baidu.com&#039;, [\n        &#039;verify&#039;    =&gt;  false,\n    ]);\n    var_dump($response-&gt;getStatusCode());\n});\n\u624b\u52a8\u6307\u5b9a Swoole \u5904\u7406\u5668use GuzzleHttp\\Client;\nuse GuzzleHttp\\HandlerStack;\nuse Yurun\\Util\\Swoole\\Guzzle\\SwooleHandler;\n\ngo(function(){\n    $handler = new SwooleHandler();\n    $stack = HandlerStack::create($handler);\n    $client = new Client([&#039;handler&#039; =&gt; $stack]);\n    $response = $client-&gt;request(&#039;GET&#039;, &#039;http:\/\/www.baidu.com&#039;, [\n        &#039;verify&#039;    =&gt;  false,\n    ]);\n    var_dump($response-&gt;getBody()-&gt;__toString(), $response-&gt;getHeaders());\n});\u66f4\u52a0\u8be6\u7ec6\u7684\u793a\u4f8b\u4ee3\u7801\u8bf7\u770btest\u76ee\u5f55\u4e0b\u4ee3\u7801\u3002"},{"id":195,"title":"\u7b2c\u4e09\u65b9\u652f\u4ed8 SDK","pageTitle":"\u7b2c\u4e09\u65b9\u652f\u4ed8 SDK","url":"other\/paysdk.html","content":"\u7b2c\u4e09\u65b9\u652f\u4ed8 SDKPaySDK \u662f PHP \u96c6\u6210\u652f\u4ed8 SDK \uff0c\u96c6\u6210\u4e86\u652f\u4ed8\u5b9d\u3001\u5fae\u4fe1\u652f\u4ed8\u7684\u652f\u4ed8\u63a5\u53e3\u548c\u5176\u5b83\u76f8\u5173\u63a5\u53e3\u7684\u64cd\u4f5c\u3002\u53ef\u4ee5\u8f7b\u677e\u5d4c\u5165\u652f\u6301 PHP &gt;= 5.4 \u7684\u4efb\u4f55\u7cfb\u7edf\u4e2d\uff0c2.0 \u7248\u73b0\u5df2\u652f\u6301 Swoole \u534f\u7a0b\u73af\u5883\u3002\u652f\u6301\u7684\u652f\u4ed8\u63a5\u53e3\u652f\u4ed8\u5b9d\u5373\u65f6\u5230\u8d26-\u7535\u8111\u7f51\u7ad9\u652f\u4ed8\uff08\u8001\uff09\u5373\u65f6\u5230\u8d26-\u624b\u673a\u7f51\u7ad9\u652f\u4ed8\uff08\u8001\uff09\u5f53\u9762\u4ed8\u624b\u673a\u7f51\u7ad9\u652f\u4ed8\u7535\u8111\u7f51\u7ad9\u652f\u4ed8APP\u652f\u4ed8\u670d\u52a1\u7aef\u5355\u7b14\u8f6c\u8d26\u5230\u652f\u4ed8\u5b9d\u8d26\u6237\u6d77\u5916\u652f\u4ed8\uff08\u7535\u8111\u7f51\u7ad9\u3001\u624b\u673a\u7f51\u7ad9\u3001APP\u3001\u626b\u7801\uff09\u6d77\u5173\u62a5\u5173\u5176\u5b83\u8f85\u52a9\u4ea4\u6613\u63a5\u53e3\uff08\u9000\u6b3e\u3001\u67e5\u8be2\u7b49\uff09\u5fae\u4fe1\u652f\u4ed8\u5237\u5361\u652f\u4ed8\u516c\u4f17\u53f7\u652f\u4ed8\u626b\u7801\u652f\u4ed8APP\u652f\u4ed8H5\u652f\u4ed8\u5c0f\u7a0b\u5e8f\u652f\u4ed8\u4f01\u4e1a\u4ed8\u6b3e\u5230\u96f6\u94b1\u4f01\u4e1a\u4ed8\u6b3e\u5230\u94f6\u884c\u5361\u6d77\u5916\u652f\u4ed8\uff08\u5237\u5361\u3001\u516c\u4f17\u53f7\u3001\u626b\u7801\u3001APP\uff09\u6d77\u5173\u62a5\u5173\u5176\u5b83\u8f85\u52a9\u4ea4\u6613\u63a5\u53e3\uff08\u9000\u6b3e\u3001\u67e5\u8be2\u7b49\uff09\u5b89\u88c5\u5728\u60a8\u7684composer.json\u4e2d\u52a0\u5165\u914d\u7f6e\uff1a{\n    &quot;require&quot;: {\n        &quot;yurunsoft\/pay-sdk&quot;: &quot;~2.1&quot;\n    }\n}\u7136\u540e\u6267\u884ccomposer update\u547d\u4ee4\u3002Swoole \u534f\u7a0b\u73af\u5883\u652f\u6301\u5728 WorkerStart \u4e8b\u4ef6\u4e2d\u52a0\u5165\uff1a\\Yurun\\Util\\YurunHttp::setDefaultHandler(&#039;Yurun\\Util\\YurunHttp\\Handler\\Swoole&#039;);\u5728\u652f\u4ed8\u3001\u9000\u6b3e\u5f02\u6b65\u901a\u77e5\u4e2d\uff0c\u9700\u8981\u8d4b\u503c Swoole \u7684 Request \u548c Response \u5bf9\u8c61\uff0c\u6216\u8005\u9075\u5faa PSR-7 \u6807\u51c6\u7684\u5bf9\u8c61\u5373\u53ef\u3002imi \u6846\u67b6\u4e2d\u4f7f\u7528imi \u662f\u57fa\u4e8e PHP Swoole \u7684\u9ad8\u6027\u80fd\u534f\u7a0b\u5e94\u7528\u5f00\u53d1\u6846\u67b6\uff0c\u5b83\u652f\u6301 HttpApi\u3001WebSocket\u3001TCP\u3001UDP\u3001MQTT \u670d\u52a1\u7684\u5f00\u53d1\u3002\u5728 Swoole \u7684\u52a0\u6301\u4e0b\uff0c\u76f8\u6bd4 php-fpm \u8bf7\u6c42\u54cd\u5e94\u80fd\u529b\uff0cI\/O\u5bc6\u96c6\u578b\u573a\u666f\u5904\u7406\u80fd\u529b\uff0c\u6709\u7740\u672c\u8d28\u4e0a\u7684\u63d0\u5347\u3002imi \u6846\u67b6\u62e5\u6709\u4e30\u5bcc\u7684\u529f\u80fd\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4e92\u8054\u7f51\u3001\u79fb\u52a8\u901a\u4fe1\u3001\u4f01\u4e1a\u8f6f\u4ef6\u3001\u4e91\u8ba1\u7b97\u3001\u7f51\u7edc\u6e38\u620f\u3001\u7269\u8054\u7f51\uff08IOT\uff09\u3001\u8f66\u8054\u7f51\u3001\u667a\u80fd\u5bb6\u5c45\u7b49\u9886\u57df\u3002\u53ef\u4ee5\u4f7f\u4f01\u4e1a IT \u7814\u53d1\u56e2\u961f\u7684\u6548\u7387\u5927\u5927\u63d0\u5347\uff0c\u66f4\u52a0\u4e13\u6ce8\u4e8e\u5f00\u53d1\u521b\u65b0\u4ea7\u54c1\u3002https:\/\/www.imiphp.com\/\/**\n * \u8fd9\u662f\u4e00\u4e2a\u5728\u63a7\u5236\u5668\u4e2d\u7684\u52a8\u4f5c\u65b9\u6cd5\n * @Action\n *\/\npublic function test()\n{\n    $payNotify = new class extends \\Yurun\\PaySDK\\Weixin\\Notify\\Pay\n    {\n        \/**\n         * \u540e\u7eed\u6267\u884c\u64cd\u4f5c\n         * @return void\n         *\/\n        protected function __exec()\n        {\n\n        }\n    };\n    $context = RequestContext::getContext();\n    \/\/ \u4e0b\u9762\u4e24\u884c\u5f88\u5173\u952e\n    $payNotify-&gt;swooleRequest = $context[&#039;request&#039;];\n    $payNotify-&gt;swooleResponse = $context[&#039;response&#039;];\n\n    $sdk-&gt;notify($payNotify);\n\n    \/\/ \u8fd9\u53e5\u8bdd\u5fc5\u987b\u586b\u5199\n    return $payNotify-&gt;swooleResponse;\n}"},{"id":194,"title":"\u7b2c\u4e09\u65b9\u6388\u6743 SDK","pageTitle":"\u7b2c\u4e09\u65b9\u6388\u6743 SDK","url":"other\/yurun-oauth-login.html","content":"\u7b2c\u4e09\u65b9\u6388\u6743 SDKYurunOAuthLogin \u662f\u4e00\u4e2aPHP \u7b2c\u4e09\u65b9\u767b\u5f55\u6388\u6743 SDK\uff0c\u96c6\u6210\u4e86QQ\u3001\u5fae\u4fe1\u3001\u5fae\u535a\u3001Github\u7b49\u5e38\u7528\u63a5\u53e3\u3002\u53ef\u4ee5\u8f7b\u677e\u5d4c\u5165\u652f\u6301 PHP &gt;= 5.4 \u7684\u4efb\u4f55\u7cfb\u7edf\u4e2d\uff0c2.0 \u7248\u73b0\u5df2\u652f\u6301 Swoole \u534f\u7a0b\u73af\u5883\u3002\u652f\u6301\u7684\u767b\u5f55\u5e73\u53f0QQ\u3001QQ \u5c0f\u7a0b\u5e8f\u5fae\u4fe1\u7f51\u9875\u626b\u7801\u3001\u5fae\u4fe1\u516c\u4f17\u53f7\u3001\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u5fae\u535a\u767e\u5ea6GithubGiteeCoding\u5f00\u6e90\u4e2d\u56fd(OSChina)CSDN\u540e\u7eed\u5c06\u4e0d\u65ad\u6dfb\u52a0\u65b0\u7684\u5e73\u53f0\u652f\u6301\uff0c\u4e5f\u6b22\u8fce\u4f60\u6765\u63d0\u4ea4PR\uff0c\u4e00\u8d77\u5b8c\u5584\uff01\u5b89\u88c5\u5728\u60a8\u7684composer.json\u4e2d\u52a0\u5165\u914d\u7f6e\uff1a{\n    &quot;require&quot;: {\n        &quot;yurunsoft\/yurun-oauth-login&quot;: &quot;~2.0&quot;\n    }\n}\u4ee3\u7801\u5b9e\u4f8b\u81eav1.2\u8d77\u6240\u6709\u65b9\u6cd5\u7edf\u4e00\u53c2\u6570\u8c03\u7528\uff0c\u5982\u679c\u9700\u8981\u989d\u5916\u53c2\u6570\u7684\u53ef\u4f7f\u7528\u5bf9\u8c61\u5c5e\u6027\u8d4b\u503c\uff0c\u5177\u4f53\u53c2\u8003test\u76ee\u5f55\u4e0b\u7684\u6d4b\u8bd5\u4ee3\u7801\u3002\u4e0b\u9762\u4ee3\u7801\u4ee5QQ\u63a5\u53e3\u4e3e\u4f8b\uff0c\u5b8c\u5168\u53ef\u4ee5\u628aQQ\u5b57\u6837\u6539\u4e3a\u5176\u5b83\u4efb\u610f\u63a5\u53e3\u5b57\u6837\u4f7f\u7528\u3002\u5b9e\u4f8b\u5316$qqOAuth = new \\Yurun\\OAuthLogin\\QQ\\OAuth2(&#039;appid&#039;, &#039;appkey&#039;, &#039;callbackUrl&#039;);\u767b\u5f55$url = $qqOAuth-&gt;getAuthUrl();\n$_SESSION[&#039;YURUN_QQ_STATE&#039;] = $qqOAuth-&gt;state;\nheader(&#039;location:&#039; . $url);\u56de\u8c03\u5904\u7406\/\/ \u83b7\u53d6accessToken\n$accessToken = $qqOAuth-&gt;getAccessToken($_SESSION[&#039;YURUN_QQ_STATE&#039;]);\n\n\/\/ \u8c03\u7528\u8fc7getAccessToken\u65b9\u6cd5\u540e\u4e5f\u53ef\u8fd9\u4e48\u83b7\u53d6\n\/\/ $accessToken = $qqOAuth-&gt;accessToken;\n\/\/ \u8fd9\u662fgetAccessToken\u7684api\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\n\/\/ $result = $qqOAuth-&gt;result;\n\n\/\/ \u7528\u6237\u8d44\u6599\n$userInfo = $qqOAuth-&gt;getUserInfo();\n\n\/\/ \u8fd9\u662fgetAccessToken\u7684api\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\n\/\/ $result = $qqOAuth-&gt;result;\n\n\/\/ \u7528\u6237\u552f\u4e00\u6807\u8bc6\n$openid = $qqOAuth-&gt;openid;\u89e3\u51b3\u7b2c\u4e09\u65b9\u767b\u5f55\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u56de\u8c03\u57df\u540d\u7684\u95ee\u9898\/\/ \u89e3\u51b3\u53ea\u80fd\u8bbe\u7f6e\u4e00\u4e2a\u56de\u8c03\u57df\u540d\u7684\u95ee\u9898\uff0c\u4e0b\u9762\u5730\u5740\u9700\u8981\u6539\u6210\u4f60\u9879\u76ee\u4e2d\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u53c2\u8003test\/QQ\/loginAgent.php\u5199\u6cd5\n$qqOAuth-&gt;loginAgentUrl = &#039;http:\/\/localhost\/test\/QQ\/loginAgent.php&#039;;\n\n$url = $qqOAuth-&gt;getAuthUrl();\n$_SESSION[&#039;YURUN_QQ_STATE&#039;] = $qqOAuth-&gt;state;\nheader(&#039;location:&#039; . $url);Swoole \u534f\u7a0b\u73af\u5883\u652f\u6301\\Yurun\\Util\\YurunHttp::setDefaultHandler(&#039;Yurun\\Util\\YurunHttp\\Handler\\Swoole&#039;);"},{"id":193,"title":"YurunHttp","pageTitle":"YurunHttp","url":"other\/yurunhttp.html","content":"YurunHttpYurunHttp \u662f\u5f00\u6e90\u7684 PHP HTTP \u7c7b\u5e93\uff0c\u652f\u6301\u94fe\u5f0f\u64cd\u4f5c\uff0c\u7b80\u5355\u6613\u7528\u3002\u652f\u6301\u6240\u6709\u5e38\u89c1\u7684 GET\u3001POST\u3001PUT\u3001DELETE\u3001UPDATE \u7b49\u8bf7\u6c42\u65b9\u5f0f\uff0c\u652f\u6301 Http2\u3001WebSocket\u3001\u6d4f\u89c8\u5668\u7ea7\u522b Cookies \u7ba1\u7406\u3001\u4e0a\u4f20\u4e0b\u8f7d\u3001\u8bbe\u7f6e\u548c\u8bfb\u53d6 header\u3001Cookie\u3001\u8bf7\u6c42\u53c2\u6570\u3001\u5931\u8d25\u91cd\u8bd5\u3001\u9650\u901f\u3001\u4ee3\u7406\u3001\u8bc1\u4e66\u7b49\u3002\u4f7f\u7528\u624b\u518c\uff1ahttp:\/\/doc.yurunsoft.com\/YurunHttp\u4f7f\u7528{\n    &quot;require&quot;: {\n        &quot;yurunsoft\/yurun-http&quot;: &quot;^4.0.0&quot;\n    }\n}Swoole \u534f\u7a0b\u6a21\u5f0f&lt;?php\nuse Yurun\\Util\\YurunHttp;\nuse Yurun\\Util\\HttpRequest;\n\n\/\/ \u8bbe\u7f6e\u9ed8\u8ba4\u8bf7\u6c42\u5904\u7406\u5668\u4e3a Swoole\nYurunHttp::setDefaultHandler(\\Yurun\\Util\\YurunHttp\\Handler\\Swoole::class);\n\n\/\/ Swoole \u5904\u7406\u5668\u5fc5\u987b\u5728\u534f\u7a0b\u4e2d\u8c03\u7528\ngo(&#039;test&#039;);\n\nfunction test()\n{\n    $http = new HttpRequest;\n    $response = $http-&gt;get(&#039;http:\/\/www.baidu.com&#039;);\n    echo &#039;html:&#039;, PHP_EOL, $response-&gt;body();\n}WebSocket ClientYurunHttp::setDefaultHandler(\\Yurun\\Util\\YurunHttp\\Handler\\Swoole::class);\ngo(function(){\n    $url = &#039;ws:\/\/127.0.0.1:1234\/&#039;;\n    $http = new HttpRequest;\n    $client = $http-&gt;websocket($url);\n    if(!$client-&gt;isConnected())\n    {\n        throw new \\RuntimeException(&#039;Connect failed&#039;);\n    }\n    $client-&gt;send(&#039;data&#039;);\n    $recv = $client-&gt;recv();\n    var_dump(&#039;recv:&#039;, $recv);\n    $client-&gt;close();\n});Http2 \u517c\u5bb9\u7528\u6cd5$http = new HttpRequest;\n$http-&gt;protocolVersion = &#039;2.0&#039;; \/\/ \u8fd9\u53e5\u662f\u5173\u952e\n$response = $http-&gt;get(&#039;https:\/\/wiki.swoole.com\/&#039;);Curl\u3001Swoole Handler \u90fd\u652f\u6301 Http2\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\u7f16\u8bd1\u65f6\u90fd\u9700\u8981\u5e26\u4e0a\u542f\u7528 Http2 \u7684\u53c2\u6570\u3002\u67e5\u770b\u662f\u5426\u652f\u6301\uff1aCurl: php --ri curlSwoole: php --ri swooleHttp2 \u5168\u53cc\u5de5\u7528\u6cd5\u8be5\u7528\u6cd5\u4ec5\u652f\u6301 Swoole$uri = new Uri(&#039;https:\/\/wiki.swoole.com\/&#039;);\n\n\/\/ \u5ba2\u6237\u7aef\u521d\u59cb\u5316\u548c\u8fde\u63a5\n$client = new \\Yurun\\Util\\YurunHttp\\Http2\\SwooleClient($uri-&gt;getHost(), Uri::getServerPort($uri), &#039;https&#039; === $uri-&gt;getScheme());\n$client-&gt;connect();\n\n\/\/ \u8bf7\u6c42\u6784\u5efa\n$httpRequest = new HttpRequest;\n$request = $httpRequest-&gt;header(&#039;aaa&#039;, &#039;bbb&#039;)-&gt;buildRequest($uri, [\n    &#039;date&#039;  =&gt;  $i,\n], &#039;POST&#039;, &#039;json&#039;);\n\nfor($i = 0; $i &lt; 10; ++$i)\n{\n    go(function() use($client, $request){\n        \/\/ \u53d1\u9001\uff08\u652f\u6301\u5728\u591a\u4e2a\u534f\u7a0b\u6267\u884c\uff09\n        $streamId = $client-&gt;send($request);\n        var_dump(&#039;send:&#039; . $streamId);\n\n        \/\/ \u63a5\u6536\uff08\u652f\u6301\u5728\u591a\u4e2a\u534f\u7a0b\u6267\u884c\uff09\n        $response = $client-&gt;recv($streamId, 3);\n        $content = $response-&gt;body();\n        var_dump($response);\n    });\n}"},{"id":189,"title":"\u5b88\u62a4\u8fdb\u7a0b","pageTitle":"\u5b88\u62a4\u8fdb\u7a0b","url":"production\/daemon.html","content":"\u5b88\u62a4\u8fdb\u7a0b\u547d\u4ee4\u6a21\u5f0f\u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u542f\u52a8\uff1abin\/imi server\/start -d\u91cd\u5b9a\u5411\u6807\u51c6\u8f93\u5165\u8f93\u51fa\uff1abin\/imi server\/start -d \u6587\u4ef6\u540d.log\u6b64\u65b9\u6cd5\u53ea\u53ef\u8ba9\u670d\u52a1\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u9000\u51fa ssh \u540e\u4e0d\u88ab\u7ec8\u6b62\u3002\u65e0\u6cd5\u5728\u670d\u52a1\u5d29\u6e83\u540e\u91cd\u65b0\u62c9\u8d77\uff0c\u5efa\u8bae\u4f7f\u7528 systemdSystemdSystemd \u4e00\u822c\u90fd\u5df2\u7ecf\u96c6\u6210\u5728\u4e86\u73b0\u4ee3 Linux \u53d1\u884c\u7248\u4e2d\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u5b9e\u73b0\u5f00\u673a\u81ea\u542f\u52a8\u548c\u5b88\u62a4\u8fdb\u7a0b\u7b49\u529f\u80fd\u3002\u4f46 Systemd \u5728 WSL\u3001Docker \u73af\u5883\u4e2d\uff0c\u53ef\u80fd\u96be\u4ee5\u4f7f\u7528\u3002\u521b\u5efa\u670d\u52a1\u914d\u7f6e\u6587\u4ef6 test.service[Unit]\nDescription=test\nAfter=network.target\nAfter=syslog.target\n\n[Service]\nType=simple\nLimitNOFILE=65535\nExecStart=\/your app path\/vendor\/bin\/imi server\/start\nExecReload=\/bin\/kill -USR1 $MAINPID\nRestart=always\n\n[Install]\nWantedBy=multi-user.target graphical.target\u4fee\u6539ExecStart\u4e3a\u4f60\u7684\u542f\u52a8\u547d\u4ee4\uff0c\u8be5\u6587\u4ef6\u9002\u7528\u4e8e\u4efb\u4f55\u5e94\u7528\uff0c\u4e0d\u4ec5\u9650\u4e8e imi \u9879\u76ee\u542f\u7528\u670d\u52a1\uff1asystemctl --user enable $PWD\/test.service\u542f\u52a8\u670d\u52a1\uff1asystemctl start test\u91cd\u542f\u670d\u52a1\uff1asystemctl restart test\u505c\u6b62\u670d\u52a1\uff1asystemctl stop test\u7981\u7528\u670d\u52a1\uff1asystemctl --user disable $PWD\/test.serviceSupervisorSupervisor\u662f\u7528 Python \u5f00\u53d1\u7684\u4e00\u5957\u901a\u7528\u7684\u8fdb\u7a0b\u7ba1\u7406\u7a0b\u5e8f\uff0c\u80fd\u5c06\u4e00\u4e2a\u666e\u901a\u7684\u547d\u4ee4\u884c\u8fdb\u7a0b\u53d8\u4e3a\u540e\u53f0 daemon\uff0c\u5e76\u76d1\u63a7\u8fdb\u7a0b\u72b6\u6001\uff0c\u5f02\u5e38\u9000\u51fa\u65f6\u80fd\u81ea\u52a8\u91cd\u542f\u3002\u5b89\u88c5\u548c\u542f\u52a8apt \u5b89\u88c5\uff1aapt-get install -y supervisoryum \u5b89\u88c5\uff1ayum install -y supervisorpip \u5b89\u88c5\uff1apip install supervisor\u542f\u52a8 Supervisor \u670d\u52a1\uff1aservice supervisor start\u670d\u52a1\u914d\u7f6e\u6587\u4ef6\u6587\u4ef6\u540d\uff1a\/etc\/supervisord.d\/\u670d\u52a1\u540d.conf\u6587\u4ef6\u5185\u5bb9\uff1a# \u9879\u76ee\u540d\n[program:\u670d\u52a1\u540d]\n\n# \u811a\u672c\u76ee\u5f55\ndirectory=\/your app path\n\n# \u811a\u672c\u6267\u884c\u547d\u4ee4\ncommand=\/your app path\/vendor\/bin\/imi server\/start\n\n# supervisor\u542f\u52a8\u7684\u65f6\u5019\u662f\u5426\u968f\u7740\u540c\u65f6\u542f\u52a8\uff0c\u9ed8\u8ba4True\nautostart=true\n\n# \u5f53\u7a0b\u5e8fexit\u7684\u65f6\u5019\uff0c\u8fd9\u4e2aprogram\u4e0d\u4f1a\u81ea\u52a8\u91cd\u542f,\u9ed8\u8ba4unexpected\uff0c\u8bbe\u7f6e\u5b50\u8fdb\u7a0b\u6302\u6389\u540e\u81ea\u52a8\u91cd\u542f\u7684\u60c5\u51b5\uff0c\u6709\u4e09\u4e2a\u9009\u9879\uff0cfalse,unexpected\u548ctrue\u3002\u5982\u679c\u4e3afalse\u7684\u65f6\u5019\uff0c\u65e0\u8bba\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u90fd\u4e0d\u4f1a\u88ab\u91cd\u65b0\u542f\u52a8\uff0c\u5982\u679c\u4e3aunexpected\uff0c\u53ea\u6709\u5f53\u8fdb\u7a0b\u7684\u9000\u51fa\u7801\u4e0d\u5728\u4e0b\u9762\u7684exitcodes\u91cc\u9762\u5b9a\u4e49\u7684\nautorestart = false\n\n# \u8fd9\u4e2a\u9009\u9879\u662f\u5b50\u8fdb\u7a0b\u542f\u52a8\u591a\u5c11\u79d2\u4e4b\u540e\uff0c\u6b64\u65f6\u72b6\u6001\u5982\u679c\u662frunning\uff0c\u5219\u6211\u4eec\u8ba4\u4e3a\u542f\u52a8\u6210\u529f\u4e86\u3002\u9ed8\u8ba4\u503c\u4e3a1\nstartsecs = 1\n\n# \u811a\u672c\u8fd0\u884c\u7684\u7528\u6237\u8eab\u4efd \nuser = test\n\n# \u65e5\u5fd7\u8f93\u51fa \nstderr_logfile=\/tmp\/stderr.log\nstdout_logfile=\/tmp\/stdout.log\n\n# \u628astderr\u91cd\u5b9a\u5411\u5230stdout\uff0c\u9ed8\u8ba4 false\nredirect_stderr = true\n\n# stdout\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\uff0c\u9ed8\u8ba4 50MB\nstdout_logfile_maxbytes = 20MB\n\n# stdout\u65e5\u5fd7\u6587\u4ef6\u5907\u4efd\u6570\nstdout_logfile_backups = 20Supervisor \u670d\u52a1\u7ba1\u7406\u547d\u4ee4\u8bf4\u660e# \u67e5\u770b\u6240\u6709\u8fdb\u7a0b\u7684\u72b6\u6001\nsupervisorctl status\n\n# \u542f\u52a8\u670d\u52a1\u540d\nsupervisorctl start \u670d\u52a1\u540d\n\n# \u505c\u6b62\u670d\u52a1\nsupervisorctl stop \u670d\u52a1\u540d\n\n# \u91cd\u542f\u670d\u52a1\u540d\nsupervisorctl restart \u670d\u52a1\u540d\n\n# \u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u540e\u4f7f\u7528\u8be5\u547d\u4ee4\u52a0\u8f7d\u65b0\u7684\u914d\u7f6e\nsupervisorctl update\n\n# \u91cd\u65b0\u542f\u52a8\u914d\u7f6e\u4e2d\u7684\u6240\u6709\u7a0b\u5e8f\nsupervisorctl reload"},{"id":188,"title":"Docker","pageTitle":"Docker","url":"production\/docker.html","content":"Docker\u63a8\u8350\u4f7f\u7528 Swoole \u5b98\u65b9 Docker\uff1ahttps:\/\/github.com\/swoole\/docker-swoole"},{"id":2,"title":"\u5e8f\u8a00","pageTitle":"\u5e8f\u8a00","url":"index.html","content":"\u5e8f\u8a00\u53d1\u5e03\u672c\u8d44\u6599\u987b\u9075\u5b88\u5f00\u653e\u51fa\u7248\u8bb8\u53ef\u534f\u8bae 1.0 \u6216\u8005\u66f4\u65b0\u7248\u672c\u3002\u672a\u7ecf\u7248\u6743\u6240\u6709\u8005\u660e\u786e\u6388\u6743\uff0c\u7981\u6b62\u53d1\u884c\u672c\u6587\u6863\u53ca\u5176\u88ab\u5b9e\u8d28\u4e0a\u4fee\u6539\u7684\u7248\u672c\u3002\u672a\u7ecf\u7248\u6743\u6240\u6709\u8005\u4e8b\u5148\u6388\u6743\uff0c\u7981\u6b62\u5c06\u6b64\u4f5c\u54c1\u53ca\u5176\u884d\u751f\u4f5c\u54c1\u4ee5\u6807\u51c6\uff08\u7eb8\u8d28\uff09\u4e66\u7c4d\u5f62\u5f0f\u53d1\u884c\u3002\u5982\u679c\u6709\u5174\u8da3\u518d\u53d1\u884c\u6216\u518d\u7248\u672c\u624b\u518c\u7684\u5168\u90e8\u6216\u90e8\u5206\u5185\u5bb9\uff0c\u4e0d\u8bba\u4fee\u6539\u8fc7\u4e0e\u5426\uff0c\u6216\u8005\u6709\u4efb\u4f55\u95ee\u9898\uff0c\u8bf7\u8054\u7cfb\u7248\u6743\u6240\u6709\u8005admin@yurunsoft.com\u672c\u6587\u6863\u7684\u7248\u6743\u5f52imi \u5f00\u53d1\u56e2\u961f\u6240\u6709\uff0c\u672c\u6587\u6863\u53ca\u5176\u63cf\u8ff0\u7684\u5185\u5bb9\u53d7\u6709\u5173\u6cd5\u5f8b\u7684\u7248\u6743\u4fdd\u62a4\uff0c\u5bf9\u672c\u6587\u6863\u5185\u5bb9\u7684\u4efb\u4f55\u5f62\u5f0f\u7684\u975e\u6cd5\u590d\u5236\uff0c\u6cc4\u9732\u6216\u6563\u5e03\uff0c\u5c06\u5bfc\u81f4\u76f8\u5e94\u7684\u6cd5\u5f8b\u8d23\u4efb\u3002QQ\u7fa4\uff1a17916227 \uff0c\u5982\u6709\u95ee\u9898\uff0c\u8d1f\u8d23\u7684\u5b87\u6da6\u5168\u7a0b\u624b\u628a\u624b\u89e3\u51b3\u3002\u5b98\u65b9\u7f51\u7ad9\uff1ahttps:\/\/www.imiphp.com\/Github\uff1ahttps:\/\/github.com\/imiphp\/imi"},{"id":149,"title":"App \u7c7b","pageTitle":"App \u7c7b","url":"utils\/app.html","content":"App \u7c7bImi\\App \u7c7b\uff0c\u662f\u6846\u67b6\u5e94\u7528\u7c7b\u3002\u65b9\u6cd5getNamespace\u83b7\u53d6\u5e94\u7528\u547d\u540d\u7a7a\u95f4public static function getNamespace()getContainer\u83b7\u53d6\u5bb9\u5668\u5bf9\u8c61public static function getContainer()\u5bb9\u5668\u624b\u52a8\u7ed1\u5b9a\/\/ \u7ed1\u5b9a\nApp::getContainer()-&gt;bind(&#039;aaa&#039;, XXX::class);\n\n\/\/ \u5b9e\u4f8b\u5316\n$obj = App::getBean(&#039;aaa&#039;);getBean\u83b7\u53d6\u5168\u5c40Bean\u5bf9\u8c61public static function getBean($name, ...$params)isDebug\u5f53\u524d\u662f\u5426\u4e3a\u8c03\u8bd5\u6a21\u5f0fpublic static function isDebug()setDebug\u5f00\u5173\u8c03\u8bd5\u6a21\u5f0fpublic static function setDebug($isDebug)setLoader\u8bbe\u7f6e Composer ClassLoaderpublic static function setLoader(\\Composer\\Autoload\\ClassLoader $loader)getLoader\u83b7\u53d6 Composer ClassLoaderpublic static function getLoader()get\u83b7\u53d6\u5e94\u7528\u4e0a\u4e0b\u6587\u6570\u636epublic static function get($name, $default = null)set\u8bbe\u7f6e\u5e94\u7528\u4e0a\u4e0b\u6587\u6570\u636epublic static function set($name, $value, $readonly = false)\u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u4ee5\u7981\u6b62\u975e Imi\\ \u5f00\u5934\u7684\u547d\u540d\u7a7a\u95f4\u7684\u7c7b\uff0c\u5bf9\u5e94\u7528\u4e0a\u4e0b\u6587\u4e2d$name\u5bf9\u5e94\u7684\u503c\u8fdb\u884c\u5199\u64cd\u4f5c\u3002\u6846\u67b6\u6838\u5fc3\u4e0a\u4e0b\u6587\u5217\u8868\u8fdb\u7a0b\u76f8\u5173\u7c7b Imi\\Util\\Process\\ProcessAppContexts:ProcessAppContexts::PROCESS_TYPE - \u8fdb\u7a0b\u7c7b\u578bProcessAppContexts::PROCESS_NAME - \u8fdb\u7a0b\u540d\u79f0ProcessAppContexts::MASTER_PID - \u4e3b\u8fdb\u7a0bpid\u8fdb\u7a0b\u7c7b\u578b\u5b9a\u4e49\u7c7b Imi\\Util\\Process\\ProcessType:ProcessType::MASTER - master \u8fdb\u7a0bProcessType::MANAGER - manager \u8fdb\u7a0bProcessType::WORKER - worker \u8fdb\u7a0bProcessType::TASK_WORKER - task worker \u8fdb\u7a0bProcessType::PROCESS - \u8fdb\u7a0b"},{"id":152,"title":"Args","pageTitle":"Args","url":"utils\/Args.html","content":"Args\u7c7b\u540d: Imi\\Util\\Args\u547d\u4ee4\u884c\u53c2\u6570\u64cd\u4f5c\u7c7b\u65b9\u6cd5get\u83b7\u53d6\u503c\/\/ \u4e0d\u59a8\u8fd0\u884c\u52a0\u4e00\u4e2a -abc 123 \u53c2\u6570\u770b\u770b\u6548\u679c\nvar_dump(Args::get(&#039;abc&#039;));\n\n\/\/ \u652f\u6301\u9ed8\u8ba4\u503c\nvar_dump(Args::get(&#039;abc&#039;, &#039;default&#039;));set\u5199\u5165\u53c2\u6570\u503cvar_dump(Args::set(&#039;abc&#039;, &#039;value&#039;));exists\u6307\u5b9a\u6570\u636e\u662f\u5426\u5b58\u5728var_dump(Args::exists(&#039;abc&#039;));"},{"id":153,"title":"ArrayUtil","pageTitle":"ArrayUtil","url":"utils\/ArrayUtil.html","content":"ArrayUtil\u7c7b\u540d: Imi\\Util\\ArrayUtil\u6570\u7ec4\u5e2e\u52a9\u7c7b\u65b9\u6cd5remove\u4ece\u6570\u7ec4\u4e2d\u79fb\u9664\u4e00\u4e2a\u5143\u7d20$array = [1, 2, 3, 4, 5];\n\n\/\/ \u5220\u9664\u4e00\u4e2a\u5143\u7d20\uff1a[1, 3, 4, 5]\nvar_dump(ArrayUtil::remove($array, 2));\n\n\/\/ \u5220\u9664\u591a\u4e2a\u5143\u7d20\uff1a[1, 5]\nvar_dump(ArrayUtil::remove($array, 2, 3, 4));recursiveMerge\u591a\u7ef4\u6570\u7ec4\u9012\u5f52\u5408\u5e76\uff0c\u5177\u4f53\u6548\u679c\u8bf7\u770b\u4e0b\u9762\u4ee3\u7801\u53ca\u8fd0\u884c\u7ed3\u679c$array1 = [\n    &#039;a&#039;    =&gt;    [\n        &#039;b1&#039;    =&gt;    [\n            &#039;c1&#039;    =&gt;    1,\n        ],\n        &#039;b2&#039;    =&gt;    [\n            &#039;c2&#039;    =&gt;    2,\n        ]\n    ]\n];\n$array2 = [\n    &#039;a&#039;    =&gt;    [\n        &#039;b1&#039;    =&gt;    [\n            &#039;c1&#039;    =&gt;    3,\n        ]\n    ]\n];\n\n\/\/ array_merge\nprint_r(array_merge($array1, $array2));\n\n\/\/ +\nprint_r($array1 + $array2);\n\n\/\/ ArrayUtil::recursiveMerge\nprint_r(ArrayUtil::recursiveMerge($array1, $array2));\u8fd0\u884c\u7ed3\u679c\uff1aArray\n(\n    [a] =&gt; Array\n        (\n            [b1] =&gt; Array\n                (\n                    [c1] =&gt; 3\n                )\n        )\n)\nArray\n(\n    [a] =&gt; Array\n        (\n            [b1] =&gt; Array\n                (\n                    [c1] =&gt; 1\n                )\n            [b2] =&gt; Array\n                (\n                    [c2] =&gt; 2\n                )\n        )\n)\nArray\n(\n    [a] =&gt; Array\n        (\n            [b1] =&gt; Array\n                (\n                    [c1] =&gt; 3\n                )\n            [b2] =&gt; Array\n                (\n                    [c2] =&gt; 2\n                )\n        )\n)columnToKey\u5c06\u4e8c\u7ef4\u6570\u7ec4\u7b2c\u4e8c\u7eac\u67d0key\u53d8\u4e3a\u4e00\u7ef4\u7684key$array = [\n    [&#039;id&#039;=&gt;1,&#039;name&#039;=&gt;&#039;a&#039;],\n    [&#039;id&#039;=&gt;2,&#039;name&#039;=&gt;&#039;b&#039;],\n    [&#039;id&#039;=&gt;3,&#039;name&#039;=&gt;&#039;c&#039;],\n];\n\n\/\/ \u4fdd\u7559\u539f\u59cb\u5b57\u6bb5\nprint_r(ArrayUtil::columnToKey($array, &#039;id&#039;));\n\n\/\/ \u53bb\u9664\u539f\u59cb\u5b57\u6bb5\nprint_r(ArrayUtil::columnToKey($array, &#039;id&#039;, false));\u8fd0\u884c\u7ed3\u679c\uff1aArray\n(\n    [1] =&gt; Array\n        (\n            [id] =&gt; 1\n            [name] =&gt; a\n        )\n    [2] =&gt; Array\n        (\n            [id] =&gt; 2\n            [name] =&gt; b\n        )\n    [3] =&gt; Array\n        (\n            [id] =&gt; 3\n            [name] =&gt; c\n        )\n\n)\nArray\n(\n    [1] =&gt; Array\n        (\n            [name] =&gt; a\n        )\n    [2] =&gt; Array\n        (\n            [name] =&gt; b\n        )\n    [3] =&gt; Array\n        (\n            [name] =&gt; c\n        )\n)isAssoc\u5224\u65ad\u6570\u7ec4\u662f\u5426\u4e3a\u5173\u8054\u6570\u7ec4$array = [1, 2, 3];\n\/\/ false\nvar_dump(ArrayUtil::isAssoc($array));\n\n$array = [1, &#039;b&#039;=&gt;2, 3];\n\/\/ true\nvar_dump(ArrayUtil::isAssoc($array));random\u968f\u673a\u83b7\u5f97\u6570\u7ec4\u4e2d\u7684\u503c\uff0c\u8fd4\u56de\u4e00\u4e2a\u4fdd\u6301\u952e\u503c\u5bf9\u5e94\u7684\u6570\u7ec4$array = [1, 2, 3];\n\/\/ \u8fd4\u56de\u968f\u673a\u7684\u6570\u7ec4\uff0c\u5982\uff1a[k1=&gt;v1]\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7f3a\u7701\u9ed8\u8ba4\u4e3a1\nvar_dump(ArrayUtil::random($array));\n\n\/\/ \u8fd4\u56de\u968f\u673a\u7684\u6570\u7ec4\uff0c\u5982\uff1a[k1=&gt;v1, k2=&gt;v2]\nvar_dump(ArrayUtil::random($array, 2));"},{"id":154,"title":"Bit","pageTitle":"Bit","url":"utils\/Bit.html","content":"Bit\u7c7b\u540d: Imi\\Util\\Bit\u4f4d\u64cd\u4f5c\u5de5\u5177\u7c7b\u65b9\u6cd5has\u5224\u65ad\u662f\u5426\u5305\u542b\u503c\/\/ true\nvar_dump(Bit::has(LOCK_SH | LOCK_NB, LOCK_NB));\n\n\/\/ false\nvar_dump(Bit::has(LOCK_SH, LOCK_NB));"},{"id":166,"title":"\u901a\u9053\u5bb9\u5668","pageTitle":"\u901a\u9053\u5bb9\u5668","url":"utils\/ChannelContainer.html","content":"\u901a\u9053\u5bb9\u5668\u7c7b\u540d: Imi\\Util\\Co\\ChannelContainer\u4e00\u4e2a\u901a\u9053\uff08Channel\uff09\u7ba1\u7406\u5bb9\u5668\uff0c\u901a\u8fc7\u4e00\u4e2a id\uff0c\u5feb\u901f\u64cd\u4f5c\u548c\u7ba1\u7406\u901a\u9053\u3002imi v1.2.0 \u7248\u672c\u65b0\u589e\u65b9\u6cd5push\u5411\u901a\u9053\u4e2d\u5199\u5165\u6570\u636e\u3002ChannelContainer::push(&#039;id123&#039;, &#039;\u6570\u636e&#039;);\nChannelContainer::push(&#039;id123&#039;, &#039;\u6570\u636e&#039;, 3); \/\/ \u8d85\u65f6 3 \u79d2pop\u4ece\u901a\u9053\u4e2d\u8bfb\u53d6\u6570\u636e\u3002ChannelContainer::pop(&#039;id123&#039;);\nChannelContainer::pop(&#039;id123&#039;, 3); \/\/ \u8d85\u65f6 3 \u79d2finallyPop\u4ece\u901a\u9053\u62ff\u6570\u636e\uff0c\u5e76\u4e14\u91ca\u653e\u901a\u9053ChannelContainer::finallyPop(&#039;id123&#039;);\nChannelContainer::finallyPop(&#039;id123&#039;, 3); \/\/ \u8d85\u65f6 3 \u79d2stats\u83b7\u53d6\u901a\u9053\u7684\u72b6\u6001ChannelContainer::stats(&#039;id123&#039;);close\u5173\u95ed\u901a\u9053\u3002\u5e76\u5524\u9192\u6240\u6709\u7b49\u5f85\u8bfb\u5199\u7684\u534f\u7a0b\u3002ChannelContainer::close(&#039;id123&#039;);length\u83b7\u53d6\u901a\u9053\u4e2d\u7684\u5143\u7d20\u6570\u91cf\u3002ChannelContainer::length(&#039;id123&#039;);isEmpty\u5224\u65ad\u5f53\u524d\u901a\u9053\u662f\u5426\u4e3a\u7a7a\u3002ChannelContainer::isEmpty(&#039;id123&#039;);isFull\u5224\u65ad\u5f53\u524d\u901a\u9053\u662f\u5426\u5df2\u6ee1\u3002ChannelContainer::isFull(&#039;id123&#039;);getChannel\u83b7\u53d6 \\Swoole\\Coroutine\\Channel \u5bf9\u8c61\uff0c\u4e0d\u5b58\u5728\u4f1a\u81ea\u52a8\u521b\u5efa\u5e76\u8fd4\u56deChannelContainer::getChannel(&#039;id123&#039;);hasChannel\u901a\u9053\u662f\u5426\u5b58\u5728ChannelContainer::hasChannel(&#039;id123&#039;);removeChannel\u79fb\u9664\u901a\u9053ChannelContainer::removeChannel(&#039;id123&#039;);"},{"id":155,"title":"ClassObject","pageTitle":"ClassObject","url":"utils\/ClassObject.html","content":"ClassObject\u7c7b\u540d: Imi\\Util\\ClassObject\u7c7b\u548c\u5bf9\u8c61\u76f8\u5173\u5de5\u5177\u7c7b\u65b9\u6cd5isAnymous\u662f\u5426\u662f\u533f\u540d\u7c7b\u5bf9\u8c61\/\/ true\nvar_dump(ClassObject::isAnymous(App::getBean(&#039;Logger&#039;)));\n\n\/\/ false\nvar_dump(ClassObject::isAnymous(new \\Imi\\Log\\Logger));\u5904\u7406\u53ef\u80fd\u662f\u540c\u7ea7\u7684\u7c7b\u540d\u5982\u679c $className \u662f\u4e00\u4e2a\u7c7b\u540d\uff0c\u5219\u539f\u6837\u8fd4\u56de\u5426\u5219\u8fd4\u56de $sameLevelClass \u540c\u7ea7\u4e0b\u7684\u7c7b\u540dClassObject::parseSameLevelClassName($className, $sameLevelClass)\u5c06\u65b9\u6cd5\u7684\u53c2\u6570\u5904\u7406\u6210 kv \u6570\u7ec4class A\n{\n    public function test($id, $name, $age = 9999)\n    {\n\n    }\n}\n\n$args = [\n    19260817,\n    &#039;imiphp.com&#039;,\n];\n\n$result1 = ClassObject::convertArgsToKV(&#039;A&#039;, &#039;test&#039;, $args, true);\nvar_dump($result1);\n\/*\narray(3) {\n  [&quot;id&quot;]=&gt;\n  int(19260817)\n  [&quot;name&quot;]=&gt;\n  string(10) &quot;imiphp.com&quot;\n  [&quot;age&quot;]=&gt;\n  int(9999)\n}\n*\/\n\n$result2 = ClassObject::convertArgsToKV(&#039;A&#039;, &#039;test&#039;, $args, false);\nvar_dump($result2);\n\/*\narray(2) {\n  [&quot;id&quot;]=&gt;\n  int(19260817)\n  [&quot;name&quot;]=&gt;\n  string(10) &quot;imiphp.com&quot;\n}\n*\/"},{"id":156,"title":"Coroutine","pageTitle":"Coroutine","url":"utils\/Coroutine.html","content":"Coroutine\u7c7b\u540d: Imi\\Util\\Coroutine\u534f\u7a0b\u5e2e\u52a9\u7c7b\u7ee7\u627f\u4e86\\Swoole\\Coroutine\u65b9\u6cd5isIn\u5224\u65ad\u5f53\u524d\u662f\u5426\u5728\u534f\u7a0b\u4e2d\u8fd0\u884cvar_dump(Coroutine::isIn());\u7531\u4e8e\u7ee7\u627f\u4e86 Swoole \u7684\u534f\u7a0b\u7c7b\uff0c\u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528\u5176\u5168\u90e8\u65b9\u6cd5"},{"id":163,"title":"DateTime","pageTitle":"DateTime","url":"utils\/DateTime.html","content":"DateTime\u7c7b\u540d: Imi\\Util\\DateTime\u65e5\u671f\u65f6\u95f4\u5de5\u5177\u7c7b\u65b9\u6cd5getSecondsByInterval\u5c06\u4e00\u4e2a \\DateInterval\uff0c\u4e0e\u5f53\u524d\u65f6\u95f4\u8fdb\u884c\u8ba1\u7b97\uff0c\u83b7\u53d6\u6beb\u79d2\u6570$d1 = new DateTime(&quot;2019-06-21&quot;);\n$d2 = new DateTime(&quot;2018-06-21&quot;);\n$diff = $d2-&gt;diff($d1); \n$s = \\Imi\\Util\\DateTime::getSecondsByInterval($diff);\nvar_dump($s); \/\/ 31622400"},{"id":"645b0b4a7fb084.13137857","title":"Digital","pageTitle":"Digital","url":"utils\/Digital.html","content":"Digital\u7c7b\u540d: Imi\\Util\\Digital\u6570\u5b57\u76f8\u5173\u5de5\u5177\u7c7b\u65b9\u6cd5scientificToNum\u79d1\u5b66\u8ba1\u6570\u8f6c\u5c0f\u6570\u5f62\u5f0f\u7684echo Digital::scientificToNum(2.1E-5, 6); \/\/ 0.000021"},{"id":157,"title":"File","pageTitle":"File","url":"utils\/File.html","content":"File\u7c7b\u540d: Imi\\Util\\File\u6587\u4ef6\u76f8\u5173\u5de5\u5177\u7c7b\u65b9\u6cd5enum\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u8c61\u3002\/\/ \u679a\u4e3e\u5f53\u524d\u76ee\u5f55\u53ca\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c\u4e0d\u5305\u542b.\u548c..\nforeach(File::enum(__DIR__) as $fileName)\n{\n    echo (string)$fileName, PHP_EOL;\n}enumPHPFile\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u5bf9\u8c61\u3002\/\/ \u679a\u4e3e\u5f53\u524d\u76ee\u5f55\u53ca\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\u7684PHP\u6587\u4ef6\nforeach(File::enumPHPFile(__DIR__) as $fileName)\n{\n    echo (string)$fileName, PHP_EOL;\n}path\u7ec4\u5408\u8def\u5f84\uff0c\u76ee\u5f55\u540e\u7684\/\u4e0d\u662f\u5fc5\u987b\/\/ abc\/index.html\necho File::path(&#039;abc&#039;, &#039;index.html&#039;);\n\n\/\/ \u652f\u6301\u534f\u8baeuri\uff0c\u591a\u4f59\u7684\/\u4f1a\u5408\u5e76\u4e3a\u4e00\u4e2a\uff1ahttp:\/www.baidu.com\/a\/b\/index.html\necho File::path(&#039;http:\/\/www.baidu.com&#039;, &#039;a\/\/b\/\/\/&#039;, &#039;index.html&#039;);readAll\u6839\u636e\u6587\u4ef6\u6253\u5f00\u53e5\u67c4\uff0c\u8bfb\u53d6\u6587\u4ef6\u6240\u6709\u5185\u5bb9$fp = fopen(__FILE__, &#039;r&#039;);\necho File::readAll($fp);\nfclose($fp);createDir\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55\/\/ \u9012\u5f52\u521b\u5efa\u76ee\u5f55\uff0c\u6743\u9650\u9ed8\u8ba40755\nFile::createDir(&#039;a\/b\/c&#039;);\n\n\/\/ \u9012\u5f52\u521b\u5efa\u76ee\u5f55\uff0c\u6743\u9650\u4e3a0777\nFile::createDir(&#039;a\/b\/c&#039;, 0777);createFile\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\/\/ \u521b\u5efa\u6587\u4ef6\uff0c\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\uff0c\u6743\u9650\u9ed8\u8ba40755\nFile::createFile(&#039;a\/b\/c.txt&#039;);\n\n\/\/ \u521b\u5efa\u6587\u4ef6\uff0c\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u6307\u5b9a\u5185\u5bb9\u4e3aabc\uff0c\u5219\u81ea\u52a8\u521b\u5efa\uff0c\u6743\u9650\u9ed8\u8ba40755\nFile::createFile(&#039;a\/b\/c.txt&#039;, &#039;abc&#039;);\n\n\/\/ \u521b\u5efa\u6587\u4ef6\uff0c\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\uff0c\u6743\u9650\u4e3a0777\nFile::createFile(&#039;a\/b\/c.txt&#039;, &#039;&#039;, 0777);isEmptyDir\u5224\u65ad\u662f\u5426\u4e3a\u7a7a\u76ee\u5f55File::isEmptyDir(__DIR__);deleteDir\u9012\u5f52\u5220\u9664\u76ee\u5f55\u53ca\u76ee\u5f55\u4e2d\u6240\u6709\u6587\u4ef6File::deleteDir(&#039;xxx&#039;);putContents\u5199\u5165\u5185\u5bb9\u5230\u6587\u4ef6\uff0c\u5982\u679c\u76ee\u5f55\u4e0d\u5b58\u5728\u81ea\u52a8\u521b\u5efa\u591a\u7ea7\u76ee\u5f55\u3002\u53c2\u6570\u3001\u8fd4\u56de\u503c\u4e0e file_put_contents \u5b8c\u5168\u4e00\u81f4File::putContents(&#039;.\/a\/b\/c\/1.txt&#039;, &#039;123&#039;);absolute\u83b7\u53d6\u7edd\u5bf9\u8def\u5f84\u76f8\u6bd4 realpath() \u51fd\u6570\uff0c\u6b64\u65b9\u6cd5\u4e0d\u9700\u8981\u8def\u5f84\u662f\u771f\u5b9e\u5b58\u5728\u7684\u3002\/\/ \/a\/b\/c\/1.jpg\nFile::absolute(&#039;\/a\/b\/d\/e\/..\/..\/c\/.\/1.jpg&#039;);"},{"id":150,"title":"\u5168\u5c40\u51fd\u6570","pageTitle":"\u5168\u5c40\u51fd\u6570","url":"utils\/functions.html","content":"\u5168\u5c40\u51fd\u6570imigo\u542f\u52a8\u4e00\u4e2a\u534f\u7a0b\uff0c\u81ea\u52a8\u521b\u5efa\u548c\u9500\u6bc1\u4e0a\u4e0b\u6587imigo(function(){\n    $value = Redis::get(&#039;key&#039;);\n    \/\/ \u65e0\u9700\u624b\u52a8\u91ca\u653e\u4efb\u4f55\u8d44\u6e90\n});\u4f20\u5165\u53c2\u6570\uff1aimigo(function($id, $name){\n    echo $id, &#039;:&#039;, $name, PHP_EOL; \/\/ 1:test\n}, 1, &#039;test&#039;);imiCallable\u4e3a\u4f20\u5165\u7684\u56de\u8c03\u81ea\u52a8\u521b\u5efa\u548c\u9500\u6bc1\u4e0a\u4e0b\u6587\uff0c\u5e76\u8fd4\u56de\u65b0\u7684\u56de\u8c03$callable = imiCallable(function(){\n    return &#039;abc&#039;;\n});\nfunction test($a)\n{\n    $value = $a(); \/\/ abc\n}\ntest($callable);\u5f00\u65b0\u534f\u7a0b\u53bb\u6267\u884c\u56de\u8c03\uff0c\u65e0\u6cd5\u83b7\u53d6\u8fd4\u56de\u503c\uff1a$callable = imiCallable(function(){\n    return &#039;abc&#039;;\n}, true); \/\/ \u8fd9\u91cc\u52a0\u4e86 true\nfunction test($a)\n{\n    $value = $a(); \/\/ \u534f\u7a0bID\n}\ntest($callable);imiGetEnvgetenv() \u51fd\u6570\u7684\u5c01\u88c5\uff0c\u652f\u6301\u9ed8\u8ba4\u503c\u5b9a\u4e49\uff1aimiGetEnv($varname = null, $default = null, $localOnly = false);"},{"id":151,"title":"Imi","pageTitle":"Imi","url":"utils\/Imi.html","content":"Imi\u7c7b\u540d: Imi\\Util\\Imi\u6846\u67b6\u91cc\u6742\u4e03\u6742\u516b\u7684\u5404\u79cd\u5de5\u5177\u65b9\u6cd5\u57fa\u672c\u90fd\u653e\u5728\u8fd9\u4e2a\u7c7b\u65b9\u6cd5\u4ec5\u5217\u51fa\u53ef\u80fd\u5e38\u7528\u7684\u65b9\u6cd5\uff0c\u5927\u591a\u6570\u65b9\u6cd5\u65e0\u9700\u4e86\u89e3\u3002parseDotRule\u5904\u7406\u6309.\u5206\u9694\u7684\u89c4\u5219\u6587\u672c\uff0c\u652f\u6301.\u8f6c\u4e49\u4e0d\u5206\u9694\/\/ [&#039;a&#039;, &#039;b&#039;, &#039;c&#039;]\nvar_dump(Imi::parseDotRule(&#039;a.b.c&#039;));\n\n\/\/ [&#039;a.b&#039;, &#039;c&#039;]\nvar_dump(Imi::parseDotRule(&#039;a\\.b.c&#039;));getClassShortName\u83b7\u53d6\u7c7b\u77ed\u540d\u79f0\/\/ C\necho Imi::getClassShortName(&#039;A\\B\\C&#039;);getNamespacePath\u6839\u636e\u547d\u540d\u7a7a\u95f4\u83b7\u53d6\u771f\u5b9e\u8def\u5f84\uff0c\u8fd4\u56denull\u5219\u4e3a\u83b7\u53d6\u5931\u8d25\/\/ \/mnt\/d\/projects\/imi-demo\/vendor\/imiphp\/imi\/src\/\necho Imi::getNamespacePath(&#039;Imi&#039;), PHP_EOL;\n\n\/\/ \/mnt\/d\/projects\/imi-demo\/HttpDemo\/\necho Imi::getNamespacePath(&#039;ImiDemo\\HttpDemo&#039;), PHP_EOL;getNamespacePaths\u6839\u636e\u547d\u540d\u7a7a\u95f4\u83b7\u53d6\u771f\u5b9e\u8def\u5f84\uff0c\u5141\u8bb8\u8fd4\u56de\u591a\u4e2avar_dump(Imi::getNamespacePaths(&#039;Imi&#039;));getClassPropertyValue\u83b7\u53d6\u7c7b\u5c5e\u6027\u7684\u503c\uff0c\u503c\u4e3abeans\u914d\u7f6e\u6216\u9ed8\u8ba4\u914d\u7f6e\uff0c\u652f\u6301\u4f20\u5165Bean\u540d\u79f0\u6784\u9020\u65b9\u6cd5\u8d4b\u503c\u65e0\u6cd5\u53d6\u51fa\/\/ \u9ed8\u8ba4\u4e3aImi\\Server\\Group\\Handler\\Redis\necho Imi::getClassPropertyValue(&#039;ServerGroup&#039;, &#039;groupHandler&#039;);getImiCmd\u83b7\u53d6imi\u547d\u4ee4\u884c\/\/ php \/mnt\/d\/projects\/imi-demo\/HttpDemo\/bin\/imi server\/reload\necho Imi::getImiCmd(&#039;server&#039;, &#039;reload&#039;);evaleval() \u51fd\u6570\u7684\u5b89\u5168\u66ff\u4ee3\u65b9\u6cd5Imi::eval(&#039;echo &quot;hello imi&quot;;&#039;);"},{"id":164,"title":"KVStorage","pageTitle":"KVStorage","url":"utils\/KVStorage.html","content":"KVStorage\u7c7b\u540d: Imi\\Util\\KVStoragekv\u5b58\u50a8\u7c7b\uff0c\u57fa\u4e8eSplObjectStorage\uff0c\u652f\u6301\u975e\u5bf9\u8c61\u952e\u4f7f\u7528\u65b9\u6cd5\u540c\uff1aSplObjectStorage\uff0c\u4e0d\u518d\u5c40\u9650\u4e8e\u5bf9\u8c61"},{"id":158,"title":"ObjectArrayHelper","pageTitle":"ObjectArrayHelper","url":"utils\/ObjectArrayHelper.html","content":"ObjectArrayHelper\u7c7b\u540d: Imi\\Util\\ObjectArrayHelper\u5bf9\u8c61\u53ca\u6570\u7ec4\u5e2e\u52a9\u7c7b\u667a\u80fd\u8bc6\u522b\u6570\u7ec4\u548c\u5bf9\u8c61\uff0c\u652f\u6301\u5bf9a.b.c\u8fd9\u6837\u7684name\u5c5e\u6027\u8fdb\u884c\u64cd\u4f5c\u65b9\u6cd5\u4ee5\u4e0b\u6240\u6709\u793a\u4f8b\uff0c\u524d\u63d0\u4ee3\u7801\u4e3a\uff1a$data = [\n    &#039;a&#039;    =&gt;    [\n        &#039;b&#039;    =&gt;    [\n            &#039;c&#039;    =&gt;    &#039;111&#039;,\n        ],\n    ],\n];\n\/\/ \u4e5f\u53ef\u4ee5\u662f\u4efb\u610f\u5bf9\u8c61\u53ca\u6570\u7ec4\u7684\u6df7\u5408\u7528\u6cd5\uff0c\u5982\uff1a\n$data = new \\stdClass;\n$data-&gt;a = [];\n$data-&gt;a[&#039;b&#039;] = new \\stdClass;\n$data-&gt;a[&#039;b&#039;]-&gt;c = &#039;111&#039;;get\u83b7\u53d6\u503c\/\/ 111\necho ObjectArrayHelper::get($data, &#039;a.b.c&#039;);\n\n\/\/ 222\necho ObjectArrayHelper::get($data, &#039;a.b.c.d&#039;, &#039;222&#039;);set\u8bbe\u7f6e\u503cObjectArrayHelper::set($data, &#039;a.b.c2&#039;, &#039;333&#039;);remove\u79fb\u9664\u503cObjectArrayHelper::remove($data, &#039;a.b.c2&#039;);exists\u503c\u662f\u5426\u5b58\u5728var_dump(ObjectArrayHelper::exists($data, &#039;a.b.c2&#039;));filter\u8fc7\u6ee4\u5c5e\u6027$data = [\n    &#039;id&#039;    =&gt;    1,\n    &#039;name&#039;    =&gt;    &#039;imi&#039;,\n];\n\/\/ $data = new stdClass;\n\/\/ $data-&gt;id = 1;\n\/\/ $data-&gt;name = &#039;imi&#039;;\n\n\/\/ \u4ee5\u4e0a\u4e24\u4e2a\u90fd\u652f\u6301\n\n\/\/ \u53ea\u4fdd\u7559 name \u5b57\u6bb5\nvar_dump(ObjectArrayHelper::filter($data, [&#039;name&#039;]));\n\n\/\/ \u5254\u9664 name \u5b57\u6bb5\nvar_dump(ObjectArrayHelper::filter($data, [&#039;name&#039;], &#039;deny&#039;));"},{"id":162,"title":"Pagination","pageTitle":"Pagination","url":"utils\/Pagination.html","content":"Pagination\u7c7b\u540d: Imi\\Util\\Pagination\u5206\u9875\u8ba1\u7b97\u7c7b\u65b9\u6cd5\u6784\u9020\u65b9\u6cd5public function __construct($page, $count)$page \u5f53\u524d\u9875\u7801$count \u6bcf\u9875\u6570\u91cfgetPage\u5b57\u9762\u610f\u601dsetPage\u5b57\u9762\u610f\u601dgetCount\u5b57\u9762\u610f\u601dsetCount\u5b57\u9762\u610f\u601dgetLimitOffset\u83b7\u53d6\u504f\u79fb\u91cf\uff0c\u5982 limit 20, 10 \u4e2d\u7684 20getLimitEndOffset\u83b7\u53d6\u7ed3\u675f\u7684\u504f\u79fb\u91cf\uff0c\u5982 limit 20, 10 \u4e2d\u7684 29calcPageCount\u6839\u636e\u8bb0\u5f55\u6570\u8ba1\u7b97\u603b\u9875\u6570$records = 101;\n$page = new \\Imi\\Util\\Pagination(1, 10);\n$pagination-&gt;calcPageCount($records); \/\/ 11\u4f8b\u5b50$page = new \\Imi\\Util\\Pagination(10, 15);\n$limit = &#039;limit &#039; . $page-&gt;getLimitOffset() . &#039;,&#039; . $page-&gt;getCount();\necho $limit;"},{"id":159,"title":"Random","pageTitle":"Random","url":"utils\/Random.html","content":"Random\u7c7b\u540d: Imi\\Util\\Random\u968f\u673a\u751f\u6210\u4e00\u4e9b\u4e1c\u897f\u7684\u5de5\u5177\u7c7b\u65b9\u6cd5int\u968f\u673a\u6574\u6570\/\/ \u968f\u673a\u8303\u56f4\uff1aPHP_INT_MIN-PHP_INT_MAX\necho Random::int(), PHP_EOL;\n\n\/\/ \u968f\u673a\u8303\u56f4\uff1a1-20\necho Random::int(1, 20), PHP_EOL;number\u968f\u673a\u751f\u6210\u5c0f\u6570\/\/ \u968f\u673a\u8303\u56f4\uff1aPHP_INT_MIN-PHP_INT_MAX\necho Random::number(), PHP_EOL;\n\n\/\/ \u968f\u673a\u8303\u56f4\uff1a12-20\necho Random::number(1.2, 20), PHP_EOL;text\u968f\u673a\u751f\u6210\u6587\u672c\/\/ \u4eceabcdefg\u4e2d\u968f\u673a4-6\u4e2a\u5b57\u7b26\necho Random::text(&#039;abcdefg&#039;, 4, 6), PHP_EOL;\n\n\/\/ \u4eceabcdefg\u4e2d\u968f\u673a5\u4e2a\u5b57\u7b26\necho Random::text(&#039;abcdefg&#039;, 5), PHP_EOL;letter\u968f\u673a\u751f\u6210\u5b57\u6bcd\/\/ \u968f\u673a\u5927\u5c0f\u5199\u5b57\u6bcd4-6\u4e2a\necho Random::letter(4, 6), PHP_EOL;\n\/\/ \u968f\u673a\u5927\u5c0f\u5199\u5b57\u6bcd5\u4e2a\necho Random::letter(5), PHP_EOL;digital\u968f\u673a\u751f\u6210\u6570\u5b57\u548cRandom::int()\u65b9\u6cd5\u4e0d\u540c\u7684\u662f\uff0c\u8fd9\u4e2a\u662f\u751f\u6210\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u4e0d\u9650\u5236\u6570\u503c\u7684\u5927\u5c0f\u3002\/\/ \u968f\u673a100-200\u4e2a\u6570\u5b57\necho Random::digital(100, 200), PHP_EOL;\n\/\/ \u968f\u673a100\u4e2a\u6570\u5b57\necho Random::digital(100), PHP_EOL;letterAndNumber\/\/ \u968f\u673a\u751f\u62104-6\u4e2a\u5b57\u6bcd+\u6570\u5b57\necho Random::letterAndNumber(4, 6);\n\/\/ \u968f\u673a\u751f\u62105\u4e2a\u5b57\u6bcd+\u6570\u5b57\necho Random::letterAndNumber(5);"},{"id":167,"title":"\u670d\u52a1\u5668\u5de5\u5177\u7c7b","pageTitle":"\u670d\u52a1\u5668\u5de5\u5177\u7c7b","url":"utils\/Server.html","content":"\u670d\u52a1\u5668\u5de5\u5177\u7c7b\u7c7b\u540d: Imi\\Server\\Server\u670d\u52a1\u5668\u5de5\u5177\u7c7b\u65b9\u6cd5getServer\u83b7\u53d6\u670d\u52a1\u5668$server = Server::getServer(); \/\/ \u83b7\u53d6\u5f53\u524d\u670d\u52a1\u5668\n$server = Server::getServer(&#039;serverName&#039;); \/\/ \u83b7\u53d6\u6307\u5b9a\u540d\u79f0\u7684\u670d\u52a1\u5668sendMessage\u53d1\u9001\u6d88\u606f\u7ed9 Worker \u8fdb\u7a0b\uff0c\u4f7f\u7528\u6846\u67b6\u5185\u7f6e\u683c\u5f0f\u8fd4\u56de\u6210\u529f\u53d1\u9001\u6d88\u606f\u6570\u91cf\/\/ \u53d1\u9001\u7ed9\u6240\u6709 Worker\nServer::sendMessage(&#039;\u52a8\u4f5c&#039;, [\n    \/\/ \u6570\u636e\n]);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a Worker\nServer::sendMessage(&#039;\u52a8\u4f5c&#039;, [\n    \/\/ \u6570\u636e\n], 0);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u591a\u4e2a Worker\nServer::sendMessage(&#039;\u52a8\u4f5c&#039;, [\n    \/\/ \u6570\u636e\n], [0, 1, 2]);sendMessageRaw\u53d1\u9001\u6d88\u606f\u7ed9 Worker \u8fdb\u7a0b\u8fd4\u56de\u6210\u529f\u53d1\u9001\u6d88\u606f\u6570\u91cf\/\/ \u53d1\u9001\u7ed9\u6240\u6709 Worker\nServer::sendMessageRaw(&#039;\u6570\u636e&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a Worker\nServer::sendMessageRaw(&#039;\u6570\u636e&#039;, 0);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u591a\u4e2a Worker\nServer::sendMessageRaw(&#039;\u6570\u636e&#039;, [0, 1, 2]);send\u53d1\u9001\u6570\u636e\u7ed9\u6307\u5b9a\u5ba2\u6237\u7aef\uff0c\u652f\u6301\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u6570\u7ec4\uff09\u6570\u636e\u5c06\u4f1a\u901a\u8fc7\u5904\u7406\u5668\u7f16\u7801\/\/ \u53d1\u9001\u7ed9\u5f53\u524d\u8fde\u63a5\nServer::send([\n    \/\/ \u6570\u636e\n]);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u8fde\u63a5\nServer::send([\n    \/\/ \u6570\u636e\n], 1);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u591a\u4e2a\u8fde\u63a5\nServer::send([\n    \/\/ \u6570\u636e\n], [1, 2, 3]);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::send([\n    \/\/ \u6570\u636e\n], 1, &#039;myServer&#039;);\n\n\/\/ SWOOLE_BASE \u6a21\u5f0f\u4e0b\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u8fdb\u7a0b\u4e2d\u7684\u8fde\u63a5\nServer::send([\n    \/\/ \u6570\u636e\n], 1, &#039;myServer&#039;, false);sendByFlag\u53d1\u9001\u6570\u636e\u7ed9\u6307\u5b9a\u6807\u8bb0\u7684\u5ba2\u6237\u7aef\uff0c\u652f\u6301\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u6570\u7ec4\uff09\u6570\u636e\u5c06\u4f1a\u901a\u8fc7\u5904\u7406\u5668\u7f16\u7801\/\/ \u9700\u8981\u6709\u7ed1\u5b9a\u8fc7\u7684\u8fde\u63a5\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\n\\Imi\\ConnectContext::bind(&#039;user1&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u5f53\u524d\u8fde\u63a5\nServer::sendByFlag([\n    \/\/ \u6570\u636e\n]);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u8fde\u63a5\nServer::sendByFlag([\n    \/\/ \u6570\u636e\n], &#039;user1&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u591a\u4e2a\u8fde\u63a5\nServer::sendByFlag([\n    \/\/ \u6570\u636e\n], [&#039;user1&#039;, &#039;user2&#039;, &#039;user3&#039;]);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendByFlag([\n    \/\/ \u6570\u636e\n], &#039;user1&#039;, &#039;myServer&#039;);\n\n\/\/ SWOOLE_BASE \u6a21\u5f0f\u4e0b\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u8fdb\u7a0b\u4e2d\u7684\u8fde\u63a5\nServer::sendByFlag([\n    \/\/ \u6570\u636e\n], &#039;user1&#039;, &#039;myServer&#039;, false);sendRaw\u53d1\u9001\u6570\u636e\u7ed9\u6307\u5b9a\u5ba2\u6237\u7aef\uff0c\u652f\u6301\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u6570\u7ec4\uff09\/\/ \u53d1\u9001\u7ed9\u5f53\u524d\u8fde\u63a5\nServer::sendRaw(&#039;\u6570\u636e&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u8fde\u63a5\nServer::sendRaw(&#039;\u6570\u636e&#039;, 1);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u591a\u4e2a\u8fde\u63a5\nServer::sendRaw(&#039;\u6570\u636e&#039;, [1, 2, 3]);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendRaw(&#039;\u6570\u636e&#039;, 1, &#039;myServer&#039;);\n\n\/\/ SWOOLE_BASE \u6a21\u5f0f\u4e0b\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u8fdb\u7a0b\u4e2d\u7684\u8fde\u63a5\nServer::sendRaw(&#039;\u6570\u636e&#039;, 1, &#039;myServer&#039;, false);sendRawByFlag\u53d1\u9001\u6570\u636e\u7ed9\u6307\u5b9a\u6807\u8bb0\u7684\u5ba2\u6237\u7aef\uff0c\u652f\u6301\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u6570\u7ec4\uff09\/\/ \u9700\u8981\u6709\u7ed1\u5b9a\u8fc7\u7684\u8fde\u63a5\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\n\\Imi\\ConnectContext::bind(&#039;user1&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u5f53\u524d\u8fde\u63a5\nServer::sendRawByFlag(&#039;\u6570\u636e&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u8fde\u63a5\nServer::sendRawByFlag(&#039;\u6570\u636e&#039;, &#039;user1&#039;);\n\n\/\/ \u53d1\u9001\u7ed9\u6307\u5b9a\u591a\u4e2a\u8fde\u63a5\nServer::sendRawByFlag(&#039;\u6570\u636e&#039;, [&#039;user1&#039;, &#039;user2&#039;, &#039;user3&#039;]);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendRawByFlag(&#039;\u6570\u636e&#039;, &#039;user1&#039;, &#039;myServer&#039;);\n\n\/\/ SWOOLE_BASE \u6a21\u5f0f\u4e0b\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u8fdb\u7a0b\u4e2d\u7684\u8fde\u63a5\nServer::sendRawByFlag(&#039;\u6570\u636e&#039;, &#039;user1&#039;, &#039;myServer&#039;, false);sendToAll\u53d1\u9001\u6570\u636e\u7ed9\u6240\u6709\u5ba2\u6237\u7aef\u6570\u636e\u5c06\u4f1a\u901a\u8fc7\u5904\u7406\u5668\u7f16\u7801\n\/\/ \u53d1\u9001\u7ed9\u6240\u6709\u8fde\u63a5\nServer::sendToAll([\n    \/\/ \u6570\u636e\n]);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendToAll([\n    \/\/ \u6570\u636e\n], &#039;myServer&#039;);\n\n\/\/ BASE\u6a21\u5f0f\u4e0b\uff0c\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u4e2d\u7684\u6240\u6709\u8fde\u63a5\uff08\u9ed8\u8ba4\u53d1\u7ed9\u6240\u6709\u8fdb\u7a0b\u7684\u8fde\u63a5\uff09\nServer::sendToAll([\n    \/\/ \u6570\u636e\n], &#039;myServer&#039;, false);sendRawToAll\u53d1\u9001\u6570\u636e\u7ed9\u6240\u6709\u5ba2\u6237\u7aef\u6570\u636e\u539f\u6837\u53d1\u9001\/\/ \u53d1\u9001\u7ed9\u6240\u6709\u8fde\u63a5\nServer::sendRawToAll(&#039;\u6570\u636e&#039;);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendRawToAll(&#039;\u6570\u636e&#039;, &#039;myServer&#039;);\n\n\/\/ BASE\u6a21\u5f0f\u4e0b\uff0c\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u4e2d\u7684\u6240\u6709\u8fde\u63a5\uff08\u9ed8\u8ba4\u53d1\u7ed9\u6240\u6709\u8fdb\u7a0b\u7684\u8fde\u63a5\uff09\nServer::sendRawToAll(&#039;\u6570\u636e&#039;, &#039;myServer&#039;, false);sendToGroup\u53d1\u9001\u6570\u636e\u7ed9\u5206\u7ec4\u4e2d\u7684\u6240\u6709\u5ba2\u6237\u7aef\uff0c\u652f\u6301\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u6570\u7ec4\uff09\u6570\u636e\u5c06\u4f1a\u901a\u8fc7\u5904\u7406\u5668\u7f16\u7801\/\/ \u53d1\u9001\u7ed9\u5355\u4e2a\u5206\u7ec4\nServer::sendToGroup(&#039;myGroupName&#039;, [\n    \/\/ \u6570\u636e\n]);\n\n\/\/ \u53d1\u9001\u7ed9\u591a\u4e2a\u5206\u7ec4\nServer::sendToGroup([&#039;myGroupName1&#039;, &#039;myGroupName2&#039;], [\n    \/\/ \u6570\u636e\n]);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendToGroup(&#039;myGroupName&#039;, [\n    \/\/ \u6570\u636e\n], &#039;myServer&#039;);\n\n\/\/ BASE\u6a21\u5f0f\u4e0b\uff0c\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u4e2d\u7684\u6240\u6709\u8fde\u63a5\uff08\u9ed8\u8ba4\u53d1\u7ed9\u6240\u6709\u8fdb\u7a0b\u7684\u8fde\u63a5\uff09\nServer::sendToGroup(&#039;myGroupName&#039;, [\n    \/\/ \u6570\u636e\n], &#039;myServer&#039;, false);sendRawToGroup\u53d1\u9001\u6570\u636e\u7ed9\u5206\u7ec4\u4e2d\u7684\u6240\u6709\u5ba2\u6237\u7aef\uff0c\u652f\u6301\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u6570\u7ec4\uff09\u6570\u636e\u539f\u6837\u53d1\u9001\/\/ \u53d1\u9001\nServer::sendRawToGroup(&#039;myGroupName&#039;, &#039;\u6570\u636e&#039;);\n\n\n\/\/ \u53d1\u9001\u7ed9\u591a\u4e2a\u5206\u7ec4\nServer::sendRawToGroup([&#039;myGroupName1&#039;, &#039;myGroupName2&#039;], &#039;\u6570\u636e&#039;);\n\n\/\/ \u6307\u5b9a\u670d\u52a1\u540d\uff0c\u652f\u6301\u76d1\u542c\u591a\u4e2a\u5b50\u670d\u52a1\u5668\u7684\u60c5\u51b5\nServer::sendRawToGroup(&#039;myGroupName&#039;, &#039;\u6570\u636e&#039;, &#039;myServer&#039;);\n\n\/\/ BASE\u6a21\u5f0f\u4e0b\uff0c\u53ea\u53d1\u9001\u7ed9\u5f53\u524d worker \u4e2d\u7684\u6240\u6709\u8fde\u63a5\uff08\u9ed8\u8ba4\u53d1\u7ed9\u6240\u6709\u8fdb\u7a0b\u7684\u8fde\u63a5\uff09\nServer::sendRawToGroup(&#039;myGroupName&#039;, &#039;\u6570\u636e&#039;, &#039;myServer&#039;, false);close\u5173\u95ed\u4e00\u4e2a\u6216\u591a\u4e2a\u8fde\u63a5Server::close(1); \/\/ \u5173\u95ed fd 1\nServer::close([1, 2, 3]); \/\/ \u5173\u95ed fd 1\u30012\u30013\nServer::close(1, &#039;myServer&#039;); \/\/ \u6307\u5b9a\u670d\u52a1\u5668\u540d\n\n\/\/ BASE\u6a21\u5f0f\u4e0b\uff0c\u53ea\u5173\u95ed\u5f53\u524d worker \u4e2d\u7684\u8fde\u63a5\uff08\u9ed8\u8ba4\u5173\u95ed\u6240\u6709\u8fdb\u7a0b\u7684\u6307\u5b9a\u8fde\u63a5\uff09\nServer::close(1, &#039;myServer&#039;, false);closeByFlag\u5173\u95ed\u4e00\u4e2a\u6216\u591a\u4e2a\u6307\u5b9a\u6807\u8bb0\u7684\u8fde\u63a5\/\/ \u9700\u8981\u6709\u7ed1\u5b9a\u8fc7\u7684\u8fde\u63a5\uff0c\u624d\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\n\\Imi\\ConnectContext::bind(&#039;user1&#039;);\n\nServer::closeByFlag(&#039;user1&#039;); \/\/ \u5173\u95ed user1\nServer::closeByFlag([&#039;user1&#039;, &#039;user2&#039;]); \/\/ \u5173\u95ed user1\u3001user2\nServer::closeByFlag(&#039;user1&#039;, &#039;myServer&#039;); \/\/ \u6307\u5b9a\u670d\u52a1\u5668\u540d\n\n\/\/ BASE\u6a21\u5f0f\u4e0b\uff0c\u53ea\u5173\u95ed\u5f53\u524d worker \u4e2d\u7684\u8fde\u63a5\uff08\u9ed8\u8ba4\u5173\u95ed\u6240\u6709\u8fdb\u7a0b\u7684\u6307\u5b9a\u8fde\u63a5\uff09\nServer::closeByFlag(&#039;user1&#039;, &#039;myServer&#039;, false);"},{"id":165,"title":"ServerManage","pageTitle":"ServerManage","url":"utils\/ServerManage.html","content":"ServerManage\u7c7b\u540d\uff1aImi\\ServerManageimi \u652f\u6301\u670d\u52a1\u76d1\u542c\u591a\u4e2a\u7aef\u53e3\u3001\u591a\u4e2a\u534f\u8bae\uff0c\u8be5\u7c7b\u7528\u4e8e\u7ba1\u7406\u76d1\u542c\u7aef\u53e3\u7684\u670d\u52a1\u3002\u53ef\u7528\u65b9\u6cd5\/**\n * \u83b7\u53d6\u670d\u52a1\u5668\u6570\u7ec4\n * @return \\Imi\\Server\\Base[]\n *\/\npublic static function getServers();\n\n\/**\n * \u83b7\u53d6\u670d\u52a1\u5668\u5bf9\u8c61\n * @param string $name\n * @return \\Imi\\Server\\Base\n *\/\npublic static function getServer($name);$name \u53c2\u6570\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5b9a\u4e49\u7684\u670d\u52a1\u5668\u540d\u79f0\u3002\u5982\u679c\u662f\u4e3b\u670d\u52a1\uff0c\u5f3a\u5236\u4e3a\uff1amain\u83b7\u53d6 Swoole \u670d\u52a1\u5668\u5bf9\u8c61$swooleServer = ServerManage::getServer(&#039;main&#039;)-&gt;getSwooleServer();"},{"id":160,"title":"Swoole","pageTitle":"Swoole","url":"utils\/Swoole.html","content":"Swoole\u7c7b\u540d: Imi\\Util\\SwooleSwoole \u73af\u5883\u4e0b\u7684\u4e00\u4e9b\u5de5\u5177\u7c7b\u3002\u65b9\u6cd5getMasterPID\u83b7\u53d6master\u8fdb\u7a0bpidecho Swoole::getMasterPID();getManagerPID\u83b7\u53d6manager\u8fdb\u7a0bpidecho Swoole::getManagerPID();"},{"id":161,"title":"Text","pageTitle":"Text","url":"utils\/Text.html","content":"Text\u7c7b\u540d: Imi\\Util\\Text\u5b57\u7b26\u4e32\u5de5\u5177\u7c7b\u65b9\u6cd5startwith\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u5f00\u5934\/\/ true\nvar_dump(Text::startwith(&#039;http:\/\/www.baidu.com&#039;, &#039;http:\/\/&#039;));\n\n\/\/ false\nvar_dump(Text::startwith(&#039;http:\/\/www.baidu.com&#039;, &#039;https:\/\/&#039;));\n\n\/\/ \u4e0d\u533a\u5206\u5927\u5c0f\u5199-true\nvar_dump(Text::startwith(&#039;http:\/\/www.baidu.com&#039;, &#039;HTTP:\/\/&#039;, false));endwith\u5b57\u7b26\u4e32\u662f\u5426\u4ee5\u53e6\u4e00\u4e2a\u5b57\u7b26\u4e32\u7ed3\u5c3e\/\/ true\nvar_dump(Text::endwith(&#039;http:\/\/www.baidu.com\/index.html&#039;, &#039;.html&#039;));\n\n\/\/ false\nvar_dump(Text::endwith(&#039;http:\/\/www.baidu.com\/index.html&#039;, &#039;.htm&#039;));\n\n\/\/ \u4e0d\u533a\u5206\u5927\u5c0f\u5199-true\nvar_dump(Text::endwith(&#039;http:\/\/www.baidu.com\/index.html&#039;, &#039;.HTML&#039;));insert\u63d2\u5165\u5b57\u7b26\u4e32$str = &#039;abde&#039;;\n\/\/ abcde\necho Text::insert($str, 2, &#039;c&#039;), PHP_EOL;isEmpty\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u7a7a\u5b57\u7b26\u4e32\u6216\u8005\u4e3anull\/\/ true\nvar_dump(Text::isEmpty(&#039;&#039;));\n\n\/\/ true\nvar_dump(Text::isEmpty(null));\n\n\/\/ false\nvar_dump(Text::isEmpty(0));\n\n\/\/ false\nvar_dump(Text::isEmpty(&#039;0&#039;));toCamelName\u8f6c\u4e3a\u9a7c\u5cf0\u547d\u540d\uff0c\u4f1a\u628a\u4e0b\u5212\u7ebf\u540e\u5b57\u6bcd\u8f6c\u4e3a\u5927\u5199\/\/ adminUserAge\necho Text::toCamelName(&#039;admin_user_age&#039;), PHP_EOL;toPascalName\u8f6c\u4e3a\u6bcf\u4e2a\u5355\u8bcd\u5927\u5199\u7684\u547d\u540d\uff0c\u4f1a\u628a\u4e0b\u5212\u7ebf\u540e\u5b57\u6bcd\u8f6c\u4e3a\u5927\u5199\/\/ AdminUserAge\necho Text::toPascalName(&#039;admin_user_age&#039;), PHP_EOL;toUnderScoreCase\u8f6c\u4e3a\u4e0b\u5212\u7ebf\u547d\u540d\/\/ admin_user_age\necho Text::toUnderScoreCase(&#039;AdminUserAge&#039;), PHP_EOL;\n\n\/\/ Admin_User_Age\necho Text::toUnderScoreCase(&#039;AdminUserAge&#039;, false), PHP_EOL;"}];
var searchDatas = [];
function initSearchDatas()
{
    searchDatas = JSON.parse(JSON.stringify(originSearchDatas));
    for(var i = 0; i < searchDatas.length; ++i)
    {
        if(void 0 !== searchDatas[i].url)
        {
            searchDatas[i] = parseCatalogItem(searchDatas[i]);
        }
    }
    doSearch($('#search-keyword').val());
}

String.prototype.indexOf2 = function(f){
    var rt = this.match(eval('/' + f + '/i'));
    return (rt == null) ? -1 : rt.index;
}

function switchSearchNode(a)
{
    if ('pushState' in history)
    {
        getChapter(a.attr('href'));
        history.pushState('', '', a.attr('href'));
        $('#treeSearch a').removeClass('curSelectedNode');
        a.addClass('curSelectedNode');
    }
    else
    {
        location = treeNode.url;
    }
}

function searchArticle(keyword)
{
    var keywords = keyword.split(' ');
    var tSearchDatas = searchDatas;
    var result = [];
    keywords.forEach(function(kw){
        if('' === kw)
        {
            return;
        }
        result = [];
        tSearchDatas.forEach(function(item, index){
            if(item.content.indexOf2(kw) > -1 || item.title.indexOf2(kw) > -1)
            {
                result.push(item);
            }
        });
        tSearchDatas = result;
    });
    return result;
}

var searchTimer = null;
function parseSearch()
{
    $('#search-keyword').on('input', function(){
        if(null != searchTimer)
        {
            clearTimeout(searchTimer);
            searchTimer = null;
        }
        var inputKeyword = $(this);
        searchTimer = setTimeout(function(){
            doSearch(inputKeyword.val());
            searchTimer = null;
        }, 200);
        return false;
    });
}

function doSearch(keyword)
{
    var result = searchArticle(keyword);
    if(result.length > 0)
    {
        $('.searchResultNone').hide();
    }
    else
    {
        $('.searchResultNone').show();
    }
    var index = -1;
    $('#treeSearch a').each(function(i, item){
        ++index;
        if($(item).hasClass('curSelectedNode'))
        {
            return false;
        }
    });
    layui.laytpl($('#searchListTemplate').html()).render(result, function(html){
        $('#treeSearch').html(html);
        if(index >= 0)
        {
            var node = $('#treeSearch a').get(index);
            if(null !== node)
            {
                $(node).addClass('curSelectedNode');
            }
        }
    });
}

$(function(){

    $('body').on('click', '#treeSearch a', function(e){
        switchSearchNode($(this));
        return false;
    });

    parseSearch();

})